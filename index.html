<!doctype html>
<!-- Generated by akashic-cli-export-html@1.8.7. -->
<!-- Options: {"force":true,"strip":true,"minify":true,"atsumaru":true} -->
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>game</title>
<script>

	!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).engineFilesV3_6_7=t()}(function(){return function r(o,n,s){function a(e,t){if(!n[e]){if(!o[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(h)return h(e,!0);throw(t=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",t}i=n[e]={exports:{}},o[e][0].call(i.exports,function(t){return a(o[e][1][t]||t)},i,i.exports,r,o,n,s)}return n[e].exports}for(var h="function"==typeof require&&require,t=0;t<s.length;t++)a(s[t]);return a}({1:[function(t,e,i){var r,o,e=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}try{r="function"==typeof setTimeout?setTimeout:n}catch(t){r=n}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(t){o=s}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===n||!r)&&setTimeout)return(r=setTimeout)(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}var h,c=[],u=!1,l=-1;function d(){u&&h&&(u=!1,h.length?c=h.concat(c):l=-1,c.length&&p())}function p(){if(!u){for(var t=a(d),e=(u=!0,c.length);e;){for(h=c,c=[];++l<e;)h&&h[l].run();l=-1,e=c.length}h=null,u=!1,!function(e){if(o===clearTimeout)return clearTimeout(e);if((o===s||!o)&&clearTimeout)return(o=clearTimeout)(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function _(){}e.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new f(t,e)),1!==c.length||u||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=_,e.addListener=_,e.once=_,e.off=_,e.removeListener=_,e.removeAllListeners=_,e.emit=_,e.prependListener=_,e.prependOnceListener=_,e.listeners=function(t){return[]},e.binding=function(t){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(t){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],2:[function(t,e,i){e.exports=t("./lib/index")},{"./lib/index":86}],3:[function(t,e,i){"use strict";function r(t){this._assetManager=t}Object.defineProperty(i,"__esModule",{value:!0}),i.AssetAccessor=void 0,r.prototype.getImage=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"image")},r.prototype.getAudio=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"audio")},r.prototype.getScript=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"script")},r.prototype.getText=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"text")},r.prototype.getTextContent=function(t){return this.getText(t).data},r.prototype.getJSONContent=function(t){return JSON.parse(this.getTextContent(t))},r.prototype.getVectorImage=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"vector-image")},r.prototype.getAllImages=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","image")},r.prototype.getAllAudios=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","audio")},r.prototype.getAllScripts=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","script")},r.prototype.getAllTexts=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","text")},r.prototype.getAllVectorImages=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","vector-image")},r.prototype.getImageById=function(t){return this._assetManager.peekLiveAssetById(t,"image")},r.prototype.getAudioById=function(t){return this._assetManager.peekLiveAssetById(t,"audio")},r.prototype.getScriptById=function(t){return this._assetManager.peekLiveAssetById(t,"script")},r.prototype.getTextById=function(t){return this._assetManager.peekLiveAssetById(t,"text")},r.prototype.getTextContentById=function(t){return this.getTextById(t).data},r.prototype.getJSONContentById=function(t){return JSON.parse(this.getTextById(t).data)},r.prototype.getVectorImageById=function(t){return this._assetManager.peekLiveAssetById(t,"vector-image")},i.AssetAccessor=r},{}],4:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],5:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetHolder=void 0;var r=t("./ExceptionFactory");function o(t){var e=t.assetManager,i=t.assetIds?t.assetIds.concat():[];i.push.apply(i,e.resolvePatternsToAssetIds(t.assetPaths||[])),this.waitingAssetsCount=i.length,this.userData=t.userData,this._assetManager=e,this._assetIds=i,this._assets=[],this._handlerSet=t.handlerSet,this._requested=!1}o.prototype.request=function(){return 0!==this.waitingAssetsCount&&(this._requested||(this._requested=!0,this._assetManager.requestAssets(this._assetIds,this)),!0)},o.prototype.destroy=function(){this._requested&&this._assetManager.unrefAssets(this._assets),this.waitingAssetsCount=0,this.userData=void 0,this._handlerSet=void 0,this._assetIds=void 0,this._requested=!1},o.prototype.destroyed=function(){return!this._handlerSet},o.prototype._onAssetError=function(t,e){var i,r=this._handlerSet;this.destroyed()||r.owner.destroyed()||(r.handleLoadFailure.call(r.owner,i={asset:t,error:e,cancelRetry:!1}),e.retriable&&!i.cancelRetry?this._assetManager.retryLoad(t):this._assetManager.configuration[t.id]&&r.handleFinish.call(r.owner,this,!1))},o.prototype._onAssetLoad=function(t){var e=this._handlerSet;if(!(this.destroyed()||e.owner.destroyed()||(e.handleLoad.call(e.owner,t),this._assets.push(t),--this.waitingAssetsCount,0<this.waitingAssetsCount))){if(this.waitingAssetsCount<0)throw r.ExceptionFactory.createAssertionError("AssetHolder#_onAssetLoad: broken waitingAssetsCount");e.handleFinish.call(e.owner,this,!0)}},i.AssetHolder=o},{"./ExceptionFactory":28}],6:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],7:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetManager=void 0;var r=t("./auxiliary/EmptyGeneratedVectorImageAsset"),s=t("./auxiliary/EmptyVectorImageAsset"),a=t("./auxiliary/PartialImageAsset"),h=t("./ExceptionFactory"),c=t("./VideoSystem"),u=function(t,e){this.asset=t,this.handlers=[e],this.errorCount=0,this.loading=!1};function l(t){var e=/([^\*\\\?]*)(\\\*|\\\?|\?|\*(?!\*)|\*\*\/|$)/g,i={"":"","\\*":"\\*","\\?":"\\?","*":"[^/]*","?":"[^/]","**/":"(?:^/)?(?:[^/]+/)*"},r=/[\\^$.*+?()[\]{}|]/g;for(var o="",n=e.exec(t);n&&""!==n[0];n=e.exec(t))o+=n[1].replace(r,"\\$&")+i[n[2]];var s=new RegExp("^"+o+"$");return function(t){return s.test(t)}}function n(t,e,i,r){this._resourceFactory=t.resourceFactory,this._audioSystemManager=t.audio,this._defaultAudioSystemId=t.defaultAudioSystemId,this._audioSystemConfMap=function(t){void 0===t&&(t={});var e,i={music:{loop:!0,hint:{streaming:!0}},sound:{loop:!1,hint:{streaming:!1}}};for(e in i)e in t||(t[e]=i[e]);return t}(i),this.configuration=this._normalize(e||{}),this._assets={},this._virtualPathToIdTable={},this._liveAssetVirtualPathTable={},this._liveAssetPathTable={},this._moduleMainScripts=r||{},this._refCounts={},this._loadings={},this._generatedAssetCount=0;for(var o=Object.keys(this.configuration),n=0;n<o.length;++n){var s=o[n],a=this.configuration[s];this._virtualPathToIdTable[a.virtualPath]=s}}n.prototype.destroy=function(){for(var t=Object.keys(this._refCounts),e=0;e<t.length;++e)this._releaseAsset(t[e]);this.configuration=void 0,this._assets=void 0,this._liveAssetVirtualPathTable=void 0,this._liveAssetPathTable=void 0,this._refCounts=void 0,this._loadings=void 0},n.prototype.destroyed=function(){return void 0===this._assets},n.prototype.retryLoad=function(t){if(!this._loadings.hasOwnProperty(t.id))throw h.ExceptionFactory.createAssertionError("AssetManager#retryLoad: invalid argument.");var e=this._loadings[t.id];if(e.errorCount>n.MAX_ERROR_COUNT){if(this.configuration[t.id])throw h.ExceptionFactory.createAssertionError("AssetManager#retryLoad: too many retrying.")}else e.loading||(e.loading=!0,t._load(this))},n.prototype.globalAssetIds=function(){var t,e=[],i=this.configuration;for(t in i)i.hasOwnProperty(t)&&i[t].global&&e.push(t);return e},n.prototype.preloadScriptAssetIds=function(){return Object.entries(this.configuration).filter(function(t){t=t[1];return"script"===t.type&&t.global&&t.preload}).map(function(t){return t[0]})},n.prototype.resolvePatternsToAssetIds=function(t){if(0===t.length)return[];for(var e=Object.keys(this._virtualPathToIdTable),i=[],r=0;r<t.length;++r)for(var o=t[r],n="string"==typeof o?l(this._replaceModulePathToAbsolute(o)):o,s=0;s<e.length;++s){var a=e[s];n("/"+a)&&i.push(this._virtualPathToIdTable[a])}return i},n.prototype.requestAsset=function(t,e){"string"==typeof t?i=t:"uri"in t?(i=t.id,t=this._normalizeAssetBaseDeclaration(i,Object.create(t))):i=t.id;var i,r,o,n,s=!1;return this._assets.hasOwnProperty(i)?(++this._refCounts[i],e._onAssetLoad(this._assets[i])):this._loadings.hasOwnProperty(i)?((n=this._loadings[i]).handlers.push(e),++this._refCounts[i],s=!0):(r=null==(o=this._getAudioSystem(t))?void 0:o.getDestroyRequestedAsset(i),o&&r?(o.cancelRequestDestroy(r),this._addAssetToTables(r),this._refCounts[i]=1,e._onAssetLoad(r)):(o=this._createAssetFor(t),n=new u(o,e),this._loadings[i]=n,this._refCounts[i]=1,n.loading=s=!0,o._load(this))),s},n.prototype.unrefAsset=function(t){t="string"==typeof t?t:t.id;0<--this._refCounts[t]||this._releaseAsset(t)},n.prototype.requestAssets=function(t,e){for(var i=0,r=0,o=t.length;r<o;++r)this.requestAsset(t[r],e)&&++i;return i},n.prototype.unrefAssets=function(t){for(var e=0,i=t.length;e<i;++e)this.unrefAsset(t[e])},n.prototype.peekLiveAssetByAccessorPath=function(t,e){if("/"!==(t=this._replaceModulePathToAbsolute(t))[0])throw h.ExceptionFactory.createAssertionError("AssetManager#peekLiveAssetByAccessorPath(): accessorPath must start with '/'");var i=t.slice(1),i=this._liveAssetVirtualPathTable[i];if(i&&e===i.type)return i;throw h.ExceptionFactory.createAssertionError("AssetManager#peekLiveAssetByAccessorPath(): No ".concat(e," asset for ").concat(t))},n.prototype.peekLiveAssetById=function(t,e){var i=this._assets[t];if(i&&e===i.type)return i;throw h.ExceptionFactory.createAssertionError("SceneAssetManager#_getById(): No ".concat(e," asset for id ").concat(t))},n.prototype.peekAllLiveAssetsByPattern=function(t,e){for(var i=Object.keys(this._liveAssetVirtualPathTable),r="string"==typeof t?l(this._replaceModulePathToAbsolute(t)):t,o=[],n=0;n<i.length;++n){var s=i[n],a=this._liveAssetVirtualPathTable[s];e&&a.type!==e||r("/"+s)&&o.push(a)}return o},n.prototype._normalize=function(t){var e,i={};if(!(t instanceof Object))throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: invalid arguments.");for(e in t)if(t.hasOwnProperty(e)){var r=this._normalizeAssetBaseDeclaration(e,Object.create(t[e]));if(!r.path)throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: No path given for: "+e);if(!r.virtualPath)throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: No virtualPath given for: "+e);r.global||(r.global=!1),i[e]=r}return i},n.prototype._normalizeAssetBaseDeclaration=function(t,e){if(!e.type)throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: No type given for: "+t);if("image"===e.type){if("number"!=typeof e.width)throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the image asset: "+t);if("number"!=typeof e.height)throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the image asset: "+t);e.slice=e.slice?(i=e.slice,Array.isArray(i)?{x:i[0],y:i[1],width:i[2],height:i[3]}:i):void 0}if("audio"===e.type){void 0===e.duration&&(e.duration=0);var i=this._audioSystemConfMap[e.systemId];if(void 0===e.loop&&(e.loop=!!i&&!!i.loop),void 0===e.hint&&(e.hint=i?i.hint:{}),"music"!==e.systemId&&"sound"!==e.systemId)throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong systemId given for the audio asset: "+t)}if("video"===e.type&&!e.useRealSize){if("number"!=typeof e.width)throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the video asset: "+t);if("number"!=typeof e.height)throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the video asset: "+t);e.useRealSize=!1}if("vector-image"===e.type){if("number"!=typeof e.width)throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the vector-image asset: "+t);if("number"!=typeof e.height)throw h.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the vector-image asset: "+t)}return e},n.prototype._createAssetFor=function(t){var e,i,r;if("string"==typeof t)r=this.configuration[e=t],i=this.configuration[e].path;else{if(!("uri"in t))return this._createGeneratedAssetFor(t);e=t.id,i=(r=t).uri}var o=this._resourceFactory;if(!r)throw h.ExceptionFactory.createAssertionError("AssetManager#_createAssetFor: unknown asset ID: "+e);switch(r.type){case"image":var n=r.slice?new a.PartialImageAsset(o,e,i,r.width,r.height,r.slice):o.createImageAsset(e,i,r.width,r.height);return n.initialize(r.hint),n;case"audio":n=r.systemId?this._audioSystemManager[r.systemId]:this._audioSystemManager[this._defaultAudioSystemId];return o.createAudioAsset(e,i,r.duration,n,!!r.loop,r.hint,r.offset);case"text":return o.createTextAsset(e,i);case"script":return o.createScriptAsset(e,i);case"video":n=new c.VideoSystem;return o.createVideoAsset(e,i,r.width,r.height,n,!!r.loop,!!r.useRealSize);case"vector-image":return o.createVectorImageAsset?o.createVectorImageAsset(e,i,r.width,r.height,r.hint):new s.EmptyVectorImageAsset(e,i,r.width,r.height,r.hint);default:throw h.ExceptionFactory.createAssertionError("AssertionError#_createAssetFor: unknown asset type "+r.type+" for asset ID: "+e)}},n.prototype._createGeneratedAssetFor=function(t){var e=this._resourceFactory,i="%akashic%/generated-asset-".concat(this._generatedAssetCount++);if("vector-image"!==t.type)throw h.ExceptionFactory.createAssertionError("AssertionError#_createFromAssetGenerationFor: unsupported asset type ".concat(t.type," for asset ID: ").concat(t.id));return e.createVectorImageAssetFromString?e.createVectorImageAssetFromString(t.id,i,t.data):new r.EmptyGeneratedVectorImageAsset(t.id,i,t.data)},n.prototype._releaseAsset=function(t){var e=this._assets[t]||this._loadings[t]&&this._loadings[t].asset,i=null;if(e)if(i=e.path,e.inUse())if("audio"===e.type)e._system.requestDestroy(e);else{if("video"!==e.type)throw h.ExceptionFactory.createAssertionError("AssetManager#unrefAssets: Unsupported in-use "+e.id);e.destroy()}else e.destroy();delete this._refCounts[t],delete this._loadings[t],delete this._assets[t],this.configuration[t]&&((e=this.configuration[t].virtualPath)&&this._liveAssetVirtualPathTable.hasOwnProperty(e)&&delete this._liveAssetVirtualPathTable[e],i&&this._liveAssetPathTable.hasOwnProperty(i)&&delete this._liveAssetPathTable[i])},n.prototype._countLoadingAsset=function(){return Object.keys(this._loadings).length},n.prototype._onAssetError=function(t,e){if(!this.destroyed()&&!t.destroyed()){var i=this._loadings[t.id],r=i.handlers;i.loading=!1,++i.errorCount,(e=i.errorCount>n.MAX_ERROR_COUNT&&e.retriable?h.ExceptionFactory.createAssetLoadError("Retry limit exceeded",!1,null,e):e).retriable||delete this._loadings[t.id];for(var o=0;o<r.length;++o)r[o]._onAssetError(t,e,this.retryLoad.bind(this))}},n.prototype._onAssetLoad=function(t){if(!this.destroyed()&&!t.destroyed())for(var e=this._loadings[t.id],i=(e.loading=!1,delete this._loadings[t.id],this._addAssetToTables(t),e.handlers),r=0;r<i.length;++r)i[r]._onAssetLoad(t)},n.prototype._replaceModulePathToAbsolute=function(t){if("/"!==t[0]&&"*"!==t[0])for(var e in this._moduleMainScripts)if(this._moduleMainScripts.hasOwnProperty(e)&&0===t.lastIndexOf(e,0))return"/node_modules/"+t;return t},n.prototype._getAudioSystem=function(t){var e=null;return"string"==typeof t?e=this.configuration[t]:"uri"in t&&(e=t),!e||"audio"!==e.type?null:e.systemId?this._audioSystemManager[e.systemId]:this._audioSystemManager[this._defaultAudioSystemId]},n.prototype._addAssetToTables=function(t){if(this._assets[t.id]=t,this.configuration[t.id]){var e=this.configuration[t.id].virtualPath;if(this._liveAssetVirtualPathTable.hasOwnProperty(e)){if(this._liveAssetVirtualPathTable[e].path!==t.path)throw h.ExceptionFactory.createAssertionError("AssetManager#_onAssetLoad(): duplicated asset path")}else this._liveAssetVirtualPathTable[e]=t;this._liveAssetPathTable.hasOwnProperty(t.path)||(this._liveAssetPathTable[t.path]=e)}},n.MAX_ERROR_COUNT=3,i.AssetManager=n},{"./ExceptionFactory":28,"./VideoSystem":70,"./auxiliary/EmptyGeneratedVectorImageAsset":74,"./auxiliary/EmptyVectorImageAsset":75,"./auxiliary/PartialImageAsset":76}],8:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],9:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AudioPlayContext=void 0;var r=t("@akashic/trigger");function o(t){var e;this.onPlay=new r.Trigger,this.onStop=new r.Trigger,this.asset=t.asset,this._system=t.system,this._resourceFactory=t.resourceFactory,this._volume=null!=(e=t.volume)?e:1,this._id=t.id,this._systemId=t.systemId,this._player=this._createAudioPlayer(),this.asset.onDestroyed.addOnce(this.stop,this)}Object.defineProperty(o.prototype,"volume",{get:function(){return this._volume},enumerable:!1,configurable:!0}),o.prototype.play=function(){this._player.play(this.asset)},o.prototype.stop=function(){this._player.stop()},o.prototype.changeVolume=function(t){this._volume=t,this._player.changeVolume(t)},o.prototype._startSuppress=function(){"music"===this._systemId?this._player.changeVolume(0):this.stop()},o.prototype._endSuppress=function(){"music"===this._systemId&&this._player.changeVolume(this._volume)},o.prototype._createAudioPlayer=function(){var t=this._resourceFactory.createAudioPlayer(this._system);return t.changeVolume(this._volume),t.onPlay.add(this.onPlay.fire,this.onPlay),t.onStop.add(this.onStop.fire,this.onStop),t},i.AudioPlayContext=o},{"@akashic/trigger":225}],10:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=(Object.defineProperty(i,"__esModule",{value:!0}),i.SoundAudioSystem=i.MusicAudioSystem=i.AudioSystem=void 0,t("./AudioPlayContext")),s=t("./ExceptionFactory"),a=t("./WeakRefKVS"),t=(Object.defineProperty(h.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t<0||1<t||isNaN(t)||"number"!=typeof t)throw s.ExceptionFactory.createAssertionError("AudioSystem#volume: expected: 0.0-1.0, actual: "+t);this._volume=t,this._onVolumeChanged()},enumerable:!1,configurable:!0}),h.prototype.play=function(t){t=this.create(t);return t.play(),t},h.prototype.create=function(t){t=new n.AudioPlayContext({id:this._generateAudioPlayContextId(),resourceFactory:this._resourceFactory,asset:t,system:this,systemId:this.id,volume:1});return this._contextCount%this._contentMapCleaningFrequency==0&&this._contextMap.clean(),this._contextMap.set(t._id,t),t},h.prototype.stopAll=function(){for(var t=0,e=this._contextMap.keys();t<e.length;t++){var i=e[t],i=this._contextMap.get(i);null!=i&&i.stop()}this._contextMap.clean()},h.prototype.requestDestroy=function(t){this._destroyRequestedAssets[t.id]=t},h.prototype.cancelRequestDestroy=function(t){delete this._destroyRequestedAssets[t.id]},h.prototype.getDestroyRequestedAsset=function(t){return this._destroyRequestedAssets.hasOwnProperty(t)?this._destroyRequestedAssets[t]:null},h.prototype._reset=function(){this.stopAll(),this._volume=1,this._destroyRequestedAssets={},this._muted=!1,this._suppressed=!1,this._explicitMuted=!1},h.prototype._setMuted=function(t){var e=this._explicitMuted;this._explicitMuted=!!t,this._explicitMuted!==e&&(this._updateMuted(),this._onMutedChanged())},h.prototype._setPlaybackRate=function(t){if(t<0||isNaN(t)||"number"!=typeof t)throw s.ExceptionFactory.createAssertionError("AudioSystem#playbackRate: expected: greater or equal to 0.0, actual: "+t);this._suppressed=1!==t,this._updateMuted(),this._onPlaybackRateChanged()},h.prototype._updateMuted=function(){this._muted=this._explicitMuted||this._suppressed},h.prototype._generateAudioPlayContextId=function(){return"".concat(this.id,"-").concat(this._contextCount++)},h.prototype._startSuppress=function(){this._setPlaybackRate(100);for(var t=0,e=this._contextMap.keys();t<e.length;t++){var i=e[t],i=this._contextMap.get(i);null!=i&&i._startSuppress()}},h.prototype._endSuppress=function(){this._setPlaybackRate(1);for(var t=0,e=this._contextMap.keys();t<e.length;t++){var i=e[t],i=this._contextMap.get(i);null!=i&&i._endSuppress()}},h);function h(t){this.id=t.id,this._volume=t.volume||1,this._destroyRequestedAssets={},this._explicitMuted=t.muted||!1,this._suppressed=!1,this._muted=!1,this._contextMap=new a.WeakRefKVS,this._contextCount=0,this._resourceFactory=t.resourceFactory,this._updateMuted()}i.AudioSystem=t;o(l,c=t),Object.defineProperty(l.prototype,"player",{get:function(){return this._player||(this._player=this._resourceFactory.createAudioPlayer(this),this._player.onPlay.add(this._handlePlay,this),this._player.onStop.add(this._handleStop,this)),this._player},set:function(t){this._player=t},enumerable:!1,configurable:!0}),l.prototype.findPlayers=function(t){return this.player.currentAudio&&this.player.currentAudio.id===t.id?[this.player]:[]},l.prototype.createPlayer=function(){return this.player},l.prototype.stopAll=function(){c.prototype.stopAll.call(this),this._player&&this._player.stop()},l.prototype._reset=function(){c.prototype._reset.call(this),this._player&&(this._player.onPlay.remove(this._handlePlay,this),this._player.onStop.remove(this._handleStop,this)),this._player=void 0},l.prototype._onVolumeChanged=function(){this.player._notifyVolumeChanged()},l.prototype._onMutedChanged=function(){this.player._changeMuted(this._muted)},l.prototype._onPlaybackRateChanged=function(){this.player._changeMuted(this._muted)},l.prototype._handlePlay=function(t){if(t.player!==this._player)throw s.ExceptionFactory.createAssertionError("MusicAudioSystem#_onPlayerPlayed: unexpected audio player")},l.prototype._handleStop=function(t){this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy())};var c,u=l;function l(t){t=c.call(this,t)||this;return t._contentMapCleaningFrequency=5,t._player=void 0,t}i.MusicAudioSystem=u;o(p,d=t),p.prototype.createPlayer=function(){var t=this._resourceFactory.createAudioPlayer(this);return t.canHandleStopped()&&this.players.push(t),t.onPlay.add(this._handlePlay,this),t.onStop.add(this._handleStop,this),t},p.prototype.findPlayers=function(t){for(var e=[],i=0;i<this.players.length;++i){var r=this.players[i].currentAudio;r&&r.id===t.id&&e.push(this.players[i])}return e},p.prototype.stopAll=function(){d.prototype.stopAll.call(this);for(var t=this.players.concat(),e=0;e<t.length;++e)t[e].stop()},p.prototype._reset=function(){d.prototype._reset.call(this);for(var t=0;t<this.players.length;++t){var e=this.players[t];e.onPlay.remove(this._handlePlay,this),e.onStop.remove(this._handleStop,this)}this.players=[]},p.prototype._onMutedChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changeMuted(this._muted)},p.prototype._onPlaybackRateChanged=function(){var t=this.players;if(this._suppressed)for(var e=0;e<t.length;++e)t[e]._changeMuted(!0)},p.prototype._handlePlay=function(t){},p.prototype._handleStop=function(t){var e=this.players.indexOf(t.player);e<0||(t.player.onStop.remove(this._handleStop,this),this.players.splice(e,1),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy()))},p.prototype._onVolumeChanged=function(){for(var t=0;t<this.players.length;++t)this.players[t]._notifyVolumeChanged()};var d,u=p;function p(t){t=d.call(this,t)||this;return t._contentMapCleaningFrequency=50,t.players=[],t}i.SoundAudioSystem=u},{"./AudioPlayContext":9,"./ExceptionFactory":28,"./WeakRefKVS":71}],11:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AudioSystemManager=void 0;var r=t("./AudioSystem"),o=t("./ExceptionFactory");function n(t){this._muted=!1,this._resourceFactory=t,this.music=new r.MusicAudioSystem({id:"music",muted:this._muted,resourceFactory:t}),this.sound=new r.SoundAudioSystem({id:"sound",muted:this._muted,resourceFactory:t})}n.prototype.create=function(t){if("music"===t._system.id)return this.music.create(t);if("sound"===t._system.id)return this.sound.create(t);throw o.ExceptionFactory.createAssertionError('AudioSystemManager#create(): unknown systemId "'.concat(t._system.id,'" for asset ID "').concat(t.id,'"'))},n.prototype.play=function(t){if("music"===t._system.id)return this.music.play(t);if("sound"===t._system.id)return this.sound.play(t);throw o.ExceptionFactory.createAssertionError('AudioSystemManager#play(): unknown systemId "'.concat(t._system.id,'" for asset ID "').concat(t.id,'"'))},n.prototype._reset=function(){this._muted=!1,this.music._reset(),this.sound._reset()},n.prototype._setMuted=function(t){this._muted!==t&&(this._muted=t,this.music._setMuted(t),this.sound._setMuted(t))},n.prototype._setPlaybackRate=function(t){this.music._setPlaybackRate(t),this.sound._setPlaybackRate(t)},n.prototype._startSuppress=function(){this.music._startSuppress(),this.sound._startSuppress()},n.prototype._endSuppress=function(){this.music._endSuppress(),this.sound._endSuppress()},n.prototype.stopAll=function(){this.music.stopAll(),this.sound.stopAll()},i.AudioSystemManager=n},{"./AudioSystem":10,"./ExceptionFactory":28}],12:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AudioUtil=void 0;var u=t("./Util"),l=function(t,e,i,r){return i*t/r+e};function h(t,e,i,r,o){void 0===r&&(r=1),void 0===o&&(o=l),e.changeVolume(0),e.play();var t=a(t,e,i,r,o),n=t.complete,s=t.cancel;return{complete:function(){n()},cancel:function(t){s(t=void 0===t?!1:t),t&&e.stop()}}}function c(t,e,i,r){var t=a(t,e,i,0,r=void 0===r?l:r),o=t.complete,n=t.cancel;return{complete:function(){o(),e.stop()},cancel:function(t){n(t=void 0===t?!1:t)}}}function a(t,e,i,r,o){void 0===o&&(o=l);function n(){var t;return(c+=a)<=i?(t=o(c,h,r-h,i),e.changeVolume(u.Util.clamp(t,0,1)),!1):(e.changeVolume(r),!0)}function s(){t.onUpdate.contains(n)&&t.onUpdate.remove(n)}var a=1e3/t.fps,h=e.volume,c=0;e.changeVolume(u.Util.clamp(h,0,1));return t.onUpdate.add(n),{complete:function(){s(),e.changeVolume(r)},cancel:function(t){s(),t&&e.changeVolume(h)}}}(t=i.AudioUtil||(i.AudioUtil={})).fadeIn=h,t.fadeOut=c,t.crossFade=function(t,e,i,r,o,n){var s=h(t,e,r,o=void 0===o?1:o,n=void 0===n?l:n),a=c(t,i,r,n);return{complete:function(){s.complete(),a.complete()},cancel:function(t){s.cancel(t=void 0===t?!1:t),a.cancel(t)}}},t.transitionVolume=a},{"./Util":69}],13:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.BitmapFont=void 0,t("./Font")),a=t("./SurfaceUtil"),t=(o=s.Font,n(h,o),h.prototype.glyphForCharacter=function(t){var e,i,r,o,n,s,a=this.map[t]||this.missingGlyph;return a?(e=void 0===a.width?this.defaultGlyphWidth:a.width,i=void 0===a.height?this.defaultGlyphHeight:a.height,r=a.offsetX||0,o=a.offsetY||0,n=void 0===a.advanceWidth?e:a.advanceWidth,s=0===e||0===i?void 0:this.surface,{code:t,x:a.x,y:a.y,width:e,height:i,surface:s,offsetX:r,offsetY:o,advanceWidth:n,isSurfaceValid:!0,_atlas:null}):null},h.prototype.destroy=function(){this.surface&&!this.surface.destroyed()&&this.surface.destroy(),this.map=void 0},h.prototype.destroyed=function(){return!this.map},h);function h(t){var e=o.call(this)||this;return e.surface=a.SurfaceUtil.asSurface(t.src),t.glyphInfo?(e.map=t.glyphInfo.map,e.defaultGlyphWidth=t.glyphInfo.width,e.defaultGlyphHeight=t.glyphInfo.height,e.missingGlyph=t.glyphInfo.missingGlyph,e.size=t.glyphInfo.height):(e.map=t.map||{},e.defaultGlyphWidth=t.defaultGlyphWidth||0,e.defaultGlyphHeight=t.defaultGlyphHeight||0,e.missingGlyph=t.missingGlyph,e.size=t.defaultGlyphHeight||0),e}i.BitmapFont=t},{"./Font":29,"./SurfaceUtil":62}],14:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],15:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.Camera2D=void 0,t("./Object2D")),t=(o=t.Object2D,n(s,o),s.deserialize=function(t){return new s(t.param)},s.prototype.modified=function(){this._modifiedCount=(this._modifiedCount+1)%32768,this._matrix&&(this._matrix._modified=!0)},s.prototype.serialize=function(){return{param:{local:this.local,name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,opacity:this.opacity,scaleX:this.scaleX,scaleY:this.scaleY,angle:this.angle,anchorX:this.anchorX,anchorY:this.anchorY,compositeOperation:this.compositeOperation}}},s.prototype._applyTransformToRenderer=function(t){this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(-this.x,-this.y),1!==this.opacity&&t.opacity(this.opacity)},s.prototype._updateMatrix=function(){this._matrix&&(this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?this._matrix.updateByInverse(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this._matrix.reset(-this.x,-this.y))},s);function s(t){var e=o.call(this,t)||this;return e.local=!!t.local,e.name=t.name,e._modifiedCount=0,e}i.Camera2D=t},{"./Object2D":40}],16:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Collision=void 0;var d,n=t("./Util");function p(t,e){return t.x*e.y-t.y*e.x}function f(t,e){return{x:t.x-e.x,y:t.y-e.y}}(d=i.Collision||(i.Collision={})).intersectEntities=function(t,e,i,r){var o,n,s,a,h,c,u,l=t._findLowestCommonAncestorWith(e);return!!l&&(i=i?{left:i.x,top:i.y,right:i.x+i.width,bottom:i.y+i.height}:{left:0,top:0,right:t.width,bottom:t.height},r=r?{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height}:{left:0,top:0,right:e.width,bottom:e.height},t=t._calculateMatrixTo(l),e=e._calculateMatrixTo(l),l=t.multiplyPoint({x:i.left,y:i.top}),o=t.multiplyPoint({x:i.right,y:i.top}),n=t.multiplyPoint({x:i.left,y:i.bottom}),t=t.multiplyPoint({x:i.right,y:i.bottom}),i=e.multiplyPoint({x:r.left,y:r.top}),s=e.multiplyPoint({x:r.right,y:r.top}),a=e.multiplyPoint({x:r.left,y:r.bottom}),e=e.multiplyPoint({x:r.right,y:r.bottom}),r=Math.min(l.x,o.x,n.x,t.x),h=Math.max(l.x,o.x,n.x,t.x),c=Math.min(i.x,s.x,a.x,e.x),u=Math.max(i.x,s.x,a.x,e.x),!(h<c||u<r)&&(h=Math.min(l.y,o.y,n.y,t.y),c=Math.max(l.y,o.y,n.y,t.y),u=Math.min(i.y,s.y,a.y,e.y),r=Math.max(i.y,s.y,a.y,e.y),!(c<u||r<h)&&(!!(d.intersectLineSegments(l,o,i,s)||d.intersectLineSegments(l,o,s,e)||d.intersectLineSegments(l,o,e,a)||d.intersectLineSegments(l,o,a,i)||d.intersectLineSegments(o,t,i,s)||d.intersectLineSegments(o,t,s,e)||d.intersectLineSegments(o,t,e,a)||d.intersectLineSegments(o,t,a,i)||d.intersectLineSegments(t,n,i,s)||d.intersectLineSegments(t,n,s,e)||d.intersectLineSegments(t,n,e,a)||d.intersectLineSegments(t,n,a,i)||d.intersectLineSegments(n,l,i,s)||d.intersectLineSegments(n,l,s,e)||d.intersectLineSegments(n,l,e,a)||d.intersectLineSegments(n,l,a,i))||(0<=(c=p(f(l,o),f(i,o)))*p(f(n,l),f(i,l))&&0<=c*p(f(t,n),f(i,n))&&0<=c*p(f(o,t),f(i,t))||0<=(u=p(f(i,s),f(l,s)))*p(f(a,i),f(l,i))&&0<=u*p(f(e,a),f(l,a))&&0<=u*p(f(s,e),f(l,e))))))},d.intersectLineSegments=function(t,e,i,r){var o=f(e,t),n=f(r,i);return p(f(i,t),o)*p(f(r,t),o)<=0&&p(f(t,i),n)*p(f(e,i),n)<=0},d.intersect=function(t,e,i,r,o,n,s,a){return t<=o+s&&o<=t+i&&e<=n+a&&n<=e+r},d.intersectAreas=function(t,e){return d.intersect(t.x,t.y,t.width,t.height,e.x,e.y,e.width,e.height)},d.within=function(t,e,i,r,o){return(o=void 0===o?1:o)>=n.Util.distance(t,e,i,r)},d.withinAreas=function(t,e,i){return(i=void 0===i?1:i)>=n.Util.distanceBetweenAreas(t,e)}},{"./Util":69}],17:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.DefaultLoadingScene=void 0,t("./entities/CameraCancellingE")),a=t("./entities/FilledRect"),t=t("./LoadingScene"),t=(o=t.LoadingScene,n(h,o),h.prototype._handleLoad=function(){var t,e,i;return i="compact"===this._style?(e=.05*Math.min(this.game.width,this.game.height),t=this.game.width-e-this._barWidth,e=this.game.height-e-this._barHeight,"transparent"):(t=(this.game.width-this._barWidth)/2,e=(this.game.height-this._barHeight)/2,"rgba(0, 0, 0, 0.8)"),this.append(new s.CameraCancellingE({scene:this,children:[new a.FilledRect({scene:this,width:this.game.width,height:this.game.height,cssColor:i,children:[new a.FilledRect({scene:this,x:t,y:e,width:this._barWidth,height:this._barHeight,cssColor:"gray",children:[i=new a.FilledRect({scene:this,width:0,height:this._barHeight,cssColor:"white"})]})]})]})),i.onUpdate.add(this._handleUpdate,this),this._gauge=i,!0},h.prototype._handleUpdate=function(){++this._gaugeUpdateCount;var t=Math.round(205+50*Math.sin(this._gaugeUpdateCount/this.game.fps*(2/3)*(2*Math.PI)));this._gauge.cssColor="rgb("+t+","+t+","+t+")",this._gauge.modified()},h.prototype._handleTargetReset=function(t){this._gauge&&(this._gauge.width=0,this._gauge.modified()),this._totalWaitingAssetCount=t._sceneAssetHolder.waitingAssetsCount},h.prototype._handleTargetAssetLoad=function(t){var e=this._targetScene._sceneAssetHolder.waitingAssetsCount;this._gauge.width=Math.ceil((1-e/this._totalWaitingAssetCount)*this._barWidth),this._gauge.modified()},h);function h(t){var e=o.call(this,{game:t.game,name:"akashic:default-loading-scene"})||this;return"compact"===t.style?(e._barWidth=e.game.width/4,e._barHeight=5,e._style="compact"):(e._barWidth=Math.min(e.game.width,Math.max(100,e.game.width/2)),e._barHeight=5,e._style="default"),e._gauge=void 0,e._gaugeUpdateCount=0,e._totalWaitingAssetCount=0,e.onLoad.add(e._handleLoad,e),e.onTargetReset.add(e._handleTargetReset,e),e.onTargetAssetLoad.add(e._handleTargetAssetLoad,e),e}i.DefaultLoadingScene=t},{"./LoadingScene":34,"./entities/CameraCancellingE":78,"./entities/FilledRect":80}],18:[function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),l=(Object.defineProperty(i,"__esModule",{value:!0}),i.DefaultSkippingScene=void 0,t("./entities/CameraCancellingE")),n=t("./entities/FilledRect"),t=t("./Scene");function d(t,e,i,r){var o,n,r=.15*r;return 0<t&&t<r?(t=t,o=e,n=i,(t/=r/2)<1?n/2*t*t+o:-n/2*(--t*(t-2)-1)+o):e+i}s=n.FilledRect,o(a,s),a.prototype._incrementAge=function(){this.age++},a.prototype._updateColor=function(){var t=this._calculateCSSColor();this.cssColor!==t&&(this.cssColor=t,this.modified())},a.prototype._calculateCSSColor=function(){var t=this,e=t.age,i=t.offsetDurationFrame,r=t.easingDurationFrame,o=t.valueFrom,n=t.valueTo,t=(0,t.easing)(Math.max(e-i,0)%r,o,n-o,r);return"rgb(".concat(t,", ").concat(t,", ").concat(t,")")};var s,p=a;function a(t){var e=s.call(this,t)||this;return e.age=0,e.offsetDurationFrame=t.offsetDurationFrame,e.easingDurationFrame=t.easingDurationFrame,e.valueFrom=t.valueFrom,e.valueTo=t.valueTo,e.easing=t.easing,e.onUpdate.add(e._incrementAge,e),e.onUpdate.add(e._updateColor,e),e}h=t.Scene,o(c,h),c.prototype._handleLoadForIndicator=function(){var i=this,r=this.game,o=.03*Math.min(r.width,r.height)|0,n=.03*Math.min(r.width,r.height)|0,s=.05*Math.min(r.width,r.height)|0,a=.05*Math.min(r.width,r.height)|0,h=400/(1e3/r.fps),c=2500/(1e3/r.fps),u=d;this.append(new l.CameraCancellingE({scene:this,children:[3,2,1,0].map(function(t,e){return new p({scene:i,cssColor:"rgb(".concat(255,", ").concat(255,", ").concat(255,")"),width:o,height:o,x:r.width-e*(o+n)-s,y:r.height-a,anchorX:1,anchorY:1,offsetDurationFrame:h*t,easingDurationFrame:c,valueFrom:205,valueTo:255,easing:u})})}))};var h,n=c;function c(t){var e=h.call(this,{game:t.game,local:"full-local",name:"akashic:default-skipping-scene"})||this;return"indicator"===t.style&&e.onLoad.addOnce(e._handleLoadForIndicator,e),e}i.DefaultSkippingScene=n},{"./Scene":52,"./entities/CameraCancellingE":78,"./entities/FilledRect":80}],19:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],20:[function(t,e,i){"use strict";var r,l,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),d=(Object.defineProperty(i,"__esModule",{value:!0}),i.DynamicFont=void 0,t("@akashic/pdi-types")),a=t("./BitmapFont"),n=t("./Font"),p=t("./SurfaceAtlasSet"),f=t("./Util"),t=(l=n.Font,o(s,l),s.prototype.glyphForCharacter=function(t){var e=this._glyphs[t];if(!e||!e.isSurfaceValid){if((e=this._glyphFactory.create(t)).surface&&!this._atlasSet.addGlyph(e))return null;this._glyphs[t]=e}return this._atlasSet.touchGlyph(e),e},s.prototype.asBitmapFont=function(t){var i,e,r,o,n,s=this;return 1!==this._atlasSet.getAtlasNum()?null:(e=null,t&&(e=f.Util.charCodeAt(t,0),this.glyphForCharacter(e)),i={},Object.keys(this._glyphs).forEach(function(t){var t=Number(t),e=s._glyphs[t],e={x:e.x,y:e.y,width:e.width,height:e.height,offsetX:e.offsetX,offsetY:e.offsetY,advanceWidth:e.advanceWidth};i[t]=e}),t=i[e],r=(e=this._atlasSet.getAtlas(0)).getAtlasUsedSize(),(n=(o=this._resourceFactory.createSurface(r.width,r.height)).renderer()).begin(),n.drawImage(e._surface,0,0,r.width,r.height,0,0),n.end(),new a.BitmapFont({src:o,map:i,defaultGlyphWidth:0,defaultGlyphHeight:this.size,missingGlyph:t}))},s.prototype.destroy=function(){this._isSurfaceAtlasSetOwner&&this._atlasSet.destroy(),this._glyphs=void 0,this._glyphFactory=void 0,this._destroyed=!0},s.prototype.destroyed=function(){return this._destroyed},s);function s(t){var e,i=l.call(this)||this,r=(i.fontFamily=t.fontFamily,i.size=t.size,i.hint=null!=t.hint?t.hint:{},i.fontColor=null!=t.fontColor?t.fontColor:"black",i.fontWeight=null!=t.fontWeight?t.fontWeight:d.FontWeight.Normal,i.strokeWidth=null!=t.strokeWidth?t.strokeWidth:0,i.strokeColor=null!=t.strokeColor?t.strokeColor:"black",i.strokeOnly=null!=t.strokeOnly&&t.strokeOnly,t.game),o=(i._resourceFactory=r.resourceFactory,i.fontFamily);if("string"==typeof o)e=o;else{if(Array.isArray(o))for(var n=[],s=0;s<o.length;++s){var a=o[s];n.push("string"==typeof a?a:f.Util.enumToSnakeCase(d.FontFamily,a))}else(n=[]).push("string"==typeof o?o:f.Util.enumToSnakeCase(d.FontFamily,o));e=n}var h=i.fontWeight,h="string"==typeof h?h:f.Util.enumToSnakeCase(d.FontWeight,h);if(i._glyphFactory=i._resourceFactory.createGlyphFactory(e,i.size,i.hint.baselineHeight,i.fontColor,i.strokeWidth,i.strokeColor,i.strokeOnly,h),i._glyphs={},i._destroyed=!1,i._isSurfaceAtlasSetOwner=!1,t.surfaceAtlasSet?i._atlasSet=t.surfaceAtlasSet:t.hint?(i._isSurfaceAtlasSetOwner=!0,i._atlasSet=new p.SurfaceAtlasSet({resourceFactory:r.resourceFactory,hint:i.hint})):i._atlasSet=r.surfaceAtlasSet,i.hint.presetChars)for(var s=0,c=i.hint.presetChars.length;s<c;s++){var u=f.Util.charCodeAt(i.hint.presetChars,s);u&&i.glyphForCharacter(u)}return i}i.DynamicFont=t},{"./BitmapFont":13,"./Font":29,"./SurfaceAtlasSet":59,"./Util":69,"@akashic/pdi-types":205}],21:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],22:[function(t,e,i){"use strict";function r(t,e,i,r,o,n){this.eventFlags=n,this.local=!!o,this.player=r,this.pointerId=t,this.target=e,this.point=i}var o,n,s=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),a=(Object.defineProperty(i,"__esModule",{value:!0}),i.SeedEvent=i.PlayerInfoEvent=i.TimestampEvent=i.LeaveEvent=i.JoinEvent=i.OperationEvent=i.MessageEvent=i.PointMoveEventBase=i.PointUpEventBase=i.PointDownEventBase=i.PointEventBase=void 0,i.PointEventBase=r,s(h,n=r),h);function h(){var t=null!==n&&n.apply(this,arguments)||this;return t.type="point-down",t}i.PointDownEventBase=a;s(u,c=r);var c,a=u;function u(t,e,i,r,o,n,s,a){t=c.call(this,t,e,i,n,s,a)||this;return t.type="point-up",t.prevDelta=r,t.startDelta=o,t}i.PointUpEventBase=a;s(d,l=r);var l,a=d;function d(t,e,i,r,o,n,s,a){t=l.call(this,t,e,i,n,s,a)||this;return t.type="point-move",t.prevDelta=r,t.startDelta=o,t}i.PointMoveEventBase=a;function p(t,e,i,r,o){this.type="operation",this.eventFlags=o,this.local=!!r,this.player=i,this.code=t,this.data=e}function f(t,e,i){this.type="join",this.eventFlags=i,this.player=t,this.storageValues=e}function _(t,e){this.type="leave",this.eventFlags=e,this.player=t}function g(t,e,i){this.type="timestamp",this.eventFlags=i,this.player=e,this.timestamp=t}function y(t,e){this.type="player-info",this.eventFlags=e,this.player=t}function m(t,e){this.type="seed",this.eventFlags=e,this.generator=t}i.MessageEvent=function(t,e,i,r){this.type="message",this.eventFlags=r,this.local=!!i,this.player=e,this.data=t},i.OperationEvent=p,i.JoinEvent=f,i.LeaveEvent=_,i.TimestampEvent=g,i.PlayerInfoEvent=y;i.SeedEvent=m},{}],23:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.EventConverter=void 0;var _=t("./entities/E"),g=t("./Event"),y=t("./ExceptionFactory"),m=t("./Storage");function r(t){this._game=t.game,this._playerId=null!=(t=t.playerId)?t:null,this._playerTable={}}r.prototype.toGameEvent=function(t){var e,i,r,o,n=t[0],s=t[1],a=t[2],h=this._playerTable[a]||{id:a};switch(n){case 0:h={id:a,name:t[3]},this._playerTable[a]&&null!=this._playerTable[a].userData&&(h.userData=this._playerTable[a].userData),this._playerTable[a]=h;var c,u,l=void 0;return t[4]&&(c=[],u=[],t[4].map(function(t){c.push(t.readKey),u.push(t.values)}),l=new m.StorageValueStore(c,u)),new g.JoinEvent(h,l,s);case 1:return delete this._playerTable[h.id],new g.LeaveEvent(h,s);case 2:return l=t[3],new g.TimestampEvent(l,h,s);case 3:h={id:a,name:t[3],userData:t[4]};return this._playerTable[a]=h,new g.PlayerInfoEvent(h,s);case 32:return d=t[4],new g.MessageEvent(t[3],h,d,s);case 33:return d=t[7],f=t[3],e=null==(p=t[6])?void 0:(0<=p?this._game.db:this._game._localDb).get(p),i={x:t[4],y:t[5]},new _.PointDownEvent(f,e,i,h,d,s);case 34:return d=t[11],f=t[3],e=null==(p=t[10])?void 0:(0<=p?this._game.db:this._game._localDb).get(p),i={x:t[4],y:t[5]},r={x:t[6],y:t[7]},o={x:t[8],y:t[9]},new _.PointMoveEvent(f,e,i,o,r,h,d,s);case 35:return d=t[11],f=t[3],e=null==(p=t[10])?void 0:(0<=p?this._game.db:this._game._localDb).get(p),i={x:t[4],y:t[5]},r={x:t[6],y:t[7]},o={x:t[8],y:t[9]},new _.PointUpEvent(f,e,i,o,r,h,d,s);case 64:var d=t[5],l=t[3],p=t[4],f=this._game._decodeOperationPluginOperation(l,p);return new g.OperationEvent(l,f,h,d,s);default:throw y.ExceptionFactory.createAssertionError("EventConverter#toGameEvent")}},r.prototype.toPlaylogEvent=function(t,e){var i;switch(t.type){case"join":case"leave":throw y.ExceptionFactory.createAssertionError("EventConverter#toPlaylogEvent: Invalid type: "+t.type);case"timestamp":var r=e?null!=(r=t.player.id)?r:null:this._playerId;return[2,t.eventFlags,r,t.timestamp];case"player-info":return r=e?null!=(i=t.player.id)?i:null:this._playerId,[3,t.eventFlags,r,t.player.name,t.player.userData];case"point-down":var o=t.target?t.target.id:null;return r=e&&t.player?null!=(i=t.player.id)?i:null:this._playerId,[33,t.eventFlags,r,t.pointerId,t.point.x,t.point.y,o,!!t.local];case"point-move":return o=t.target?t.target.id:null,r=e&&t.player?null!=(i=t.player.id)?i:null:this._playerId,[34,t.eventFlags,r,t.pointerId,t.point.x,t.point.y,t.startDelta.x,t.startDelta.y,t.prevDelta.x,t.prevDelta.y,o,!!t.local];case"point-up":return o=t.target?t.target.id:null,r=e&&t.player?null!=(i=t.player.id)?i:null:this._playerId,[35,t.eventFlags,r,t.pointerId,t.point.x,t.point.y,t.startDelta.x,t.startDelta.y,t.prevDelta.x,t.prevDelta.y,o,!!t.local];case"message":return r=e&&t.player?null!=(i=t.player.id)?i:null:this._playerId,[32,t.eventFlags,r,t.data,!!t.local];case"operation":return r=e&&t.player?null!=(o=t.player.id)?o:null:this._playerId,[64,t.eventFlags,r,t.code,t.data,!!t.local];default:throw y.ExceptionFactory.createAssertionError("Unknown type: "+t.type)}},r.prototype.makePlaylogOperationEvent=function(t){var e=this._playerId;return[64,null!=t.priority?3&t.priority:0,e,t._code,t.data,!!t.local]},i.EventConverter=r},{"./Event":22,"./ExceptionFactory":28,"./Storage":57,"./entities/E":79}],24:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],25:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],26:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],27:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],28:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ExceptionFactory=void 0,(i=i.ExceptionFactory||(i.ExceptionFactory={})).createAssertionError=function(t,e){return(t=new Error(t)).name="AssertionError",t.cause=e,t},i.createTypeMismatchError=function(t,e,i,r){if(t="Type mismatch on "+t+", expected type is "+e,2<arguments.length)try{var o=void 0;t+=", actual type is "+(40<(o=i&&i.constructor&&i.constructor.name?i.constructor.name:typeof i).length?o.substr(0,40):o)}catch(t){}return t+=".",(o=new Error(t)).name="TypeMismatchError",o.cause=r,o.expected=e,o.actual=i,o},i.createAssetLoadError=function(t,e,i,r){return void 0===e&&(e=!0),void 0===i&&(i=null),(i=new Error(t)).name="AssetLoadError",i.cause=r,i.retriable=e,i}},{}],29:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Font=void 0;var a=t("./Util");function r(){}r.prototype.measureText=function(t){for(var e=0,i=0,r=0,o=null,n=0;n<t.length;n++){var s=a.Util.charCodeAt(t,n);s&&(!(s=this.glyphForCharacter(s))||s.x<0||s.y<0||s.width<0||s.height<0||(0===n&&(i=-s.offsetX),e+=(o=s).advanceWidth))}return{width:e,actualBoundingBoxLeft:i,actualBoundingBoxRight:r=o?e+o.offsetX+o.width-o.advanceWidth:r}},i.Font=r},{"./Util":69}],30:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Game=void 0;var r=t("@akashic/trigger"),o=t("./AssetManager"),n=t("./AudioSystemManager"),s=t("./DefaultLoadingScene"),a=t("./DefaultSkippingScene"),h=t("./EventConverter"),c=t("./ExceptionFactory"),u=t("./LoadingScene"),l=t("./ModuleManager"),d=t("./OperationPluginManager"),p=t("./PointEventResolver"),f=t("./Scene"),_=t("./Storage"),g=t("./SurfaceAtlasSet"),y=t("./WeakRefKVS"),m=t("./XorshiftRandomGenerator");function v(t){var e=this._normalizeConfiguration(t.configuration);this.fps=e.fps,this.width=e.width,this.height=e.height,this.renderers=[],this.scenes=[],this.age=0,this.assetBase=t.assetBase||"",this.resourceFactory=t.resourceFactory,this.handlerSet=t.handlerSet,this.selfId=t.selfId,this.db=void 0,this.loadingScene=void 0,this.operationPlugins=void 0,this.random=void 0,this.localRandom=void 0,this._defaultLoadingScene=void 0,this._defaultSkippingScene=void 0,this._eventConverter=void 0,this._pointEventResolver=void 0,this._idx=void 0,this._localDb=void 0,this._localIdx=void 0,this._cameraIdx=void 0,this._isTerminated=void 0,this._modified=void 0,this._postTickTasks=void 0,this._toBeDestroyedScenes=[],this.playId=void 0,this.isSkipping=!1,this.joinedPlayerIds=[],this.audio=new n.AudioSystemManager(this.resourceFactory),this.defaultAudioSystemId="sound",this.storage=new _.Storage,this.assets={},this.surfaceAtlasSet=new g.SurfaceAtlasSet({resourceFactory:this.resourceFactory}),this.onJoin=new r.Trigger,this.onLeave=new r.Trigger,this.onPlayerInfo=new r.Trigger,this.onSeed=new r.Trigger,this.join=this.onJoin,this.leave=this.onLeave,this.playerInfo=this.onPlayerInfo,this.seed=this.onSeed,this._eventTriggerMap={unknown:void 0,timestamp:void 0,join:this.onJoin,leave:this.onLeave,"player-info":this.onPlayerInfo,seed:this.onSeed,message:void 0,"point-down":void 0,"point-move":void 0,"point-up":void 0,operation:void 0},this.onResized=new r.Trigger,this.onSkipChange=new r.Trigger,this.resized=this.onResized,this.skippingChanged=this.onSkipChange,this.isLastTickLocal=!0,this.lastOmittedLocalTickCount=0,this.lastLocalTickMode=null,this.lastTickGenerationMode=null,this._onLoad=new r.Trigger,this._onStart=new r.Trigger,this._loaded=this._onLoad,this._started=this._onStart,this.isLoaded=!1,this.onSnapshotRequest=new r.Trigger,this.snapshotRequest=this.onSnapshotRequest,this.external={},this._runtimeValueBase=Object.create(t.engineModule,{game:{value:this,enumerable:!0}}),this._main=e.main,this._mainFunc=t.mainFunc,this._mainParameter=void 0,this._configuration=e,this._assetManager=new o.AssetManager(this,e.assets,e.audio,e.moduleMainScripts),this._moduleManager=void 0,this.operationPluginManager=new d.OperationPluginManager(this,t.operationPluginViewInfo||null),this._onOperationPluginOperated=new r.Trigger,this._operationPluginOperated=this._onOperationPluginOperated,this._onOperationPluginOperated.add(this._handleOperationPluginOperated,this),this.onSceneChange=new r.Trigger,this._onSceneChange=new r.Trigger,this._onSceneChange.add(this._handleSceneChanged,this),this._sceneChanged=this._onSceneChange,this.onUpdate=new r.Trigger,this._initialScene=new f.Scene({game:this,assetIds:this._assetManager.globalAssetIds(),local:!0,name:"akashic:initial-scene"}),this._initialScene.onLoad.add(this._handleInitialSceneLoad,this),this._reset({age:0})}Object.defineProperty(v.prototype,"focusingCamera",{get:function(){return this._focusingCamera},set:function(t){t!==this._focusingCamera&&(this._modified&&this.render(),this._focusingCamera=t)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"skippingScene",{get:function(){return this._skippingScene},set:function(t){if(t!==this._skippingScene){if(t){if("full-local"!==t.local)throw c.ExceptionFactory.createAssertionError("Game#skippingScene: only 'full-local' scene is supported.");if(t._needsLoading())throw c.ExceptionFactory.createAssertionError("Game#skippingScene: must not depend on any assets/storages.")}this._skippingScene=t}},enumerable:!1,configurable:!0}),v.prototype.pushScene=function(t){this._postTickTasks.push({type:0,scene:t})},v.prototype.replaceScene=function(t,e){this._postTickTasks.push({type:1,scene:t,preserveCurrent:!!e})},v.prototype.popScene=function(t,e){void 0===e&&(e=1);for(var i=0;i<e;i++)this._postTickTasks.push({type:2,preserveCurrent:!!t})},v.prototype.scene=function(){if(this.scenes.length)return this.scenes[this.scenes.length-1]},v.prototype.tick=function(t,e,i){var r=null;if(this._isTerminated)return!1;if(this.isLastTickLocal=!t,this.lastOmittedLocalTickCount=e||0,this.scenes.length){if(r=this.scenes[this.scenes.length-1],i&&i.length)for(var o=0;o<i.length;++o){var n=this._eventConverter.toGameEvent(i[o]),s=this._eventTriggerMap[n.type];s&&s.fire(n)}r.onUpdate.fire(),t&&++this.age}return this.onUpdate.fire(),!!this._postTickTasks.length&&(this._flushPostTickTasks(),r!==this.scenes[this.scenes.length-1])},v.prototype.render=function(){var t,e=null!=(e=this._skippingScene)?e:this._defaultSkippingScene;if(e&&this.isSkipping?(t=e).onUpdate.fire():t=this.scene(),this._modified&&t){for(var i=this.focusingCamera,r=this.renderers,o=0;o<r.length;++o){for(var n=r[o],s=(n.begin(),n.save(),n.clear(),i&&(n.save(),i._applyTransformToRenderer(n)),t.children),a=0;a<s.length;++a)s[a].render(n,i);i&&n.restore(),n.restore(),n.end()}this._modified=!1}},v.prototype.resolvePointEvent=function(t){switch(t.type){case 0:return this._pointEventResolver.pointDown(t);case 1:return this._pointEventResolver.pointMove(t);case 2:return this._pointEventResolver.pointUp(t)}},v.prototype.findPointSource=function(t,e){e=e||this.focusingCamera;var i=this.scene();if(i)return i.findPointSourceByPoint(t,!1,e)},v.prototype.register=function(t){if(t.local){if(void 0===t.id)t.id=--this._localIdx;else{if(0<t.id)throw c.ExceptionFactory.createAssertionError("Game#register: invalid local id: "+t.id);if(this._localDb.has(t.id))throw c.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+t.id);this._localIdx>t.id&&(this._localIdx=t.id)}this._localDb.set(t.id,t)}else{if(void 0===t.id)t.id=++this._idx;else{if(t.id<0)throw c.ExceptionFactory.createAssertionError("Game#register: invalid non-local id: "+t.id);if(this.db.has(t.id))throw c.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+t.id);this._idx<t.id&&(this._idx=t.id)}this.db.set(t.id,t)}},v.prototype.unregister=function(t){(t.local?this._localDb:this.db).delete(t.id)},v.prototype.terminateGame=function(){this._isTerminated=!0,this._terminateGame()},v.prototype.modified=function(){this._modified=!0},v.prototype.raiseEvent=function(t){this.handlerSet.raiseEvent(this._eventConverter.toPlaylogEvent(t))},v.prototype.raiseTick=function(t){if(null!=t&&t.length){for(var e=[],i=0;i<t.length;i++)e.push(this._eventConverter.toPlaylogEvent(t[i]));this.handlerSet.raiseTick(e)}else this.handlerSet.raiseTick()},v.prototype.addEventFilter=function(t,e){this.handlerSet.addEventFilter(t,e)},v.prototype.removeEventFilter=function(t){this.handlerSet.removeEventFilter(t)},v.prototype.shouldSaveSnapshot=function(){return this.handlerSet.shouldSaveSnapshot()},v.prototype.saveSnapshot=function(t,e){this.handlerSet.saveSnapshot(this.age,t,this.random.serialize(),this._idx,e)},v.prototype.requestSaveSnapshot=function(e,i){var r=this;this._postTickTasks.unshift({type:3,fun:function(){var t;!r.handlerSet.shouldSaveSnapshot()||(t=e.call(i))&&r.handlerSet.saveSnapshot(r.age,t.snapshot,r.random.serialize(),r._idx,t.timestamp)},owner:null})},v.prototype.getCurrentTime=function(){return this.handlerSet.getCurrentTime()},v.prototype.isActiveInstance=function(){return"active"===this.handlerSet.getInstanceType()},v.prototype._pushPostTickTask=function(t,e){this._postTickTasks.push({type:3,fun:t,owner:e})},v.prototype._normalizeConfiguration=function(t){if(!t)throw c.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: invalid arguments");if(null==t.assets&&(t.assets={}),null==t.fps&&(t.fps=30),"number"!=typeof t.fps)throw c.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be given as a number");if(!(0<=t.fps&&t.fps<=60))throw c.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be a number in (0, 60].");if("number"!=typeof t.width)throw c.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: width must be given as a number");if("number"!=typeof t.height)throw c.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: height must be given as a number");return t},v.prototype._setAudioPlaybackRate=function(t){this.audio._setPlaybackRate(t)},v.prototype._startSuppressAudio=function(){this.audio._startSuppress()},v.prototype._endSuppressAudio=function(){this.audio._endSuppress()},v.prototype._setMuted=function(t){this.audio._setMuted(t)},v.prototype._decodeOperationPluginOperation=function(t,e){t=this.operationPluginManager.plugins[t];return t&&t.decode?t.decode(e):e},v.prototype._reset=function(t){if(this.operationPluginManager.reset(),this.operationPluginManager.onOperate.add(this._onOperationPluginOperated.fire,this._onOperationPluginOperated),this.scene()){for(;this.scene()!==this._initialScene;)this.popScene(),this._flushPostTickTasks();this.isLoaded||this.scenes.pop()}switch(this._skippingScene&&!this._skippingScene.destroyed()&&this._skippingScene.destroy(),t&&(void 0!==t.age&&(this.age=t.age),void 0!==t.nextEntityId&&(this._idx=t.nextEntityId),void 0!==t.randGenSer?this.random=m.XorshiftRandomGenerator.deserialize(t.randGenSer):void 0!==t.randSeed&&(this.random=new m.XorshiftRandomGenerator(t.randSeed))),this.audio._reset(),this._onLoad.removeAll({func:this._handleLoad,owner:this}),this.onJoin.removeAll(),this.onLeave.removeAll(),this.onSeed.removeAll(),this.onResized.removeAll(),this.onSkipChange.removeAll(),this.onSceneChange.removeAll(),this.onUpdate.removeAll(),this.handlerSet.removeAllEventFilters(),this.isSkipping=!1,this.onSkipChange.add(this._handleSkipChange,this),this.joinedPlayerIds=[],this.onJoin.add(this._handleJoinEvent,this),this.onLeave.add(this._handleLeaveEvent,this),this._idx=0,this._localIdx=0,this._cameraIdx=0,this.db=new y.WeakRefKVS,this._localDb=new y.WeakRefKVS,this._modified=!0,this.loadingScene=void 0,this._skippingScene=void 0,this._focusingCamera=void 0,this.lastLocalTickMode=null,this.lastTickGenerationMode=null,this.onSnapshotRequest.removeAll(),this._postTickTasks=[],this._toBeDestroyedScenes=[],this._eventConverter=new h.EventConverter({game:this,playerId:this.selfId}),this._pointEventResolver=new p.PointEventResolver({sourceResolver:this,playerId:this.selfId,maxPoints:this._configuration.maxPoints}),this.localRandom=new m.XorshiftRandomGenerator(Math.floor(9007199254740991*Math.random())),this._isTerminated=!1,this.vars={},this._moduleManager=new l.ModuleManager(this._runtimeValueBase,this._assetManager),this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=new g.SurfaceAtlasSet({resourceFactory:this.resourceFactory}),this._configuration.defaultLoadingScene){case"none":this._defaultLoadingScene=new u.LoadingScene({game:this});break;case"compact":this._defaultLoadingScene=new s.DefaultLoadingScene({game:this,style:"compact"});break;default:this._defaultLoadingScene=new s.DefaultLoadingScene({game:this})}switch(this._configuration.defaultSkippingScene){case"none":this._defaultSkippingScene=new a.DefaultSkippingScene({game:this,style:"none"});break;case"indicator":this._defaultSkippingScene=new a.DefaultSkippingScene({game:this,style:"indicator"});break;default:this._defaultSkippingScene=void 0}},v.prototype._destroy=function(){if(this.operationPluginManager.destroy(),this.scene())for(;this.scene()!==this._initialScene;)this.popScene(),this._flushPostTickTasks();this._initialScene.destroy(),this.loadingScene&&!this.loadingScene.destroyed()&&this.loadingScene.destroy(),this._defaultLoadingScene.destroyed()||this._defaultLoadingScene.destroy(),this._defaultSkippingScene&&!this._defaultSkippingScene.destroyed()&&this._defaultSkippingScene.destroy(),this._skippingScene&&!this._skippingScene.destroyed()&&this._skippingScene.destroy(),this.db=void 0,this.renderers=void 0,this.scenes=void 0,this.random=void 0,this._modified=!1,this.age=0,this.assets=void 0,this.isLoaded=!1,this.loadingScene=void 0,this.assetBase="",this.selfId=void 0,this.audio.music.stopAll(),this.audio.sound.stopAll(),this.audio=void 0,this.defaultAudioSystemId=void 0,this.handlerSet=void 0,this.localRandom=void 0,this.onJoin.destroy(),this.onJoin=void 0,this.onLeave.destroy(),this.onLeave=void 0,this.onSeed.destroy(),this.onSeed=void 0,this.onPlayerInfo.destroy(),this.onPlayerInfo=void 0,this.onResized.destroy(),this.onResized=void 0,this.onSkipChange.destroy(),this.onSkipChange=void 0,this.onSceneChange.destroy(),this.onSceneChange=void 0,this.onUpdate.destroy(),this.onUpdate=void 0,this.onSnapshotRequest.destroy(),this.onSnapshotRequest=void 0,this.join=void 0,this.leave=void 0,this.seed=void 0,this.playerInfo=void 0,this.snapshotRequest=void 0,this.resized=void 0,this.skippingChanged=void 0,this._sceneChanged=void 0,this._loaded=void 0,this._started=void 0,this._operationPluginOperated=void 0,this._onSceneChange.destroy(),this._onSceneChange=void 0,this._onLoad.destroy(),this._onLoad=void 0,this._onStart.destroy(),this._onStart=void 0,this.resourceFactory=void 0,this.storage=void 0,this.playId=void 0,this.operationPlugins=void 0,this._eventTriggerMap=void 0,this._initialScene=void 0,this._defaultLoadingScene=void 0,this._main=void 0,this._mainFunc=void 0,this._mainParameter=void 0,this._assetManager.destroy(),this._assetManager=void 0,this._eventConverter=void 0,this._pointEventResolver=void 0,this.operationPluginManager=void 0,this._onOperationPluginOperated.destroy(),this._onOperationPluginOperated=void 0,this._idx=0,this._localDb=void 0,this._localIdx=0,this._cameraIdx=0,this._isTerminated=!0,this._focusingCamera=void 0,this._skippingScene=void 0,this._configuration=void 0,this._postTickTasks=void 0,this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=void 0,this._moduleManager=void 0},v.prototype._loadAndStart=function(t){this._mainParameter=t||{},this.isLoaded?this._handleLoad():(this._onLoad.add(this._handleLoad,this),this.pushScene(this._initialScene),this._flushPostTickTasks())},v.prototype._startLoadingGlobalAssets=function(){if(this.isLoaded)throw c.ExceptionFactory.createAssertionError("Game#_startLoadingGlobalAssets: already loaded.");this.pushScene(this._initialScene),this._flushPostTickTasks()},v.prototype._updateEventTriggers=function(t){this._modified=!0,t?(this._eventTriggerMap.message=t.onMessage,this._eventTriggerMap["point-down"]=t.onPointDownCapture,this._eventTriggerMap["point-move"]=t.onPointMoveCapture,this._eventTriggerMap["point-up"]=t.onPointUpCapture,this._eventTriggerMap.operation=t.onOperation,t._activate()):(this._eventTriggerMap.message=void 0,this._eventTriggerMap["point-down"]=void 0,this._eventTriggerMap["point-move"]=void 0,this._eventTriggerMap["point-up"]=void 0,this._eventTriggerMap.operation=void 0)},v.prototype._handleInitialSceneLoad=function(){this._initialScene.onLoad.remove(this._handleInitialSceneLoad,this),this.assets=this._initialScene.assets,this.isLoaded=!0,this._onLoad.fire(this)},v.prototype._handleOperationPluginOperated=function(t){t=this._eventConverter.makePlaylogOperationEvent(t);this.handlerSet.raiseEvent(t)},v.prototype._handleSceneChanged=function(t){this._updateEventTriggers(t);var e=t?t.local:"full-local",t=t?t.tickGenerationMode:"by-clock";this.lastLocalTickMode===e&&this.lastTickGenerationMode===t||(this.lastLocalTickMode=e,this.lastTickGenerationMode=t,this.handlerSet.changeSceneMode({local:e,tickGenerationMode:t}))},v.prototype._handleSkippingSceneReady=function(t){this._pushPostTickTask(t._fireLoaded,t)},v.prototype._terminateGame=function(){},v.prototype._flushPostTickTasks=function(){do{var t=this._postTickTasks;this._postTickTasks=[];for(var e=0;e<t.length;++e){var i=t[e];switch(i.type){case 0:var r=this.scene();r&&r._deactivate(),this._doPushScene(i.scene);break;case 1:this._doPopScene(i.preserveCurrent,!1),this._doPushScene(i.scene);break;case 2:this._doPopScene(i.preserveCurrent,!0);break;case 3:i.fun.call(i.owner);break;default:throw c.ExceptionFactory.createAssertionError("Game#_flushPostTickTasks: unknown post-tick task type.")}}}while(0<this._postTickTasks.length);if(0<this._toBeDestroyedScenes.length){for(var o=0,n=this._toBeDestroyedScenes;o<n.length;o++)n[o].destroy();this._toBeDestroyedScenes=[]}},v.prototype._handleSkipChange=function(t){(this.isSkipping=t)&&(t=null!=(t=this._skippingScene)?t:this._defaultSkippingScene)&&!t._loaded&&(t._load(),t._onReady.addOnce(this._handleSkippingSceneReady,this)),this._cleanDB(),this._modified=!0},v.prototype._handleJoinEvent=function(t){t.player.id&&-1===this.joinedPlayerIds.indexOf(t.player.id)&&this.joinedPlayerIds.push(t.player.id)},v.prototype._handleLeaveEvent=function(e){this.joinedPlayerIds=this.joinedPlayerIds.filter(function(t){return t!==e.player.id})},v.prototype._doPopScene=function(t,e){var i=this.scenes.pop();if(!i)throw c.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; scene stack underflow");if(i===this._initialScene)throw c.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; attempting to pop the initial scene");t||this._toBeDestroyedScenes.includes(i)||this._toBeDestroyedScenes.push(i),e&&(t=this.scene(),this.onSceneChange.fire(t),this._onSceneChange.fire(t))},v.prototype._handleLoad=function(){for(var t=0,e=this._configuration.operationPlugins||[];t<e.length;t++){var i,r=e[t];r.script&&(i=this._moduleManager._require(r.script),i=this.operationPluginManager.register(i,r.code,r.option),!r.manualStart&&i&&i.start())}this.operationPlugins=this.operationPluginManager.plugins;for(var o=0,n=this._assetManager.preloadScriptAssetIds();o<n.length;o++){var s=n[o],a=this._moduleManager._require(s);if(!a||"function"!=typeof a)throw c.ExceptionFactory.createAssertionError("Game#_handleLoad: ".concat(s," has no-exported function."));a()}if(this._mainFunc)this._mainFunc(this._runtimeValueBase,this._mainParameter||{});else{if(!this._main)throw c.ExceptionFactory.createAssertionError("Game#_handleLoad: does not have an entry point");var h=this._moduleManager._require(this._main);if(!h||"function"!=typeof h)throw c.ExceptionFactory.createAssertionError("Game#_handleLoad: Entry point ".concat(this._main," not found."));h(this._mainParameter)}this._flushPostTickTasks(),this._onStart.fire()},v.prototype._doPushScene=function(t,e){if(e=e||this.loadingScene||this._defaultLoadingScene,this.scenes.push(t),t._needsLoading()&&"loaded-fired"!==t._loadingState){if(this._defaultLoadingScene._needsLoading())throw c.ExceptionFactory.createAssertionError("Game#_doPushScene: _defaultLoadingScene must not depend on any assets/storages.");this._doPushScene(e,this._defaultLoadingScene),e.reset(t)}else this.onSceneChange.fire(t),this._onSceneChange.fire(t),t._loaded||(t._load(),this._pushPostTickTask(t._fireLoaded,t));this._modified=!0},v.prototype._cleanDB=function(){this.db.clean(),this._localDb.clean()},i.Game=v},{"./AssetManager":7,"./AudioSystemManager":11,"./DefaultLoadingScene":17,"./DefaultSkippingScene":18,"./EventConverter":23,"./ExceptionFactory":28,"./LoadingScene":34,"./ModuleManager":38,"./OperationPluginManager":42,"./PointEventResolver":47,"./Scene":52,"./Storage":57,"./SurfaceAtlasSet":59,"./WeakRefKVS":71,"./XorshiftRandomGenerator":73,"@akashic/trigger":225}],31:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],32:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],33:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],34:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.LoadingScene=void 0,t("@akashic/trigger")),a=t("./ExceptionFactory"),t=t("./Scene"),t=(o=t.Scene,n(h,o),h.prototype.destroy=function(){this._clearTargetScene(),o.prototype.destroy.call(this)},h.prototype.reset=function(t){this._clearTargetScene(),this._targetScene=t,"loaded-fired"!==this._loadingState?this.onLoad.addOnce(this._doReset,this):this._doReset()},h.prototype.getTargetWaitingAssetsCount=function(){return this._targetScene?this._targetScene._sceneAssetHolder.waitingAssetsCount:0},h.prototype.end=function(){var t;if(!this._targetScene||"initial"===this._targetScene._loadingState)throw t=this._targetScene?this._targetScene._loadingState:"(no scene)",a.ExceptionFactory.createAssertionError("LoadingScene#end(): the target scene is in invalid state: "+t);this.game.popScene(!0),this.game._pushPostTickTask(this._targetScene._fireLoaded,this._targetScene),this._clearTargetScene()},h.prototype._clearTargetScene=function(){this._targetScene&&(this._targetScene._onReady.removeAll({owner:this}),this._targetScene.onAssetLoad.removeAll({owner:this}),this._targetScene=void 0)},h.prototype._doReset=function(){this.onTargetReset.fire(this._targetScene),"initial"===this._targetScene._loadingState||"ready"===this._targetScene._loadingState?(this._targetScene._onReady.add(this._handleReady,this),this._targetScene.onAssetLoad.add(this._handleAssetLoad,this),this._targetScene._load()):this._handleReady(this._targetScene)},h.prototype._handleAssetLoad=function(t){this.onTargetAssetLoad.fire(t)},h.prototype._handleReady=function(t){this.onTargetReady.fire(t),this._explicitEnd||this.end()},h);function h(t){var e=this;return t.local=!0,(e=o.call(this,t)||this).onTargetReset=new s.Trigger,e.onTargetReady=new s.Trigger,e.onTargetAssetLoad=new s.Trigger,e.targetReset=e.onTargetReset,e.targetReady=e.onTargetReady,e.targetAssetLoaded=e.onTargetAssetLoad,e._explicitEnd=!!t.explicitEnd,e._targetScene=void 0,e}i.LoadingScene=t},{"./ExceptionFactory":28,"./Scene":52,"@akashic/trigger":225}],35:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],36:[function(t,e,i){"use strict";function r(t,e,i,r,o,n,s){void 0===t?(this._modified=!1,this._matrix=[1,0,0,1,0,0]):"number"==typeof t?(this._modified=!1,this._matrix=new Array(6),this.update(t,e,i,r,o,0,0,n,s)):(this._modified=t._modified,this._matrix=[t._matrix[0],t._matrix[1],t._matrix[2],t._matrix[3],t._matrix[4],t._matrix[5]])}Object.defineProperty(i,"__esModule",{value:!0}),i.PlainMatrix=void 0,r.prototype.update=function(t,e,i,r,o,n,s,a,h){var c,u;null==a||null==h?this._updateWithoutAnchor(t,e,i,r,o,n,s):(o=o*Math.PI/180,c=Math.cos(o),u=(o=Math.sin(o))*i,o*=r,r*=c,a*=t,t=h*e,this._matrix[0]=h=c*i,this._matrix[1]=u,this._matrix[2]=-o,this._matrix[3]=r,this._matrix[4]=-h*a+o*t+n,this._matrix[5]=-u*a-r*t+s)},r.prototype._updateWithoutAnchor=function(t,e,i,r,o,n,s){var o=o*Math.PI/180,a=Math.cos(o),o=Math.sin(o),h=a*i,i=o*i,o=o*r,a=a*r,r=t/2,t=e/2;this._matrix[0]=h,this._matrix[1]=i,this._matrix[2]=-o,this._matrix[3]=a,this._matrix[4]=-h*r+o*t+r+n,this._matrix[5]=-i*r-a*t+t+s},r.prototype.updateByInverse=function(t,e,i,r,o,n,s,a,h){var c,u;null==a||null==h?this._updateByInverseWithoutAnchor(t,e,i,r,o,n,s):(o=o*Math.PI/180,c=Math.cos(o),u=(o=Math.sin(o))/r,o/=i,r=c/r,a*=t,t=h*e,this._matrix[0]=h=c/i,this._matrix[1]=-u,this._matrix[2]=o,this._matrix[3]=r,this._matrix[4]=-h*n-o*s+a,this._matrix[5]=u*n-r*s+t)},r.prototype._updateByInverseWithoutAnchor=function(t,e,i,r,o,n,s){var o=o*Math.PI/180,a=Math.cos(o),o=Math.sin(o),h=a/i,c=o/r,o=o/i,i=a/r,a=t/2,r=e/2;this._matrix[0]=h,this._matrix[1]=-c,this._matrix[2]=o,this._matrix[3]=i,this._matrix[4]=-h*(a+n)-o*(r+s)+a,this._matrix[5]=c*(a+n)-i*(r+s)+r},r.prototype.multiply=function(t){var e=this._matrix,t=t._matrix,i=e[0],r=e[1],o=e[2],n=e[3];e[0]=i*t[0]+o*t[1],e[1]=r*t[0]+n*t[1],e[2]=i*t[2]+o*t[3],e[3]=r*t[2]+n*t[3],e[4]=i*t[4]+o*t[5]+e[4],e[5]=r*t[4]+n*t[5]+e[5]},r.prototype.multiplyLeft=function(t){var t=t._matrix,e=this._matrix,i=e[0],r=e[2],o=e[4];e[0]=t[0]*i+t[2]*e[1],e[1]=t[1]*i+t[3]*e[1],e[2]=t[0]*r+t[2]*e[3],e[3]=t[1]*r+t[3]*e[3],e[4]=t[0]*o+t[2]*e[5]+t[4],e[5]=t[1]*o+t[3]*e[5]+t[5]},r.prototype.multiplyNew=function(t){var e=this.clone();return e.multiply(t),e},r.prototype.reset=function(t,e){this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=1,this._matrix[4]=t||0,this._matrix[5]=e||0},r.prototype.clone=function(){return new r(this)},r.prototype.multiplyInverseForPoint=function(t){var e=this._matrix,i=1/(e[0]*e[3]+e[2]*-e[1]);return{x:e[3]*i*t.x+-e[2]*i*t.y+(e[5]*e[2]-e[4]*e[3])*i,y:e[0]*i*t.y+-e[1]*i*t.x+(-e[5]*e[0]+e[4]*e[1])*i}},r.prototype.scale=function(t,e){var i=this._matrix;i[0]*=t,i[1]*=e,i[2]*=t,i[3]*=e,i[4]*=t,i[5]*=e},r.prototype.multiplyPoint=function(t){var e=this._matrix;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}},i.PlainMatrix=r},{}],37:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Module=void 0;var h=t("./PathUtil");i.Module=function(t){function e(t){return s(t,i)}var i=this,r=t.path,o=h.PathUtil.resolveDirname(r),n=(n=t.virtualPath)?h.PathUtil.resolveDirname(n):void 0,s=t.requireFunc,a=t.resolveFunc;this._runtimeValue=Object.create(t.runtimeValueBase,{filename:{value:r,enumerable:!0},dirname:{value:o,enumerable:!0},module:{value:this,writable:!0,enumerable:!0,configurable:!0}}),this.id=t.id,this.filename=t.path,this.exports={},this.parent=null,this.loaded=!1,this.children=[],this.paths=n?h.PathUtil.makeNodeModulePaths(n):[],this._dirname=o,this._virtualDirname=n,e.resolve=function(t){return a(t,i)},this.require=e}},{"./PathUtil":45}],38:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ModuleManager=void 0;var u=t("./ExceptionFactory"),l=t("./Module"),d=t("./PathUtil"),p=t("./RequireCachedValue"),f=t("./ScriptAssetContext");function r(t,e){this._assetManager=e,this._runtimeValueBase=t,this._scriptCaches={}}r.prototype._require=function(t,e){var i=this,r=this._assetManager._liveAssetVirtualPathTable,o=this._assetManager._moduleMainScripts;if(-1===t.indexOf("/")&&this._assetManager._assets.hasOwnProperty(t)&&(a=this._assetManager._assets[t],c=this._assetManager._liveAssetPathTable[a.path]),/^\.\/|^\.\.\/|^\//.test(t)){if(e){if(!e._virtualDirname)throw u.ExceptionFactory.createAssertionError("g._require: require from modules without virtualPath is not supported");c=d.PathUtil.resolvePath(e._virtualDirname,t)}else{if(!/^\.\//.test(t))throw u.ExceptionFactory.createAssertionError("g._require: entry point path must start with './'");c=t.substring(2)}if(this._scriptCaches.hasOwnProperty(c))return this._scriptCaches[c]._cachedValue();if(this._scriptCaches.hasOwnProperty(c+".js"))return this._scriptCaches[c+".js"]._cachedValue();a=(a=a||this._findAssetByPathAsFile(c,r))||this._findAssetByPathAsDirectory(c,r)}else if(!(a=o[t]?r[c=o[t]]:a)){var n=e?e.paths:[];n.push("node_modules");for(var s=0;s<n.length;++s){var a,h=n[s],c=d.PathUtil.resolvePath(h,t);if(a=this._findAssetByPathAsFile(c,r))break;if(a=this._findAssetByPathAsDirectory(c,r))break}}if(a){if(this._scriptCaches.hasOwnProperty(c))return this._scriptCaches[c]._cachedValue();if("script"===a.type)return o=new l.Module({runtimeValueBase:this._runtimeValueBase,id:a.id,path:a.path,virtualPath:this._assetManager._liveAssetPathTable[a.path],requireFunc:function(t,e){return i._require(t,e)},resolveFunc:function(t,e){return i._resolvePath(t,e)}}),o=new f.ScriptAssetContext(a,o),(this._scriptCaches[c]=o)._executeScript(e);if("text"===a.type&&a&&".json"===d.PathUtil.resolveExtname(t))return(this._scriptCaches[c]=new p.RequireCachedValue(JSON.parse(a.data)))._cachedValue()}throw u.ExceptionFactory.createAssertionError("g._require: can not find module: "+t)},r.prototype._resolvePath=function(t,e){var i=null,r=this._assetManager._liveAssetVirtualPathTable,o=this._assetManager._moduleMainScripts;if(/^\.\/|^\.\.\/|^\//.test(t)){if(!e)throw u.ExceptionFactory.createAssertionError("g._require.resolve: couldn't resolve the moudle without currentModule");if(!e._virtualDirname)throw u.ExceptionFactory.createAssertionError("g._require.resolve: couldn't resolve the moudle path without virtualPath");i=d.PathUtil.resolvePath(e._virtualDirname,t);if(h=this._resolveAbsolutePathAsFile(i,r))return h;if(h=this._resolveAbsolutePathAsDirectory(i,r))return h}else{if(o[t])return o[t];var n=e?e.paths.concat():[];n.push("node_modules");for(var s=0;s<n.length;++s){var a=n[s],h=d.PathUtil.resolvePath(a,t);if(i=this._resolveAbsolutePathAsFile(h,r))return i;if(i=this._resolveAbsolutePathAsDirectory(h,r))return i}}throw u.ExceptionFactory.createAssertionError("g._require.resolve: couldn't resolve the path: "+t)},r.prototype._findAssetByPathAsFile=function(t,e){return e.hasOwnProperty(t)?e[t]:e.hasOwnProperty(t+".js")?e[t+".js"]:void 0},r.prototype._findAssetByPathAsDirectory=function(t,e){var i=t+"/package.json";if(e.hasOwnProperty(i)&&"text"===e[i].type){var r=JSON.parse(e[i].data);if(r&&"string"==typeof r.main){r=this._findAssetByPathAsFile(d.PathUtil.resolvePath(t,r.main),e);if(r)return r}}if(e.hasOwnProperty(i=t+"/index.js"))return e[i]},r.prototype._resolveAbsolutePathAsFile=function(t,e){return e.hasOwnProperty(t)?"/"+t:e.hasOwnProperty(t+".js")?"/"+t+".js":null},r.prototype._resolveAbsolutePathAsDirectory=function(t,e){var i=t+"/package.json";if(e.hasOwnProperty(i)&&"text"===e[i].type){var r=JSON.parse(e[i].data);if(r&&"string"==typeof r.main){r=this._resolveAbsolutePathAsFile(d.PathUtil.resolvePath(t,r.main),e);if(r)return"/"+r}}return e.hasOwnProperty(i=t+"/index.js")?"/"+i:null},i.ModuleManager=r},{"./ExceptionFactory":28,"./Module":37,"./PathUtil":45,"./RequireCachedValue":51,"./ScriptAssetContext":53}],39:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.NinePatchSurfaceEffector=void 0;var r=t("./SurfaceUtil");function o(t,e){void 0===e&&(e=4),this.game=t,this.borderWidth="number"==typeof e?{top:e,bottom:e,left:e,right:e}:e}o.prototype.render=function(t,e,i){return this._surface&&this._surface.width===e&&this._surface.height===i&&this._beforeSrcSurface===t||(this._surface=this.game.resourceFactory.createSurface(Math.ceil(e),Math.ceil(i)),this._beforeSrcSurface=t),r.SurfaceUtil.drawNinePatch(this._surface,t,this.borderWidth),this._surface},i.NinePatchSurfaceEffector=o},{"./SurfaceUtil":62}],40:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Object2D=void 0;var r=t("./ExceptionFactory"),o=t("./Matrix");function n(t){t?(this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.opacity=null!=t.opacity?t.opacity:1,this.scaleX=null!=t.scaleX?t.scaleX:1,this.scaleY=null!=t.scaleY?t.scaleY:1,this.angle=t.angle||0,this.compositeOperation=t.compositeOperation,this.anchorX=void 0===t.anchorX?0:t.anchorX,this.anchorY=void 0===t.anchorY?0:t.anchorY):(this.x=0,this.y=0,this.width=0,this.height=0,this.opacity=1,this.scaleX=1,this.scaleY=1,this.angle=0,this.compositeOperation=void 0,this.anchorX=0,this.anchorY=0),this._matrix=void 0}n.prototype.moveTo=function(t,e){if("number"==typeof t&&"number"!=typeof e)throw r.ExceptionFactory.createAssertionError("Object2D#moveTo: arguments must be CommonOffset or pair of x and y as a number.");"number"==typeof t?(this.x=t,this.y=e):(this.x=t.x,this.y=t.y)},n.prototype.moveBy=function(t,e){this.x+=t,this.y+=e},n.prototype.resizeTo=function(t,e){if("number"==typeof t&&"number"!=typeof e)throw r.ExceptionFactory.createAssertionError("Object2D#resizeTo: arguments must be CommonSize or pair of width and height as a number.");"number"==typeof t?(this.width=t,this.height=e):(this.width=t.width,this.height=t.height)},n.prototype.resizeBy=function(t,e){this.width+=t,this.height+=e},n.prototype.scale=function(t){this.scaleX=t,this.scaleY=t},n.prototype.anchor=function(t,e){this.anchorX=t,this.anchorY=e},n.prototype.getMatrix=function(){if(this._matrix){if(!this._matrix._modified)return this._matrix}else this._matrix=new o.PlainMatrix;return this._updateMatrix(),this._matrix._modified=!1,this._matrix},n.prototype._updateMatrix=function(){this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?this._matrix.update(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this._matrix.reset(this.x,this.y)},i.Object2D=n},{"./ExceptionFactory":28,"./Matrix":36}],41:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],42:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.OperationPluginManager=void 0;var r=t("@akashic/trigger"),o=(n.prototype.onOperation=function(t){var e;t instanceof Array?e={_code:this._code,data:t}:(e=t)._code=this._code,this._handler.call(this._handlerOwner,e)},n);function n(t,e,i){this._code=t,this._handler=i,this._handlerOwner=e}function s(t,e){this.onOperate=new r.Trigger,this.operated=this.onOperate,this.plugins={},this._game=t,this._viewInfo=e}s.prototype.register=function(t,e,i){return this._instantiateOperationPlugin(t,e,i)},s.prototype.start=function(t){t=this.plugins[t];t&&t.start()},s.prototype.stop=function(t){t=this.plugins[t];t&&t.stop()},s.prototype.destroy=function(){this.stopAll(),this.onOperate.destroy(),this.onOperate=void 0,this.operated=void 0,this.plugins=void 0,this._game=void 0,this._viewInfo=void 0},s.prototype.reset=function(){this.stopAll(),this.onOperate.removeAll(),this.plugins={}},s.prototype.stopAll=function(){for(var t in this.plugins)this.plugins.hasOwnProperty(t)&&((t=this.plugins[t])&&t.stop())},s.prototype._instantiateOperationPlugin=function(t,e,i){if(t.isSupported()){if(this.plugins[e])throw new Error("Plugin#code conflicted for code: ".concat(e));t=new t(this._game,this._viewInfo,i),i=(this.plugins[e]=t,new o(e,this.onOperate,this.onOperate.fire));return t.operationTrigger.add(i.onOperation,i),t}},i.OperationPluginManager=s},{"@akashic/trigger":225}],43:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],44:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],45:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PathUtil=void 0;var h,c=t("./ExceptionFactory");(h=i.PathUtil||(i.PathUtil={})).resolvePath=function(t,e){function i(t){t=t.split("/");return""===t[t.length-1]&&t.pop(),t}if(""===e)return t;for(var r=i((t=h.splitPath(t)).path).concat(i(e)),o=[],n=0;n<r.length;++n){var s=r[n];switch(s){case"..":var a=o.pop();if(void 0===a||""===a||"."===a)throw c.ExceptionFactory.createAssertionError("PathUtil.resolvePath: invalid arguments");break;case".":0===o.length&&o.push(".");break;case"":o=[""];break;default:o.push(s)}}return t.host+o.join("/")},h.resolveDirname=function(t){var e=t.lastIndexOf("/");return-1===e?t:t.substr(0,e)},h.resolveExtname=function(t){for(var e=t.length-1;0<=e;--e){var i=t.charAt(e);if("."===i)return t.substr(e);if("/"===i)return""}return""},h.makeNodeModulePaths=function(t){for(var e,i=h.splitPath(t),r=i.host,o=(t="/"===(t=i.path)[t.length-1]?t.slice(0,t.length-1):t).split("/"),n=0<(i=o.indexOf("node_modules"))?i-1:0,s=[],a=o.length-1;n<=a;--a)"node_modules"!==o[a]&&((e=o.slice(0,a+1)).push("node_modules"),e=e.join("/"),s.push(r+e));return s},h.splitPath=function(t){var e="",i=t.indexOf("//");return 0<=i?t=0<=(i=t.indexOf("/",i+2))?(e=t.slice(0,i),t.slice(i)):(e=t,"/"):e="",{host:e,path:t}}},{"./ExceptionFactory":28}],46:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],47:[function(t,e,i){"use strict";function r(t){this._currentPoints=0,this._pointEventMap={},this._sourceResolver=t.sourceResolver,this._playerId=t.playerId,this._maxPoints=null!=(t=t.maxPoints)?t:null}Object.defineProperty(i,"__esModule",{value:!0}),i.PointEventResolver=void 0,r.prototype.pointDown=function(t){var e,i,r,o;return null!=this._maxPoints&&this._currentPoints>=this._maxPoints?null:(i=(e=this._sourceResolver.findPointSource(t.offset)).point||t.offset,r=e.target?e.target.id:void 0,o=e.local,this._pointEventMap[t.identifier]={targetId:r,local:o,point:i,start:{x:t.offset.x,y:t.offset.y},prev:{x:t.offset.x,y:t.offset.y}},this._currentPoints++,o=[33,2,this._playerId,t.identifier,i.x,i.y,r],e&&e.local&&o.push(e.local),o)},r.prototype.pointMove=function(t){var e,i,r=this._pointEventMap[t.identifier];return r?(this._pointMoveAndUp(r,t.offset,e={x:0,y:0},i={x:0,y:0}),t=[34,2,this._playerId,t.identifier,r.point.x,r.point.y,i.x,i.y,e.x,e.y,r.targetId],r.local&&t.push(r.local),t):null},r.prototype.pointUp=function(t){var e,i,r=this._pointEventMap[t.identifier];return r?(this._pointMoveAndUp(r,t.offset,e={x:0,y:0},i={x:0,y:0}),delete this._pointEventMap[t.identifier],this._currentPoints--,t=[35,2,this._playerId,t.identifier,r.point.x,r.point.y,i.x,i.y,e.x,e.y,r.targetId],r.local&&t.push(r.local),t):null},r.prototype._pointMoveAndUp=function(t,e,i,r){r.x=e.x-t.start.x,r.y=e.y-t.start.y,i.x=e.x-t.prev.x,i.y=e.y-t.prev.y,t.prev.x=e.x,t.prev.y=e.y},i.PointEventResolver=r},{}],48:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.RandomGenerator=void 0,i.RandomGenerator=function(t){this.seed=t}},{}],49:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],50:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],51:[function(t,e,i){"use strict";function r(t){this._value=t}Object.defineProperty(i,"__esModule",{value:!0}),i.RequireCachedValue=void 0,r.prototype._cachedValue=function(){return this._value},i.RequireCachedValue=r},{}],52:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Scene=void 0;var o=t("@akashic/trigger"),n=t("./AssetAccessor"),s=t("./AssetHolder"),h=t("./Camera2D"),r=t("./ExceptionFactory"),a=t("./TimerManager");function c(t){var e=t.game,i=void 0===t.local||!1===t.local?"non-local":!0===t.local?"full-local":t.local,r=void 0!==t.tickGenerationMode?t.tickGenerationMode:"by-clock";t.storageKeys?(this._storageLoader=e.storage._createLoader(t.storageKeys,t.storageValuesSerialization),this.storageValues=this._storageLoader._valueStore):(this._storageLoader=void 0,this.storageValues=void 0),this.name=t.name,this.game=e,this.local=i,this.tickGenerationMode=r,this.onLoad=new o.Trigger,this.loaded=this.onLoad,this._onReady=new o.Trigger,this._ready=this._onReady,this.assets={},this.asset=new n.AssetAccessor(e._assetManager),this._loaded=!1,this._prefetchRequested=!1,this._loadingState="initial",this.onUpdate=new o.Trigger,this.update=this.onUpdate,this._timer=new a.TimerManager(this.onUpdate,this.game.fps),this.onAssetLoad=new o.Trigger,this.onAssetLoadFailure=new o.Trigger,this.onAssetLoadComplete=new o.Trigger,this.assetLoaded=this.onAssetLoad,this.assetLoadFailed=this.onAssetLoadFailure,this.assetLoadCompleted=this.onAssetLoadComplete,this.onMessage=new o.Trigger,this.onPointDownCapture=new o.Trigger,this.onPointMoveCapture=new o.Trigger,this.onPointUpCapture=new o.Trigger,this.onOperation=new o.Trigger,this.message=this.onMessage,this.pointDownCapture=this.onPointDownCapture,this.pointMoveCapture=this.onPointMoveCapture,this.pointUpCapture=this.onPointUpCapture,this.operation=this.onOperation,this.children=[],this.state="standby",this.onStateChange=new o.Trigger,this._assetHolders=[],this._sceneAssetHolder=new s.AssetHolder({assetManager:this.game._assetManager,assetIds:t.assetIds,assetPaths:t.assetPaths,handlerSet:{owner:this,handleLoad:this._handleSceneAssetLoad,handleLoadFailure:this._handleSceneAssetLoadFailure,handleFinish:this._handleSceneAssetLoadFinish},userData:null})}c.prototype.modified=function(t){this.game.modified()},c.prototype.destroy=function(){this.state="before-destroyed",this.onStateChange.fire(this.state);for(var t=0,e=[this.game.db,this.game._localDb];t<e.length;t++)for(var i=e[t],r=0,o=i.keys();r<o.length;r++){var n=o[r],n=i.get(n);(null==n?void 0:n.scene)===this&&n.destroy()}this._timer.destroy(),this.onUpdate.destroy(),this.onMessage.destroy(),this.onPointDownCapture.destroy(),this.onPointMoveCapture.destroy(),this.onPointUpCapture.destroy(),this.onOperation.destroy(),this.onLoad.destroy(),this.onAssetLoad.destroy(),this.onAssetLoadFailure.destroy(),this.onAssetLoadComplete.destroy(),this.assets={};for(var s=0;s<this._assetHolders.length;++s)this._assetHolders[s].destroy();this._sceneAssetHolder.destroy(),this._storageLoader=void 0,this.game=void 0,this.state="destroyed",this.onStateChange.fire(this.state),this.onStateChange.destroy()},c.prototype.destroyed=function(){return void 0===this.game},c.prototype.createTimer=function(t){return this._timer.createTimer(t)},c.prototype.deleteTimer=function(t){this._timer.deleteTimer(t)},c.prototype.setInterval=function(t,e,i){return this._timer.setInterval(t,e,i)},c.prototype.clearInterval=function(t){this._timer.clearInterval(t)},c.prototype.setTimeout=function(t,e,i){return this._timer.setTimeout(t,e,i)},c.prototype.clearTimeout=function(t){this._timer.clearTimeout(t)},c.prototype.isCurrentScene=function(){return this.game.scene()===this},c.prototype.gotoScene=function(t,e){if(!this.isCurrentScene())throw r.ExceptionFactory.createAssertionError("Scene#gotoScene: this scene is not the current scene");e?this.game.pushScene(t):this.game.replaceScene(t)},c.prototype.end=function(){if(!this.isCurrentScene())throw r.ExceptionFactory.createAssertionError("Scene#end: this scene is not the current scene");this.game.popScene()},c.prototype.register=function(t){this.game.register(t),t.scene=this},c.prototype.unregister=function(t){t.scene=void 0,this.game.unregister(t)},c.prototype.append=function(t){this.insertBefore(t,void 0)},c.prototype.insertBefore=function(t,e){t.parent&&t.remove(),t.parent=this;var i=-1;void 0!==e&&-1<(i=this.children.indexOf(e))?this.children.splice(i,0,t):this.children.push(t),this.modified(!0)},c.prototype.remove=function(t){t=this.children.indexOf(t);-1!==t&&(this.children[t].parent=void 0,this.children.splice(t,1),this.modified(!0))},c.prototype.findPointSourceByPoint=function(t,e,i){for(var r="non-local"!==this.local,o=this.children,n=i&&i instanceof h.Camera2D?i.getMatrix():void 0,s=o.length-1;0<=s;--s){var a=o[s].findPointSourceByPoint(t,n,e);if(a)return a.local=a.target&&a.target.local||r,a}return{target:void 0,point:void 0,local:r}},c.prototype.prefetch=function(){this._loaded||this._prefetchRequested||(this._prefetchRequested=!0,this._sceneAssetHolder.request())},c.prototype.serializeStorageValues=function(){if(this._storageLoader)return this._storageLoader._valueStoreSerialization},c.prototype.requestAssets=function(t,e){var i=this;if("ready-fired"!==this._loadingState&&"loaded-fired"!==this._loadingState)throw r.ExceptionFactory.createAssertionError("Scene#requestAssets(): can be called after loaded.");t=new s.AssetHolder({assetManager:this.game._assetManager,assetIds:t,handlerSet:{owner:this,handleLoad:this._handleSceneAssetLoad,handleLoadFailure:this._handleSceneAssetLoadFailure,handleFinish:this._handleSceneAssetLoadFinish},userData:function(){i.destroyed()||e()}});this._assetHolders.push(t),t.request()},c.prototype._activate=function(){this.state="active",this.onStateChange.fire(this.state)},c.prototype._deactivate=function(){this.state="deactive",this.onStateChange.fire(this.state)},c.prototype._needsLoading=function(){return 0<this._sceneAssetHolder.waitingAssetsCount||!!this._storageLoader&&!this._storageLoader._loaded},c.prototype._load=function(){var t;this._loaded||(this._loaded=!0,t=this._sceneAssetHolder.request(),this._storageLoader&&(this._storageLoader._load(this),t=!0),t||this._notifySceneReady())},c.prototype._handleSceneAssetLoad=function(t){this.assets[t.id]=t,this.onAssetLoad.fire(t),this.onAssetLoadComplete.fire(t)},c.prototype._handleSceneAssetLoadFailure=function(t){this.onAssetLoadFailure.fire(t),this.onAssetLoadComplete.fire(t.asset)},c.prototype._handleSceneAssetLoadFinish=function(t,e){e?t.userData?this.game._pushPostTickTask(t.userData,null):!this._loaded||this._storageLoader&&!this._storageLoader._loaded||this._notifySceneReady():this.game.terminateGame()},c.prototype._onStorageLoadError=function(t){this.game.terminateGame()},c.prototype._onStorageLoaded=function(){0===this._sceneAssetHolder.waitingAssetsCount&&this._notifySceneReady()},c.prototype._notifySceneReady=function(){this._loadingState="ready",this.game._pushPostTickTask(this._fireReady,this)},c.prototype._fireReady=function(){this.destroyed()||(this._onReady.fire(this),this._loadingState="ready-fired")},c.prototype._fireLoaded=function(){this.destroyed()||"loaded-fired"!==this._loadingState&&(this.onLoad.fire(this),this._loadingState="loaded-fired")},i.Scene=c},{"./AssetAccessor":3,"./AssetHolder":5,"./Camera2D":15,"./ExceptionFactory":28,"./TimerManager":68,"@akashic/trigger":225}],53:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ScriptAssetContext=void 0;var r=t("./ExceptionFactory");function o(t,e){this._asset=t,this._module=e,this._started=!1}o.prototype._cachedValue=function(){if(this._started)return this._module.exports;throw r.ExceptionFactory.createAssertionError("ScriptAssetContext#_cachedValue: not executed yet.")},o.prototype._executeScript=function(t){return this._started||(t&&(this._module.parent=t).children.push(this._module),this._started=!0,this._asset.execute(this._module._runtimeValue),this._module.loaded=!0),this._module.exports},i.ScriptAssetContext=o},{"./ExceptionFactory":28}],54:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ShaderProgram=void 0,i.ShaderProgram=function(t){this.fragmentShader=t.fragmentShader,this.uniforms=t.uniforms}},{}],55:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],56:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SpriteFactory=void 0;var u=t("./entities/Sprite"),l=t("./ExceptionFactory");function r(){}r.createSpriteFromE=function(t,e,i){var r,o,n=e.x,s=e.y,a=0,h=0,c=(e.width,e.height,e.calculateBoundingRect());if(!c)throw l.ExceptionFactory.createAssertionError("SpriteFactory.createSpriteFromE: camera must look e");r=c.right-c.left,o=c.bottom-c.top,c.left<e.x&&(a=e.x-c.left),c.top<e.y&&(h=e.y-c.top),e.moveTo(a,h),e._matrix&&(e._matrix._modified=!0);a=t.game.resourceFactory.createSurface(Math.ceil(r),Math.ceil(o)),h=a.renderer(),h.begin(),e.render(h,i),h.end(),i=new u.Sprite({scene:t,src:a,width:r,height:o});return i.moveTo(c.left,c.top),e.moveTo(n,s),e._matrix&&(e._matrix._modified=!0),i},r.createSpriteFromScene=function(t,e,i){for(var r=t.game.resourceFactory.createSurface(Math.ceil(e.game.width),Math.ceil(e.game.height)),o=r.renderer(),n=(o.begin(),e.children),s=0;s<n.length;++s)n[s].render(o,i);return o.end(),new u.Sprite({scene:t,src:r,width:e.game.width,height:e.game.height})},i.SpriteFactory=r},{"./ExceptionFactory":28,"./entities/Sprite":84}],57:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Storage=i.StorageLoader=i.StorageValueStore=i.StorageCountsOperation=i.StorageCondition=i.StorageOrder=i.StorageRegion=void 0,(r=i.StorageRegion||(i.StorageRegion={}))[r.Slots=1]="Slots",r[r.Scores=2]="Scores",r[r.Counts=3]="Counts",r[r.Values=4]="Values",(r=i.StorageOrder||(i.StorageOrder={}))[r.Asc=0]="Asc",r[r.Desc=1]="Desc",(r=i.StorageCondition||(i.StorageCondition={}))[r.Equal=1]="Equal",r[r.GreaterThan=2]="GreaterThan",r[r.LessThan=3]="LessThan",(r=i.StorageCountsOperation||(i.StorageCountsOperation={}))[r.Incr=1]="Incr",r[r.Decr=2]="Decr",n.prototype.get=function(t){if(void 0!==this._values){if("number"==typeof t)return this._values[t];var e=this._keys.indexOf(t);if(-1!==e)return this._values[e];for(var i=0;i<this._keys.length;++i){var r=this._keys[i];if(r.region===t.region&&r.regionKey===t.regionKey&&r.userId===t.userId&&r.gameId===t.gameId)return this._values[i]}}return[]},n.prototype.getOne=function(t){t=this.get(t);if(t)return t[0]};var r,o=n;function n(t,e){this._keys=t,this._values=e}i.StorageValueStore=o;a.prototype._load=function(t){this._handler=t,this._storage._load&&this._storage._load.call(this._storage,this._valueStore._keys,this,this._valueStoreSerialization)},a.prototype._onLoaded=function(t,e){this._valueStore._values=t,this._loaded=!0,e&&(this._valueStoreSerialization=e),this._handler&&this._handler._onStorageLoaded()},a.prototype._onError=function(t){this._handler&&this._handler._onStorageLoadError(t)};var s=a;function a(t,e,i){this._loaded=!1,this._storage=t,this._valueStore=new o(e),this._handler=void 0,this._valueStoreSerialization=i}function h(){}i.StorageLoader=s,h.prototype.write=function(t,e,i){this._write&&this._write(t,e,i)},h.prototype.requestValuesForJoinPlayer=function(t){this._requestedKeysForJoinPlayer=t},h.prototype._createLoader=function(t,e){return new s(this,t,e)},h.prototype._registerWrite=function(t){this._write=t},h.prototype._registerLoad=function(t){this._load=t},i.Storage=h},{}],58:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SurfaceAtlas=void 0;var s=t("./SurfaceAtlasSlot");function r(t){this._surface=t,this._emptySurfaceAtlasSlotHead=new s.SurfaceAtlasSlot(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize={width:0,height:0}}r.prototype.reset=function(){var t=this._surface.renderer();t.begin(),t.clear(),t.end(),this._emptySurfaceAtlasSlotHead=new s.SurfaceAtlasSlot(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize.width=0,this._usedRectangleAreaSize.height=0},r.prototype._acquireSurfaceAtlasSlot=function(t,e){var i,r,o,n=function(t,e,i){for(;t;){if(t.width>=e&&t.height>=i)return t;t=t.next}return null}(this._emptySurfaceAtlasSlotHead,t+=1,e+=1);return n?(r=(o=n.width-t)<=(r=n.height-e)?(i=new s.SurfaceAtlasSlot(n.x+t,n.y,o,e),new s.SurfaceAtlasSlot(n.x,n.y+e,n.width,r)):(i=new s.SurfaceAtlasSlot(n.x,n.y+e,t,r),new s.SurfaceAtlasSlot(n.x+t,n.y,o,n.height)),i.prev=n.prev,i.next=r,null===i.prev?this._emptySurfaceAtlasSlotHead=i:i.prev.next=i,r.prev=i,r.next=n.next,r.next&&(r.next.prev=r),o=new s.SurfaceAtlasSlot(n.x,n.y,t,e),this._updateUsedRectangleAreaSize(o),o):null},r.prototype._updateUsedRectangleAreaSize=function(t){var e=t.x+t.width,t=t.y+t.height;e>this._usedRectangleAreaSize.width&&(this._usedRectangleAreaSize.width=e),t>this._usedRectangleAreaSize.height&&(this._usedRectangleAreaSize.height=t)},r.prototype.addSurface=function(t,e,i,r,o){var n,s=this._acquireSurfaceAtlasSlot(r,o);return s?((n=this._surface.renderer()).begin(),n.drawImage(t,e,i,r,o,s.x,s.y),n.end(),s):null},r.prototype.destroy=function(){this._surface.destroy()},r.prototype.destroyed=function(){return this._surface.destroyed()},r.prototype.getAtlasUsedSize=function(){return this._usedRectangleAreaSize},r.prototype.getAccessScore=function(){return this._accessScore},i.SurfaceAtlas=r},{"./SurfaceAtlasSlot":60}],59:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SurfaceAtlasSet=void 0;var r=t("./SurfaceAtlas");function o(t){this._surfaceAtlases=[],this._atlasGlyphsTable=[],this._resourceFactory=t.resourceFactory,this._currentAtlasIndex=0;var t=t.hint||{};this._maxAtlasNum=t.maxAtlasNum||o.INITIAL_MAX_SURFACEATLAS_NUM,t.initialAtlasWidth=t.initialAtlasWidth||512,t.initialAtlasHeight=t.initialAtlasHeight||512,t.maxAtlasWidth=t.maxAtlasWidth||512,t.maxAtlasHeight=t.maxAtlasHeight||512,this._atlasSize=(t=t,{width:Math.ceil(Math.min(t.initialAtlasWidth,t.maxAtlasWidth)),height:Math.ceil(Math.min(t.initialAtlasHeight,t.maxAtlasHeight))})}o.prototype._deleteAtlas=function(t){for(var e=0;e<t;++e){var i=this._spliceLeastFrequentlyUsedAtlas();if(!i)return;i.destroy()}},o.prototype._findLeastFrequentlyUsedAtlasIndex=function(){for(var t=Number.MAX_VALUE,e=-1,i=0;i<this._surfaceAtlases.length;++i)this._surfaceAtlases[i]._accessScore<=t&&(t=this._surfaceAtlases[i]._accessScore,e=i);return e},o.prototype._spliceLeastFrequentlyUsedAtlas=function(){var t=this._findLeastFrequentlyUsedAtlasIndex();if(-1===t)return null;this._currentAtlasIndex>=t&&--this._currentAtlasIndex;for(var e=this._surfaceAtlases.splice(t,1)[0],i=this._atlasGlyphsTable.splice(t,1)[0],r=0;r<i.length;r++){var o=i[r];o.surface=void 0,o.isSurfaceValid=!1,o._atlas=null}return e},o.prototype._moveGlyphSurface=function(t){for(var e=0;e<this._surfaceAtlases.length;++e){var i=(this._currentAtlasIndex+e)%this._surfaceAtlases.length,r=this._surfaceAtlases[i],o=r.addSurface(t.surface,t.x,t.y,t.width,t.height);if(o)return this._currentAtlasIndex=i,t.surface&&t.surface.destroy(),t.surface=r._surface,t.x=o.x,t.y=o.y,t._atlas=r,this._atlasGlyphsTable[i].push(t),!0}return!1},o.prototype._reallocateAtlas=function(){var t=null;this._surfaceAtlases.length>=this._maxAtlasNum?(t=this._spliceLeastFrequentlyUsedAtlas()).reset():t=new r.SurfaceAtlas(this._resourceFactory.createSurface(this._atlasSize.width,this._atlasSize.height)),this._surfaceAtlases.push(t),this._atlasGlyphsTable.push([]),this._currentAtlasIndex=this._surfaceAtlases.length-1},o.prototype.getAtlas=function(t){return this._surfaceAtlases[t]},o.prototype.getAtlasNum=function(){return this._surfaceAtlases.length},o.prototype.getMaxAtlasNum=function(){return this._maxAtlasNum},o.prototype.changeMaxAtlasNum=function(t){this._maxAtlasNum=t,this._surfaceAtlases.length>this._maxAtlasNum&&(t=this._surfaceAtlases.length-this._maxAtlasNum,this._deleteAtlas(t))},o.prototype.getAtlasUsedSize=function(){return this._atlasSize},o.prototype.addGlyph=function(t){return!(t.width>this._atlasSize.width||t.height>this._atlasSize.height)&&(!!this._moveGlyphSurface(t)||(this._reallocateAtlas(),this._moveGlyphSurface(t)))},o.prototype.touchGlyph=function(t){t._atlas&&(t._atlas._accessScore+=1);for(var e=0;e<this._surfaceAtlases.length;e++)this._surfaceAtlases[e]._accessScore/=2},o.prototype.destroy=function(){for(var t=0;t<this._surfaceAtlases.length;++t)this._surfaceAtlases[t].destroy();this._surfaceAtlases=void 0,this._resourceFactory=void 0,this._atlasGlyphsTable=void 0},o.prototype.destroyed=function(){return void 0===this._surfaceAtlases},o.INITIAL_MAX_SURFACEATLAS_NUM=10,i.SurfaceAtlasSet=o},{"./SurfaceAtlas":58}],60:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SurfaceAtlasSlot=void 0,i.SurfaceAtlasSlot=function(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r,this.prev=null,this.next=null}},{}],61:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],62:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SurfaceUtil=void 0;var r=t("./ExceptionFactory");function o(t,e,i,r,o){for(var n=(o="number"==typeof(o=void 0===o?4:o)?{top:o,bottom:o,left:o,right:o}:o).left,s=r.width-o.right,a=o.top,h=r.height-o.bottom,c=o.left,e=e-o.right,u=o.top,i=i-o.bottom,l=[{x:0,y:0,width:o.left,height:o.top},{x:s,y:0,width:o.right,height:o.top},{x:0,y:h,width:o.left,height:o.bottom},{x:s,y:h,width:o.right,height:o.bottom}],d=[{x:0,y:0},{x:e,y:0},{x:0,y:i},{x:e,y:i}],p=0;p<l.length;++p){var f=l[p];t.save(),t.translate(d[p].x,d[p].y),t.drawImage(r,f.x,f.y,f.width,f.height,0,0),t.restore()}for(var _=[{x:n,y:0,width:s-n,height:o.top},{x:0,y:a,width:o.left,height:h-a},{x:s,y:a,width:o.right,height:h-a},{x:n,y:h,width:s-n,height:o.bottom}],g=[{x:c,y:0,width:e-c,height:o.top},{x:0,y:u,width:o.left,height:i-u},{x:e,y:u,width:o.right,height:i-u},{x:c,y:i,width:e-c,height:o.bottom}],p=0;p<_.length;++p){var y=_[p],m=g[p];t.save(),t.translate(m.x,m.y),t.transform([m.width/y.width,0,0,m.height/y.height,0,0]),t.drawImage(r,y.x,y.y,y.width,y.height,0,0),t.restore()}o=s-n,s=h-a,h=e-c,e=i-u;t.save(),t.translate(c,u),t.transform([h/o,0,0,e/s,0,0]),t.drawImage(r,n,a,o,s,0,0),t.restore()}(t=i.SurfaceUtil||(i.SurfaceUtil={})).asSurface=function(t){if(t){if("type"in t&&"image"===t.type)return t.asSurface();if("_drawable"in t)return t;throw r.ExceptionFactory.createTypeMismatchError("SurfaceUtil#asSurface","ImageAsset|Surface",t)}},t.setupAnimatingHandler=function(t,e){e.isPlaying()&&t._handleAnimationStart()},t.migrateAnimatingHandler=function(t,e,i){t._handleAnimationStop(),i.isPlaying()&&t._handleAnimationStart()},t.drawNinePatch=function(t,e,i){void 0===i&&(i=4);var r=t.renderer();r.begin(),r.clear(),o(r,t.width,t.height,e,i),r.end()},t.renderNinePatch=o},{"./ExceptionFactory":28}],63:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TextAlign=void 0,(i=i.TextAlign||(i.TextAlign={}))[i.Left=0]="Left",i[i.Center=1]="Center",i[i.Right=2]="Right"},{}],64:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],65:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],66:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],67:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Timer=void 0;var r=t("@akashic/trigger");function o(t,e){this.interval=t,this._scaledInterval=Math.round(t*e),this.onElapse=new r.Trigger,this.elapsed=this.onElapse,this._scaledElapsed=0}o.prototype.tick=function(){for(this._scaledElapsed+=1e3;this._scaledElapsed>=this._scaledInterval&&this.onElapse;)this.onElapse.fire(),this._scaledElapsed-=this._scaledInterval},o.prototype.canDelete=function(){return!this.onElapse||0===this.onElapse.length},o.prototype.destroy=function(){this.interval=void 0,this.onElapse.destroy(),this.onElapse=void 0,this.elapsed=void 0,this._scaledInterval=0,this._scaledElapsed=0},o.prototype.destroyed=function(){return void 0===this.onElapse},i.Timer=o},{"@akashic/trigger":225}],68:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TimerManager=i.TimerIdentifier=void 0;var o=t("./ExceptionFactory"),n=t("./Timer"),r=(s.prototype.destroy=function(){this._timer.onElapse.remove(this._handleElapse,this),this._timer=void 0,this._handler=void 0,this._handlerOwner=void 0,this._fired=void 0,this._firedOwner=void 0},s.prototype.destroyed=function(){return void 0===this._timer},s.prototype._handleElapse=function(){this.destroyed()||(this._handler.call(this._handlerOwner),this._fired&&this._fired.call(this._firedOwner,this))},s);function s(t,e,i,r,o){this._timer=t,this._handler=e,this._handlerOwner=i,this._fired=r,this._firedOwner=o,this._timer.onElapse.add(this._handleElapse,this)}function a(t,e){this._timers=[],this._trigger=t,this._identifiers=[],this._fps=e,this._registered=!1}i.TimerIdentifier=r,a.prototype.destroy=function(){for(var t=0;t<this._identifiers.length;++t)this._identifiers[t].destroy();for(t=0;t<this._timers.length;++t)this._timers[t].destroy();this._timers=void 0,this._trigger=void 0,this._identifiers=void 0,this._fps=void 0},a.prototype.destroyed=function(){return void 0===this._timers},a.prototype.createTimer=function(t){if(this._registered||(this._trigger.add(this._tick,this),this._registered=!0),t<0)throw o.ExceptionFactory.createAssertionError("TimerManager#createTimer: invalid interval");t<1&&(t=1);for(var e=Math.min(1e3,t*this._fps),i=0;i<this._timers.length;++i)if(this._timers[i].interval===t&&this._timers[i]._scaledElapsed<e)return this._timers[i];var r=new n.Timer(t,this._fps);return this._timers.push(r),r},a.prototype.deleteTimer=function(t){if(t.canDelete()){var e=this._timers.indexOf(t);if(e<0)throw o.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: can not find timer");if(this._timers.splice(e,1),t.destroy(),!this._timers.length){if(!this._registered)throw o.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: handler is not handled");this._trigger.remove(this._tick,this),this._registered=!1}}},a.prototype.setTimeout=function(t,e,i){e=this.createTimer(e),e=new r(e,t,i,this._onTimeoutFired,this);return this._identifiers.push(e),e},a.prototype.clearTimeout=function(t){this._clear(t)},a.prototype.setInterval=function(t,e,i){e=this.createTimer(e),e=new r(e,t,i);return this._identifiers.push(e),e},a.prototype.clearInterval=function(t){this._clear(t)},a.prototype._tick=function(){for(var t=this._timers.concat(),e=0;e<t.length;++e)t[e].tick()},a.prototype._onTimeoutFired=function(t){var e=this._identifiers.indexOf(t);if(e<0)throw o.ExceptionFactory.createAssertionError("TimerManager#_onTimeoutFired: can not find identifier");this._identifiers.splice(e,1);e=t._timer;t.destroy(),this.deleteTimer(e)},a.prototype._clear=function(t){var e=this._identifiers.indexOf(t);if(e<0)throw o.ExceptionFactory.createAssertionError("TimerManager#_clear: can not find identifier");if(t.destroyed())throw o.ExceptionFactory.createAssertionError("TimerManager#_clear: invalid identifier");this._identifiers.splice(e,1);e=t._timer;t.destroy(),this.deleteTimer(e)},i.TimerManager=a},{"./ExceptionFactory":28,"./Timer":67}],69:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Util=void 0;var r,t=t("@akashic/pdi-types");(r=i.Util||(i.Util={})).distance=function(t,e,i,r){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2))},r.distanceBetweenOffsets=function(t,e){return r.distance(t.x,t.y,e.x,e.y)},r.distanceBetweenAreas=function(t,e){return r.distance(t.x+t.width/2,t.y+t.height/2,e.x+e.width/2,e.y+e.height/2)},r.charCodeAt=function(t,e){var i=t.charCodeAt(e);return 55296<=i&&i<=56319?i<<16|t.charCodeAt(e+1):56320<=i&&i<=57343?null:i},r.enumToSnakeCase=function(t,e){return(t=t[e])[0].toLowerCase()+t.slice(1).replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})},r.clamp=function(t,e,i){return Math.min(Math.max(t,e),i)},r.compositeOperationStringTable=((i={})[t.CompositeOperation.SourceOver]="source-over",i[t.CompositeOperation.SourceAtop]="source-atop",i[t.CompositeOperation.Lighter]="lighter",i[t.CompositeOperation.Copy]="copy",i[t.CompositeOperation.ExperimentalSourceIn]="experimental-source-in",i[t.CompositeOperation.ExperimentalSourceOut]="experimental-source-out",i[t.CompositeOperation.ExperimentalDestinationAtop]="experimental-destination-atop",i[t.CompositeOperation.ExperimentalDestinationIn]="experimental-destination-in",i[t.CompositeOperation.DestinationOut]="destination-out",i[t.CompositeOperation.DestinationOver]="destination-over",i[t.CompositeOperation.Xor]="xor",i)},{"@akashic/pdi-types":205}],70:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.VideoSystem=void 0,i.VideoSystem=function(){}},{}],71:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WeakRefKVS=void 0;o.prototype.deref=function(){return this._target};var r=o;function o(t){this._target=t}function n(){this._weakRefClass="undefined"!=typeof WeakRef?WeakRef:r,this._refMap=Object.create(null)}n.prototype.set=function(t,e){this._refMap[t]&&this.delete(t),this._refMap[t]=new this._weakRefClass(e)},n.prototype.get=function(t){t=this._refMap[t];if(t)return t.deref()},n.prototype.has=function(t){return t in this._refMap},n.prototype.delete=function(t){delete this._refMap[t]},n.prototype.keys=function(){return Object.keys(this._refMap)},n.prototype.clear=function(){this._refMap=Object.create(null)},n.prototype.clean=function(){for(var t=0,e=Object.entries(this._refMap);t<e.length;t++){var i=e[t],r=i[0];void 0===i[1].deref()&&this.delete(r)}},i.WeakRefKVS=n},{}],72:[function(t,e,i){"use strict";function r(t){t=Array.isArray(t)?t:this.generateSeeds(t);this._state0U=0|t[0],this._state0L=0|t[1],this._state1U=0|t[2],this._state1L=0|t[3]}Object.defineProperty(i,"__esModule",{value:!0}),i.Xorshift=void 0,r.deserialize=function(t){return new r([t._state0U,t._state0L,t._state1U,t._state1L])},r.prototype.initState=function(t){t=this.generateSeeds(t);this._state0L=0|t[0],this._state0U=0|t[1],this._state1L=0|t[2],this._state1U=0|t[3]},r.prototype.randomInt=function(){var t=this._state0U,e=this._state0L,i=this._state1U,r=this._state1L,o=(r>>>0)+(e>>>0),n=i+t+(o/2>>>31)>>>0,o=o>>>0,s=0,a=0;s=(t^=s=t<<23|(-512&e)>>>9)^(this._state0U=i),s^=t>>>18;return a=(a=(e^=a=e<<23)^(this._state0L=r))^(e>>>18|(262143&t)<<14)^(r>>>5|(31&i)<<27),this._state1U=s^=i>>>5,this._state1L=a,[n,o]},r.prototype.random=function(){var t=this.randomInt();return 2.3283064365386963e-10*t[0]+2220446049250313e-31*(t[1]>>>12)},r.prototype.nextInt=function(t,e){return Math.floor(t+this.random()*(e-t))},r.prototype.serialize=function(){return{_state0U:this._state0U,_state0L:this._state0L,_state1U:this._state1U,_state1L:this._state1L}},r.prototype.generateSeeds=function(t){var e=1812433253,i=t=e*(t^t>>30)+1,r=t=e*(t^t>>30)+2,o=t=e*(t^t>>30)+3;t=e*(t^t>>30)+4;return[i,r,o,t]},i.Xorshift=r},{}],73:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.XorshiftRandomGenerator=void 0,t("./ExceptionFactory")),a=t("./RandomGenerator"),h=t("./Xorshift"),t=(o=a.RandomGenerator,n(c,o),c.deserialize=function(t){return new c(t._seed,t._xorshift)},c.prototype.get=function(t,e){return this._xorshift.nextInt(t,e+1)},c.prototype.generate=function(){return this._xorshift.random()},c.prototype.serialize=function(){return{_seed:this.seed,_xorshift:this._xorshift.serialize()}},c);function c(t,e){var i=this;if(void 0===t)throw s.ExceptionFactory.createAssertionError("XorshiftRandomGenerator#constructor: seed is undefined");return(i=o.call(this,t)||this)._xorshift=e?h.Xorshift.deserialize(e):new h.Xorshift(t),i}i.XorshiftRandomGenerator=t},{"./ExceptionFactory":28,"./RandomGenerator":48,"./Xorshift":72}],74:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.EmptyGeneratedVectorImageAsset=void 0,t("./EmptyVectorImageAsset")),t=(o=t.EmptyVectorImageAsset,n(s,o),s);function s(t,e,i){t=o.call(this,t,e,0,0)||this;return t.data=i,t}i.EmptyGeneratedVectorImageAsset=t},{"./EmptyVectorImageAsset":75}],75:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.EmptyVectorImageAsset=void 0;var n=t("@akashic/trigger");function r(t,e,i,r,o){this.type="vector-image",this.width=0,this.height=0,this.onDestroyed=new n.Trigger,this.id=t,this.path=e,this.originalPath=e,this.width=i,this.height=r,this.hint=o}r.prototype.createSurface=function(t,e,i,r,o,n){return null},r.prototype.inUse=function(){return!1},r.prototype.destroy=function(){this.destroyed()||(this.onDestroyed.destroy(),this.onDestroyed=void 0)},r.prototype.destroyed=function(){return!this.onDestroyed},r.prototype._load=function(t){t._onAssetLoad(this)},r.prototype._assetPathFilter=function(t){return t},i.EmptyVectorImageAsset=r},{"@akashic/trigger":225}],76:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PartialImageAsset=void 0;var s=t("@akashic/trigger");function r(t,e,i,r,o,n){this.type="image",this.hint=void 0,this.onDestroyed=new s.Trigger,this._surface=null,this._loadHandler=null,this.id=e,this.path=i,this.originalPath=i,this.width=n.width,this.height=n.height,this._slice=n,this._resourceFactory=t;n="".concat(e,"/<internal>");this._src=t.createImageAsset(n,i,r,o)}r.prototype.initialize=function(t){this.hint=t,this._src.initialize(t)},r.prototype.inUse=function(){return!1},r.prototype.destroy=function(){this.destroyed()||(this.onDestroyed.fire(this),this._src.destroy(),this._src=null,this._slice=null,this._resourceFactory=null,this._surface=null,this._loadHandler=null,this.onDestroyed.destroy(),this.onDestroyed=void 0)},r.prototype.destroyed=function(){return!this._src},r.prototype.asSurface=function(){var t,e,i,r,o,n;return this._surface||(t=(r=this._slice).x,e=r.y,i=r.width,r=r.height,(n=(o=this._resourceFactory.createSurface(i,r)).renderer()).begin(),n.drawImage(this._src.asSurface(),t,e,i,r,0,0),n.end(),this._surface=o)},r.prototype._load=function(t){this._loadHandler=t,this._src._load(this)},r.prototype._onAssetLoad=function(t){this._loadHandler._onAssetLoad(this)},r.prototype._onAssetError=function(t,e){this._loadHandler._onAssetError(this,e)},r.prototype._assetPathFilter=function(t){return t},i.PartialImageAsset=r},{"@akashic/trigger":225}],77:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.CacheableE=void 0,t("./E")),t=(o=t.E,n(s,o),s.prototype.invalidate=function(){this.state&=-3,this.modified()},s.prototype.renderSelf=function(t,e){var i,r,o,n=s.PADDING;return this._renderedCamera!==e&&(this.state&=-3,this._renderedCamera=e),2&this.state||(this._cacheSize=this.calculateCacheSize(),o=Math.ceil(this._cacheSize.width)+2*n,i=Math.ceil(this._cacheSize.height)+2*n,(r=!this._cache||this._cache.width<o||this._cache.height<i)&&(this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=this.scene.game.resourceFactory.createSurface(o,i),this._renderer=this._cache.renderer()),(o=this._renderer).begin(),r||o.clear(),o.save(),o.translate(n,n),this.renderCache(o,e),o.restore(),this.state|=2,o.end()),this._cache&&0<this._cacheSize.width&&0<this._cacheSize.height&&(t.translate(-n,-n),this.renderSelfFromCache(t),t.translate(n,n)),this._shouldRenderChildren},s.prototype.renderSelfFromCache=function(t){t.drawImage(this._cache,0,0,this._cacheSize.width+s.PADDING,this._cacheSize.height+s.PADDING,0,0)},s.prototype.destroy=function(){this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=void 0,o.prototype.destroy.call(this)},s.prototype.calculateCacheSize=function(){return{width:this.width,height:this.height}},s.PADDING=1,s);function s(t){t=o.call(this,t)||this;return t._shouldRenderChildren=!0,t._cache=void 0,t._renderer=void 0,t._renderedCamera=void 0,t}i.CacheableE=t},{"./E":79}],78:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.CameraCancellingE=void 0,t("../Object2D")),t=t("./E"),t=(o=t.E,n(a,o),a.prototype.renderSelf=function(t,e){if(this.children){e&&(r=this._canceller,(i=e).x===r.x&&i.y===r.y&&i.angle===r.angle&&i.scaleX===r.scaleX&&i.scaleY===r.scaleY||(r.x=i.x,r.y=i.y,r.angle=i.angle,r.scaleX=i.scaleX,r.scaleY=i.scaleY,r._matrix&&(r._matrix._modified=!0)),t.save(),t.transform(r.getMatrix()._matrix));for(var i,r,o=this.children,n=0;n<o.length;++n)o[n].render(t,e);e&&t.restore()}return!1},a);function a(t){t=o.call(this,t)||this;return t._canceller=new s.Object2D,t}i.CameraCancellingE=t},{"../Object2D":40,"./E":79}],79:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.E=i.PointMoveEvent=i.PointUpEvent=i.PointDownEvent=void 0,t("@akashic/trigger")),a=t("../Event"),h=t("../ExceptionFactory"),c=t("../Matrix"),u=t("../Object2D"),l=t("../Util"),t=(o=a.PointDownEventBase,n(d,o),d);function d(){return null!==o&&o.apply(this,arguments)||this}i.PointDownEvent=t;p=a.PointUpEventBase,n(f,p);var p,t=f;function f(){return null!==p&&p.apply(this,arguments)||this}i.PointUpEvent=t;_=a.PointMoveEventBase,n(g,_);var _,t=g;function g(){return null!==_&&_.apply(this,arguments)||this}i.PointMoveEvent=t;y=u.Object2D,n(m,y),Object.defineProperty(m.prototype,"onUpdate",{get:function(){return this._onUpdate||(this._onUpdate=new s.ChainTrigger(this.scene.onUpdate)),this._onUpdate},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"onMessage",{get:function(){return this._onMessage||(this._onMessage=new s.ChainTrigger(this.scene.onMessage)),this._onMessage},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"onPointDown",{get:function(){return this._onPointDown||(this._onPointDown=new s.ChainTrigger(this.scene.onPointDownCapture,this._isTargetOperation,this)),this._onPointDown},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"onPointUp",{get:function(){return this._onPointUp||(this._onPointUp=new s.ChainTrigger(this.scene.onPointUpCapture,this._isTargetOperation,this)),this._onPointUp},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"onPointMove",{get:function(){return this._onPointMove||(this._onPointMove=new s.ChainTrigger(this.scene.onPointMoveCapture,this._isTargetOperation,this)),this._onPointMove},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"touchable",{get:function(){return this._touchable},set:function(t){this._touchable!==t&&((this._touchable=t)?this._enableTouchPropagation():this._disableTouchPropagation())},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"update",{get:function(){return this.onUpdate},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"message",{get:function(){return this.onMessage},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"pointDown",{get:function(){return this.onPointDown},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"pointUp",{get:function(){return this.onPointUp},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"pointMove",{get:function(){return this.onPointMove},enumerable:!1,configurable:!0}),m.prototype.render=function(t,e){if(this.state&=-5,!(1&this.state))if(8&this.state){if(t.translate(this.x,this.y),this.renderSelf(t,e)&&this.children)for(var i=(n=this.children).length,r=0;r<i;++r)n[r].render(t,e);t.translate(-this.x,-this.y)}else{t.save(),this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(this.x,this.y),1!==this.opacity&&t.opacity(this.opacity);var o=this.compositeOperation;if(void 0!==o&&t.setCompositeOperation("string"==typeof o?o:l.Util.compositeOperationStringTable[o]),void 0!==this.shaderProgram&&t.isSupportedShaderProgram()&&t.setShaderProgram(this.shaderProgram),this.renderSelf(t,e)&&this.children)for(var n=this.children,r=0;r<n.length;++r)n[r].render(t,e);t.restore()}},m.prototype.renderSelf=function(t,e){return!0},m.prototype.game=function(){return this.scene.game},m.prototype.append=function(t){this.insertBefore(t,void 0)},m.prototype.insertBefore=function(t,e){t.parent&&t.remove(),this.children||(this.children=[]),t.parent=this;var i=-1;void 0!==e&&-1<(i=this.children.indexOf(e))?this.children.splice(i,0,t):this.children.push(t),(t._touchable||t._hasTouchableChildren)&&(this._hasTouchableChildren=!0,this._enableTouchPropagation()),this.modified(!0)},m.prototype.remove=function(t){if(void 0===t)this.parent.remove(this);else{var e=this.children?this.children.indexOf(t):-1;if(e<0)throw h.ExceptionFactory.createAssertionError("E#remove: invalid child");this.children[e].parent=void 0,this.children.splice(e,1),!t._touchable&&!t._hasTouchableChildren||this._findTouchableChildren(this)||(this._hasTouchableChildren=!1,this._disableTouchPropagation()),this.modified(!0)}},m.prototype.destroy=function(){if(this.parent&&this.remove(),this.children){for(var t=this.children.length-1;0<=t;--t)this.children[t].destroy();if(0!==this.children.length)throw h.ExceptionFactory.createAssertionError("E#destroy: can not destroy all children, "+this.children.length);this.children=void 0}this._onUpdate&&(this._onUpdate.destroy(),this._onUpdate=void 0),this._onMessage&&(this._onMessage.destroy(),this._onMessage=void 0),this._onPointDown&&(this._onPointDown.destroy(),this._onPointDown=void 0),this._onPointMove&&(this._onPointMove.destroy(),this._onPointMove=void 0),this._onPointUp&&(this._onPointUp.destroy(),this._onPointUp=void 0),this.scene.unregister(this)},m.prototype.destroyed=function(){return void 0===this.scene},m.prototype.modified=function(t){this._matrix&&(this._matrix._modified=!0),this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY||1!==this.opacity||void 0!==this.compositeOperation||void 0!==this.shaderProgram?this.state&=-9:this.state|=8,4&this.state||(this.state|=4,this.parent&&this.parent.modified(!0))},m.prototype.shouldFindChildrenByPoint=function(t){return!0},m.prototype.findPointSourceByPoint=function(t,e,i){if(!(1&this.state)){var r=(e=e?e.multiplyNew(this.getMatrix()):this.getMatrix().clone()).multiplyInverseForPoint(t);if(this._hasTouchableChildren||i&&this.children&&this.children.length){var o=this.children;if(this.shouldFindChildrenByPoint(r))for(var n=o.length-1;0<=n;--n){var s=o[n];if(i||s._touchable||s._hasTouchableChildren){s=s.findPointSourceByPoint(t,e,i);if(s)return s}}}return i||this._touchable?0<=r.x&&this.width>r.x&&0<=r.y&&this.height>r.y?{target:this,point:r}:void 0:void 0}},m.prototype.visible=function(){return 1!=(1&this.state)},m.prototype.show=function(){1&this.state&&(this.state&=-2,this.parent&&this.parent.modified(!0))},m.prototype.hide=function(){1&this.state||(this.state|=1,this.parent&&this.parent.modified(!0))},m.prototype.calculateBoundingRect=function(){return this._calculateBoundingRect(void 0)},m.prototype.localToGlobal=function(t){for(var e=t,i=this;i instanceof m;i=i.parent)e=i.getMatrix().multiplyPoint(e);return e},m.prototype.globalToLocal=function(t){for(var e=new c.PlainMatrix,i=this;i instanceof m;i=i.parent)e.multiplyLeft(i.getMatrix());return e.multiplyInverseForPoint(t)},m.prototype._calculateMatrixTo=function(t){for(var e=new c.PlainMatrix,i=this;i instanceof m&&i!==t;i=i.parent)e.multiplyLeft(i.getMatrix());return e},m.prototype._findLowestCommonAncestorWith=function(t){for(var e={},i=this;i instanceof m;i=i.parent)e[i.id]=!0;for(var r=t;r instanceof m&&!e.hasOwnProperty(r.id);r=r.parent);return r},m.prototype._calculateBoundingRect=function(t){var e=this.getMatrix();if(t&&(e=t.multiplyNew(e)),this.visible()){for(var t={left:0,right:this.width,top:0,bottom:this.height},i=[{x:t.left,y:t.top},{x:t.left,y:t.bottom},{x:t.right,y:t.top},{x:t.right,y:t.bottom}],r=e.multiplyPoint(i[0]),o={left:r.x,right:r.x,top:r.y,bottom:r.y},n=1;n<i.length;++n)r=e.multiplyPoint(i[n]),o.left>r.x&&(o.left=r.x),o.right<r.x&&(o.right=r.x),o.top>r.y&&(o.top=r.y),o.bottom<r.y&&(o.bottom=r.y);if(void 0!==this.children)for(n=0;n<this.children.length;++n){var s=this.children[n]._calculateBoundingRect(e);s&&(o.left>s.left&&(o.left=s.left),o.right<s.right&&(o.right=s.right),o.top>s.top&&(o.top=s.top),o.bottom<s.bottom&&(o.bottom=s.bottom))}return o}},m.prototype._enableTouchPropagation=function(){for(var t=this.parent;t instanceof m&&!t._hasTouchableChildren;)t._hasTouchableChildren=!0,t=t.parent},m.prototype._disableTouchPropagation=function(){for(var t=this.parent;t instanceof m&&t._hasTouchableChildren&&!this._findTouchableChildren(t);)t._hasTouchableChildren=!1,t=t.parent},m.prototype._isTargetOperation=function(t){return!(1&this.state)&&(t instanceof a.PointEventBase&&(this._touchable&&t.target===this))},m.prototype._findTouchableChildren=function(t){if(t.children)for(var e=0;e<t.children.length;++e){if(t.children[e].touchable)return t.children[e];var i=this._findTouchableChildren(t.children[e]);if(i)return i}};var y,t=m;function m(t){var e=y.call(this,t)||this;if(e.children=void 0,e.parent=void 0,e._touchable=!1,e.state=0,e._hasTouchableChildren=!1,e._onUpdate=void 0,e._onMessage=void 0,e._onPointDown=void 0,e._onPointMove=void 0,e._onPointUp=void 0,e.tag=t.tag,e.shaderProgram=t.shaderProgram,e.local="non-local"!==t.scene.local||!!t.local,t.children)for(var i=0;i<t.children.length;++i)e.append(t.children[i]);return t.parent&&t.parent.append(e),null!=t.touchable&&(e.touchable=t.touchable),t.hidden&&e.hide(),e.id=t.id,t.scene.register(e),e}i.E=t},{"../Event":22,"../ExceptionFactory":28,"../Matrix":36,"../Object2D":40,"../Util":69,"@akashic/trigger":225}],80:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.FilledRect=void 0,t("../ExceptionFactory")),t=t("./E"),t=(o=t.E,n(a,o),a.prototype.renderSelf=function(t){return t.fillRect(0,0,this.width,this.height,this.cssColor),!0},a);function a(t){var e=o.call(this,t)||this;if("string"!=typeof t.cssColor)throw s.ExceptionFactory.createTypeMismatchError("ColorBox#constructor(cssColor)","string",t.cssColor);return e.cssColor=t.cssColor,e}i.FilledRect=t},{"../ExceptionFactory":28,"./E":79}],81:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.FrameSprite=void 0,t("@akashic/trigger")),t=t("./Sprite"),t=(o=t.Sprite,n(a,o),a.createBySprite=function(t,e,i){var r=new a({scene:t.scene,src:t.src,width:void 0===e?t.width:e,height:void 0===i?t.height:i});return r.srcHeight=void 0===i?t.srcHeight:i,r.srcWidth=void 0===e?t.srcWidth:e,r},a.prototype.start=function(){void 0===this.interval&&(this.interval=1e3/this.game().fps),this._timer&&this._free(),this._timer=this.scene.createTimer(this.interval),this._timer.onElapse.add(this._handleElapse,this)},a.prototype.destroy=function(t){this.stop(),o.prototype.destroy.call(this,t)},a.prototype.stop=function(){this._timer&&this._free()},a.prototype.modified=function(t){this._modifiedSelf(t),o.prototype.modified.call(this,t)},a.prototype._handleElapse=function(){this.frameNumber===this.frames.length-1?this.loop?this.frameNumber=0:(this.stop(),this.onFinish.fire()):this.frameNumber++,this.modified()},a.prototype._free=function(){this._timer&&(this._timer.onElapse.remove(this._handleElapse,this),this._timer.canDelete()&&this.scene.deleteTimer(this._timer),this._timer=void 0)},a.prototype._changeFrame=function(){var t=this.frames[this.frameNumber],e=Math.floor(this._surface.width/this.srcWidth);this.srcX=t%e*this.srcWidth,this.srcY=Math.floor(t/e)*this.srcHeight,this._lastUsedIndex=t},a.prototype._modifiedSelf=function(t){this._lastUsedIndex!==this.frames[this.frameNumber]&&this._changeFrame()},a);function a(t){var e=o.call(this,t)||this;return e._lastUsedIndex=0,e.frameNumber=t.frameNumber||0,e.frames=null!=t.frames?t.frames:[0],e.interval=t.interval,e._timer=void 0,e.loop=null==t.loop||t.loop,e.onFinish=new s.Trigger,e.finished=e.onFinish,e._modifiedSelf(),e}i.FrameSprite=t},{"./Sprite":84,"@akashic/trigger":225}],82:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),h=(Object.defineProperty(i,"__esModule",{value:!0}),i.Label=void 0,t("../TextAlign")),c=t("../Util"),s=t("./CacheableE"),t=(o=s.CacheableE,n(a,o),a.prototype.aligning=function(t,e){this.width=t,this.widthAutoAdjust=!1,this.textAlign=e},a.prototype.invalidate=function(){this._invalidateSelf(),o.prototype.invalidate.call(this)},a.prototype.renderSelfFromCache=function(t){var e;switch(this._realTextAlign){case"center":e=this.widthAutoAdjust?this._overhangLeft:0;break;case"right":e=this.widthAutoAdjust?this._overhangLeft:this._overhangRight;break;default:e=this._overhangLeft}t.drawImage(this._cache,0,0,this._cacheSize.width+s.CacheableE.PADDING,this._cacheSize.height+s.CacheableE.PADDING,e,0)},a.prototype.renderCache=function(t){if(!(!this.fontSize||this.height<=0||this._textWidth<=0)){var e=this.maxWidth&&0<this.maxWidth&&this.maxWidth<this._textWidth?this.maxWidth/this._textWidth:1,i=0;switch(this._realTextAlign){case"center":i=this.width/2-(this._textWidth+this._overhangLeft)/2*e;break;case"right":i=this.width-(this._textWidth+this._overhangLeft)*e;break;default:i-=this._overhangLeft*e}t.translate(Math.round(i),0),1!=e&&t.transform([e,0,0,1,0,0]),t.save();for(var r=this.fontSize/this.font.size,o=0,n=0;n<this.glyphs.length;++n){var s=this.glyphs[n],a=s.advanceWidth*r,h=s.code;s.isSurfaceValid||(s=this.font.glyphForCharacter(h))?(s.surface&&(t.save(),t.translate(Math.round(o),0),t.transform([r,0,0,r,0,0]),t.drawImage(s.surface,s.x,s.y,s.width,s.height,s.offsetX,s.offsetY),t.restore()),o+=a):this._outputOfWarnLogWithNoGlyph(h,"renderCache()")}t.restore(),t.save(),this.textColor&&(t.setCompositeOperation("source-atop"),t.fillRect(0,0,this._textWidth,this.height,this.textColor)),t.restore()}},a.prototype.destroy=function(){o.prototype.destroy.call(this)},a.prototype._invalidateSelf=function(){this.glyphs.length=0,this._textWidth=0;var t=this.textAlign;if(this._realTextAlign="string"==typeof t?t:c.Util.enumToSnakeCase(h.TextAlign,t),this.fontSize){for(var e=this.text.length-1,i=this.text.length-1;0<=i;--i){var r=c.Util.charCodeAt(this.text,i);if(r)if((o=this.font.glyphForCharacter(r))&&0!==o.width&&0!==o.advanceWidth){e=i;break}}for(var o,n,s=0,a=0<this.font.size?this.fontSize/this.font.size:0,i=0;i<=e;++i)(r=c.Util.charCodeAt(this.text,i))&&((o=this.font.glyphForCharacter(r))?o.width<0||o.height<0||o.x<0||o.y<0||(this.glyphs.push(o),(n=0)===i&&(this._overhangLeft=Math.min(o.offsetX,0),n=-this._overhangLeft),i===e&&(this._overhangRight=Math.max(o.width+o.offsetX-o.advanceWidth,0),n+=this._overhangRight),this._textWidth+=(o.advanceWidth+n)*a,s<(n=o.offsetY+o.height)&&(s=n)):this._outputOfWarnLogWithNoGlyph(r,"_invalidateSelf()"));this.widthAutoAdjust&&(this.width=this._textWidth),this.height=s*a}else this.height=0},a.prototype._outputOfWarnLogWithNoGlyph=function(t,e){t=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t);console.warn("Label#"+e+": failed to get a glyph for '"+t+"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).")},a);function a(t){var e=o.call(this,t)||this;return e.text=t.text,e.font=t.font,e.textAlign=null!=t.textAlign?t.textAlign:h.TextAlign.Left,e.glyphs=new Array(t.text.length),e.fontSize=null!=t.fontSize?t.fontSize:t.font.size,e.maxWidth=t.maxWidth,e.widthAutoAdjust=null==t.widthAutoAdjust||t.widthAutoAdjust,e.textColor=t.textColor,e._realTextAlign="left",e._textWidth=0,e._overhangLeft=0,e._overhangRight=0,e._invalidateSelf(),e}i.Label=t},{"../TextAlign":63,"../Util":69,"./CacheableE":77}],83:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.Pane=void 0,t("../SurfaceUtil")),t=t("./CacheableE"),t=(o=t.CacheableE,n(a,o),Object.defineProperty(a.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding=t,this._paddingChanged=!0},enumerable:!1,configurable:!0}),a.prototype.modified=function(t){t&&(this.state&=-3),o.prototype.modified.call(this)},a.prototype.shouldFindChildrenByPoint=function(t){var e=this._normalizedPadding;return e.left<t.x&&this.width-e.right>t.x&&e.top<t.y&&this.height-e.bottom>t.y},a.prototype.renderCache=function(t,e){this.width<=0||this.height<=0||(this._renderBackground(),this._renderChildren(e),this._bgSurface?t.drawImage(this._bgSurface,0,0,this.width,this.height,0,0):this._backgroundImageSurface&&t.drawImage(this._backgroundImageSurface,0,0,this.width,this.height,0,0),this._childrenArea.width<=0||this._childrenArea.height<=0||(t.save(),0===this._childrenArea.x&&0===this._childrenArea.y||t.translate(this._childrenArea.x,this._childrenArea.y),t.drawImage(this._childrenSurface,0,0,this._childrenArea.width,this._childrenArea.height,0,0),t.restore()))},a.prototype.destroy=function(t){t&&this._backgroundImageSurface&&!this._backgroundImageSurface.destroyed()&&this._backgroundImageSurface.destroy(),this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this.backgroundImage=void 0,this._backgroundImageSurface=void 0,this._beforeBackgroundImage=void 0,this._bgSurface=void 0,this._childrenSurface=void 0,o.prototype.destroy.call(this)},a.prototype._renderBackground=function(){var t;this.backgroundImage!==this._beforeBackgroundImage&&(this._backgroundImageSurface=s.SurfaceUtil.asSurface(this.backgroundImage),this._beforeBackgroundImage=this.backgroundImage),this._backgroundImageSurface&&this.backgroundEffector?(t=this.backgroundEffector.render(this._backgroundImageSurface,this.width,this.height),this._bgSurface!==t&&(this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._bgSurface=t)):this._bgSurface=void 0},a.prototype._renderChildren=function(t){var e=this._oldWidth!==this.width||this._oldHeight!==this.height||this._paddingChanged;if(e&&(this._initialize(),this._paddingChanged=!1,this._oldWidth=this.width,this._oldHeight=this.height),this._childrenRenderer.begin(),e||this._childrenRenderer.clear(),this.children)for(var i=this.children,r=0;r<i.length;++r)i[r].render(this._childrenRenderer,t);this._childrenRenderer.end()},a.prototype._initialize=function(){var t=this._padding,t="number"==typeof t?{top:t,bottom:t,left:t,right:t}:this._padding,e=(this._childrenArea={x:t.left,y:t.top,width:this.width-t.left-t.right,height:this.height-t.top-t.bottom},this.scene.game.resourceFactory);this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this._childrenSurface=e.createSurface(Math.ceil(this._childrenArea.width),Math.ceil(this._childrenArea.height)),this._childrenRenderer=this._childrenSurface.renderer(),this._normalizedPadding=t},a.prototype._calculateBoundingRect=function(t){var e=this.getMatrix();if(t&&(e=t.multiplyNew(e)),this.visible()){for(var t={left:0,right:this.width,top:0,bottom:this.height},i=[{x:t.left,y:t.top},{x:t.left,y:t.bottom},{x:t.right,y:t.top},{x:t.right,y:t.bottom}],r=e.multiplyPoint(i[0]),o={left:r.x,right:r.x,top:r.y,bottom:r.y},n=1;n<i.length;++n)r=e.multiplyPoint(i[n]),o.left>r.x&&(o.left=r.x),o.right<r.x&&(o.right=r.x),o.top>r.y&&(o.top=r.y),o.bottom<r.y&&(o.bottom=r.y);return o}},a);function a(t){var e=o.call(this,t)||this;return e._oldWidth=t.width,e._oldHeight=t.height,e.backgroundImage=t.backgroundImage,e._beforeBackgroundImage=t.backgroundImage,e._backgroundImageSurface=s.SurfaceUtil.asSurface(t.backgroundImage),e.backgroundEffector=t.backgroundEffector,e._shouldRenderChildren=!1,e._padding=t.padding||0,e._initialize(),e._paddingChanged=!1,e}i.Pane=t},{"../SurfaceUtil":62,"./CacheableE":77}],84:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.Sprite=void 0,t("../Matrix")),a=t("../SurfaceUtil"),t=t("./E"),t=(o=t.E,n(h,o),h.prototype._handleUpdate=function(){this.modified()},h.prototype._handleAnimationStart=function(){this.onUpdate.contains(this._handleUpdate,this)||this.onUpdate.add(this._handleUpdate,this)},h.prototype._handleAnimationStop=function(){this.destroyed()||this.onUpdate.remove(this._handleUpdate,this)},h.prototype.renderSelf=function(t,e){return this.srcWidth<=0||this.srcHeight<=0||(this._stretchMatrix&&(t.save(),t.transform(this._stretchMatrix._matrix)),t.drawImage(this._surface,this.srcX,this.srcY,this.srcWidth,this.srcHeight,0,0),this._stretchMatrix&&t.restore()),!0},h.prototype.invalidate=function(){this._invalidateSelf(),this.modified()},h.prototype.destroy=function(t){this._surface&&!this._surface.destroyed()&&t&&this._surface.destroy(),this.src=void 0,this._beforeSrc=void 0,this._surface=void 0,o.prototype.destroy.call(this)},h.prototype._invalidateSelf=function(){this.width===this.srcWidth&&this.height===this.srcHeight?this._stretchMatrix=void 0:(this._stretchMatrix=new s.PlainMatrix,this._stretchMatrix.scale(this.width/this.srcWidth,this.height/this.srcHeight)),this.src!==this._beforeSrc&&(this._beforeSrc=this.src,"_drawable"in this.src?this._surface=this.src:this._surface=a.SurfaceUtil.asSurface(this.src)),this._surface!==this._beforeSurface&&(a.SurfaceUtil.migrateAnimatingHandler(this,this._beforeSurface,this._surface),this._beforeSurface=this._surface)},h);function h(t){var e=o.call(this,t)||this;return e.src=t.src,"_drawable"in t.src?e._surface=t.src:e._surface=a.SurfaceUtil.asSurface(t.src),null==t.width&&(e.width=e._surface.width),null==t.height&&(e.height=e._surface.height),e.srcWidth=null!=t.srcWidth?t.srcWidth:e.width,e.srcHeight=null!=t.srcHeight?t.srcHeight:e.height,e.srcX=t.srcX||0,e.srcY=t.srcY||0,e._stretchMatrix=void 0,e._beforeSrc=e.src,e._beforeSurface=e._surface,a.SurfaceUtil.setupAnimatingHandler(e,e._surface),e._invalidateSelf(),e}i.Sprite=t},{"../Matrix":36,"../SurfaceUtil":62,"./E":79}],85:[function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var o=Object.getOwnPropertyDescriptor(e,i);o&&("get"in o?e.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,o)}:function(t,e,i,r){t[r=void 0===r?i:r]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)},n=(Object.defineProperty(i,"__esModule",{value:!0}),i.VideoSystem=i.ShaderProgram=i.Module=i.AudioSystem=void 0,o(t("@akashic/game-configuration"),i),o(t("@akashic/trigger"),i),o(t("@akashic/pdi-types"),i),t("./AudioSystem")),s=(Object.defineProperty(i,"AudioSystem",{enumerable:!0,get:function(){return n.AudioSystem}}),t("./Module")),a=(Object.defineProperty(i,"Module",{enumerable:!0,get:function(){return s.Module}}),t("./ShaderProgram")),h=(Object.defineProperty(i,"ShaderProgram",{enumerable:!0,get:function(){return a.ShaderProgram}}),t("./VideoSystem"));Object.defineProperty(i,"VideoSystem",{enumerable:!0,get:function(){return h.VideoSystem}}),o(t("./entities/CacheableE"),i),o(t("./entities/E"),i),o(t("./entities/FilledRect"),i),o(t("./entities/FrameSprite"),i),o(t("./entities/Label"),i),o(t("./entities/Pane"),i),o(t("./entities/Sprite"),i),o(t("./AssetAccessor"),i),o(t("./AssetGenerationConfiguration"),i),o(t("./AssetHolder"),i),o(t("./AssetLoadFailureInfo"),i),o(t("./AssetManager"),i),o(t("./AssetManagerLoadHandler"),i),o(t("./AudioPlayContext"),i),o(t("./AudioSystem"),i),o(t("./AudioSystemManager"),i),o(t("./AudioUtil"),i),o(t("./BitmapFont"),i),o(t("./Camera"),i),o(t("./Camera2D"),i),o(t("./Collision"),i),o(t("./DefaultLoadingScene"),i),o(t("./DefaultSkippingScene"),i),o(t("./DynamicAssetConfiguration"),i),o(t("./DynamicFont"),i),o(t("./EntityStateFlags"),i),o(t("./Event"),i),o(t("./EventConverter"),i),o(t("./EventFilter"),i),o(t("./EventFilterController"),i),o(t("./EventIndex"),i),o(t("./EventPriority"),i),o(t("./ExceptionFactory"),i),o(t("./Font"),i),o(t("./GameMainParameterObject"),i),o(t("./InternalOperationPluginInfo"),i),o(t("./LoadingScene"),i),o(t("./LocalTickModeString"),i),o(t("./Matrix"),i),o(t("./Module"),i),o(t("./ModuleManager"),i),o(t("./NinePatchSurfaceEffector"),i),o(t("./Object2D"),i),o(t("./OperationPlugin"),i),o(t("./OperationPluginManager"),i),o(t("./OperationPluginOperation"),i),o(t("./OperationPluginStatic"),i),o(t("./PathUtil"),i),o(t("./Player"),i),o(t("./PointEventResolver"),i),o(t("./RandomGenerator"),i),o(t("./Require"),i),o(t("./RequireCacheable"),i),o(t("./RequireCachedValue"),i),o(t("./ScriptAssetContext"),i),o(t("./ShaderProgram"),i),o(t("./SnapshotSaveRequest"),i),o(t("./SpriteFactory"),i),o(t("./Storage"),i),o(t("./SurfaceAtlas"),i),o(t("./SurfaceAtlasSet"),i),o(t("./SurfaceAtlasSlot"),i),o(t("./SurfaceEffector"),i),o(t("./SurfaceUtil"),i),o(t("./TextAlign"),i),o(t("./TextAlignString"),i),o(t("./TextMetrics"),i),o(t("./TickGenerationModeString"),i),o(t("./Timer"),i),o(t("./TimerManager"),i),o(t("./Util"),i),o(t("./VideoSystem"),i),o(t("./WeakRefKVS"),i),o(t("./Xorshift"),i),o(t("./XorshiftRandomGenerator"),i),o(t("./Scene"),i),o(t("./Game"),i)},{"./AssetAccessor":3,"./AssetGenerationConfiguration":4,"./AssetHolder":5,"./AssetLoadFailureInfo":6,"./AssetManager":7,"./AssetManagerLoadHandler":8,"./AudioPlayContext":9,"./AudioSystem":10,"./AudioSystemManager":11,"./AudioUtil":12,"./BitmapFont":13,"./Camera":14,"./Camera2D":15,"./Collision":16,"./DefaultLoadingScene":17,"./DefaultSkippingScene":18,"./DynamicAssetConfiguration":19,"./DynamicFont":20,"./EntityStateFlags":21,"./Event":22,"./EventConverter":23,"./EventFilter":24,"./EventFilterController":25,"./EventIndex":26,"./EventPriority":27,"./ExceptionFactory":28,"./Font":29,"./Game":30,"./GameMainParameterObject":32,"./InternalOperationPluginInfo":33,"./LoadingScene":34,"./LocalTickModeString":35,"./Matrix":36,"./Module":37,"./ModuleManager":38,"./NinePatchSurfaceEffector":39,"./Object2D":40,"./OperationPlugin":41,"./OperationPluginManager":42,"./OperationPluginOperation":43,"./OperationPluginStatic":44,"./PathUtil":45,"./Player":46,"./PointEventResolver":47,"./RandomGenerator":48,"./Require":49,"./RequireCacheable":50,"./RequireCachedValue":51,"./Scene":52,"./ScriptAssetContext":53,"./ShaderProgram":54,"./SnapshotSaveRequest":55,"./SpriteFactory":56,"./Storage":57,"./SurfaceAtlas":58,"./SurfaceAtlasSet":59,"./SurfaceAtlasSlot":60,"./SurfaceEffector":61,"./SurfaceUtil":62,"./TextAlign":63,"./TextAlignString":64,"./TextMetrics":65,"./TickGenerationModeString":66,"./Timer":67,"./TimerManager":68,"./Util":69,"./VideoSystem":70,"./WeakRefKVS":71,"./Xorshift":72,"./XorshiftRandomGenerator":73,"./entities/CacheableE":77,"./entities/E":79,"./entities/FilledRect":80,"./entities/FrameSprite":81,"./entities/Label":82,"./entities/Pane":83,"./entities/Sprite":84,"@akashic/game-configuration":92,"@akashic/pdi-types":205,"@akashic/trigger":225}],86:[function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var o=Object.getOwnPropertyDescriptor(e,i);o&&("get"in o?e.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,o)}:function(t,e,i,r){t[r=void 0===r?i:r]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(i,"__esModule",{value:!0}),o(t("./index.common"),i),o(t("./GameHandlerSet"),i)},{"./GameHandlerSet":31,"./index.common":85}],87:[function(t,e,i){"use strict";function r(t){this._tickHandlers=[],this._eventHandlers=[],this._events=[],this._tickList=null,this._playId=t.playId,this._putStorageDataSyncFunc=t.putStorageDataSyncFunc||function(){throw new Error("Implementation not given")},this._getStorageDataSyncFunc=t.getStorageDataSyncFunc||function(){throw new Error("Implementation not given")},t.startPoints?(t.tickList&&(this._tickList=t.tickList),this._startPoints=t.startPoints):this._startPoints=[]}function o(i){return i&&"object"==typeof i?Array.isArray(i)?i.map(o):Object.keys(i).reduce(function(t,e){return t[e]=o(i[e]),t},{}):i}Object.defineProperty(i,"__esModule",{value:!0}),i._cloneDeep=i.MemoryAmflowClient=void 0,r.prototype.dump=function(){return{tickList:this._tickList,startPoints:this._startPoints}},r.prototype.open=function(t,e){var i=this;setTimeout(function(){e&&(t!==i._playId?e(new Error("MemoryAmflowClient#open: unknown playId")):e(null))},0)},r.prototype.close=function(t){t&&setTimeout(function(){t(null)},0)},r.prototype.authenticate=function(t,e){setTimeout(function(){switch(t){case r.TOKEN_ACTIVE:e(null,{writeTick:!0,readTick:!0,subscribeTick:!1,sendEvent:!1,subscribeEvent:!0,maxEventPriority:2});break;case r.TOKEN_PASSIVE:e(null,{writeTick:!1,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!1,maxEventPriority:2});break;default:e(null,{writeTick:!0,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!0,maxEventPriority:2})}},0)},r.prototype.sendTick=function(e){if(e=o(e),this._tickList){if(this._tickList[0]<=e[0]&&e[0]<=this._tickList[1])throw new Error("illegal age tick");this._tickList[1]=e[0]}else this._tickList=[e[0],e[0],[]];var t=e[1],i=e[2];(t||i)&&(t&&(e[1]=t.filter(function(t){return!(8&t[1])})),this._tickList[2].push(e)),this._tickHandlers.forEach(function(t){return t(e)})},r.prototype.onTick=function(t){this._tickHandlers.push(t)},r.prototype.offTick=function(e){this._tickHandlers=this._tickHandlers.filter(function(t){return t!==e})},r.prototype.sendEvent=function(e){e=o(e),0===this._eventHandlers.length?this._events.push(e):this._eventHandlers.forEach(function(t){return t(e)})},r.prototype.onEvent=function(t){var i=this;this._eventHandlers.push(t),0<this._events.length&&(this._events.forEach(function(e){i._eventHandlers.forEach(function(t){return t(e)})}),this._events=[])},r.prototype.offEvent=function(e){this._eventHandlers=this._eventHandlers.filter(function(t){return t!==e})},r.prototype.getTickList=function(t,e,i){var r,o,n,s,a="number"==typeof t?(r={begin:t,end:e},i):(r=t,e);this._tickList?(o=Math.max(r.begin,this._tickList[0]),n=Math.min(r.end,this._tickList[1]),i=this._tickList[2].filter(function(t){t=t[0];return o<=t&&t<=n}),s=[o,n,i],setTimeout(function(){return a(null,s)},0)):a&&setTimeout(function(){return a(null)},0)},r.prototype.putStartPoint=function(t,e){var i=this;setTimeout(function(){i._startPoints.push(t),e(null)},0)},r.prototype.getStartPoint=function(s,a){var h=this;setTimeout(function(){if(h._startPoints&&0!==h._startPoints.length){var t=0;if(null!=s.frame)for(var e=h._startPoints[0].frame,i=1;i<h._startPoints.length;++i){var r=h._startPoints[i].frame;r<=s.frame&&e<r&&(e=r,t=i)}else for(var o=h._startPoints[0].timestamp,i=1;i<h._startPoints.length;++i){var n=h._startPoints[i].timestamp;n<=s.timestamp&&o<n&&(o=n,t=i)}a(null,h._startPoints[t])}else a(new Error("no startpoint"))},0)},r.prototype.putStorageData=function(t,e,i,r){var o=this;setTimeout(function(){try{o._putStorageDataSyncFunc(t,e,i),r(null)}catch(t){r(t)}},0)},r.prototype.getStorageData=function(e,i){var r=this;setTimeout(function(){try{var t=r._getStorageDataSyncFunc(e);i(null,t)}catch(t){i(t)}},0)},r.prototype.dropAfter=function(e){var i,t;this._tickList&&(i=this._tickList[0],t=this._tickList[1],e<=i?(this._tickList=null,this._startPoints=[]):e<=t&&(this._tickList[1]=e-1,this._tickList[2]=this._tickList[2].filter(function(t){t=t[0];return i<=t&&t<=e-1}),this._startPoints=this._startPoints.filter(function(t){return t.frame<e})))},r.TOKEN_ACTIVE="mamfc-token:active",r.TOKEN_PASSIVE="mamfc-token:passive",i.MemoryAmflowClient=r,i._cloneDeep=o},{}],88:[function(t,e,i){"use strict";function r(t){this._amflow=t.amflow,this._tickList=t.tickList,this._startPoints=t.startPoints}Object.defineProperty(i,"__esModule",{value:!0}),i.ReplayAmflowProxy=void 0,r.prototype.dropAfter=function(e){var t,i,r;this._tickList&&(t=this._tickList[0],i=this._tickList[1],r=this._tickList[2]||[],e<=t?(this._tickList=null,this._startPoints=[]):e<=i&&(this._tickList[1]=e-1,this._tickList[2]=this._sliceTicks(r,i,e-1),this._startPoints=this._startPoints.filter(function(t){return t.frame<e})))},r.prototype.open=function(t,e){this._amflow.open(t,e)},r.prototype.close=function(t){this._amflow.close(t)},r.prototype.authenticate=function(t,e){this._amflow.authenticate(t,e)},r.prototype.sendTick=function(t){this._amflow.sendTick(t)},r.prototype.onTick=function(t){this._amflow.onTick(t)},r.prototype.offTick=function(t){this._amflow.offTick(t)},r.prototype.sendEvent=function(t){this._amflow.sendEvent(t)},r.prototype.onEvent=function(t){this._amflow.onEvent(t)},r.prototype.offEvent=function(t){this._amflow.offEvent(t)},r.prototype.getTickList=function(t,e,i){var r,o,n,s,a,h,c,u,l=this,d="number"==typeof t?(r={begin:t,end:e},i):(r=t,e);this._tickList?(o=r.begin,n=r.end,s=this._tickList[0],a=this._tickList[1],h=this._tickList[2]||[],u=s<=n&&n<=a,(c=s<=o&&o<=a)&&u?setTimeout(function(){d(null,[o,n,l._sliceTicks(h,o,n)])},0):this._amflow.getTickList({begin:o,end:n},function(t,e){var i,r;t?d(t):e?c||u?c?(i=l._sliceTicks(h,o,n).concat(e[2]||[]),d(null,[o,e[1],i])):(i=(e[2]||[]).concat(l._sliceTicks(h,o,n)),d(null,[e[0],n,i])):n<s||a<o?d(null,e):(i=(i=e[2])?(t=l._sliceTicks(i,o,s-1),r=l._sliceTicks(i,a+1,n),t.concat(h,r)):h,d(null,[o,n,i])):d(null,c||u?c?[o,a,l._sliceTicks(h,o,n)]:[s,n,l._sliceTicks(h,o,n)]:n<s||a<o?e:[s,a,l._sliceTicks(h,o,n)])})):this._amflow.getTickList(r,d)},r.prototype.putStartPoint=function(t,e){this._amflow.putStartPoint(t,e)},r.prototype.getStartPoint=function(t,i){var r=this,o=0;if(0<this._startPoints.length)if(null!=t.frame)for(var e=this._startPoints[0].frame,n=1;n<this._startPoints.length;++n){var s=this._startPoints[n].frame;s<=t.frame&&e<s&&(e=s,o=n)}else for(var a=this._startPoints[0].timestamp,n=1;n<this._startPoints.length;++n){var h=this._startPoints[n].timestamp;h<=t.timestamp&&a<h&&(a=h,o=n)}var c=this._tickList?this._tickList[1]:-1;"number"==typeof t.frame&&t.frame>c?this._amflow.getStartPoint(t,function(t,e){t?i(t):e&&c<e.frame?i(null,e):i(null,r._startPoints[o])}):setTimeout(function(){i(null,r._startPoints[o])},0)},r.prototype.putStorageData=function(t,e,i,r){this._amflow.putStorageData(t,e,i,r)},r.prototype.getStorageData=function(t,e){this._amflow.getStorageData(t,e)},r.prototype._sliceTicks=function(t,e,i){return t.filter(function(t){t=t[0];return e<=t&&t<=i})},i.ReplayAmflowProxy=r},{}],89:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],90:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],91:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],92:[function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var o=Object.getOwnPropertyDescriptor(e,i);o&&("get"in o?e.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,o)}:function(t,e,i,r){t[r=void 0===r?i:r]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(i,"__esModule",{value:!0}),o(t("./AssetConfiguration"),i),o(t("./GameConfiguration"),i),o(t("./OperationPluginInfo"),i)},{"./AssetConfiguration":89,"./GameConfiguration":90,"./OperationPluginInfo":91}],93:[function(t,e,i){"use strict";var h;Object.defineProperty(i,"__esModule",{value:!0}),i.PathUtil=void 0,(h=i.PathUtil||(i.PathUtil={})).resolvePath=function(t,e){function i(t){t=t.split("/");return""===t[t.length-1]&&t.pop(),t}if(""===e)return t;for(var r=i((t=h.splitPath(t)).path).concat(i(e)),o=[],n=0;n<r.length;++n){var s=r[n];switch(s){case"..":var a=o.pop();if(void 0===a||""===a||"."===a)throw new Error("PathUtil.resolvePath: invalid arguments");break;case".":0===o.length&&o.push(".");break;case"":o=[""];break;default:o.push(s)}}return t.host+o.join("/")},h.resolveDirname=function(t){var e=t.lastIndexOf("/");return-1===e?t:t.substr(0,e)},h.resolveExtname=function(t){for(var e=t.length-1;0<=e;--e){var i=t.charAt(e);if("."===i)return t.substr(e);if("/"===i)return""}return""},h.makeNodeModulePaths=function(t){for(var e,i=h.splitPath(t),r=i.host,o=(t="/"===(t=i.path)[t.length-1]?t.slice(0,t.length-1):t).split("/"),n=0<(i=o.indexOf("node_modules"))?i-1:0,s=[],a=o.length-1;n<=a;--a)"node_modules"!==o[a]&&((e=o.slice(0,a+1)).push("node_modules"),e=e.join("/"),s.push(r+e));return s},h.splitPath=function(t){var e="",i=t.indexOf("//");return 0<=i?t=0<=(i=t.indexOf("/",i+2))?(e=t.slice(0,i),t.slice(i)):(e=t,"/"):e="",{host:e,path:t}}},{}],94:[function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var o=Object.getOwnPropertyDescriptor(e,i);o&&("get"in o?e.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,o)}:function(t,e,i,r){t[r=void 0===r?i:r]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(i,"__esModule",{value:!0}),o(t("./PathUtil"),i),o(t("./types"),i),o(t("./utils"),i)},{"./PathUtil":93,"./types":95,"./utils":96}],95:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],96:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i._mergeObject=i.makeLoadConfigurationFunc=void 0;var a=t("es6-promise"),h=t("./PathUtil");function c(t,e){for(var i=Object.keys(e),r=0,o=i.length;r<o;++r){var n=i[r],s=e[n],a=typeof s;if(a!=typeof t[n])t[n]=s;else if("string"==a||"number"==a||"boolean"==a)t[n]=s;else{if("object"!=a)throw new Error("_mergeObject(): unknown type");null==s?t[n]=s:Array.isArray(s)?t[n]=t[n].concat(s):c(t[n],s)}}return t}i.makeLoadConfigurationFunc=function(t){function n(i,r,o,n){t(i,function(t,e){if(t)n(t);else if("definitions"in e){t=e.definitions.map(function(t){return"string"==typeof t?s(o?h.PathUtil.resolvePath(o,t):t,void 0,o):s(o?h.PathUtil.resolvePath(o,t.url):t.url,t.basePath,o)});a.Promise.all(t).then(function(t){return n(null,t.reduce(c))}).catch(function(t){return n(t)})}else{t=void 0;try{t=function(t,r){var e,i={};function o(t,e){if(i.hasOwnProperty(t))throw new Error("_normalizeAssets: asset ID already exists: "+t);i[t]=e}if(Array.isArray(t.assets))t.assets.forEach(function(t){var e,i=t.path;i&&(t.virtualPath=null!=(e=t.virtualPath)?e:t.path,t.path=h.PathUtil.resolvePath(r,i)),o(i,t)});else if("object"==typeof t.assets)for(var n in t.assets){var s;t.assets.hasOwnProperty(n)&&((s=t.assets[n]).path&&(s.virtualPath=null!=(e=s.virtualPath)?e:s.path,s.path=h.PathUtil.resolvePath(r,s.path)),o(n,s))}t.globalScripts&&(t.globalScripts.forEach(function(t){o(t,{type:/\.json$/i.test(t)?"text":"script",virtualPath:t,path:h.PathUtil.resolvePath(r,t),global:!0})}),delete t.globalScripts);return t.assets=i,t}(e,null!=r?r:h.PathUtil.resolveDirname(i))}catch(t){return void n(t)}n(null,t)}})}function s(t,e,o){return new a.Promise(function(i,r){n(t,e,o,function(t,e){return t?r(t):i(e)})})}return n},i._mergeObject=c},{"./PathUtil":93,"es6-promise":226}],97:[function(t,e,i){arguments[4][2][0].apply(i,arguments)},{"./lib/index":115,dup:2}],98:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Clock=void 0;var r=t("@akashic/akashic-engine");function o(t){this.fps=t.fps,this.scaleFactor=t.scaleFactor||1,this.frameTrigger=new r.Trigger,this.rawFrameTrigger=new r.Trigger,this._platform=t.platform,this._maxFramePerOnce=t.maxFramePerOnce,this._deltaTimeBrokenThreshold=t.deltaTimeBrokenThreshold||o.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD,t.frameHandler&&this.frameTrigger.add(t.frameHandler,t.frameHandlerOwner),this.running=!1,this._totalDeltaTime=0,this._onLooperCall_bound=this._onLooperCall.bind(this),this._looper=this._platform.createLooper(this._onLooperCall_bound),this._waitTime=0,this._waitTimeDoubled=0,this._waitTimeMax=0,this._skipFrameWaitTime=0,this._realMaxFramePerOnce=0}o.prototype.start=function(){this.running||(this._totalDeltaTime=0,this._updateWaitTimes(this.fps,this.scaleFactor),this._looper.start(),this.running=!0)},o.prototype.stop=function(){this.running&&(this._looper.stop(),this.running=!1)},o.prototype.changeScaleFactor=function(t){this.running?(this.stop(),this.scaleFactor=t,this.start()):this.scaleFactor=t},o.prototype._onLooperCall=function(t){var e=t=isNaN(t)?this._waitTime-this._totalDeltaTime:t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var i=this._totalDeltaTime;if(!((i+=t)<=this._skipFrameWaitTime)){for(var t,r=t=i<this._waitTimeDoubled?1:i>this._waitTimeMax?this._realMaxFramePerOnce:i/this._waitTime|0,o={deltaTime:e,interrupt:!1};0<r&&this.running&&!o.interrupt;)--r,this.frameTrigger.fire(o),o.deltaTime=0;i-=(t-r)*this._waitTime,this.rawFrameTrigger.fire()}return this._totalDeltaTime=i,this._waitTime-i},o.prototype._updateWaitTimes=function(t,e){t*=e;this._waitTime=1e3/t,this._waitTimeDoubled=Math.max(2e3/t|0,1),this._waitTimeMax=Math.max(e*(1e3*this._maxFramePerOnce/t)|0,1),this._skipFrameWaitTime=this._waitTime*o.ANTICIPATE_RATE|0,this._realMaxFramePerOnce=this._maxFramePerOnce*e},o.ANTICIPATE_RATE=.8,o.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD=150,i.Clock=o},{"@akashic/akashic-engine":2}],99:[function(t,e,i){"use strict";function a(t){var e=this;this._discardsEventsDuringSkip=!0,this._discardsLocalEventsDuringSkip=!0,this._filters=null,this._amflow=t.amflow,this._isLocalReceiver=!0,this._isReceiver=!1,this._isSender=!1,this._isDiscarder=!1,this._skipping=!1,this._defaultEventPriority=0,this._buffer=[],this._joinLeaveBuffer=[],this._localBuffer=[],this._filters=null,this._filterController={processNext:function(t){(a.isEventLocal(t)?e._unfilteredLocalEvents:e._unfilteredEvents).push(t)}},this._unfilteredLocalEvents=[],this._unfilteredEvents=[],this._resolvePointEvent_bound=t.game.resolvePointEvent.bind(t.game),this._onEvent_bound=this.onEvent.bind(this)}Object.defineProperty(i,"__esModule",{value:!0}),i.EventBuffer=void 0,a.isEventLocal=function(t){switch(t[0]){case 0:return t[5];case 1:return t[3];case 2:return t[4];case 3:return t[5];case 32:return t[4];case 33:return t[7];case 34:case 35:return t[11];case 64:return t[5];default:throw new Error("EventBuffer.isEventLocal")}},a.prototype.setMode=function(t){null!=t.isLocalReceiver&&(this._isLocalReceiver=t.isLocalReceiver),null!=t.isReceiver&&this._isReceiver!==t.isReceiver&&(this._isReceiver=t.isReceiver,t.isReceiver?this._amflow.onEvent(this._onEvent_bound):this._amflow.offEvent(this._onEvent_bound)),null!=t.isSender&&(this._isSender=t.isSender),null!=t.isDiscarder&&(this._isDiscarder=t.isDiscarder),null!=t.defaultEventPriority&&(this._defaultEventPriority=3&t.defaultEventPriority)},a.prototype.getMode=function(){return{isLocalReceiver:this._isLocalReceiver,isReceiver:this._isReceiver,isSender:this._isSender,isDiscarder:this._isDiscarder,defaultEventPriority:this._defaultEventPriority}},a.prototype.onEvent=function(t){a.isEventLocal(t)?!this._isLocalReceiver||this._isDiscarder||this._skipping&&this._discardsLocalEventsDuringSkip||this._unfilteredLocalEvents.push(t):this._skipping&&this._discardsEventsDuringSkip||(this._isReceiver&&!this._isDiscarder&&this._unfilteredEvents.push(t),this._isSender&&(null==t[1]&&(t[1]=3&this._defaultEventPriority),this._amflow.sendEvent(t)))},a.prototype.onPointEvent=function(t){t=this._resolvePointEvent_bound(t);t&&this.onEvent(t)},a.prototype.addEventDirect=function(t){if(a.isEventLocal(t))return!this._isLocalReceiver||this._isDiscarder?void 0:void this._localBuffer.push(t);this._isReceiver&&!this._isDiscarder&&(0===t[0]||1===t[0]?this._joinLeaveBuffer:this._buffer).push(t),this._isSender&&(null==t[1]&&(t[1]=3&this._defaultEventPriority),this._amflow.sendEvent(t))},a.prototype.readEvents=function(){var t=this._buffer;return 0===t.length?null:(this._buffer=[],t)},a.prototype.readJoinLeaves=function(){var t=this._joinLeaveBuffer;return 0===t.length?null:(this._joinLeaveBuffer=[],t)},a.prototype.readLocalEvents=function(){var t=this._localBuffer;return 0===t.length?null:(this._localBuffer=[],t)},a.prototype.addFilter=function(t,e){this._filters||(this._filters=[]),this._filters.push({func:t,handleEmpty:!!e})},a.prototype.removeFilter=function(t){if(this._filters)if(t)for(var e=this._filters.length-1;0<=e;--e)this._filters[e].func===t&&this._filters.splice(e,1);else this._filters=null},a.prototype.processEvents=function(t){var e=this._unfilteredLocalEvents,i=this._unfilteredEvents,r=(this._unfilteredLocalEvents=[],e);if(!t&&0<i.length&&(r=0<r.length?r.concat(i):i,this._unfilteredEvents=[]),this._filters)for(var o=0;o<this._filters.length;++o){var n=this._filters[o];(0<r.length||n.handleEmpty)&&(r=this._filters[o].func(r,this._filterController)||[])}for(o=0;o<r.length;++o){var s=r[o];(a.isEventLocal(s)?this._localBuffer:0===s[0]||1===s[0]?this._joinLeaveBuffer:this._buffer).push(s)}},a.prototype.startSkipping=function(){this._skipping=!0},a.prototype.endSkipping=function(){this._skipping=!1},i.EventBuffer=a},{}],100:[function(t,e,i){"use strict";var r,o;Object.defineProperty(i,"__esModule",{value:!0}),(o=r=r||{})[o.Active=0]="Active",o[o.Passive=1]="Passive",i.default=r},{}],101:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.Game=void 0,t("@akashic/akashic-engine")),t=(o=s.Game,n(a,o),a.prototype.requestNotifyAgePassed=function(t){this._notifyPassedAgeTable[t]=!0},a.prototype.cancelNotifyAgePassed=function(t){delete this._notifyPassedAgeTable[t]},a.prototype.requestNotifyTargetTimeReached=function(){this._notifiesTargetTimeReached=!0},a.prototype.cancelNofityTargetTimeReached=function(){this._notifiesTargetTimeReached=!1},a.prototype.fireAgePassedIfNeeded=function(){var t=this.age-1;return!!this._notifyPassedAgeTable[t]&&(delete this._notifyPassedAgeTable[t],this.agePassedTrigger.fire(t),!0)},a.prototype.setStorageFunc=function(t){this.storage._registerLoad(t.storageGetFunc),this.storage._registerWrite(t.storagePutFunc),this.storage.requestValuesForJoinPlayer=t.requestValuesForJoinFunc},a.prototype.getIsSkipAware=function(){return this._isSkipAware},a.prototype.setIsSkipAware=function(t){this._isSkipAware=t},a.prototype._destroy=function(){this.agePassedTrigger.destroy(),this.agePassedTrigger=null,this.targetTimeReachedTrigger.destroy(),this.targetTimeReachedTrigger=null,this.skippingChangedTrigger.destroy(),this.skippingChangedTrigger=null,this.abortTrigger.destroy(),this.abortTrigger=null,this.player=null,this.handlerSet=null,this._notifyPassedAgeTable=null,this._gameArgs=null,this._globalGameArgs=null,o.prototype._destroy.call(this)},a.prototype._restartWithSnapshot=function(t){var e=t.data;null!=e.seed?(this._reset({age:t.frame,randSeed:e.seed}),this._loadAndStart({args:this._gameArgs,globalArgs:this._globalGameArgs})):(this._reset({age:t.frame,nextEntityId:e.nextEntityId,randGenSer:e.randGenSer}),this._loadAndStart({args:this._gameArgs,snapshot:e.gameSnapshot}))},a.prototype._abortGame=function(){this.abortTrigger.fire()},a.prototype._onRawTargetTimeReached=function(t){this._notifiesTargetTimeReached&&(this._notifiesTargetTimeReached=!1,this.targetTimeReachedTrigger.fire(t))},a.prototype._onSkippingChanged=function(t){this._isSkipAware&&this.onSkipChange.fire(t)},a);function a(t){var e=o.call(this,t)||this;return e.agePassedTrigger=new s.Trigger,e.targetTimeReachedTrigger=new s.Trigger,e.skippingChangedTrigger=new s.Trigger,e.abortTrigger=new s.Trigger,e._notifyPassedAgeTable=Object.create(null),e._notifiesTargetTimeReached=!1,e._isSkipAware=!1,e.player=t.player,e.handlerSet=t.handlerSet,e._gameArgs=t.gameArgs,e._globalGameArgs=t.globalGameArgs,e.skippingChangedTrigger.add(e._onSkippingChanged,e),e}i.Game=t},{"@akashic/akashic-engine":2}],102:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GameDriver=void 0;var g=t("@akashic/akashic-engine"),r=t("@akashic/game-configuration/lib/utils"),s=t("es6-promise"),o=t("./constants"),y=t("./EventBuffer"),m=t("./ExecutionMode"),v=t("./Game"),A=t("./GameHandlerSet"),T=t("./GameLoop"),n=t("./LoopMode"),a="GAME_DESTROYED";function h(t){this.errorTrigger=new g.Trigger,this.configurationLoadedTrigger=new g.Trigger,this.gameCreatedTrigger=new g.Trigger,this._rendererRequirement=null,this._game=null,this._gameLoop=null,this._eventBuffer=null,this._openedAmflow=!1,this._playToken=null,this._permission=null,this._hidden=!1,this._destroyed=!1,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._platform=t.platform,this._loadConfigurationFunc=(0,r.makeLoadConfigurationFunc)(t.platform.loadGameConfiguration),this._player=t.player}h.prototype.initialize=function(t,e){this.doInitialize(t).then(function(){e()},e)},h.prototype.changeState=function(t,e){var i,r=this,o=this._gameLoop&&this._gameLoop.running;o&&null!=(i=this._gameLoop)&&i.stop(),this.initialize(t,function(t){t?e(t):(o&&null!=(t=r._gameLoop)&&t.start(),e())})},h.prototype.startGame=function(){this._gameLoop?this._gameLoop.start():this.errorTrigger.fire(new Error("Not initialized"))},h.prototype.stopGame=function(){this._gameLoop&&this._gameLoop.stop()},h.prototype.setNextAge=function(t){var e;null!=(e=this._gameLoop)&&e.setNextAge(t)},h.prototype.getPermission=function(){return this._permission},h.prototype.getDriverConfiguration=function(){var t;return{playId:this._playId,playToken:null!=(t=this._playToken)?t:void 0,executionMode:this._gameLoop?this._gameLoop.getExecutionMode():void 0,eventBufferMode:this._eventBuffer?this._eventBuffer.getMode():void 0}},h.prototype.getLoopConfiguration=function(){return this._gameLoop?this._gameLoop.getLoopConfiguration():null},h.prototype.getHidden=function(){return this._hidden},h.prototype.resetPrimarySurface=function(t,e,i){i=i||(this._rendererRequirement?this._rendererRequirement.rendererCandidates:void 0);var r=this._game,o=this._platform,n=o.getPrimarySurface();r.renderers=r.renderers.filter(function(t){return t!==n.renderer()}),o.setRendererRequirement({primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i}),this._rendererRequirement={primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i},r.renderers.push(o.getPrimarySurface().renderer()),r.width=t,r.height=e,r.onResized.fire({width:t,height:e}),r.modified()},h.prototype.doInitialize=function(i){var r=this,t=new s.Promise(function(t,e){if(r._gameLoop&&r._gameLoop.running)return e(new Error("Game is running. Must be stopped."));r._gameLoop&&i.loopConfiguration&&r._gameLoop.setLoopConfiguration(i.loopConfiguration),null!=i.hidden&&(r._hidden=i.hidden,r._game&&r._game._setMuted(i.hidden)),t()}).then(function(){return r._assertLive(),r._doSetDriverConfiguration(i.driverConfiguration)}),e=i.configurationUrl;return e?t.then(function(){return r._assertLive(),r._loadConfiguration(e,i.assetBase,i.configurationBase)}).then(function(t){return r._assertLive(),r._createGame(t,r._player,i)}):t},h.prototype.destroy=function(){var i=this;return new s.Promise(function(t,e){i.stopGame(),i._game&&(i._game._destroy(),i._game=null),i.errorTrigger.destroy(),i.errorTrigger=null,i.configurationLoadedTrigger.destroy(),i.configurationLoadedTrigger=null,i.gameCreatedTrigger.destroy(),i.gameCreatedTrigger=null,i._platform.destroy?i._platform.destroy():i._platform.setRendererRequirement(void 0),i._platform=null,i._loadConfigurationFunc=null,i._player=null,i._rendererRequirement=null,i._playId=void 0,i._gameLoop=null,i._eventBuffer=null,i._openedAmflow=!1,i._playToken=null,i._permission=null,i._hidden=!1,i._destroyed=!0,t()})},h.prototype._doSetDriverConfiguration=function(t){var e=this;if(null==t)return s.Promise.resolve();void 0===t.playId&&(t.playId=null!=(i=this._playId)?i:void 0),void 0===t.playToken&&(t.playToken=null!=(i=this._playToken)?i:void 0),void 0===t.eventBufferMode&&(t.executionMode===m.default.Active?t.eventBufferMode={isReceiver:!0,isSender:!1}:t.executionMode===m.default.Passive&&(t.eventBufferMode={isReceiver:!1,isSender:!0}));var i=s.Promise.resolve();return this._playId!==t.playId&&(i=i.then(function(){return e._assertLive(),e._doOpenAmflow(t.playId)})),(i=this._playToken!==t.playToken?i.then(function(){return e._assertLive(),e._doAuthenticate(t.playToken)}):i).then(function(){e._assertLive(),null!=t.eventBufferMode&&(null==t.eventBufferMode.defaultEventPriority&&(e._permission?t.eventBufferMode.defaultEventPriority=3&e._permission.maxEventPriority:t.eventBufferMode.defaultEventPriority=0),e._eventBuffer&&e._eventBuffer.setMode(t.eventBufferMode)),null!=t.executionMode&&e._gameLoop&&e._gameLoop.setExecutionMode(t.executionMode)})},h.prototype._doCloseAmflow=function(){var r=this;return new s.Promise(function(e,i){if(!r._openedAmflow)return e();r._platform.amflow.close(function(t){r._openedAmflow=!1;t=r._getCallbackError(t);if(t)return i(t);e()})})},h.prototype._doOpenAmflow=function(r){var o=this;return void 0===r?s.Promise.resolve():this._doCloseAmflow().then(function(){return o._assertLive(),new s.Promise(function(e,i){if(null===r)return e();o._platform.amflow.open(r,function(t){t=o._getCallbackError(t);if(t)return i(t);o._openedAmflow=!0,o._playId=r,o._game&&o._updateGamePlayId(o._game),e()})})})},h.prototype._doAuthenticate=function(o){var n=this;return null==o?s.Promise.resolve():new s.Promise(function(i,r){n._platform.amflow.authenticate(o,function(t,e){t=n._getCallbackError(t);if(t)return r(t);e?(n._playToken=o,n._permission=e,n._game&&(n._game.handlerSet.isSnapshotSaver=e.writeTick),i()):r(new Error("Permission denied."))})})},h.prototype._loadConfiguration=function(t,e,o){var n=this;return new s.Promise(function(i,r){n._loadConfigurationFunc(t,e,o,function(t,e){t=n._getCallbackError(t);t?r(t):e?(n.configurationLoadedTrigger.fire(e),i(e)):r(new Error("GameDriver#_loadConfiguration: No configuration found."))})})},h.prototype._putZerothStartPoint=function(r){var o=this;return new s.Promise(function(e,i){var t={frame:0,timestamp:r.startedAt,data:r};o._platform.amflow.putStartPoint(t,function(t){t=o._getCallbackError(t);if(t)return i(t);e()})})},h.prototype._getStartPoint=function(t){var o=this;return new s.Promise(function(i,r){o._platform.amflow.getStartPoint({frame:t},function(t,e){t=o._getCallbackError(t);return t?r(t):e?void i(e):r(new Error("GameDriver#_getStartPoint: No startPoint found"))})})},h.prototype._createGame=function(u,l,d){var t,p,f=this,_=!(null==(t=this._permission)||!t.writeTick),i=!((null==(t=d.driverConfiguration)?void 0:t.executionMode)!==m.default.Active)&&_;if(d.loopConfiguration)return p=d.loopConfiguration,(i?this._putZerothStartPoint({seed:Date.now(),globalArgs:d.globalGameArgs,fps:u.fps,startedAt:Date.now()}):s.Promise.resolve()).then(function(){return f._assertLive(),f._getStartPoint(0)}).then(function(e){return i||p.loopMode!==n.default.Realtime?[e,e]:f._getStartPoint(o.PSEUDO_INFINITE_AGE).then(function(t){return[e,t]})}).then(function(t){var e=t[0],t=t[1],e=(f._assertLive(),e.data);if("number"!=typeof e.seed)throw new Error("GameDriver#_createGame: No seed found in the zeroth startpoint.");var i=f._platform,r=d.driverConfiguration||{eventBufferMode:{isReceiver:!0,isSender:!1},executionMode:m.default.Active},o=e.seed,n=d.gameArgs,s=e.globalArgs,e=e.startedAt,a={primarySurfaceWidth:u.width,primarySurfaceHeight:u.height,rendererCandidates:u.renderers},h=(i.setRendererRequirement(a),new A.GameHandlerSet({isSnapshotSaver:_})),n=new v.Game({engineModule:g,handlerSet:h,configuration:u,selfId:l.id,player:l,resourceFactory:i.getResourceFactory(),assetBase:d.assetBase,operationPluginViewInfo:i.getOperationPluginViewInfo?i.getOperationPluginViewInfo():void 0,gameArgs:n,globalGameArgs:s}),s=new y.EventBuffer({game:n,amflow:i.amflow}),c=r.eventBufferMode,r=r.executionMode,c=(s.setMode(c),i.setPlatformEventHandler(s),h.setEventFilterFuncs({addFilter:s.addFilter.bind(s),removeFilter:s.removeFilter.bind(s)}),n.renderers.push(i.getPrimarySurface().renderer()),new T.GameLoop({game:n,amflow:i.amflow,platform:i,executionMode:r,eventBuffer:s,configuration:p,startedAt:e,profiler:d.profiler}));c.rawTargetTimeReachedTrigger.add(n._onRawTargetTimeReached,n),h.setCurrentTimeFunc(c.getCurrentTime.bind(c)),n._reset({age:0,randSeed:o}),f._updateGamePlayId(n),f._hidden&&n._setMuted(!0),h.snapshotTrigger.add(function(t){0!==t.frame&&f._platform.amflow.putStartPoint(t,function(t){t=f._getCallbackError(t);t&&f.errorTrigger.fire(t)})}),f._game=n,f._eventBuffer=s,f._gameLoop=c,f._rendererRequirement=a,f.gameCreatedTrigger.fire(n),c.reset(t)});throw new Error("GameDriver#_createGame: No loopConfiguration")},h.prototype._updateGamePlayId=function(t){var e=this;t.playId=this._playId,t.external.send=function(t){e._playId&&e._platform.sendToExternal(e._playId,t)}},h.prototype._assertLive=function(){if(this._destroyed)throw new Error(a)},h.prototype._getCallbackError=function(t){return t||(this._destroyed?new Error(a):null)},i.GameDriver=h},{"./EventBuffer":99,"./ExecutionMode":100,"./Game":101,"./GameHandlerSet":103,"./GameLoop":104,"./LoopMode":106,"./constants":114,"@akashic/akashic-engine":2,"@akashic/game-configuration/lib/utils":94,"es6-promise":226}],103:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GameHandlerSet=void 0;var r=t("@akashic/akashic-engine");function o(t){this.raiseEventTrigger=new r.Trigger,this.raiseTickTrigger=new r.Trigger,this.snapshotTrigger=new r.Trigger,this.changeSceneModeTrigger=new r.Trigger,this._getCurrentTimeFunc=null,this._eventFilterFuncs=null,this._local=null,this._tickGenerationMode=null,this.isSnapshotSaver=!!t.isSnapshotSaver}o.prototype.setCurrentTimeFunc=function(t){this._getCurrentTimeFunc=t},o.prototype.setEventFilterFuncs=function(t){this._eventFilterFuncs=t},o.prototype.removeAllEventFilters=function(){this._eventFilterFuncs&&this._eventFilterFuncs.removeFilter()},o.prototype.changeSceneMode=function(t){this._local=t.local,this._tickGenerationMode=t.tickGenerationMode,this.changeSceneModeTrigger.fire(t)},o.prototype.getCurrentTime=function(){return Math.floor(this._getCurrentTimeFunc())},o.prototype.raiseEvent=function(t){this.raiseEventTrigger.fire(t)},o.prototype.raiseTick=function(t){this.raiseTickTrigger.fire(t)},o.prototype.addEventFilter=function(t,e){this._eventFilterFuncs&&this._eventFilterFuncs.addFilter(t,e)},o.prototype.removeEventFilter=function(t){this._eventFilterFuncs&&t&&this._eventFilterFuncs.removeFilter(t)},o.prototype.shouldSaveSnapshot=function(){return this.isSnapshotSaver},o.prototype.getInstanceType=function(){return this.shouldSaveSnapshot()?"active":"passive"},o.prototype.saveSnapshot=function(t,e,i,r,o){void 0===o&&(o=this._getCurrentTimeFunc()),this.shouldSaveSnapshot()&&this.snapshotTrigger.fire({frame:t,timestamp:o,data:{randGenSer:i,nextEntityId:r,gameSnapshot:e}})},i.GameHandlerSet=o},{"@akashic/akashic-engine":2}],104:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GameLoop=void 0;var r=t("@akashic/akashic-engine"),o=t("./Clock"),n=t("./constants"),s=t("./ExecutionMode"),d=t("./LoopMode"),a=t("./LoopRenderMode"),h=t("./ProfilerClock"),c=t("./TickController");r.EventIndex;function u(t){this.errorTrigger=new r.Trigger,this.rawTargetTimeReachedTrigger=new r.Trigger,this.running=!1,this._omittedTickDuration=0,this._sceneTickMode=null,this._sceneLocalMode=null,this._waitingStartPoint=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._waitingNextTick=!1,this._foundLatestTick=!1,this._skipping=!1,this._lastPollingTickTime=0,this._events=[],this._currentTime=t.startedAt,this._currentTickTime=this._currentTime,this._frameTime=1e3/t.game.fps,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner);var e=t.configuration,i=(this._startedAt=t.startedAt,this._targetTimeFunc=e.targetTimeFunc||null,this._targetTimeOffset=e.targetTimeOffset||null,this._originDate=e.originDate||null,this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,this._delayIgnoreThreshold=e.delayIgnoreThreshold||n.DEFAULT_DELAY_IGNORE_THRESHOLD,this._skipTicksAtOnce=e.skipTicksAtOnce||n.DEFAULT_SKIP_TICKS_AT_ONCE,this._skipThreshold=e.skipThreshold||n.DEFAULT_SKIP_THRESHOLD,this._skipThresholdTime=this._skipThreshold*this._frameTime,this._jumpTryThreshold=e.jumpTryThreshold||n.DEFAULT_JUMP_TRY_THRESHOLD,this._jumpIgnoreThreshold=e.jumpIgnoreThreshold||n.DEFAULT_JUMP_IGNORE_THRESHOLD,this._pollingTickThreshold=e._pollingTickThreshold||n.DEFAULT_POLLING_TICK_THRESHOLD,this._playbackRate=e.playbackRate||1,null!=e.loopRenderMode?e.loopRenderMode:a.default.AfterRawFrame);this._loopRenderMode=null,this._omitInterpolatedTickOnReplay=null==e.omitInterpolatedTickOnReplay||e.omitInterpolatedTickOnReplay,this._loopMode=e.loopMode,this._amflow=t.amflow,this._game=t.game,this._eventBuffer=t.eventBuffer,this._executionMode=t.executionMode,this._targetAge=null!=e.targetAge?e.targetAge:null,t.profiler?this._clock=new h.ProfilerClock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5,profiler:t.profiler}):this._clock=new o.Clock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5}),this._tickController=new c.TickController({amflow:t.amflow,clock:this._clock,game:t.game,eventBuffer:t.eventBuffer,executionMode:t.executionMode,startedAt:t.startedAt,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._tickBuffer=this._tickController.getBuffer(),this._onGotStartPoint_bound=this._onGotStartPoint.bind(this),this._setLoopRenderMode(i),this._game.setIsSkipAware(null==e.skipAwareGame||e.skipAwareGame),this._game.setStorageFunc(this._tickController.storageFunc()),this._game.handlerSet.raiseEventTrigger.add(this._onGameRaiseEvent,this),this._game.handlerSet.raiseTickTrigger.add(this._onGameRaiseTick,this),this._game.handlerSet.changeSceneModeTrigger.add(this._handleSceneChange,this),this._game._onStart.add(this._onGameStarted,this),this._tickBuffer.gotNextTickTrigger.add(this._onGotNextFrameTick,this),this._tickBuffer.gotNoTickTrigger.add(this._onGotNoTick,this),this._tickBuffer.start(),this._updateGameAudioSuppression()}u.prototype.reset=function(t){this._clock.frameTrigger.remove(this._onEventsProcessed,this),this._skipping&&this._stopSkipping(),this._tickBuffer.setCurrentAge(t.frame),this._currentTime=t.timestamp||t.data.timestamp||0,this._currentTickTime=this._currentTime,this._waitingNextTick=!1,this._foundLatestTick=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._omittedTickDuration=0,this._game._restartWithSnapshot(t)},u.prototype.start=function(){this.running=!0,this._clock.start()},u.prototype.stop=function(){this._clock.stop(),this.running=!1},u.prototype.setNextAge=function(t){this._tickController.setNextAge(t)},u.prototype.getExecutionMode=function(){return this._executionMode},u.prototype.setExecutionMode=function(t){this._executionMode=t,this._tickController.setExecutionMode(t)},u.prototype.getLoopConfiguration=function(){var t;return{loopMode:this._loopMode,delayIgnoreThreshold:this._delayIgnoreThreshold,skipTicksAtOnce:this._skipTicksAtOnce,skipThreshold:this._skipThreshold,skipAwareGame:this._game.getIsSkipAware(),jumpTryThreshold:this._jumpTryThreshold,jumpIgnoreThreshold:this._jumpIgnoreThreshold,playbackRate:this._playbackRate,loopRenderMode:null!=(t=this._loopRenderMode)?t:void 0,targetTimeFunc:null!=(t=this._targetTimeFunc)?t:void 0,targetTimeOffset:null!=(t=this._targetTimeOffset)?t:void 0,originDate:null!=(t=this._originDate)?t:void 0,omitInterpolatedTickOnReplay:this._omitInterpolatedTickOnReplay,targetAge:null!=(t=this._targetAge)?t:void 0}},u.prototype.setLoopConfiguration=function(t){null!=t.loopMode&&(this._loopMode=t.loopMode),null!=t.delayIgnoreThreshold&&(this._delayIgnoreThreshold=t.delayIgnoreThreshold),null!=t.skipTicksAtOnce&&(this._skipTicksAtOnce=t.skipTicksAtOnce),null!=t.skipThreshold&&(this._skipThreshold=t.skipThreshold,this._skipThresholdTime=this._skipThreshold*this._frameTime),null!=t.skipAwareGame&&this._game.setIsSkipAware(t.skipAwareGame),null!=t.jumpTryThreshold&&(this._jumpTryThreshold=t.jumpTryThreshold),null!=t.jumpIgnoreThreshold&&(this._jumpIgnoreThreshold=t.jumpIgnoreThreshold),null!=t.playbackRate&&(this._playbackRate=t.playbackRate,this._clock.changeScaleFactor(this._playbackRate),this._updateGameAudioSuppression()),null!=t.loopRenderMode&&this._setLoopRenderMode(t.loopRenderMode),null!=t.targetTimeFunc&&(this._targetTimeFunc=t.targetTimeFunc),null!=t.targetTimeOffset&&(this._targetTimeOffset=t.targetTimeOffset),null!=t.originDate&&(this._originDate=t.originDate),this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,null!=t.omitInterpolatedTickOnReplay&&(this._omitInterpolatedTickOnReplay=t.omitInterpolatedTickOnReplay),null!=t.targetAge&&(this._targetAge!==t.targetAge&&(this._waitingNextTick=!1),this._targetAge=t.targetAge)},u.prototype.addTickList=function(t){this._tickBuffer.addTickList(t)},u.prototype.getCurrentTime=function(){return this._currentTime},u.prototype._startSkipping=function(t){this._skipping=!0,t||this._updateGameAudioSuppression(),this._tickBuffer.startSkipping(),this._eventBuffer.startSkipping(),this._game.skippingChangedTrigger.fire(!0)},u.prototype._stopSkipping=function(){this._skipping=!1,this._updateGameAudioSuppression(),this._tickBuffer.endSkipping(),this._eventBuffer.endSkipping(),this._game.skippingChangedTrigger.fire(!1)},u.prototype._updateGameAudioSuppression=function(){1!==(this._skipping?this._playbackRate*this._skipTicksAtOnce:this._playbackRate)?this._game._startSuppressAudio():this._game._endSuppressAudio()},u.prototype._handleSceneChange=function(t){var e=t.local,i=t.tickGenerationMode;if(this._sceneLocalMode!==e||this._sceneTickMode!==i)switch(this._sceneLocalMode=e,this._sceneTickMode=i,this._clock.frameTrigger.remove(this._onFrame,this),this._clock.frameTrigger.remove(this._onLocalFrame,this),e){case"full-local":this._tickController.stopTick(),this._clock.frameTrigger.add(this._onLocalFrame,this);break;case"non-local":case"interpolate-local":"by-clock"===i?this._tickController.startTick():this._tickController.startTickOnce(),this._clock.frameTrigger.add(this._onFrame,this);break;default:return void this.errorTrigger.fire(new Error("Unknown LocalTickMode: "+e))}},u.prototype._onLocalFrame=function(){this._doLocalTick()},u.prototype._doLocalTick=function(){var t=this._game,e=this._eventBuffer.readLocalEvents();this._currentTime+=this._frameTime,e?t.tick(!1,Math.floor(this._omittedTickDuration/this._frameTime),e):t.tick(!1,Math.floor(this._omittedTickDuration/this._frameTime)),this._omittedTickDuration=0},u.prototype._onFrame=function(t){var e,i,r;this._loopMode===d.default.Replay&&this._targetTimeFunc?(i=(e=this._targetTimeFunc())+this._realTargetTimeOffset,r=this._currentTickTime,this._onFrameForTimedReplay(i,t),r===this._currentTickTime&&r<=i&&this._isImmediateBeforeOf(i)&&this.rawTargetTimeReachedTrigger.fire(e)):this._onFrameNormal(t)},u.prototype._onFrameForTimedReplay=function(t,e){var i=!1,r=this._game,o=(t-this._currentTickTime)/this._frameTime;if((o>this._jumpTryThreshold||o<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointTime<this._currentTickTime&&(this._waitingStartPoint=!0,this._lastRequestedStartPointTime=t,this._amflow.getStartPoint({timestamp:t},this._onGotStartPoint_bound)),o<=0)this._skipping&&this._stopSkipping();else{this._skipping||(o>this._skipThreshold||0===this._tickBuffer.currentAge)&&(this._tickBuffer.hasNextTick()||this._omitInterpolatedTickOnReplay&&this._foundLatestTick)&&(o=o<=this._skipThreshold,this._startSkipping(o));for(var n=0;n<this._skipTicksAtOnce;++n){var s=this._currentTime+this._frameTime;if(!this._tickBuffer.hasNextTick()){this._waitingNextTick||(this._startWaitingNextTick(),this._foundLatestTick||this._tickBuffer.requestNonIgnorableTicks()),this._omitInterpolatedTickOnReplay&&"interpolate-local"===this._sceneLocalMode&&(this._foundLatestTick&&(this._currentTime=t-this._frameTime),s<t&&this._doLocalTick());break}var a=null!=(a=this._tickBuffer.readNextTickTime())?a:this._currentTickTime+this._frameTime;if(t<=a&&t<=s)break;if(s<a){if(!this._omitInterpolatedTickOnReplay||!this._skipping){"interpolate-local"===this._sceneLocalMode&&this._doLocalTick();continue}if(t<=a){this._omittedTickDuration+=t-this._currentTickTime,this._currentTime=Math.floor(t/this._frameTime)*this._frameTime;break}this._omittedTickDuration+=(s=a)-this._currentTickTime}this._currentTime=s,this._currentTickTime=a;var h,c,s=this._tickBuffer.consume(),a=-1;if(this._events.length=0,null!=s&&((h=this._eventBuffer.readLocalEvents())&&(c=this._events).push.apply(c,h),i=("number"==typeof s?a=s:(a=s[0],(c=s[1])&&(h=this._events).push.apply(h,c)),r.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime),this._events))),this._omittedTickDuration=0,r._notifyPassedAgeTable[a]&&r.fireAgePassedIfNeeded()){e.interrupt=!0;break}if(i)break}this._skipping&&t-this._currentTime<this._frameTime&&this._isImmediateBeforeOf(t)&&(this._stopSkipping(),this._tickBuffer.dropAll(),this._tickBuffer.requestTicks())}},u.prototype._onFrameNormal=function(t){var e=!1,i=this._game;if(!this._skipping&&t.deltaTime>this._skipThresholdTime&&(this._startSkipping(!1),this._waitingNextTick&&this._stopSkipping()),this._waitingNextTick)"interpolate-local"===this._sceneLocalMode&&this._doLocalTick();else{var r,o=this._tickBuffer.currentAge,n=this._loopMode===d.default.Realtime?(r=this._tickBuffer.knownLatestAge+1)-o:null===this._targetAge?(r=null,1):this._targetAge===o?(r=this._targetAge=null,1):(r=this._targetAge)-o;if((n>this._jumpTryThreshold||n<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointAge<o&&(this._waitingStartPoint=!0,this._lastRequestedStartPointAge=r,this._amflow.getStartPoint({frame:r},this._onGotStartPoint_bound)),n<=0)0===n&&(this._foundLatestTick||this._tickBuffer.requestNonIgnorableTicks(),this._startWaitingNextTick()),"interpolate-local"===this._sceneLocalMode&&this._doLocalTick(),this._skipping&&this._stopSkipping();else{!this._skipping&&(n>this._skipThreshold||0===o)&&this._tickBuffer.hasNextTick()&&(o=0===o&&this._tickBuffer.isKnownLatestTickTimeNear(this._skipThresholdTime,this._currentTickTime,this._frameTime),this._startSkipping(o));for(var s=!this._skipping&&n<=this._delayIgnoreThreshold?1:Math.min(n,this._skipTicksAtOnce),a=0;a<s;++a){var h=this._currentTime+this._frameTime,c=this._tickBuffer.readNextTickTime();if(null!=c&&h<c){if(!(this._loopMode===d.default.Realtime||this._omitInterpolatedTickOnReplay&&this._skipping)){if("interpolate-local"!==this._sceneLocalMode)break;this._doLocalTick();continue}h=Math.ceil(c/this._frameTime)*this._frameTime,this._omittedTickDuration+=h-this._currentTickTime}this._currentTime=h,this._currentTickTime=null!=c?c:this._currentTickTime+this._frameTime;h=this._tickBuffer.consume(),c=-1;if(this._events.length=0,null==h){this._tickBuffer.requestTicks(),this._startWaitingNextTick();break}var u,l=this._eventBuffer.readLocalEvents();if(l&&(u=this._events).push.apply(u,l),e=("number"==typeof h?c=h:(c=h[0],(u=h[1])&&(l=this._events).push.apply(l,u)),i.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime),this._events)),this._omittedTickDuration=0,i._notifyPassedAgeTable[c]&&i.fireAgePassedIfNeeded()){t.interrupt=!0;break}if(e)break}this._skipping&&r-this._tickBuffer.currentAge<1&&this._stopSkipping()}}},u.prototype._onGotNextFrameTick=function(){this._waitingNextTick&&this._loopMode!==d.default.FrameByFrame&&this._stopWaitingNextTick()},u.prototype._onGotNoTick=function(){this._waitingNextTick&&(this._foundLatestTick=!0)},u.prototype._onGotStartPoint=function(t,e){if(this._waitingStartPoint=!1,t)this.errorTrigger.fire(t);else if(e){if(this._targetTimeFunc&&this._loopMode!==d.default.Realtime){t=this._targetTimeFunc()+this._realTargetTimeOffset;if(t<e.timestamp)return;var i=this._currentTickTime;if(i<=t&&e.timestamp<i+this._jumpIgnoreThreshold*this._frameTime)return}else{t=this._loopMode===d.default.Realtime?this._tickBuffer.knownLatestAge+1:this._targetAge;if(null===t||t<e.frame)return;i=this._tickBuffer.currentAge;if(i<=t&&e.frame<i+this._jumpIgnoreThreshold)return}this.reset(e)}},u.prototype._onGameStarted=function(){this._clock.frameTrigger.add({index:0,owner:this,func:this._onEventsProcessed})},u.prototype._onEventsProcessed=function(){this._eventBuffer.processEvents("full-local"===this._sceneLocalMode)},u.prototype._setLoopRenderMode=function(t){if(t!==this._loopRenderMode)switch(this._loopRenderMode=t){case a.default.AfterRawFrame:this._clock.rawFrameTrigger.add(this._renderOnRawFrame,this);break;case a.default.None:this._clock.rawFrameTrigger.remove(this._renderOnRawFrame,this);break;default:this.errorTrigger.fire(new Error("GameLoop#_setLoopRenderMode: unknown mode: "+t))}},u.prototype._renderOnRawFrame=function(){this._game.render()},u.prototype._onGameRaiseEvent=function(t){this._eventBuffer.onEvent(t)},u.prototype._onGameRaiseTick=function(t){if(this._executionMode===s.default.Active){if(t)for(var e=0;e<t.length;++e)this._eventBuffer.addEventDirect(t[e]);this._tickController.forceGenerateTick()}},u.prototype._onPollingTick=function(){var t=Date.now();t-this._lastPollingTickTime>this._pollingTickThreshold&&(this._lastPollingTickTime=t,this._tickBuffer.requestTicks())},u.prototype._startWaitingNextTick=function(){this._waitingNextTick=!0,this._clock.rawFrameTrigger.add(this._onPollingTick,this),this._lastPollingTickTime=Date.now(),this._skipping&&this._stopSkipping()},u.prototype._stopWaitingNextTick=function(){this._waitingNextTick=!1,this._clock.rawFrameTrigger.remove(this._onPollingTick,this)},u.prototype._isImmediateBeforeOf=function(t){return this._tickBuffer.hasNextTick()?t<(null!=(t=this._tickBuffer.readNextTickTime())?t:this._currentTickTime+this._frameTime):this._foundLatestTick},i.GameLoop=u},{"./Clock":98,"./ExecutionMode":100,"./LoopMode":106,"./LoopRenderMode":107,"./ProfilerClock":108,"./TickController":111,"./constants":114,"@akashic/akashic-engine":2}],105:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.JoinResolver=i.JoinLeaveRequest=void 0;var r=t("@akashic/akashic-engine"),o=(n.prototype._onGotStorageData=function(t,e){this.resolved=!0,t?this.joinResolver.errorTrigger.fire(t):this.pev[4]=e},n);function n(t,e,i,r){this.joinResolver=e,0===(this.pev=t)[0]&&r?(this.resolved=!1,null!=i&&i.getStorageData(r,this._onGotStorageData.bind(this))):this.resolved=!0}function s(t){this._keysForJoin=null,this._requested=[],this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow}i.JoinLeaveRequest=o,s.prototype.request=function(t){this._requested.push(new o(t,this,this._amflow,this._keysForJoin||void 0))},s.prototype.readResolved=function(){var t=this._requested.length;if(0===t||!this._requested[0].resolved)return null;for(var e=[],i=0;i<t;++i){var r=this._requested[i];if(!r.resolved)break;e.push(r.pev)}return this._requested.splice(0,i),e},s.prototype.setRequestValuesForJoin=function(t){this._keysForJoin=t},i.JoinResolver=s},{"@akashic/akashic-engine":2}],106:[function(t,e,i){"use strict";var r,o;Object.defineProperty(i,"__esModule",{value:!0}),(o=r=r||{})[o.Realtime=0]="Realtime",o[o.Replay=1]="Replay",o[o.FrameByFrame=2]="FrameByFrame",i.default=r},{}],107:[function(t,e,i){"use strict";var r,o;Object.defineProperty(i,"__esModule",{value:!0}),(o=r=r||{})[o.AfterRawFrame=0]="AfterRawFrame",o[o.None=1]="None",i.default=r},{}],108:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.ProfilerClock=void 0,t("./Clock")),t=(o=t.Clock,n(s,o),s.prototype._onLooperCall=function(t){var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var i=this._totalDeltaTime;if((i+=t)<=this._skipFrameWaitTime)this._totalDeltaTime=i;else{this._profiler.timeEnd(1),this._profiler.time(1);var t=i<this._waitTimeDoubled?1:i>this._waitTimeMax?this._realMaxFramePerOnce:i/this._waitTime|0,r=t,o={deltaTime:e,interrupt:!1};for(this._profiler.setValue(0,r-1);0<r&&this.running&&!o.interrupt;)--r,this._profiler.time(2),this.frameTrigger.fire(o),this._profiler.timeEnd(2),o.deltaTime=0;i-=(t-r)*this._waitTime,this._profiler.time(3),this.rawFrameTrigger.fire(),this._profiler.timeEnd(3),this._totalDeltaTime=i,this._profiler.flush()}return this._waitTime-i},s);function s(t){var e=o.call(this,t)||this;return e._profiler=t.profiler,e}i.ProfilerClock=t},{"./Clock":98}],109:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.StorageResolver=void 0;var r=t("@akashic/akashic-engine"),o=t("./ExecutionMode");function n(t){this.errorTrigger=new r.Trigger,this._unresolvedLoaders=Object.create(null),this._unresolvedStorages=Object.create(null),t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.getStorageFunc=this._getStorage.bind(this),this.putStorageFunc=this._putStorage.bind(this),this.requestValuesForJoinFunc=this._requestValuesForJoin.bind(this),this._onStoragePut_bound=this._onStoragePut.bind(this),this._game=t.game,this._amflow=t.amflow,this._tickGenerator=t.tickGenerator,this._tickBuffer=t.tickBuffer,this._executionMode=null,this.setExecutionMode(t.executionMode)}n.prototype.setExecutionMode=function(t){var e,i;this._executionMode!==t&&(this._executionMode=t,e=this._tickBuffer,i=this._tickGenerator,(t===o.default.Active?(e.gotStorageTrigger.remove(this._onGotStorageOnTick,this),i):(i.gotStorageTrigger.remove(this._onGotStorageOnTick,this),e)).gotStorageTrigger.add(this._onGotStorageOnTick,this))},n.prototype._onGotStorageOnTick=function(t){var e,i,r=t.age,t=t.storageData,o=this._unresolvedLoaders[r];o?(delete this._unresolvedLoaders[r],e=r,i=t.map(function(t){return t.values}),o._onLoaded(i,e)):this._unresolvedStorages[r]=t},n.prototype._getStorage=function(t,e,i){null!=i?this._tickBuffer.requestTicks(r=i,1):this._executionMode===o.default.Active?r=this._tickGenerator.requestStorageTick(t):(r=this._game.age,this._tickBuffer.requestTicks(r,1));var r,i=this._unresolvedStorages[r];i?(delete this._unresolvedStorages[r],t=r,i=i.map(function(t){return t.values}),e._onLoaded(i,t)):this._unresolvedLoaders[r]=e},n.prototype._putStorage=function(t,e,i){this._executionMode===o.default.Active&&this._amflow.putStorageData(t,e,i,this._onStoragePut_bound)},n.prototype._requestValuesForJoin=function(t){this._tickGenerator.setRequestValuesForJoin(t)},n.prototype._onStoragePut=function(t){t&&this.errorTrigger.fire(t)},i.StorageResolver=n},{"./ExecutionMode":100,"@akashic/akashic-engine":2}],110:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TickBuffer=void 0;var r=t("@akashic/akashic-engine"),o=t("./ExecutionMode");r.EventIndex;function n(t){this.currentAge=0,this.knownLatestAge=-1,this.gotNextTickTrigger=new r.Trigger,this.gotNoTickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this._receiving=!1,this._skipping=!1,this._tickRanges=[],this._nextTickTimeCache=null,this._amflow=t.amflow,this._prefetchThreshold=t.prefetchThreshold||n.DEFAULT_PREFETCH_THRESHOLD,this._sizeRequestOnce=t.sizeRequestOnce||n.DEFAULT_SIZE_REQUEST_ONCE,this._executionMode=t.executionMode,this._startedAt=t.startedAt||0,this._oldTimestampThreshold=null!=t.startedAt?t.startedAt-864e6:0,this._nearestAbsentAge=this.currentAge,this._addTick_bound=this.addTick.bind(this),this._onTicks_bound=this._onTicks.bind(this)}n.prototype.start=function(){this._receiving=!0,this._updateAmflowReceiveState()},n.prototype.stop=function(){this._receiving=!1,this._updateAmflowReceiveState()},n.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._dropUntil(this.knownLatestAge+1),this.knownLatestAge=this.currentAge,this._nextTickTimeCache=null,this._nearestAbsentAge=this.currentAge,this._executionMode=t,this._updateAmflowReceiveState())},n.prototype.setCurrentAge=function(t){this._dropUntil(t),this._nextTickTimeCache=null,this.currentAge=t,this.knownLatestAge<t-1&&(this.knownLatestAge=t-1),this._nearestAbsentAge=this._findNearestAbscentAge(t)},n.prototype.startSkipping=function(){this._skipping=!0},n.prototype.endSkipping=function(){this._skipping=!1},n.prototype.hasNextTick=function(){return this.currentAge!==this._nearestAbsentAge},n.prototype.consume=function(){var t,e;return this.currentAge===this._nearestAbsentAge?null:(t=this.currentAge)===(e=this._tickRanges[0]).start?(this._nextTickTimeCache=null,++this.currentAge,++e.start,t+this._prefetchThreshold===this._nearestAbsentAge&&this.requestTicks(this._nearestAbsentAge,this._sizeRequestOnce),e.start===e.end&&this._tickRanges.shift(),0<e.ticks.length&&e.ticks[0][0]===t?e.ticks.shift():t):(this._dropUntil(this.currentAge),this.consume())},n.prototype.readNextTickTime=function(){if(null!=this._nextTickTimeCache)return this._nextTickTimeCache;if(this.currentAge!==this._nearestAbsentAge){var t=this.currentAge,e=this._tickRanges[0];if(t!==e.start)return this._dropUntil(this.currentAge),this.readNextTickTime();if(0!==e.ticks.length){e=e.ticks[0];if(e[0]===t){var i=e[1];if(i)for(var r,o=0;o<i.length;++o)if(2===i[o][0])return(r=i[o][3])<this._oldTimestampThreshold&&(r+=this._startedAt),this._nextTickTimeCache=r}}}return null},n.prototype.isKnownLatestTickTimeNear=function(t,e,i){return this._calcKnownLatestTickTimeDelta(t,e,i)<t},n.prototype.requestTicks=function(t,e){void 0===t&&(t=this.currentAge),void 0===e&&(e=this._sizeRequestOnce),this._skipping?this.requestNonIgnorableTicks(t,e):this.requestAllTicks(t,e)},n.prototype.requestAllTicks=function(t,e){void 0===t&&(t=this.currentAge),void 0===e&&(e=this._sizeRequestOnce),this._executionMode===o.default.Passive&&("undefined"!=typeof window&&window.prompt===window.confirm?this._amflow.getTickList(t,t+e,this._onTicks_bound):this._amflow.getTickList({begin:t,end:t+e},this._onTicks_bound))},n.prototype.requestNonIgnorableTicks=function(t,e){void 0===t&&(t=this.currentAge),void 0===e&&(e=this._sizeRequestOnce),this._executionMode===o.default.Passive&&("undefined"!=typeof window&&window.prompt===window.confirm?this._amflow.getTickList(t,t+e,this._onTicks_bound):this._amflow.getTickList({begin:t,end:t+e,excludeEventFlags:{ignorable:!0}},this._onTicks_bound))},n.prototype.addTick=function(t){for(var e=t[0],i=this.currentAge===e&&this._nearestAbsentAge===e,r=(this.knownLatestAge<e&&(this.knownLatestAge=e),t[2]),o=(r&&this.gotStorageTrigger.fire({age:t[0],storageData:r}),this._tickRanges.length-1);0<=o&&!(e>=(n=this._tickRanges[o]).start);--o);var n,r=this._tickRanges[o+1];o<0?this._tickRanges.unshift(this._createTickRangeFromTick(t)):e===(n=this._tickRanges[o]).end?(++n.end,t[1]&&n.ticks.push(t)):e>n.end&&this._tickRanges.splice(o+1,0,this._createTickRangeFromTick(t)),this._nearestAbsentAge===e&&(++this._nearestAbsentAge,r&&this._nearestAbsentAge===r.start&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge))),i&&this.gotNextTickTrigger.fire()},n.prototype.addTickList=function(t){for(var e=t[0],i=t[1]+1,r=t[2],t=e,o=i,n=(this.knownLatestAge<i-1&&(this.knownLatestAge=i-1),0),s=this._tickRanges.length,n=0;n<s;++n){var a=this._tickRanges[n];if(e<a.start)break}var h=n;for(0<n&&(d=this._tickRanges[--n].end,e<d&&(e=d));n<s;++n){a=this._tickRanges[n];if(i<=a.end)break}if(n<s&&((d=this._tickRanges[n].start)<i&&(i=d)),i<=e)return{start:e,end:e,ticks:[]};r=r||[],t===e&&o===i||(r=r.filter(function(t){t=t[0];return e<=t&&t<i}));for(var c=0;c<r.length;++c){var u=r[c],l=u[2];l&&this.gotStorageTrigger.fire({age:u[0],storageData:l})}var d={start:e,end:i,ticks:r},t=Math.max(0,n-h);return this._tickRanges.splice(h,t,d),e<=this._nearestAbsentAge&&this._nearestAbsentAge<i&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge)),d},n.prototype.dropAll=function(){this._tickRanges=[],this._nearestAbsentAge=this.currentAge,this._nextTickTimeCache=null},n.prototype._updateAmflowReceiveState=function(){this._receiving&&this._executionMode===o.default.Passive?this._amflow.onTick(this._addTick_bound):this._amflow.offTick(this._addTick_bound)},n.prototype._onTicks=function(t,e){if(t)throw t;e&&(t=this.currentAge===this._nearestAbsentAge,e=this.addTickList(e),t&&e.start<=this.currentAge&&this.currentAge<e.end&&this.gotNextTickTrigger.fire(),e.start!==e.end)||this.gotNoTickTrigger.fire()},n.prototype._findNearestAbscentAge=function(t){for(var e=0,i=this._tickRanges.length;e<i&&!(t<=this._tickRanges[e].end);++e);for(;e<i;++e){var r=this._tickRanges[e];if(t<r.start)break;t=r.end}return t},n.prototype._dropUntil=function(t){for(var e=0;e<this._tickRanges.length&&!(t<this._tickRanges[e].end);++e);if(this._tickRanges=this._tickRanges.slice(e),0!==this._tickRanges.length){var i=this._tickRanges[0];if(!(t<i.start)){for(i.start=t,e=0;e<i.ticks.length&&!(t<=i.ticks[e][0]);++e);i.ticks=i.ticks.slice(e)}}},n.prototype._calcKnownLatestTickTimeDelta=function(t,e,i){var r=this._tickRanges;if(0===r.length)return 0;for(var o=0,n=h=r[r.length-1].end,s=r.length-1;0<=s;--s){var a=r[s];if(a.end!==h)return 1/0;for(var h=a.start,c=a.ticks,u=c.length-1;0<=u;--u){var l=c[u],d=l[1];if(d){l=l[0];if(t<(o+=(n-l)*i))return t;for(var p,n=l,f=0;f<d.length;++f)if(2===d[f][0])return p=d[f][3],Math.min(p-e+o,t)}}}return o+=(n-r[0].start)*i,Math.min(o,t)},n.prototype._createTickRangeFromTick=function(t){var e=t[0],e={start:e,end:e+1,ticks:[]};return t[1]&&e.ticks.push(t),e},n.DEFAULT_PREFETCH_THRESHOLD=1800,n.DEFAULT_SIZE_REQUEST_ONCE=9e3,i.TickBuffer=n},{"./ExecutionMode":100,"@akashic/akashic-engine":2}],111:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TickController=void 0;var r=t("@akashic/akashic-engine"),o=t("./ExecutionMode"),n=t("./StorageResolver"),s=t("./TickBuffer"),a=t("./TickGenerator");function h(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._clock=t.clock,this._started=!1,this._executionMode=t.executionMode,this._generator=new a.TickGenerator({amflow:t.amflow,eventBuffer:t.eventBuffer,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._buffer=new s.TickBuffer({amflow:t.amflow,executionMode:t.executionMode,startedAt:t.startedAt}),this._storageResolver=new n.StorageResolver({game:t.game,amflow:t.amflow,tickGenerator:this._generator,tickBuffer:this._buffer,executionMode:t.executionMode,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._generator.tickTrigger.add(this._onTickGenerated,this),this._clock.frameTrigger.add(this._generator.next,this._generator)}h.prototype.startTick=function(){this._started=!0,this._updateGeneratorState()},h.prototype.stopTick=function(){this._started=!1,this._updateGeneratorState()},h.prototype.startTickOnce=function(){this._started=!0,this._generator.tickTrigger.addOnce(this._stopTriggerOnTick,this),this._updateGeneratorState()},h.prototype.setNextAge=function(t){this._generator.setNextAge(t)},h.prototype.forceGenerateTick=function(){this._generator.forceNext()},h.prototype.getBuffer=function(){return this._buffer},h.prototype.storageFunc=function(){return{storageGetFunc:this._storageResolver.getStorageFunc,storagePutFunc:this._storageResolver.putStorageFunc,requestValuesForJoinFunc:this._storageResolver.requestValuesForJoinFunc}},h.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._executionMode=t,this._updateGeneratorState(),this._buffer.setExecutionMode(t),this._storageResolver.setExecutionMode(t))},h.prototype._stopTriggerOnTick=function(){this.stopTick()},h.prototype._updateGeneratorState=function(){var t=this._started&&this._executionMode===o.default.Active;this._generator.startStopGenerate(t)},h.prototype._onTickGenerated=function(t){this._amflow.sendTick(t),this._buffer.addTick(t)},i.TickController=h},{"./ExecutionMode":100,"./StorageResolver":109,"./TickBuffer":110,"./TickGenerator":112,"@akashic/akashic-engine":2}],112:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TickGenerator=void 0;var r=t("@akashic/akashic-engine"),o=t("./JoinResolver");function n(t){this.tickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this.errorTrigger=new r.Trigger,this._nextAge=0,this._storageDataForNext=null,this._generatingTick=!1,this._waitingStorage=!1,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._eventBuffer=t.eventBuffer,this._joinResolver=new o.JoinResolver({amflow:t.amflow,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._onGotStorageData_bound=this._onGotStorageData.bind(this)}n.prototype.next=function(){if(this._generatingTick&&!this._waitingStorage){var t=this._eventBuffer.readJoinLeaves();if(t)for(var e=0;e<t.length;++e)this._joinResolver.request(t[e]);var i=this._eventBuffer.readEvents(),r=this._joinResolver.readResolved(),r=(r&&(i?i.push.apply(i,r):i=r),this._storageDataForNext);this._storageDataForNext=null,r?this.tickTrigger.fire([this._nextAge++,i,r]):this.tickTrigger.fire([this._nextAge++,i])}},n.prototype.forceNext=function(){var t;this._waitingStorage?this.errorTrigger.fire(new Error("TickGenerator#forceNext(): cannot generate tick while waiting storage.")):(t=this._generatingTick,this._generatingTick=!0,this.next(),this._generatingTick=t)},n.prototype.startStopGenerate=function(t){this._generatingTick=t},n.prototype.startTick=function(){this._generatingTick=!0},n.prototype.stopTick=function(){this._generatingTick=!1},n.prototype.setNextAge=function(t){this._waitingStorage?this.errorTrigger.fire(new Error("TickGenerator#setNextAge(): cannot change the next age while waiting storage.")):this._nextAge=t},n.prototype.requestStorageTick=function(t){var e;return this._waitingStorage?(e=new Error("TickGenerator#requestStorageTick(): Unsupported: multiple storage request"),this.errorTrigger.fire(e),-1):(this._waitingStorage=!0,this._amflow.getStorageData(t,this._onGotStorageData_bound),this._nextAge)},n.prototype.setRequestValuesForJoin=function(t){this._joinResolver.setRequestValuesForJoin(t)},n.prototype._onGotStorageData=function(t,e){this._waitingStorage=!1,t?this.errorTrigger.fire(t):e&&(this._storageDataForNext=e,this.gotStorageTrigger.fire({age:this._nextAge,storageData:e}))},i.TickGenerator=n},{"./JoinResolver":105,"@akashic/akashic-engine":2}],113:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SimpleProfiler=void 0;var r=t("@akashic/akashic-engine");function o(t){var e;this._startTime=0,this._beforeFlushTime=0,this._beforeTimes=[],this._values=[],this._calculateProfilerValueTrigger=new r.Trigger,this._interval=null!=(e=t.interval)?e:o.DEFAULT_INTERVAL,null!=t.limit?this._limit=t.limit>=o.DEFAULT_LIMIT?t.limit:o.DEFAULT_LIMIT:this._limit=o.DEFAULT_LIMIT,t.getValueHandler&&this._calculateProfilerValueTrigger.add(t.getValueHandler,t.getValueHandlerOwner),this._reset()}o.prototype.time=function(t){this._beforeTimes[t]=this._getCurrentTime()},o.prototype.timeEnd=function(t){var e=this._getCurrentTime(),i=null!=this._beforeTimes[t]?e-this._beforeTimes[t]:0;this._values[t].push({time:e,value:i})},o.prototype.flush=function(){var t=this._getCurrentTime();if(0===this._beforeFlushTime&&(this._beforeFlushTime=t),this._beforeFlushTime+this._interval<t&&(this._calculateProfilerValueTrigger.fire(this.getProfilerValue(this._interval)),this._beforeFlushTime=t),this._values[1].length>this._limit)for(var e in this._values)this._values.hasOwnProperty(e)&&(this._values[e]=this._values[e].slice(-o.BACKUP_MARGIN))},o.prototype.setValue=function(t,e){this._values[t].push({time:this._getCurrentTime(),value:e})},o.prototype.getProfilerValue=function(t){var e=this._calculateProfilerValue(1,t);return{skippedFrameCount:this._calculateProfilerValue(0,t),rawFrameInterval:e,framePerSecond:{ave:1e3/e.ave,max:1e3/e.min,min:1e3/e.max},frameTime:this._calculateProfilerValue(2,t),renderingTime:this._calculateProfilerValue(3,t)}},o.prototype._reset=function(){this._startTime=this._getCurrentTime(),this._beforeFlushTime=0,this._beforeTimes=[],this._beforeTimes[1]=0,this._beforeTimes[2]=0,this._beforeTimes[3]=0,this._beforeTimes[0]=0,this._values=[],this._values[1]=[],this._values[2]=[],this._values[3]=[],this._values[0]=[]},o.prototype._calculateProfilerValue=function(t,e){for(var i=this._getCurrentTime()-e,r=0,o=0,n=0,s=Number.MAX_VALUE,a=this._values[t].length-1;0<=a&&!(0<o&&this._values[t][a].time<i);--a){var h=this._values[t][a].value;n<h&&(n=h),h<s&&(s=h),r+=h,++o}return{ave:r/o,max:n,min:s}},o.prototype._getCurrentTime=function(){return+new Date},o.DEFAULT_INTERVAL=1e3,o.DEFAULT_LIMIT=1e3,o.BACKUP_MARGIN=100,i.SimpleProfiler=o},{"@akashic/akashic-engine":2}],114:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PSEUDO_INFINITE_AGE=i.DEFAULT_POLLING_TICK_THRESHOLD=i.DEFAULT_JUMP_IGNORE_THRESHOLD=i.DEFAULT_JUMP_TRY_THRESHOLD=i.DEFAULT_SKIP_THRESHOLD=i.DEFAULT_SKIP_TICKS_AT_ONCE=i.DEFAULT_DELAY_IGNORE_THRESHOLD=void 0,i.DEFAULT_DELAY_IGNORE_THRESHOLD=6,i.DEFAULT_SKIP_TICKS_AT_ONCE=100,i.DEFAULT_SKIP_THRESHOLD=100,i.DEFAULT_JUMP_TRY_THRESHOLD=3e4,i.DEFAULT_JUMP_IGNORE_THRESHOLD=15e3,i.DEFAULT_POLLING_TICK_THRESHOLD=1e4,i.PSEUDO_INFINITE_AGE=189216e4},{}],115:[function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var o=Object.getOwnPropertyDescriptor(e,i);o&&("get"in o?e.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,o)}:function(t,e,i,r){t[r=void 0===r?i:r]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)},n=(Object.defineProperty(i,"__esModule",{value:!0}),i.LoopRenderMode=i.LoopMode=i.GameDriver=i.Game=i.ExecutionMode=i.SimpleProfiler=i.ReplayAmflowProxy=i.MemoryAmflowClient=void 0,o(t("./constants"),i),t("@akashic/amflow-util/lib/MemoryAmflowClient")),s=(Object.defineProperty(i,"MemoryAmflowClient",{enumerable:!0,get:function(){return n.MemoryAmflowClient}}),t("@akashic/amflow-util/lib/ReplayAmflowProxy")),a=(Object.defineProperty(i,"ReplayAmflowProxy",{enumerable:!0,get:function(){return s.ReplayAmflowProxy}}),t("./auxiliary/SimpleProfiler")),o=(Object.defineProperty(i,"SimpleProfiler",{enumerable:!0,get:function(){return a.SimpleProfiler}}),t("./ExecutionMode")),h=(i.ExecutionMode=o.default,t("./Game")),c=(Object.defineProperty(i,"Game",{enumerable:!0,get:function(){return h.Game}}),t("./GameDriver")),o=(Object.defineProperty(i,"GameDriver",{enumerable:!0,get:function(){return c.GameDriver}}),t("./LoopMode")),o=(i.LoopMode=o.default,t("./LoopRenderMode"));i.LoopRenderMode=o.default},{"./ExecutionMode":100,"./Game":101,"./GameDriver":102,"./LoopMode":106,"./LoopRenderMode":107,"./auxiliary/SimpleProfiler":113,"./constants":114,"@akashic/amflow-util/lib/MemoryAmflowClient":87,"@akashic/amflow-util/lib/ReplayAmflowProxy":88}],116:[function(t,e,i){e.exports=t("./lib/full/index")},{"./lib/full/index":158}],117:[function(t,e,i){"use strict";function r(){this.audioAssets=[],this._masterVolume=1}Object.defineProperty(i,"__esModule",{value:!0}),i.AudioManager=void 0,r.prototype.registerAudioAsset=function(t){-1===this.audioAssets.indexOf(t)&&this.audioAssets.push(t)},r.prototype.removeAudioAsset=function(t){t=this.audioAssets.indexOf(t);-1===t&&this.audioAssets.splice(t,1)},r.prototype.setMasterVolume=function(t){this._masterVolume=t;for(var e=0;e<this.audioAssets.length;e++)this.audioAssets[e]._lastPlayedPlayer&&this.audioAssets[e]._lastPlayedPlayer.notifyMasterVolumeChanged()},r.prototype.getMasterVolume=function(){return this._masterVolume},i.AudioManager=r},{}],118:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ContainerController=void 0;var r=t("@akashic/trigger"),o=t("./InputHandlerLayer");function n(t){this.container=void 0,this.surface=void 0,this.inputHandlerLayer=void 0,this.rootView=void 0,this.useResizeForScaling=!1,this.pointEventTrigger=new r.Trigger,this._rendererReq=void 0,this._disablePreventDefault=!1,this.resourceFactory=t}n.prototype.initialize=function(t){this._rendererReq=t.rendererRequirement,this._disablePreventDefault=!!t.disablePreventDefault,this._loadView()},n.prototype.setRootView=function(t){t!==this.rootView&&(this.rootView&&(this.unloadView(),this._loadView()),this.rootView=t,this._appendToRootView(t))},n.prototype.resetView=function(t){this.unloadView(),this._rendererReq=t,this._loadView(),this._appendToRootView(this.rootView)},n.prototype.getRenderer=function(){if(this.surface)return this.surface.renderer();throw new Error("this container has no surface")},n.prototype.changeScale=function(t,e){this.useResizeForScaling?this.surface.changePhysicalScale(t,e):this.surface.changeVisualScale(t,e),this.inputHandlerLayer._inputHandler.setScale(t,e)},n.prototype.unloadView=function(){if(this.inputHandlerLayer.disablePointerEvent(),this.rootView)for(;this.rootView.firstChild;)this.rootView.removeChild(this.rootView.firstChild)},n.prototype._loadView=function(){var t=this._rendererReq,e=t.primarySurfaceWidth,t=t.primarySurfaceHeight,i=this._disablePreventDefault;this.container=document.createDocumentFragment(),this.inputHandlerLayer?(this.inputHandlerLayer.setViewSize({width:e,height:t}),this.inputHandlerLayer.pointEventTrigger.removeAll(),this.surface&&!this.surface.destroyed()&&(this.inputHandlerLayer.view.removeChild(this.surface.canvas),this.surface.destroy())):this.inputHandlerLayer=new o.InputHandlerLayer({width:e,height:t,disablePreventDefault:i}),this.surface=this.resourceFactory.createPrimarySurface(e,t),this.inputHandlerLayer.view.appendChild(this.surface.getHTMLElement()),this.container.appendChild(this.inputHandlerLayer.view)},n.prototype._appendToRootView=function(t){t.appendChild(this.container),this.inputHandlerLayer.enablePointerEvent(),this.inputHandlerLayer.pointEventTrigger.add(this.pointEventTrigger.fire,this.pointEventTrigger)},i.ContainerController=n},{"./InputHandlerLayer":119,"@akashic/trigger":225}],119:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.InputHandlerLayer=void 0;var r=t("@akashic/trigger"),o=t("./handler/TouchHandler");function n(t){this.view=this._createInputView(t.width,t.height),this._inputHandler=void 0,this.pointEventTrigger=new r.Trigger,this._disablePreventDefault=!!t.disablePreventDefault}n.prototype.enablePointerEvent=function(){var e=this;this._inputHandler=new o.TouchHandler(this.view,this._disablePreventDefault),this._inputHandler.pointTrigger.add(function(t){e.pointEventTrigger.fire(t)}),this._inputHandler.start()},n.prototype.disablePointerEvent=function(){this._inputHandler&&this._inputHandler.stop()},n.prototype.setOffset=function(t){t="position:relative; left:".concat(t.x,"px; top:").concat(t.y,"px");this._inputHandler.inputView.setAttribute("style",t)},n.prototype.setViewSize=function(t){var e=this.view;e.style.width=t.width+"px",e.style.height=t.height+"px"},n.prototype._createInputView=function(t,e){var i=document.createElement("div");return i.setAttribute("tabindex","1"),i.className="input-handler",i.setAttribute("style","display:inline-block; outline:none;"),i.style.width=t+"px",i.style.height=e+"px",i},i.InputHandlerLayer=n},{"./handler/TouchHandler":157,"@akashic/trigger":225}],120:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.addExtname=void 0,i.addExtname=function(t,e){var i=t.indexOf("?");return-1===i?t+"."+e:t.substring(0,i)+"."+e+t.substring(i,t.length)}},{}],121:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Platform=void 0;var r=t("./asset/XHRTextAsset"),o=t("./AudioManager"),n=t("./ContainerController"),s=t("./plugin/AudioPluginManager"),a=t("./plugin/AudioPluginRegistry"),h=t("./RafLooper"),c=t("./ResourceFactory");function u(t){this.containerView=t.containerView,this.audioPluginManager=new s.AudioPluginManager,t.audioPlugins&&this.audioPluginManager.tryInstallPlugin(t.audioPlugins),this.audioPluginManager.tryInstallPlugin(a.AudioPluginRegistry.getRegisteredAudioPlugins()),this._audioManager=new o.AudioManager,this.amflow=t.amflow,this._platformEventHandler=null,this._resourceFactory=t.resourceFactory||new c.ResourceFactory({audioPluginManager:this.audioPluginManager,platform:this,audioManager:this._audioManager}),this.containerController=new n.ContainerController(this._resourceFactory),this._rendererReq=null,this._disablePreventDefault=!!t.disablePreventDefault}u.prototype.setPlatformEventHandler=function(t){this.containerController&&(this.containerController.pointEventTrigger.removeAll({owner:this._platformEventHandler}),this.containerController.pointEventTrigger.add(t.onPointEvent,t)),this._platformEventHandler=t},u.prototype.loadGameConfiguration=function(t,i){var e=new r.XHRTextAsset("(game.json)",t);e._load({_onAssetLoad:function(t){i(null,JSON.parse(e.data))},_onAssetError:function(t,e){i(e,null)}})},u.prototype.getResourceFactory=function(){return this._resourceFactory},u.prototype.setRendererRequirement=function(t){var e;t?(this._rendererReq=t,this._resourceFactory._rendererCandidates=null!=(e=this._rendererReq.rendererCandidates)?e:[],this.containerController&&!this.containerController.inputHandlerLayer?(this.containerController.initialize({rendererRequirement:t,disablePreventDefault:this._disablePreventDefault}),this.containerController.setRootView(this.containerView),this._platformEventHandler&&this.containerController.pointEventTrigger.add(this._platformEventHandler.onPointEvent,this._platformEventHandler)):this.containerController.resetView(t)):this.containerController&&this.containerController.unloadView()},u.prototype.getPrimarySurface=function(){return this.containerController.surface},u.prototype.getOperationPluginViewInfo=function(){var t=this;return{type:"pdi-browser",view:this.containerController.inputHandlerLayer.view,getScale:function(){return t.containerController.inputHandlerLayer._inputHandler.getScale()}}},u.prototype.createLooper=function(t){return new h.RafLooper(t)},u.prototype.sendToExternal=function(t,e){},u.prototype.registerAudioPlugins=function(t){return this.audioPluginManager.tryInstallPlugin(t)},u.prototype.setScale=function(t,e){this.containerController.changeScale(t,e)},u.prototype.notifyViewMoved=function(){},u.prototype.setMasterVolume=function(t){this._audioManager.setMasterVolume(t)},u.prototype.getMasterVolume=function(){return this._audioManager.getMasterVolume()},u.prototype.destroy=function(){this.setRendererRequirement(void 0),this.setMasterVolume(0)},i.Platform=u},{"./AudioManager":117,"./ContainerController":118,"./RafLooper":122,"./ResourceFactory":123,"./asset/XHRTextAsset":133,"./plugin/AudioPluginManager":160,"./plugin/AudioPluginRegistry":161}],122:[function(t,e,i){"use strict";function r(t){this._timerId=null,this._fun=t,this._prev=0}Object.defineProperty(i,"__esModule",{value:!0}),i.RafLooper=void 0,r.prototype.start=function(){var e=this,i=function(t){null!=e._timerId&&(e._timerId=requestAnimationFrame(i),e._fun(t-e._prev),e._prev=t)};this._timerId=requestAnimationFrame(function(t){e._timerId=requestAnimationFrame(i),e._fun(0),e._prev=t})},r.prototype.stop=function(){null!=this._timerId&&cancelAnimationFrame(this._timerId),this._timerId=null,this._prev=0},i.RafLooper=r},{}],123:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ResourceFactory=void 0;var r=t("./asset/GeneratedSVGImageAsset"),o=t("./asset/HTMLImageAsset"),a=t("./asset/HTMLVideoAsset"),n=t("./asset/SVGImageAsset"),s=t("./asset/XHRScriptAsset"),h=t("./asset/XHRTextAsset"),c=t("./canvas/GlyphFactory"),u=t("./canvas/shims/SurfaceFactory");function l(t){this._audioPluginManager=t.audioPluginManager,this._audioManager=t.audioManager,this._platform=t.platform,this._surfaceFactory=new u.SurfaceFactory}l.prototype.createAudioAsset=function(t,e,i,r,o,n,s){void 0===s&&(s=0);var a=this._audioPluginManager.getActivePlugin();if(a)return a=a.createAsset(t,e,i,r,o,n,s),this._audioManager.registerAudioAsset(a),a.onDestroyed.addOnce(this._onAudioAssetDestroyed,this),a;throw new Error("ResourceFactory#createAudioAsset(): could not initialize ActivePlugin")},l.prototype.createAudioPlayer=function(t){var e=this._audioPluginManager.getActivePlugin();if(e)return e.createPlayer(t,this._audioManager);throw new Error("ResourceFactory#createAudioAsset(): could not initialize ActivePlugin")},l.prototype.createImageAsset=function(t,e,i,r){return new o.HTMLImageAsset(t,e,i,r)},l.prototype.createVideoAsset=function(t,e,i,r,o,n,s){return new a.HTMLVideoAsset(t,e,i,r,o,n,s)},l.prototype.createTextAsset=function(t,e){return new h.XHRTextAsset(t,e)},l.prototype.createScriptAsset=function(t,e){return new s.XHRScriptAsset(t,e)},l.prototype.createPrimarySurface=function(t,e){return this._surfaceFactory.createPrimarySurface(t,e,this._rendererCandidates)},l.prototype.createSurface=function(t,e){return this._surfaceFactory.createBackSurface(t,e,this._rendererCandidates)},l.prototype.createGlyphFactory=function(t,e,i,r,o,n,s,a){return new c.GlyphFactory(t,e,i,r,o,n,s,a)},l.prototype.createVectorImageAsset=function(t,e,i,r,o){return new n.SVGImageAsset(t,e,i,r,o)},l.prototype.createVectorImageAssetFromString=function(t,e,i){return new r.GeneratedSVGImageAsset(t,e,i)},l.prototype._onAudioAssetDestroyed=function(t){this._audioManager.removeAudioAsset(t)},i.ResourceFactory=l},{"./asset/GeneratedSVGImageAsset":127,"./asset/HTMLImageAsset":128,"./asset/HTMLVideoAsset":129,"./asset/SVGImageAsset":131,"./asset/XHRScriptAsset":132,"./asset/XHRTextAsset":133,"./canvas/GlyphFactory":136,"./canvas/shims/SurfaceFactory":143}],124:[function(t,e,i){"use strict";function r(t,e,i){if(this.width=t,this.height=e,this._drawable=i,t%1!=0||e%1!=0)throw new Error("Surface#constructor: width and height must be integers");this.width=t,this.height=e,this._drawable=i}Object.defineProperty(i,"__esModule",{value:!0}),i.Surface=void 0,r.prototype.destroy=function(){this._destroyed=!0},r.prototype.destroyed=function(){return!!this._destroyed},i.Surface=r},{}],125:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Asset=void 0;var r=t("@akashic/trigger");function o(t,e){this.onDestroyed=new r.Trigger,this.id=t,this.originalPath=e,this.path=this._assetPathFilter(e)}o.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},o.prototype.destroyed=function(){return void 0===this.id},o.prototype.inUse=function(){return!1},o.prototype._assetPathFilter=function(t){return t},i.Asset=o},{"@akashic/trigger":225}],126:[function(t,e,i){"use strict";var r,a,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.AudioAsset=void 0,t("./Asset")),t=(a=t.Asset,o(n,a),n.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),this._lastPlayedPlayer=t},n.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},n.prototype.inUse=function(){return 0<this._system.findPlayers(this).length},n.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,a.prototype.destroy.call(this)},n);function n(t,e,i,r,o,n,s){t=a.call(this,t,e)||this;return t.type="audio",t.data=void 0,t.duration=i,t.loop=o,t.hint=n,t._system=r,t.offset=s,t.path=t._modifyPath(t.path),t}i.AudioAsset=t},{"./Asset":125}],127:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),c=(Object.defineProperty(i,"__esModule",{value:!0}),i.GeneratedSVGImageAsset=void 0,t("../utils/ExceptionFactory")),t=t("./SVGImageAsset"),t=(o=t.SVGImageAsset,n(s,o),s.prototype.destroy=function(){this._svgString=null,o.prototype.destroy.call(this)},s.prototype._load=function(e){var t,i=this,r=this._svgString,o=new DOMParser;try{var n=o.parseFromString(r,"text/xml").getElementsByTagName("svg")[0],s=n.getAttribute("width"),a=n.getAttribute("height");if(null==s)throw new Error("must give width in the root element.");if(null==a)throw new Error("must give height in the root element.");if(!u(s))throw new Error('the width in the root element must be given in "px" units');if(!u(a))throw new Error('the height in the root element must be given in "px" units');t=window.btoa(r),this.width=parseFloat(s),this.height=parseFloat(a)}catch(t){return void e._onAssetError(this,c.ExceptionFactory.createAssetLoadError(t.message,!1,t))}var h=new Image;h.onerror=function(t){e._onAssetError(i,c.ExceptionFactory.createAssetLoadError("GeneratedSVGImageAsset: unknown loading error",void 0,t))},h.onload=function(){i.data=h,e._onAssetLoad(i)},h.src="data:image/svg+xml;base64,"+t},s);function s(t,e,i){t=o.call(this,t,e,0,0)||this;return t._svgString=i,t}function u(t){return/^[+-]?(?:(?:[0-9]+(?:\.[0-9]*)?)|(?:\.[0-9]+))(?:[eE][+-]?[0-9]+)?(?:px)?$/.test(t)}i.GeneratedSVGImageAsset=t},{"../utils/ExceptionFactory":174,"./SVGImageAsset":131}],128:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLImageAsset=i.ImageAssetSurface=void 0,t("../Surface")),a=t("../utils/ExceptionFactory"),t=t("./Asset"),h=(o=s.Surface,n(c,o),c.prototype.renderer=function(){throw new Error("ImageAssetSurface cannot be rendered.")},c.prototype.isPlaying=function(){return!1},c);function c(){return null!==o&&o.apply(this,arguments)||this}i.ImageAssetSurface=h;u=t.Asset,n(l,u),l.prototype.initialize=function(t){this.hint=t},l.prototype.destroy=function(){this._surface&&!this._surface.destroyed()&&this._surface.destroy(),this.data=void 0,this._surface=void 0,u.prototype.destroy.call(this)},l.prototype._load=function(t){var e=this,i=new Image;this.hint&&this.hint.untainted&&(i.crossOrigin="anonymous"),i.onerror=function(){t._onAssetError(e,a.ExceptionFactory.createAssetLoadError("HTMLImageAsset unknown loading error"))},i.onload=function(){e.data=i,t._onAssetLoad(e)},i.src=this.path},l.prototype.asSurface=function(){if(this.data)return this._surface||(this._surface=new h(this.width,this.height,this.data)),this._surface;throw new Error("ImageAssetImpl#asSurface: not yet loaded.")};var u,s=l;function l(t,e,i,r){t=u.call(this,t,e)||this;return t.type="image",t.width=i,t.height=r,t.data=void 0,t._surface=void 0,t}i.HTMLImageAsset=s},{"../Surface":124,"../utils/ExceptionFactory":174,"./Asset":125}],129:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLVideoAsset=void 0,t("../Surface")),a=t("./Asset"),h=t("./HTMLVideoPlayer"),c=(o=s.Surface,n(u,o),u.prototype.renderer=function(){throw new Error("VideoAssetSurface cannot be rendered.")},u.prototype.isPlaying=function(){return!1},u);function u(t,e,i){return o.call(this,t,e,i)||this}l=a.Asset,n(d,l),d.prototype.play=function(t){return this.getPlayer().play(this),this.getPlayer()},d.prototype.stop=function(){this.getPlayer().stop()},d.prototype.inUse=function(){return!1},d.prototype._load=function(t){var e=this;setTimeout(function(){t._onAssetLoad(e)},0)},d.prototype.getPlayer=function(){return this._player},d.prototype.asSurface=function(){return this._surface};var l,t=d;function d(t,e,i,r,o,n,s){t=l.call(this,t,e)||this;return t.type="video",t.width=i,t.height=r,t.realWidth=0,t.realHeight=0,t._system=o,t._loop=n,t._useRealSize=s,t._player=new h.HTMLVideoPlayer,t._surface=new c(i,r),t}i.HTMLVideoAsset=t},{"../Surface":124,"./Asset":125,"./HTMLVideoPlayer":130}],130:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLVideoPlayer=void 0;var r=t("@akashic/trigger");function o(t){this._loop=!!t,this.onPlay=new r.Trigger,this.onStop=new r.Trigger,this.played=this.onPlay,this.stopped=this.onStop,this.currentVideo=void 0,this.volume=1,this.isDummy=!0}o.prototype.play=function(t){},o.prototype.stop=function(){},o.prototype.changeVolume=function(t){},i.HTMLVideoPlayer=o},{"@akashic/trigger":225}],131:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),c=(Object.defineProperty(i,"__esModule",{value:!0}),i.SVGImageAsset=i.SVGImageAssetSurface=void 0,t("../canvas/context2d/Context2DSurface")),s=t("../Surface"),a=t("../utils/ExceptionFactory"),t=t("./Asset"),u=(o=s.Surface,n(h,o),h.prototype.renderer=function(){throw new Error("SVGImageAssetSurface cannot be rendered.")},h.prototype.isPlaying=function(){return!1},h);function h(){return null!==o&&o.apply(this,arguments)||this}i.SVGImageAssetSurface=u;l=t.Asset,n(d,l),d.prototype.destroy=function(){this.data=null,this.hint=void 0,this._surface=null,l.prototype.destroy.call(this)},d.prototype._load=function(t){var e=this,i=new Image;this.hint&&this.hint.untainted&&(i.crossOrigin="anonymous"),i.onerror=function(){t._onAssetError(e,a.ExceptionFactory.createAssetLoadError("SVGImageAsset unknown loading error"))},i.onload=function(){e.data=i,t._onAssetLoad(e)},i.src=this.path},d.prototype.createSurface=function(t,e,i,r,o,n){void 0===i&&(i=0),void 0===r&&(r=0);var s=this.width,a=this.height,h=this.data;if(!h)throw new Error("SVGImageAsset#asSurface: not yet loaded.");this._surface||(this._surface=new u(s,a,h)),o=o||s,n=n||a;h=new c.Context2DSurface(t,e),s=h.renderer();return s.save(),s.transform([t/o,0,0,e/n,0,0]),s.drawImage(this._surface,i,r,o,n,0,0),s.restore(),h};var l,s=d;function d(t,e,i,r,o){t=l.call(this,t,e)||this;return t.type="vector-image",t.width=i,t.height=r,t.hint=o,t.data=null,t._surface=null,t}i.SVGImageAsset=s},{"../Surface":124,"../canvas/context2d/Context2DSurface":141,"../utils/ExceptionFactory":174,"./Asset":125}],132:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.XHRScriptAsset=void 0,t("../utils/XHRLoader")),t=t("./Asset"),t=(o=t.Asset,n(a,o),a.prototype._load=function(i){var r=this;(new s.XHRLoader).get(this.path,function(t,e){t?i._onAssetError(r,t):(r.script=e+"\n",i._onAssetLoad(r))})},a.prototype.execute=function(t){return this._wrap()(t),t.module.exports},a.prototype.destroy=function(){this.script=void 0,o.prototype.destroy.call(this)},a.prototype._wrap=function(){return new Function("g",a.PRE_SCRIPT+this.script+a.POST_SCRIPT)},a.PRE_SCRIPT="(function(exports, require, module, __filename, __dirname) {",a.POST_SCRIPT="\n})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);",a);function a(){var t=null!==o&&o.apply(this,arguments)||this;return t.type="script",t.script="",t}i.XHRScriptAsset=t},{"../utils/XHRLoader":175,"./Asset":125}],133:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.XHRTextAsset=void 0,t("../utils/XHRLoader")),t=t("./Asset"),t=(o=t.Asset,n(a,o),a.prototype._load=function(i){var r=this;(new s.XHRLoader).get(this.path,function(t,e){t?i._onAssetError(r,t):e?(r.data=e,i._onAssetLoad(r)):i._onAssetError(r,{name:"AssetLoadError",message:"XHRTextAsset#_load(): no data received",retriable:!1})})},a.prototype.destroy=function(){this.data=void 0,o.prototype.destroy.call(this)},a);function a(t,e){t=o.call(this,t,e)||this;return t.type="text",t.data="",t}i.XHRTextAsset=t},{"../utils/XHRLoader":175,"./Asset":125}],134:[function(t,e,i){"use strict";function r(t){this.matrix=t?new Float32Array(t.matrix):new Float32Array([1,0,0,1,0,0])}Object.defineProperty(i,"__esModule",{value:!0}),i.AffineTransformer=void 0,r.prototype.scale=function(t,e){var i=this.matrix;return i[0]*=t,i[1]*=t,i[2]*=e,i[3]*=e,this},r.prototype.translate=function(t,e){var i=this.matrix;return i[4]+=i[0]*t+i[2]*e,i[5]+=i[1]*t+i[3]*e,this},r.prototype.transform=function(t){var e=this.matrix,i=t[0]*e[0]+t[1]*e[2],r=t[0]*e[1]+t[1]*e[3],o=t[2]*e[0]+t[3]*e[2],n=t[2]*e[1]+t[3]*e[3],s=t[4]*e[0]+t[5]*e[2]+e[4],t=t[4]*e[1]+t[5]*e[3]+e[5];return e[0]=i,e[1]=r,e[2]=o,e[3]=n,e[4]=s,e[5]=t,this},r.prototype.setTransform=function(t){var e=this.matrix;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]},r.prototype.copyFrom=function(t){return this.matrix.set(t.matrix),this},i.AffineTransformer=r},{}],135:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.CanvasSurface=void 0,t("../Surface")),t=(o=t.Surface,n(s,o),s.prototype.destroy=function(){this.canvas.width=1,this.canvas.height=1,this.canvas=void 0,o.prototype.destroy.call(this)},s.prototype.getHTMLElement=function(){return this.canvas},s.prototype.changeVisualScale=function(t,e){var i=this.canvas.style;"transform"in i?(i.transformOrigin="0 0",i.transform="scale("+t+","+e+")"):"webkitTransform"in i?(i.webkitTransformOrigin="0 0",i.webkitTransform="scale("+t+","+e+")"):(i.width=Math.floor(t*this.width)+"px",i.height=Math.floor(e*this.width)+"px")},s);function s(t,e){var i=this,r=document.createElement("canvas"),i=o.call(this,t,e,r)||this;return r.width=t,r.height=e,i.canvas=r,i}i.CanvasSurface=t},{"../Surface":124}],136:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GlyphFactory=void 0;var g=t("./context2d/Context2DSurface");function o(t,e,i,r,o,n,s,a,h,c,u,l){var d=e<y._environmentMinimumFontSize?e/y._environmentMinimumFontSize:1,p=Math.ceil((e+2*o)*d),f=Math.ceil((e+2*n)*d),p=new g.Context2DSurface(p,f),f=p.canvas,_=f.getContext("2d");if(_)return t=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t),_.save(),_.font=l+" "+e+"px "+i,_.textAlign="left",_.textBaseline="alphabetic",_.lineJoin="bevel",1!=d&&_.scale(d,d),0<h&&(_.lineWidth=h,_.strokeStyle=c,_.strokeText(t,o,n+r)),u||(_.fillStyle=a,_.fillText(t,o,n+r)),l=_.measureText(t).width,_.restore(),{surface:p,advanceWidth:l,imageData:s?_.getImageData(0,0,f.width,f.height):void 0};throw new Error("createGlyphRenderedSurface(): could not initialize CanvasRenderingContext2D")}var r=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function h(t){return-1!==r.indexOf(t)?t:'"'+t+'"'}function n(t,e,i,r,o,n,s,a,h,c){return{code:t,x:e,y:i,width:r,height:o,surface:h,offsetX:n,offsetY:s,advanceWidth:a,isSurfaceValid:c,_atlas:null}}c.prototype.create=function(t){var e,i=null,r=this._glyphAreas[t];return r||((r=function(t){for(var e=t.width,i=t.height,r=0,o=0,n=0,s=0,a=t.height;s<a;s=s+1|0)for(var h=0,c=t.width;h<c;h=h+1|0)0!==t.data[n+3]&&(h<e&&(e=h),r<h&&(r=h),s<i&&(i=s),o<s&&(o=s)),n+=4;return e===t.width?{x:0,y:0,width:0,height:0}:{x:e,y:i,width:r-e+1,height:o-i+1}}((i=o(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!0,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)).imageData)).advanceWidth=i.advanceWidth,this._glyphAreas[t]=r),0===(e=r).width||0===e.height?(i&&i.surface.destroy(),n(t,0,0,0,0,0,0,r.advanceWidth,void 0,!0)):(i=i||o(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!1,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight),n(t,r.x,r.y,r.width,r.height,r.x-this._marginW,r.y-this._marginH,r.advanceWidth,i.surface,!0))},c.prototype.measureMinimumFontSize=function(){var t,e=1,i=document.createElement("canvas").getContext("2d");if(!i)throw new Error("GlyphFactory#measureMinimumFontSize(): could not initialize CanvasRenderingContext2D");i.textAlign="left",i.textBaseline="alphabetic",i.lineJoin="bevel",i.font=e+"px sans-serif";for(var r=i.measureText("M").width;t=r,i.font=(e+=1)+"px sans-serif",t===(r=i.measureText("M").width)||50<e;);return e};var y=c;function c(t,e,i,r,o,n,s,a){void 0===i&&(i=e),void 0===r&&(r="black"),void 0===o&&(o=0),void 0===n&&(n="black"),void 0===s&&(s=!1),void 0===a&&(a="normal"),this._glyphAreas=Object.create(null),this.fontFamily=t,this.fontSize=e,this.baselineHeight=i,this.fontColor=r,this.strokeWidth=o,this.strokeColor=n,this.strokeOnly=s,this.fontWeight=a,this._cssFontFamily="string"==typeof t?h(t):t.map(h).join(","),-1===this._cssFontFamily.indexOf("sans-serif")&&(this._cssFontFamily+=",sans-serif"),this._marginW=Math.ceil(.3*this.fontSize+this.strokeWidth/2),this._marginH=Math.ceil(.3*this.fontSize+this.strokeWidth/2),void 0===c._environmentMinimumFontSize&&(c._environmentMinimumFontSize=this.measureMinimumFontSize())}i.GlyphFactory=y},{"./context2d/Context2DSurface":141}],137:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.RenderingHelper=void 0,(i=i.RenderingHelper||(i.RenderingHelper={})).toPowerOfTwo=function(t){if(0==(t&t-1))return t;for(var e=1;e<t;)e*=2;return e},i.clamp=function(t){return Math.min(Math.max(t,0),1)},i.usedWebGL=function(t){var e=!1;return e=t&&0<t.length?"webgl"===t[0]:e}},{}],138:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CanvasRenderingState=void 0;var r=t("../AffineTransformer");i.CanvasRenderingState=function(t){t?(this.fillStyle=t.fillStyle,this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new r.AffineTransformer(t.transformer)):(this.fillStyle="#000000",this.globalAlpha=1,this.globalCompositeOperation="source-over",this.transformer=new r.AffineTransformer)}},{"../AffineTransformer":134}],139:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CanvasSurfaceContext=void 0;var r=t("./CanvasRenderingState");function o(t){this._stateStack=[],this._modifiedTransform=!1,this._context=t;t=new r.CanvasRenderingState;this._contextFillStyle=t.fillStyle,this._contextGlobalAlpha=t.globalAlpha,this._contextGlobalCompositeOperation=t.globalCompositeOperation,this.pushState(t)}Object.defineProperty(o.prototype,"fillStyle",{get:function(){return this.currentState().fillStyle},set:function(t){this.currentState().fillStyle=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"globalAlpha",{get:function(){return this.currentState().globalAlpha},set:function(t){this.currentState().globalAlpha=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"globalCompositeOperation",{get:function(){return this.currentState().globalCompositeOperation},set:function(t){this.currentState().globalCompositeOperation=t},enumerable:!1,configurable:!0}),o.prototype.getCanvasRenderingContext2D=function(){return this._context},o.prototype.clearRect=function(t,e,i,r){this.prerender(),this._context.clearRect(t,e,i,r)},o.prototype.save=function(){var t=new r.CanvasRenderingState(this.currentState());this.pushState(t)},o.prototype.restore=function(){this.popState()},o.prototype.scale=function(t,e){this.currentState().transformer.scale(t,e),this._modifiedTransform=!0},o.prototype.drawImage=function(t,e,i,r,o,n,s,a,h){this.prerender(),this._context.drawImage(t,e,i,r,o,n,s,a,h)},o.prototype.fillRect=function(t,e,i,r){this.prerender(),this._context.fillRect(t,e,i,r)},o.prototype.fillText=function(t,e,i,r){this.prerender(),this._context.fillText(t,e,i,r)},o.prototype.strokeText=function(t,e,i,r){this.prerender(),this._context.strokeText(t,e,i,r)},o.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e),this._modifiedTransform=!0},o.prototype.transform=function(t,e,i,r,o,n){this.currentState().transformer.transform([t,e,i,r,o,n]),this._modifiedTransform=!0},o.prototype.setTransform=function(t,e,i,r,o,n){this.currentState().transformer.setTransform([t,e,i,r,o,n]),this._modifiedTransform=!0},o.prototype.setGlobalAlpha=function(t){this.currentState().globalAlpha=t},o.prototype.getImageData=function(t,e,i,r){return this._context.getImageData(t,e,i,r)},o.prototype.putImageData=function(t,e,i,r,o,n,s){this._context.putImageData(t,e,i,r,o,n,s)},o.prototype.prerender=function(){var t=this.currentState();t.fillStyle!==this._contextFillStyle&&(this._context.fillStyle=t.fillStyle,this._contextFillStyle=t.fillStyle),t.globalAlpha!==this._contextGlobalAlpha&&(this._context.globalAlpha=t.globalAlpha,this._contextGlobalAlpha=t.globalAlpha),t.globalCompositeOperation!==this._contextGlobalCompositeOperation&&(this._context.globalCompositeOperation=t.globalCompositeOperation,this._contextGlobalCompositeOperation=t.globalCompositeOperation),this._modifiedTransform&&(t=t.transformer,this._context.setTransform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this._modifiedTransform=!1)},o.prototype.pushState=function(t){this._stateStack.push(t)},o.prototype.popState=function(){this._stateStack.length<=1||(this._stateStack.pop(),this._modifiedTransform=!0,this._contextFillStyle=this._context.fillStyle,this._contextGlobalAlpha=this._context.globalAlpha,this._contextGlobalCompositeOperation=this._context.globalCompositeOperation)},o.prototype.currentState=function(){return this._stateStack[this._stateStack.length-1]},i.CanvasSurfaceContext=o},{"./CanvasRenderingState":138}],140:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Context2DRenderer=void 0;var r={"source-over":"source-over","source-atop":"source-atop",lighter:"lighter",copy:"copy","experimental-source-in":"source-in","experimental-source-out":"source-out","experimental-destination-atop":"destination-atop","experimental-destination-in":"destination-in","destination-out":"destination-out","destination-over":"destination-over",xor:"xor"};function o(t){this.surface=t,this.context=t.context(),this.canvasRenderingContext2D=this.context.getCanvasRenderingContext2D()}o.prototype.begin=function(){this.canvasRenderingContext2D.save(),this.context.save()},o.prototype.end=function(){this.canvasRenderingContext2D.restore(),this.context.restore()},o.prototype.clear=function(){this.context.clearRect(0,0,this.surface.width,this.surface.height)},o.prototype.drawImage=function(t,e,i,r,o,n,s){this.context.drawImage(t._drawable,e,i,r,o,n,s,r,o)},o.prototype.drawSprites=function(t,e,i,r,o,n,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],o[h],n[h],s[h])},o.prototype.translate=function(t,e){this.context.translate(t,e)},o.prototype.transform=function(t){this.context.transform(t[0],t[1],t[2],t[3],t[4],t[5])},o.prototype.opacity=function(t){this.context.globalAlpha*=t},o.prototype.save=function(){this.context.save()},o.prototype.restore=function(){this.context.restore()},o.prototype.fillRect=function(t,e,i,r,o){this.context.fillStyle=o,this.context.fillRect(t,e,i,r)},o.prototype.setCompositeOperation=function(t){this.context.globalCompositeOperation=r[t]||"source-over"},o.prototype.setOpacity=function(t){this.context.globalAlpha=t},o.prototype.setTransform=function(t){this.context.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])},o.prototype.setShaderProgram=function(t){throw new Error("Context2DRenderer#setShaderProgram() is not implemented")},o.prototype.isSupportedShaderProgram=function(){return!1},o.prototype._getImageData=function(t,e,i,r){return this.context.getImageData(t,e,i,r)},o.prototype._putImageData=function(t,e,i,r,o,n,s){void 0===n&&(n=t.width),void 0===s&&(s=t.height),this.context.putImageData(t,e,i,r=void 0===r?0:r,o=void 0===o?0:o,n,s)},i.Context2DRenderer=o},{}],141:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.Context2DSurface=void 0,t("../CanvasSurface")),a=t("./CanvasSurfaceContext"),h=t("./Context2DRenderer"),t=(o=s.CanvasSurface,n(c,o),c.prototype.context=function(){if(!this._context){var t=this.canvas.getContext("2d");if(!t)throw new Error("Context2DSurface#context(): could not initialize CanvasRenderingContext2D");this._context=new a.CanvasSurfaceContext(t)}return this._context},c.prototype.renderer=function(){return this._renderer||(this._renderer=new h.Context2DRenderer(this)),this._renderer},c.prototype.changePhysicalScale=function(t,e){if(!this._context)throw new Error("Context2DSurface#changePhysicalScale(): context has not been initialized");this.canvas.width=this.width*t,this.canvas.height=this.height*e,this._context.scale(t,e)},c.prototype.isPlaying=function(){return!1},c);function c(){return null!==o&&o.apply(this,arguments)||this}i.Context2DSurface=t},{"../CanvasSurface":135,"./CanvasSurfaceContext":139,"./Context2DRenderer":140}],142:[function(t,e,i){"use strict";function r(){this._idCounter=0,this._canvasMap={},this._registry="undefined"!=typeof FinalizationRegistry?new FinalizationRegistry(this._dispose.bind(this)):null}Object.defineProperty(i,"__esModule",{value:!0}),i.CanvasDisposer=void 0,r.prototype.register=function(t,e){var i;this._registry&&(i="".concat(this._idCounter++),this._canvasMap[i]=e,this._registry.register(t,i))},r.prototype._dispose=function(t){var e=this._canvasMap[t];e&&(e.width=1,e.height=1,delete this._canvasMap[t])},i.CanvasDisposer=r},{}],143:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SurfaceFactory=void 0;var r=t("../context2d/Context2DSurface"),o=t("../RenderingHelper"),n=t("../webgl/WebGLSharedObject"),s=t("./CanvasDisposer");function a(){this._disposer=new s.CanvasDisposer}a.prototype.createPrimarySurface=function(t,e,i){return o.RenderingHelper.usedWebGL(i)?(this._shared||(this._shared=new n.WebGLSharedObject(t,e)),this._shared.getPrimarySurface()):new r.Context2DSurface(t,e)},a.prototype.createBackSurface=function(t,e,i){i=o.RenderingHelper.usedWebGL(i)?this._shared.createBackSurface(t,e):new r.Context2DSurface(t,e);return this._disposer.register(i,i.getHTMLElement()),i},i.SurfaceFactory=a},{"../RenderingHelper":137,"../context2d/Context2DSurface":141,"../webgl/WebGLSharedObject":152,"./CanvasDisposer":142}],144:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLBackSurface=void 0,t("./WebGLBackSurfaceRenderer")),t=t("./WebGLPrimarySurface"),t=(o=t.WebGLPrimarySurface,n(a,o),a.prototype.renderer=function(){return this._renderer||(this._renderer=new s.WebGLBackSurfaceRenderer(this,this._shared)),this._renderer},a.prototype.destroy=function(){this._renderer&&this._renderer.destroy(),this._renderer=void 0,this._drawable=void 0,o.prototype.destroy.call(this)},a);function a(){return null!==o&&o.apply(this,arguments)||this}i.WebGLBackSurface=t},{"./WebGLBackSurfaceRenderer":145,"./WebGLPrimarySurface":147}],145:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLBackSurfaceRenderer=void 0,t("./WebGLRenderer")),a=t("./WebGLRenderingState"),t=(o=s.WebGLRenderer,n(h,o),h.prototype.begin=function(){o.prototype.begin.call(this),this.save();var t=new a.WebGLRenderingState(this.currentState()),e=t.transformer.matrix;e[1]*=-1,e[3]*=-1,e[5]=-e[5]+this._renderTarget.height,this.currentState().copyFrom(t),this._shared.pushRenderTarget(this._renderTarget)},h.prototype.end=function(){this.restore(),this._shared.popRenderTarget(),o.prototype.end.call(this)},h);function h(t,e){e=o.call(this,e,e.createRenderTarget(t.width,t.height))||this;return t._drawable={texture:e._renderTarget.texture,textureOffsetX:0,textureOffsetY:0,textureWidth:t.width,textureHeight:t.height},e}i.WebGLBackSurfaceRenderer=t},{"./WebGLRenderer":149,"./WebGLRenderingState":150}],146:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLColor=void 0;var r,o=t("../RenderingHelper");(r=i.WebGLColor||(i.WebGLColor={})).colorMap={ALICEBLUE:[240/255,248/255,1,1],ANTIQUEWHITE:[250/255,235/255,215/255,1],AQUA:[0,1,1,1],AQUAMARINE:[127/255,1,212/255,1],AZURE:[240/255,1,1,1],BEIGE:[245/255,245/255,220/255,1],BISQUE:[1,228/255,196/255,1],BLACK:[0,0,0,1],BLANCHEDALMOND:[1,235/255,205/255,1],BLUE:[0,0,1,1],BLUEVIOLET:[138/255,43/255,226/255,1],BROWN:[165/255,42/255,42/255,1],BURLYWOOD:[222/255,184/255,135/255,1],CADETBLUE:[95/255,158/255,160/255,1],CHARTREUSE:[127/255,1,0,1],CHOCOLATE:[210/255,105/255,30/255,1],CORAL:[1,127/255,80/255,1],CORNFLOWERBLUE:[100/255,149/255,237/255,1],CORNSILK:[1,248/255,220/255,1],CRIMSON:[220/255,20/255,60/255,1],CYAN:[0,1,1,1],DARKBLUE:[0,0,139/255,1],DARKCYAN:[0,139/255,139/255,1],DARKGOLDENROD:[184/255,134/255,11/255,1],DARKGRAY:[169/255,169/255,169/255,1],DARKGREEN:[0,100/255,0,1],DARKGREY:[169/255,169/255,169/255,1],DARKKHAKI:[189/255,183/255,107/255,1],DARKMAGENTA:[139/255,0,139/255,1],DARKOLIVEGREEN:[85/255,107/255,47/255,1],DARKORANGE:[1,140/255,0,1],DARKORCHID:[.6,50/255,.8,1],DARKRED:[139/255,0,0,1],DARKSALMON:[233/255,150/255,122/255,1],DARKSEAGREEN:[143/255,188/255,143/255,1],DARKSLATEBLUE:[72/255,61/255,139/255,1],DARKSLATEGRAY:[47/255,79/255,79/255,1],DARKSLATEGREY:[47/255,79/255,79/255,1],DARKTURQUOISE:[0,206/255,209/255,1],DARKVIOLET:[148/255,0,211/255,1],DEEPPINK:[1,20/255,147/255,1],DEEPSKYBLUE:[0,191/255,1,1],DIMGRAY:[105/255,105/255,105/255,1],DIMGREY:[105/255,105/255,105/255,1],DODGERBLUE:[30/255,144/255,1,1],FIREBRICK:[178/255,34/255,34/255,1],FLORALWHITE:[1,250/255,240/255,1],FORESTGREEN:[34/255,139/255,34/255,1],FUCHSIA:[1,0,1,1],GAINSBORO:[220/255,220/255,220/255,1],GHOSTWHITE:[248/255,248/255,1,1],GOLD:[1,215/255,0,1],GOLDENROD:[218/255,165/255,32/255,1],GRAY:[128/255,128/255,128/255,1],GREEN:[0,128/255,0,1],GREENYELLOW:[173/255,1,47/255,1],GREY:[128/255,128/255,128/255,1],HONEYDEW:[240/255,1,240/255,1],HOTPINK:[1,105/255,180/255,1],INDIANRED:[205/255,92/255,92/255,1],INDIGO:[75/255,0,130/255,1],IVORY:[1,1,240/255,1],KHAKI:[240/255,230/255,140/255,1],LAVENDER:[230/255,230/255,250/255,1],LAVENDERBLUSH:[1,240/255,245/255,1],LAWNGREEN:[124/255,252/255,0,1],LEMONCHIFFON:[1,250/255,205/255,1],LIGHTBLUE:[173/255,216/255,230/255,1],LIGHTCORAL:[240/255,128/255,128/255,1],LIGHTCYAN:[224/255,1,1,1],LIGHTGOLDENRODYELLOW:[250/255,250/255,210/255,1],LIGHTGRAY:[211/255,211/255,211/255,1],LIGHTGREEN:[144/255,238/255,144/255,1],LIGHTGREY:[211/255,211/255,211/255,1],LIGHTPINK:[1,182/255,193/255,1],LIGHTSALMON:[1,160/255,122/255,1],LIGHTSEAGREEN:[32/255,178/255,170/255,1],LIGHTSKYBLUE:[135/255,206/255,250/255,1],LIGHTSLATEGRAY:[119/255,136/255,.6,1],LIGHTSLATEGREY:[119/255,136/255,.6,1],LIGHTSTEELBLUE:[176/255,196/255,222/255,1],LIGHTYELLOW:[1,1,224/255,1],LIME:[0,1,0,1],LIMEGREEN:[50/255,205/255,50/255,1],LINEN:[250/255,240/255,230/255,1],MAGENTA:[1,0,1,1],MAROON:[128/255,0,0,1],MEDIUMAQUAMARINE:[.4,205/255,170/255,1],MEDIUMBLUE:[0,0,205/255,1],MEDIUMORCHID:[186/255,85/255,211/255,1],MEDIUMPURPLE:[147/255,112/255,219/255,1],MEDIUMSEAGREEN:[60/255,179/255,113/255,1],MEDIUMSLATEBLUE:[123/255,104/255,238/255,1],MEDIUMSPRINGGREEN:[0,250/255,154/255,1],MEDIUMTURQUOISE:[72/255,209/255,.8,1],MEDIUMVIOLETRED:[199/255,21/255,133/255,1],MIDNIGHTBLUE:[25/255,25/255,112/255,1],MINTCREAM:[245/255,1,250/255,1],MISTYROSE:[1,228/255,225/255,1],MOCCASIN:[1,228/255,181/255,1],NAVAJOWHITE:[1,222/255,173/255,1],NAVY:[0,0,128/255,1],OLDLACE:[253/255,245/255,230/255,1],OLIVE:[128/255,128/255,0,1],OLIVEDRAB:[107/255,142/255,35/255,1],ORANGE:[1,165/255,0,1],ORANGERED:[1,69/255,0,1],ORCHID:[218/255,112/255,214/255,1],PALEGOLDENROD:[238/255,232/255,170/255,1],PALEGREEN:[152/255,251/255,152/255,1],PALETURQUOISE:[175/255,238/255,238/255,1],PALEVIOLETRED:[219/255,112/255,147/255,1],PAPAYAWHIP:[1,239/255,213/255,1],PEACHPUFF:[1,218/255,185/255,1],PERU:[205/255,133/255,63/255,1],PINK:[1,192/255,203/255,1],PLUM:[221/255,160/255,221/255,1],POWDERBLUE:[176/255,224/255,230/255,1],PURPLE:[128/255,0,128/255,1],RED:[1,0,0,1],ROSYBROWN:[188/255,143/255,143/255,1],ROYALBLUE:[65/255,105/255,225/255,1],SADDLEBROWN:[139/255,69/255,19/255,1],SALMON:[250/255,128/255,114/255,1],SANDYBROWN:[244/255,164/255,96/255,1],SEAGREEN:[46/255,139/255,87/255,1],SEASHELL:[1,245/255,238/255,1],SIENNA:[160/255,82/255,45/255,1],SILVER:[192/255,192/255,192/255,1],SKYBLUE:[135/255,206/255,235/255,1],SLATEBLUE:[106/255,90/255,205/255,1],SLATEGRAY:[112/255,128/255,144/255,1],SLATEGREY:[112/255,128/255,144/255,1],SNOW:[1,250/255,250/255,1],SPRINGGREEN:[0,1,127/255,1],STEELBLUE:[70/255,130/255,180/255,1],TAN:[210/255,180/255,140/255,1],TEAL:[0,128/255,128/255,1],THISTLE:[216/255,191/255,216/255,1],TOMATO:[1,99/255,71/255,1],TURQUOISE:[64/255,224/255,208/255,1],VIOLET:[238/255,130/255,238/255,1],WHEAT:[245/255,222/255,179/255,1],WHITE:[1,1,1,1],WHITESMOKE:[245/255,245/255,245/255,1],YELLOW:[1,1,0,1],YELLOWGREEN:[154/255,205/255,50/255,1]},r.get=function(t){return(t="string"==typeof t?r._toColor(t):[t[0],t[1],t[2],t[3]])[3]=o.RenderingHelper.clamp(t[3]),t[0]=o.RenderingHelper.clamp(t[0])*t[3],t[1]=o.RenderingHelper.clamp(t[1])*t[3],t[2]=o.RenderingHelper.clamp(t[2])*t[3],t},r._hsl2rgb=function(t){var e=t[0]%360,i=t[1],r=50<t[2]?100-t[2]:t[2],t=t[3],o=r+r*i,r=r-r*i;return e<60?[o,e/60*(o-r)+r,r,t]:e<120?[(120-e)/60*(o-r)+r,o,r,t]:e<180?[r,o,(e-120)/60*(o-r)+r,t]:e<240?[r,(240-e)/60*(o-r)+r,o,t]:e<300?[(e-240)/60*(o-r)+r,r,o,t]:[o,r,(360-e)/60*(o-r)+r,t]},r._toColor=function(t){var t=t.toUpperCase().replace(/\s+/g,""),e=r.colorMap[t];if(e)return e;if(t.match(/^#([\dA-F])([\dA-F])([\dA-F])$/))return[parseInt(RegExp.$1,16)/15,parseInt(RegExp.$2,16)/15,parseInt(RegExp.$3,16)/15,1];if(t.match(/^#([\dA-F]{2})([\dA-F]{2})([\dA-F]{2})$/))return[parseInt(RegExp.$1,16)/255,parseInt(RegExp.$2,16)/255,parseInt(RegExp.$3,16)/255,1];if(t.match(/^RGB\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,1];if(t.match(/^RGBA\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d(\.\d*)?)\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,parseFloat(RegExp.$4)];if(t.match(/^HSL\((\d{1,3}),(\d{1,3})%,(\d{1,3})%\)$/))return r._hsl2rgb([parseInt(RegExp.$1,10),o.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),o.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),1]);if(t.match(/^HSLA\((\d{1,3}),(\d{1,3})%,(\d{1,3})%,(\d(\.\d*)?)\)$/))return r._hsl2rgb([parseInt(RegExp.$1,10),o.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),o.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),parseFloat(RegExp.$4)]);throw Error("illigal cssColor format: "+t)}},{"../RenderingHelper":137}],147:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLPrimarySurface=void 0,t("../CanvasSurface")),a=t("./WebGLPrimarySurfaceRenderer"),t=(o=s.CanvasSurface,n(h,o),h.prototype.renderer=function(){return this._renderer||(this._renderer=new a.WebGLPrimarySurfaceRenderer(this._shared,this._shared.getPrimaryRenderTarget(this.width,this.height))),this._renderer},h.prototype.changePhysicalScale=function(t,e){t=Math.ceil(this.width*t),e=Math.ceil(this.height*e);this.canvas.width=t,this.canvas.height=e,this.renderer().changeViewportSize(t,e)},h.prototype.isPlaying=function(){return!1},h);function h(t,e,i){e=o.call(this,e,i)||this;return e.canvas.style.position="absolute",e._shared=t,e}i.WebGLPrimarySurface=t},{"../CanvasSurface":135,"./WebGLPrimarySurfaceRenderer":148}],148:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLPrimarySurfaceRenderer=void 0,t("./WebGLRenderer")),t=(o=t.WebGLRenderer,n(s,o),s.prototype.begin=function(){o.prototype.begin.call(this),this._shared.begin()},s);function s(t,e){t=o.call(this,t,e)||this;return t._shared.pushRenderTarget(t._renderTarget),t}i.WebGLPrimarySurfaceRenderer=t},{"./WebGLRenderer":149}],149:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLRenderer=void 0;var n=t("./WebGLColor"),r=t("./WebGLRenderingState");function o(t,e){this._stateStack=[],this._stateStackPointer=0,this._capacity=0,this._reallocation(o.DEFAULT_CAPACITY),this._whiteColor=[1,1,1,1],this._shared=t,this._renderTarget=e}o.prototype.clear=function(){this._shared.clear()},o.prototype.begin=function(){},o.prototype.end=function(){this._shared.end()},o.prototype.save=function(){this._pushState()},o.prototype.restore=function(){this._popState()},o.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e)},o.prototype.transform=function(t){this.currentState().transformer.transform(t)},o.prototype.opacity=function(t){this.currentState().globalAlpha*=t},o.prototype.setCompositeOperation=function(t){this.currentState().globalCompositeOperation=t},o.prototype.currentState=function(){return this._stateStack[this._stateStackPointer]},o.prototype.fillRect=function(t,e,i,r,o){this._shared.draw(this.currentState(),this._shared.getFillRectSurfaceTexture(),0,0,i,r,t,e,n.WebGLColor.get(o))},o.prototype.drawSprites=function(t,e,i,r,o,n,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],o[h],n[h],s[h])},o.prototype.drawImage=function(t,e,i,r,o,n,s){if(!t._drawable)throw new Error("WebGLRenderer#drawImage: no drawable surface.");if(t._drawable.texture instanceof WebGLTexture||this._shared.makeTextureForSurface(t),!t._drawable.texture)throw new Error("WebGLRenderer#drawImage: could not create a texture.");this._shared.draw(this.currentState(),t._drawable,e,i,r,o,n,s,this._whiteColor)},o.prototype.setTransform=function(t){this.currentState().transformer.setTransform(t)},o.prototype.setOpacity=function(t){this.currentState().globalAlpha=t},o.prototype.setShaderProgram=function(t){this.currentState().shaderProgram=this._shared.initializeShaderProgram(t)},o.prototype.isSupportedShaderProgram=function(){return!0},o.prototype.changeViewportSize=function(t,e){var i=this._renderTarget;this._renderTarget={width:i.width,height:i.height,viewportWidth:t,viewportHeight:e,texture:i.texture,framebuffer:i.framebuffer}},o.prototype.destroy=function(){this._shared.requestDeleteRenderTarget(this._renderTarget),this._shared=void 0,this._renderTarget=void 0,this._whiteColor=void 0},o.prototype._getImageData=function(){throw new Error("WebGLRenderer#_getImageData() is not implemented")},o.prototype._putImageData=function(t,e,i,r,o,n,s){throw new Error("WebGLRenderer#_putImageData() is not implemented")},o.prototype._pushState=function(){var t=this.currentState();++this._stateStackPointer,this._isOverCapacity()&&this._reallocation(this._stateStackPointer+1),this.currentState().copyFrom(t)},o.prototype._popState=function(){if(!(0<this._stateStackPointer))throw new Error("WebGLRenderer#restore: state stack under-flow.");this.currentState().shaderProgram=null,--this._stateStackPointer},o.prototype._isOverCapacity=function(){return this._capacity<=this._stateStackPointer},o.prototype._reallocation=function(t){var e=this._capacity;if(e<t){t<2*e?this._capacity*=2:this._capacity=t;for(var i=e;i<this._capacity;++i)this._stateStack.push(new r.WebGLRenderingState)}},o.DEFAULT_CAPACITY=16,i.WebGLRenderer=o},{"./WebGLColor":146,"./WebGLRenderingState":150}],150:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLRenderingState=void 0;var r=t("../AffineTransformer");function o(t){t?(this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new r.AffineTransformer(t.transformer),this.shaderProgram=t.shaderProgram):(this.globalAlpha=1,this.globalCompositeOperation="source-over",this.transformer=new r.AffineTransformer,this.shaderProgram=null)}o.prototype.copyFrom=function(t){return this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer.copyFrom(t.transformer),this.shaderProgram=t.shaderProgram,this},i.WebGLRenderingState=o},{"../AffineTransformer":134}],151:[function(t,e,i){"use strict";function o(t,e,i){void 0===i&&(i=Object.create(null));e=o._makeShaderProgram(t,o._DEFAULT_VERTEX_SHADER,e=e||o._DEFAULT_FRAGMENT_SHADER),this.program=e,this._context=t,this._aVertex=t.getAttribLocation(this.program,"aVertex"),e=t.getUniformLocation(this.program,"uColor");if(!e)throw new Error("WebGLShaderProgram#constructor: could not get UniformLocation of 'uColor'");var r=t.getUniformLocation(this.program,"uAlpha");if(!r)throw new Error("WebGLShaderProgram#constructor: could not get UniformLocation of 'uAlpha'");t=t.getUniformLocation(this.program,"uSampler");if(!t)throw new Error("WebGLShaderProgram#constructor: could not get UniformLocation of 'uSampler'");this._uColor=e,this._uAlpha=r,this._uSampler=t,this._uniforms=i,this._uniformCaches=[],this._uniformSetterTable={float:this._uniform1f.bind(this),int:this._uniform1i.bind(this),float_v:this._uniform1fv.bind(this),int_v:this._uniform1iv.bind(this),vec2:this._uniform2fv.bind(this),vec3:this._uniform3fv.bind(this),vec4:this._uniform4fv.bind(this),ivec2:this._uniform2iv.bind(this),ivec3:this._uniform3iv.bind(this),ivec4:this._uniform4iv.bind(this),mat2:this._uniformMatrix2fv.bind(this),mat3:this._uniformMatrix3fv.bind(this),mat4:this._uniformMatrix4fv.bind(this)}}Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLShaderProgram=void 0,o._makeShader=function(t,e,i){e=t.createShader(e);if(!e)throw new Error("WebGLShaderProgram._makeShader(): WebGLShader could not initialize");if(t.shaderSource(e,i),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS))return e;throw i=t.getShaderInfoLog(e),t.deleteShader(e),new Error(null!=i?i:"WebGLShaderProgram._makeShader(): unknown gl error")},o._makeShaderProgram=function(t,e,i){var r=t.createProgram();if(!r)throw new Error("WebGLShaderProgram._makeShaderProgram(): WebGLProgram could not initialize");e=o._makeShader(t,t.VERTEX_SHADER,e),t.attachShader(r,e),t.deleteShader(e),e=o._makeShader(t,t.FRAGMENT_SHADER,i);if(t.attachShader(r,e),t.deleteShader(e),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS))return r;throw i=t.getProgramInfoLog(r),t.deleteProgram(r),new Error(null!=i?i:"WebGLShaderProgram._makeShaderProgram(): unknown gl error")},o.prototype.set_aVertex=function(t){this._context.bindBuffer(this._context.ARRAY_BUFFER,t),this._context.enableVertexAttribArray(this._aVertex),this._context.vertexAttribPointer(this._aVertex,4,this._context.FLOAT,!1,0,0)},o.prototype.set_uColor=function(t){this._context.uniform4f(this._uColor,t[0],t[1],t[2],t[3])},o.prototype.set_uAlpha=function(t){this._context.uniform1f(this._uAlpha,t)},o.prototype.set_uSampler=function(t){this._context.uniform1i(this._uSampler,t)},o.prototype.updateUniforms=function(){for(var t=0;t<this._uniformCaches.length;++t){var e=this._uniformCaches[t],i=this._uniforms[e.name].value;!e.isArray&&i===e.beforeValue||(e.update(e.loc,i),e.beforeValue=i)}},o.prototype.initializeUniforms=function(){var o=this,n=[],s=this._uniforms;null!=s&&Object.keys(s).forEach(function(t){var e=s[t].type,i=!("number"==typeof s[t].value),r=(!i||"int"!==e&&"float"!==e||(e+="_v"),o._uniformSetterTable[e]);if(!r)throw new Error("WebGLShaderProgram#initializeUniforms: Uniform type '".concat(e,"' is not supported."));e=o._context.getUniformLocation(o.program,t);if(!e)throw new Error("WebGLShaderProgram#initializeUniforms: could not get UniformLocation of '".concat(t,"'."));n.push({name:t,update:r,beforeValue:null,isArray:i,loc:e})}),this._uniformCaches=n},o.prototype.use=function(){this._context.useProgram(this.program)},o.prototype.unuse=function(){this._context.useProgram(null)},o.prototype.destroy=function(){this._context.deleteProgram(this.program)},o.prototype._uniform1f=function(t,e){this._context.uniform1f(t,e)},o.prototype._uniform1i=function(t,e){this._context.uniform1i(t,e)},o.prototype._uniform1fv=function(t,e){this._context.uniform1fv(t,e)},o.prototype._uniform1iv=function(t,e){this._context.uniform1iv(t,e)},o.prototype._uniform2fv=function(t,e){this._context.uniform2fv(t,e)},o.prototype._uniform3fv=function(t,e){this._context.uniform3fv(t,e)},o.prototype._uniform4fv=function(t,e){this._context.uniform4fv(t,e)},o.prototype._uniform2iv=function(t,e){this._context.uniform2iv(t,e)},o.prototype._uniform3iv=function(t,e){this._context.uniform3iv(t,e)},o.prototype._uniform4iv=function(t,e){this._context.uniform4iv(t,e)},o.prototype._uniformMatrix2fv=function(t,e){this._context.uniformMatrix2fv(t,!1,e)},o.prototype._uniformMatrix3fv=function(t,e){this._context.uniformMatrix3fv(t,!1,e)},o.prototype._uniformMatrix4fv=function(t,e){this._context.uniformMatrix4fv(t,!1,e)},o._DEFAULT_VERTEX_SHADER="#version 100\nprecision mediump float;\nattribute vec4 aVertex;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform vec4 uColor;\nuniform float uAlpha;\nvoid main() {    gl_Position = vec4(aVertex.xy, 0.0, 1.0);    vTexCoord = aVertex.zw;    vColor = uColor * uAlpha;}",o._DEFAULT_FRAGMENT_SHADER="#version 100\nprecision mediump float;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main() {    gl_FragColor = texture2D(uSampler, vTexCoord) * vColor;}",i.WebGLShaderProgram=o},{}],152:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLSharedObject=void 0;var r=t("./WebGLBackSurface"),o=t("./WebGLPrimarySurface"),n=t("./WebGLShaderProgram"),s=t("./WebGLTextureAtlas");function a(t,e){this._renderTarget=void 0,this._defaultShaderProgram=void 0,this._textureAtlas=void 0,this._fillRectTexture=void 0,this._fillRectSurfaceTexture=void 0,this._maxSpriteCount=void 0,this._vertices=void 0,this._verticesCache=void 0,this._numSprites=void 0,this._renderTargetStack=void 0,this._currentTexture=void 0,this._currentColor=void 0,this._currentAlpha=void 0,this._currentCompositeOperation=void 0,this._currentShaderProgram=void 0,this._compositeOps=void 0,this._deleteRequestedTargets=void 0;t=new o.WebGLPrimarySurface(this,t,e),e=t.canvas.getContext("webgl",{depth:!1,preserveDrawingBuffer:!0});if(!e)throw new Error("WebGLSharedObject#constructor: could not initialize WebGLRenderingContext");this._surface=t,this._context=e,this._init()}a.prototype.getFillRectSurfaceTexture=function(){return this._fillRectSurfaceTexture},a.prototype.getPrimarySurface=function(){return this._surface},a.prototype.createBackSurface=function(t,e){return new r.WebGLBackSurface(this,t,e)},a.prototype.pushRenderTarget=function(t){this._commit(),this._renderTargetStack.push(t),this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},a.prototype.popRenderTarget=function(){this._commit(),this._renderTargetStack.pop();var t=this.getCurrentRenderTarget();this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},a.prototype.getCurrentRenderTarget=function(){return this._renderTargetStack[this._renderTargetStack.length-1]},a.prototype.begin=function(){this.clear(),this._currentShaderProgram.use(),this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0),this._currentShaderProgram.updateUniforms()},a.prototype.clear=function(){this._context.clear(this._context.COLOR_BUFFER_BIT)},a.prototype.draw=function(t,e,i,r,o,n,s,a,h){this._numSprites>=this._maxSpriteCount&&this._commit(),c=e===this._fillRectSurfaceTexture||null==t.shaderProgram||null==t.shaderProgram._program?this._defaultShaderProgram:t.shaderProgram._program,this._currentShaderProgram!==c&&(this._commit(),this._currentShaderProgram=c,this._currentShaderProgram.use(),this._currentShaderProgram.updateUniforms(),this._currentCompositeOperation=null,this._currentAlpha=null,this._currentColor=[],this._currentTexture=null),this._currentTexture!==e.texture&&(this._currentTexture=e.texture,this._commit(),this._context.bindTexture(this._context.TEXTURE_2D,e.texture)),this._currentColor[0]===h[0]&&this._currentColor[1]===h[1]&&this._currentColor[2]===h[2]&&this._currentColor[3]===h[3]||(this._currentColor=h,this._commit(),this._currentShaderProgram.set_uColor(h)),this._currentAlpha!==t.globalAlpha&&(this._currentAlpha=t.globalAlpha,this._commit(),this._currentShaderProgram.set_uAlpha(t.globalAlpha)),this._currentCompositeOperation!==t.globalCompositeOperation&&(this._currentCompositeOperation=t.globalCompositeOperation,this._commit(),c=this._compositeOps[this._currentCompositeOperation],this._context.blendFunc(c[0],c[1]));var h=1/e.textureWidth,c=1/e.textureHeight,u=e.textureOffsetX,e=e.textureOffsetY,l=h*(u+i+o),d=c*(e+r+n),h=h*(u+i),u=c*(e+r);this._register(this._transformVertex(s,a,o,n,t.transformer),[h,u,l,u,l,d,h,u,l,d,h,d])},a.prototype.end=function(){if(this._commit(),0<this._deleteRequestedTargets.length){for(var t=0;t<this._deleteRequestedTargets.length;++t)this.deleteRenderTarget(this._deleteRequestedTargets[t]);this._deleteRequestedTargets=[]}},a.prototype.makeTextureForSurface=function(t){this._textureAtlas.makeTextureForSurface(this,t)},a.prototype.disposeTexture=function(t){this._currentTexture===t&&this._commit()},a.prototype.assignTexture=function(t,e,i,r){if(this._context.bindTexture(this._context.TEXTURE_2D,r),t instanceof HTMLVideoElement)throw new Error("WebGLRenderer#assignTexture: HTMLVideoElement is not supported.");this._context.texSubImage2D(this._context.TEXTURE_2D,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},a.prototype.clearTexture=function(t,e,i,r){this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.texSubImage2D(this._context.TEXTURE_2D,0,0,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},a.prototype.makeTextureRaw=function(t,e,i){void 0===i&&(i=null);var r=this._context.createTexture();if(r)return this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,t,e,0,this._context.RGBA,this._context.UNSIGNED_BYTE,i),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),r;throw new Error("WebGLSharedObject#makeTextureRaw(): could not create WebGLTexture")},a.prototype.makeTexture=function(t){var e=this._context.createTexture();if(e)return this._context.bindTexture(this._context.TEXTURE_2D,e),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData)&&this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),e;throw new Error("WebGLSharedObject#makeTexture(): could not create WebGLTexture")},a.prototype.getPrimaryRenderTarget=function(t,e){return this._renderTarget},a.prototype.createRenderTarget=function(t,e){var i=this._context,r=i.createFramebuffer(),o=(i.bindFramebuffer(i.FRAMEBUFFER,r),i.createTexture()),n=(i.bindTexture(i.TEXTURE_2D,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,o,0),i.bindTexture(i.TEXTURE_2D,this._currentTexture),this.getCurrentRenderTarget());return i.bindFramebuffer(i.FRAMEBUFFER,n.framebuffer),{width:t,height:e,viewportWidth:t,viewportHeight:e,framebuffer:r,texture:o}},a.prototype.requestDeleteRenderTarget=function(t){this._deleteRequestedTargets.push(t)},a.prototype.deleteRenderTarget=function(t){var e=this._context;this.getCurrentRenderTarget()===t&&this._commit(),e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t.texture)},a.prototype.getContext=function(){return this._context},a.prototype.getDefaultShaderProgram=function(){return this._defaultShaderProgram},a.prototype.initializeShaderProgram=function(t){var e;return t&&!t._program&&((e=new n.WebGLShaderProgram(this._context,t.fragmentShader,t.uniforms)).initializeUniforms(),t._program=e),t},a.prototype._init=function(){var t=new n.WebGLShaderProgram(this._context);this._textureAtlas=new s.WebGLTextureAtlas,this._fillRectTexture=this.makeTextureRaw(1,1,new Uint8Array([255,255,255,255])),this._fillRectSurfaceTexture={texture:this._fillRectTexture,textureWidth:1,textureHeight:1,textureOffsetX:0,textureOffsetY:0},this._renderTarget={width:this._surface.width,height:this._surface.height,viewportWidth:this._surface.width,viewportHeight:this._surface.height,framebuffer:null,texture:null},this._maxSpriteCount=1024,this._vertices=this._makeBuffer(24*this._maxSpriteCount*4),this._verticesCache=new Float32Array(24*this._maxSpriteCount),this._numSprites=0,this._currentTexture=null,this._currentColor=[1,1,1,1],this._currentAlpha=1,this._currentCompositeOperation="source-over",this._currentShaderProgram=t,this._defaultShaderProgram=t,this._renderTargetStack=[],this._deleteRequestedTargets=[],this._currentShaderProgram.use();try{this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0)}finally{this._currentShaderProgram.unuse()}this._context.enable(this._context.BLEND),this._context.activeTexture(this._context.TEXTURE0),this._context.bindTexture(this._context.TEXTURE_2D,this._fillRectTexture),this._compositeOps={"source-atop":[this._context.DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],"experimental-source-in":[this._context.DST_ALPHA,this._context.ZERO],"experimental-source-out":[this._context.ONE_MINUS_DST_ALPHA,this._context.ZERO],"source-over":[this._context.ONE,this._context.ONE_MINUS_SRC_ALPHA],"experimental-destination-atop":[this._context.ONE_MINUS_DST_ALPHA,this._context.SRC_ALPHA],"experimental-destination-in":[this._context.ZERO,this._context.SRC_ALPHA],"destination-out":[this._context.ZERO,this._context.ONE_MINUS_SRC_ALPHA],"destination-over":[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE],lighter:[this._context.ONE,this._context.ONE],copy:[this._context.ONE,this._context.ZERO],xor:[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA]};t=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(t[0],t[1])},a.prototype._makeBuffer=function(t){var e=this._context.createBuffer();if(e)return this._context.bindBuffer(this._context.ARRAY_BUFFER,e),this._context.bufferData(this._context.ARRAY_BUFFER,t,this._context.DYNAMIC_DRAW),e;throw new Error("WebGLSharedObject#_makeBuffer(): could not create WebGLBuffer")},a.prototype._transformVertex=function(t,e,i,r,o){var n=this.getCurrentRenderTarget(),s=2/n.width,n=-2/n.height,o=o.matrix,a=s*i*o[0],i=n*i*o[1],h=s*r*o[2],r=n*r*o[3],s=s*(t*o[0]+e*o[2]+o[4])-1,n=n*(t*o[1]+e*o[3]+o[5])+1;return[s,n,a+s,i+n,a+h+s,i+r+n,s,n,a+h+s,i+r+n,h+s,r+n]},a.prototype._register=function(t,e){var i=6*this._numSprites;++this._numSprites;for(var r=0;r<6;++r)this._verticesCache[4*(r+i)+0]=t[2*r+0],this._verticesCache[4*(r+i)+1]=t[2*r+1],this._verticesCache[4*(r+i)+2]=e[2*r+0],this._verticesCache[4*(r+i)+3]=e[2*r+1]},a.prototype._commit=function(){0<this._numSprites&&(this._context.bindBuffer(this._context.ARRAY_BUFFER,this._vertices),this._context.bufferSubData(this._context.ARRAY_BUFFER,0,this._verticesCache.subarray(0,24*this._numSprites)),this._context.drawArrays(this._context.TRIANGLES,0,6*this._numSprites),this._numSprites=0)},i.WebGLSharedObject=a},{"./WebGLBackSurface":144,"./WebGLPrimarySurface":147,"./WebGLShaderProgram":151,"./WebGLTextureAtlas":153}],153:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLTextureAtlas=void 0;var s=t("../RenderingHelper"),n=t("./WebGLTextureMap");function a(){this._maps=[],this._insertPos=0,this.emptyTexturePixels=new Uint8Array(a.TEXTURE_SIZE*a.TEXTURE_SIZE*4)}a.prototype.clear=function(){for(var t=0;t<this._maps.length;++t)this._maps[t].dispose()},a.prototype.showOccupancy=function(){for(var t=0;t<this._maps.length;++t)console.log("occupancy["+t+"]: "+this._maps[t].occupancy())},a.prototype.makeTextureForSurface=function(t,e){var i=e._drawable;if(i&&!i.texture){var r=i.width,o=i.height;if(a.TEXTURE_SIZE<=r||a.TEXTURE_SIZE<=o){r=s.RenderingHelper.toPowerOfTwo(i.width),o=s.RenderingHelper.toPowerOfTwo(i.height);if(r!==i.width||o!==i.height){var n=document.createElement("canvas"),n=(n.width=r,n.height=o,n.getContext("2d"));if(!n)throw new Error("WebGLTextureAtlas#makeTextureForSurface(): could not initialize CanvasRenderingContext2D");n.globalCompositeOperation="copy",n.drawImage(i,0,0),i=n.getImageData(0,0,r,o)}e._drawable.texture=t.makeTexture(i),e._drawable.textureOffsetX=0,e._drawable.textureOffsetY=0,e._drawable.textureWidth=r,e._drawable.textureHeight=o}else this._assign(t,e,this._maps)}},a.prototype._assign=function(t,e,i){for(var r=null,o=0;o<i.length;++o)if(r=i[(o+this._insertPos)%i.length].insert(e))return this._register(t,r,e._drawable),void(this._insertPos=o);r=null,i.length>=a.TEXTURE_COUNT&&(r=i.shift(),t.disposeTexture(r.texture),r.dispose(),t.clearTexture(this.emptyTexturePixels,a.TEXTURE_SIZE,a.TEXTURE_SIZE,r.texture)),r=r||new n.WebGLTextureMap(t.makeTextureRaw(a.TEXTURE_SIZE,a.TEXTURE_SIZE),0,0,a.TEXTURE_SIZE,a.TEXTURE_SIZE),i.push(r),r=r.insert(e),this._register(t,r,e._drawable)},a.prototype._register=function(t,e,i){i.texture=e.texture,i.textureOffsetX=e.offsetX,i.textureOffsetY=e.offsetY,i.textureWidth=a.TEXTURE_SIZE,i.textureHeight=a.TEXTURE_SIZE,t.assignTexture(i,e.offsetX,e.offsetY,e.texture)},a.TEXTURE_SIZE=1024,a.TEXTURE_COUNT=16,i.WebGLTextureAtlas=a},{"../RenderingHelper":137,"./WebGLTextureMap":154}],154:[function(t,e,i){"use strict";function n(t,e,i,r,o){this._left=null,this._right=null,this._surface=null,this.texture=t,this.offsetX=e,this.offsetY=i,this._width=r,this._height=o}Object.defineProperty(i,"__esModule",{value:!0}),i.WebGLTextureMap=void 0,n.prototype.dispose=function(){this._left&&(this._left.dispose(),this._left=null),this._right&&(this._right.dispose(),this._right=null),this._surface&&(this._surface._drawable&&(this._surface._drawable.texture=null),this._surface=null)},n.prototype.capacity=function(){return this._width*this._height},n.prototype.area=function(){var t;return this._surface?(t=(t=this._surface._drawable).width*t.height,this._left&&(t+=this._left.area()),this._right&&(t+=this._right.area()),t):0},n.prototype.occupancy=function(){return this.area()/this.capacity()},n.prototype.insert=function(t){var e,i=t._drawable,r=i.width+n.TEXTURE_MARGIN,i=i.height+n.TEXTURE_MARGIN;if(this._surface){if(this._left){var o=this._left.insert(t);if(o)return o}if(this._right){var o=this._right.insert(t);if(o)return o}return null}return this._width<r||this._height<i?null:((o=this._width-r)<=(e=this._height-i)?(this._left=new n(this.texture,this.offsetX+r,this.offsetY,o,i),this._right=new n(this.texture,this.offsetX,this.offsetY+i,this._width,e)):(this._left=new n(this.texture,this.offsetX,this.offsetY+i,r,e),this._right=new n(this.texture,this.offsetX+r,this.offsetY,o,this._height)),this._surface=t,this)},n.TEXTURE_MARGIN=1,i.WebGLTextureMap=n},{}],155:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.InputAbstractHandler=void 0;var r=t("@akashic/trigger");function o(t,e){if(Object.getPrototypeOf&&Object.getPrototypeOf(this)===o.prototype)throw new Error("InputAbstractHandler is abstract and should not be directly instantiated");this.inputView=t,this.pointerEventLock={},this._xScale=1,this._yScale=1,this._disablePreventDefault=!!e,this.pointTrigger=new r.Trigger}o.isSupported=function(){return!1},o.prototype.start=function(){throw new Error("This method is abstract")},o.prototype.stop=function(){throw new Error("This method is abstract")},o.prototype.setScale=function(t,e){void 0===e&&(e=t),this._xScale=t,this._yScale=e},o.prototype.pointDown=function(t,e){this.pointTrigger.fire({type:0,identifier:t,offset:this.getOffsetFromEvent(e)}),this.pointerEventLock[t]=!0},o.prototype.pointMove=function(t,e){this.pointerEventLock.hasOwnProperty(t+"")&&this.pointTrigger.fire({type:1,identifier:t,offset:this.getOffsetFromEvent(e)})},o.prototype.pointUp=function(t,e){this.pointerEventLock.hasOwnProperty(t+"")&&(this.pointTrigger.fire({type:2,identifier:t,offset:this.getOffsetFromEvent(e)}),delete this.pointerEventLock[t])},o.prototype.getOffsetFromEvent=function(t){return{x:t.offsetX,y:t.offsetY}},o.prototype.getScale=function(){return{x:this._xScale,y:this._yScale}},o.prototype.getOffsetPositionFromInputView=function(t){var e=this.inputView.getBoundingClientRect(),i=this.getScale();return{offsetX:(t.pageX-Math.round(window.pageXOffset+e.left))/i.x,offsetY:(t.pageY-Math.round(window.pageYOffset+e.top))/i.y}},i.InputAbstractHandler=o},{"@akashic/trigger":225}],156:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.MouseHandler=void 0,t("./InputAbstractHandler")),t=(o=t.InputAbstractHandler,n(s,o),s.prototype.start=function(){this.inputView.addEventListener("mousedown",this.onMouseDown,!1)},s.prototype.stop=function(){this.inputView.removeEventListener("mousedown",this.onMouseDown,!1)},s);function s(t,e){var i=o.call(this,t,e)||this;return i.onMouseDown=function(t){0===t.button&&(i.pointDown(1,i.getOffsetPositionFromInputView(t)),window.addEventListener("mousemove",i.onMouseMove,!1),window.addEventListener("mouseup",i.onMouseUp,!1),i._disablePreventDefault||(t.stopPropagation(),t.preventDefault()))},i.onMouseMove=function(t){i.pointMove(1,i.getOffsetPositionFromInputView(t)),i._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},i.onMouseUp=function(t){i.pointUp(1,i.getOffsetPositionFromInputView(t)),window.removeEventListener("mousemove",i.onMouseMove,!1),window.removeEventListener("mouseup",i.onMouseUp,!1),i._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},i}i.MouseHandler=t},{"./InputAbstractHandler":155}],157:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.TouchHandler=void 0,t("./MouseHandler")),t=(o=t.MouseHandler,n(s,o),s.prototype.start=function(){o.prototype.start.call(this),this.inputView.addEventListener("touchstart",this.onTouchDown),this.inputView.addEventListener("touchmove",this.onTouchMove),this.inputView.addEventListener("touchend",this.onTouchUp)},s.prototype.stop=function(){o.prototype.stop.call(this),this.inputView.removeEventListener("touchstart",this.onTouchDown),this.inputView.removeEventListener("touchmove",this.onTouchMove),this.inputView.removeEventListener("touchend",this.onTouchUp)},s);function s(t,e){var n=o.call(this,t,e)||this;return n.onTouchDown=function(t){for(var e=t.changedTouches,i=0,r=e.length;i<r;i++){var o=e[i];n.pointDown(o.identifier,n.getOffsetPositionFromInputView(o))}n._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},n.onTouchMove=function(t){for(var e=t.changedTouches,i=0,r=e.length;i<r;i++){var o=e[i];n.pointMove(o.identifier,n.getOffsetPositionFromInputView(o))}n._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},n.onTouchUp=function(t){for(var e=t.changedTouches,i=0,r=e.length;i<r;i++){var o=e[i];n.pointUp(o.identifier,n.getOffsetPositionFromInputView(o))}n._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},n}i.TouchHandler=t},{"./MouseHandler":156}],158:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ProxyAudioPlugin=i.WebAudioPlugin=i.HTMLAudioPlugin=i.AudioPluginManager=i.AudioPluginRegistry=i.ResourceFactory=i.Platform=void 0;var r=t("./Platform"),o=(Object.defineProperty(i,"Platform",{enumerable:!0,get:function(){return r.Platform}}),t("./plugin/AudioPluginRegistry")),n=(Object.defineProperty(i,"AudioPluginRegistry",{enumerable:!0,get:function(){return o.AudioPluginRegistry}}),t("./plugin/AudioPluginManager")),s=(Object.defineProperty(i,"AudioPluginManager",{enumerable:!0,get:function(){return n.AudioPluginManager}}),t("./plugin/HTMLAudioPlugin/HTMLAudioPlugin")),a=(Object.defineProperty(i,"HTMLAudioPlugin",{enumerable:!0,get:function(){return s.HTMLAudioPlugin}}),t("./plugin/ProxyAudioPlugin/ProxyAudioPlugin")),h=(Object.defineProperty(i,"ProxyAudioPlugin",{enumerable:!0,get:function(){return a.ProxyAudioPlugin}}),t("./plugin/WebAudioPlugin/WebAudioPlugin")),c=(Object.defineProperty(i,"WebAudioPlugin",{enumerable:!0,get:function(){return h.WebAudioPlugin}}),t("./ResourceFactory"));Object.defineProperty(i,"ResourceFactory",{enumerable:!0,get:function(){return c.ResourceFactory}})},{"./Platform":121,"./ResourceFactory":123,"./plugin/AudioPluginManager":160,"./plugin/AudioPluginRegistry":161,"./plugin/HTMLAudioPlugin/HTMLAudioPlugin":165,"./plugin/ProxyAudioPlugin/ProxyAudioPlugin":168,"./plugin/WebAudioPlugin/WebAudioPlugin":173}],159:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AudioPlayer=void 0;var r=t("@akashic/trigger");function o(t){this.onPlay=new r.Trigger,this.onStop=new r.Trigger,this.played=this.onPlay,this.stopped=this.onStop,this.volume=1,this._muted=!1,this._system=t}o.prototype.play=function(t){this.currentAudio=t,this.onPlay.fire({player:this,audio:t})},o.prototype.stop=function(){var t=this.currentAudio;t&&(this.currentAudio=void 0,this.onStop.fire({player:this,audio:t}))},o.prototype.canHandleStopped=function(){return!0},o.prototype.changeVolume=function(t){this.volume=t},o.prototype._changeMuted=function(t){},o.prototype._notifyVolumeChanged=function(){this.changeVolume(this.volume)},i.AudioPlayer=o},{"@akashic/trigger":225}],160:[function(t,e,i){"use strict";function r(){this._activePlugin=null}Object.defineProperty(i,"__esModule",{value:!0}),i.AudioPluginManager=void 0,r.prototype.getActivePlugin=function(){return this._activePlugin},r.prototype.tryInstallPlugin=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e];if(!r.isSupported)return this._activePlugin=r,!0;if(r.isSupported())return this._activePlugin=new r,!0}return!1},i.AudioPluginManager=r},{}],161:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AudioPluginRegistry=void 0;var r=[];i.AudioPluginRegistry={addPlugin:function(t){-1===r.indexOf(t)&&r.push(t)},getRegisteredAudioPlugins:function(){return r},clear:function(){r=[]}}},{}],162:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLAudioAsset=void 0,t("../../asset/AudioAsset")),h=t("../../PathUtil"),c=t("../../utils/ExceptionFactory"),t=(o=s.AudioAsset,n(u,o),u.prototype._load=function(t){var i,e,r,o,n,s,a=this;null==this.path?(this.data=null,setTimeout(function(){return t._onAssetLoad(a)},0)):(i=this.createAudioElement(),e=function(t,e){i.autoplay=!1,i.preload="none",i.src=t,a._attachAll(i,e),i.preload="auto",o(i,e),i.load()},r={success:function(){a._detachAll(i,r),a.data=i,t._onAssetLoad(a),window.clearInterval(a._intervalId)},error:function(){a._detachAll(i,r),a.data=i,t._onAssetError(a,c.ExceptionFactory.createAssetLoadError("HTMLAudioAsset loading error")),window.clearInterval(a._intervalId)}},o=function(t,e){a._intervalCount=0,a._intervalId=window.setInterval(function(){4===t.readyState?e.success():(++a._intervalCount,600===a._intervalCount&&e.error())},100)},".aac"===(0<=(n=this.path.indexOf("?"))?this.path.substring(0,n):this.path).slice(-4)&&-1!==u.supportedFormats.indexOf("mp4")?(s={success:r.success,error:function(){a._detachAll(i,s),window.clearInterval(a._intervalId),a.path=(0,h.addExtname)(a.originalPath,"mp4"),e(a.path,r)}},e(this.path,s)):e(this.path,r))},u.prototype.cloneElement=function(){return this.data?this.createAudioElement(this.data.src):null},u.prototype._assetPathFilter=function(t){return-1!==u.supportedFormats.indexOf("ogg")?(0,h.addExtname)(t,"ogg"):-1!==u.supportedFormats.indexOf("aac")?(0,h.addExtname)(t,"aac"):null},u.prototype._modifyPath=function(t){if(this.hint&&this.hint.extensions&&0<this.hint.extensions.length)for(var e=0,i=u.supportedFormats;e<i.length;e++){var r=i[e];if(-1!==this.hint.extensions.indexOf(r))return(0,h.addExtname)(this.originalPath,r)}return t},u.prototype.createAudioElement=function(t){return new Audio(t)},u.prototype._attachAll=function(t,e){e.success&&t.addEventListener("canplaythrough",e.success,!1),e.error&&(t.addEventListener("stalled",e.error,!1),t.addEventListener("error",e.error,!1),t.addEventListener("abort",e.error,!1))},u.prototype._detachAll=function(t,e){e.success&&t.removeEventListener("canplaythrough",e.success,!1),e.error&&(t.removeEventListener("stalled",e.error,!1),t.removeEventListener("error",e.error,!1),t.removeEventListener("abort",e.error,!1))},u);function u(){var t=null!==o&&o.apply(this,arguments)||this;return t._intervalId=-1,t._intervalCount=0,t}i.HTMLAudioAsset=t},{"../../PathUtil":120,"../../asset/AudioAsset":126,"../../utils/ExceptionFactory":174}],163:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.setupChromeMEIWorkaround=void 0;var o=0,n=[];function s(){a(),document.removeEventListener("keydown",s),document.removeEventListener("mousedown",s),document.removeEventListener("touchend",s)}function a(){o=2,n.forEach(function(t){return t.play()}),n=[]}i.setupChromeMEIWorkaround=function(t){var e=null;function i(){switch(o){case 0:case 1:a()}o=2,clearTimeout(e)}function r(){switch(t.removeEventListener("play",i),o){case 0:n.push(t),o=1,document.addEventListener("keydown",s,!0),document.addEventListener("mousedown",s,!0),document.addEventListener("touchend",s,!0);break;case 1:n.push(t);break;case 2:t.play()}}switch(o){case 0:t.addEventListener("play",i,!0),e=window.setTimeout(r,100);break;case 1:n.push(t)}}},{}],164:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLAudioPlayer=void 0,t("../AudioPlayer")),a=t("./HTMLAudioAutoplayHelper"),t=(o=s.AudioPlayer,n(h,o),h.prototype.play=function(t){this.currentAudio&&this.stop();var e=t.cloneElement();e?((0,a.setupChromeMEIWorkaround)(e),e.volume=this._calculateVolume(),e.play().catch(function(t){}),e.loop=t.loop,e.addEventListener("ended",this._endedEventHandler,!1),e.addEventListener("play",this._onPlayEventHandler,!1),this._isWaitingPlayEvent=!0,this._audioInstance=e):this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,t.duration),o.prototype.play.call(this,t)},h.prototype.stop=function(){this.currentAudio&&(this._clearEndedEventHandler(),this._audioInstance&&(this._isWaitingPlayEvent?this._isStopRequested=!0:(this._audioInstance.pause(),this._audioInstance=null))),o.prototype.stop.call(this)},h.prototype.changeVolume=function(t){o.prototype.changeVolume.call(this,t),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},h.prototype._changeMuted=function(t){o.prototype._changeMuted.call(this,t),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},h.prototype.notifyMasterVolumeChanged=function(){this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},h.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),o.prototype.stop.call(this)},h.prototype._clearEndedEventHandler=function(){this._audioInstance&&this._audioInstance.removeEventListener("ended",this._endedEventHandler,!1),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},h.prototype._onPlayEvent=function(){var t;this._isWaitingPlayEvent&&(this._isWaitingPlayEvent=!1,this._isStopRequested&&(this._isStopRequested=!1,null!=(t=this._audioInstance)&&t.pause(),this._audioInstance=null))},h.prototype._calculateVolume=function(){return this._system._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},h);function h(t,e){var i=o.call(this,t)||this;return i._audioInstance=null,i._isWaitingPlayEvent=!1,i._isStopRequested=!1,i._manager=e,i._endedEventHandler=function(){i._onAudioEnded()},i._onPlayEventHandler=function(){i._onPlayEvent()},i._dummyDurationWaitTimer=null,i}i.HTMLAudioPlayer=t},{"../AudioPlayer":159,"./HTMLAudioAutoplayHelper":163}],165:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.HTMLAudioPlugin=void 0;var a=t("./HTMLAudioAsset"),r=t("./HTMLAudioPlayer");function o(){this._supportedFormats=[],this.supportedFormats=this._detectSupportedFormats()}o.isSupported=function(){var t=document.createElement("audio"),e=!1;try{e=void 0!==t.canPlayType}catch(t){}return e},Object.defineProperty(o.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,a.HTMLAudioAsset.supportedFormats=t},enumerable:!1,configurable:!0}),o.prototype.createAsset=function(t,e,i,r,o,n,s){return new a.HTMLAudioAsset(t,e,i,r,o,n,s)},o.prototype.createPlayer=function(t,e){return new r.HTMLAudioPlayer(t,e)},o.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf("Edge/"))return["aac"];var t=document.createElement("audio"),e=[];try{for(var i=["m4a","ogg","aac","mp4"],r=0,o=i.length;r<o;r++){var n=i[r],s=t.canPlayType("audio/"+n);"no"!==s&&""!==s&&e.push(n)}}catch(t){}return e},i.HTMLAudioPlugin=o},{"./HTMLAudioAsset":162,"./HTMLAudioPlayer":164}],166:[function(t,e,i){"use strict";var r,h,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=(Object.defineProperty(i,"__esModule",{value:!0}),i.ProxyAudioAsset=void 0,t("../../asset/AudioAsset")),s=t("../../utils/ExceptionFactory"),t=(h=n.AudioAsset,o(a,h),a.prototype.destroy=function(){this._handlerSet.unloadAudioAsset(this.id),h.prototype.destroy.call(this)},a.prototype._load=function(e){var i=this;this._handlerSet.loadAudioAsset({id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint,offset:this.offset},function(t){t?e._onAssetError(i,s.ExceptionFactory.createAssetLoadError(t)):e._onAssetLoad(i)})},a.prototype._assetPathFilter=function(t){return t},a.prototype._modifyPath=function(t){return t},a);function a(t,e,i,r,o,n,s,a){e=h.call(this,e,i,r,o,n,s,a)||this;return e._handlerSet=t,e}i.ProxyAudioAsset=t},{"../../asset/AudioAsset":126,"../../utils/ExceptionFactory":174}],167:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.ProxyAudioPlayer=void 0,t("../AudioPlayer")),t=(o=t.AudioPlayer,n(s,o),s.prototype.changeVolume=function(t){o.prototype.changeVolume.call(this,t),this._notifyVolumeToHandler()},s.prototype._changeMuted=function(t){o.prototype._changeMuted.call(this,t),this._notifyVolumeToHandler()},s.prototype.play=function(t){null!=this._audioPlayerId&&this.stop(),this._audioPlayerId="ap".concat(s._audioPlayerIdCounter++),this._handlerSet.createAudioPlayer({assetId:t.id,audioPlayerId:this._audioPlayerId,isPlaying:!0,volume:this._calculateVolume(),playbackRate:1}),o.prototype.play.call(this,t)},s.prototype.stop=function(){null!=this._audioPlayerId&&(this._handlerSet.stopAudioPlayer(this._audioPlayerId),this._handlerSet.destroyAudioPlayer(this._audioPlayerId),this._audioPlayerId=null),o.prototype.stop.call(this)},s.prototype.notifyMasterVolumeChanged=function(){this._notifyVolumeToHandler()},s.prototype._notifyVolumeToHandler=function(){null!=this._audioPlayerId&&this._handlerSet.changeAudioVolume(this._audioPlayerId,this._calculateVolume())},s.prototype._calculateVolume=function(){return this._system._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},s._audioPlayerIdCounter=0,s);function s(t,e,i){e=o.call(this,e)||this;return e._audioPlayerId=null,e._handlerSet=t,e._manager=i,e}i.ProxyAudioPlayer=t},{"../AudioPlayer":159}],168:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ProxyAudioPlugin=void 0;var a=t("./ProxyAudioAsset"),r=t("./ProxyAudioPlayer");function o(t){this.supportedFormats=[],this._handlerSet=t}o.isSupported=function(){return!0},o.prototype.createAsset=function(t,e,i,r,o,n,s){return new a.ProxyAudioAsset(this._handlerSet,t,e,i,r,o,n,s)},o.prototype.createPlayer=function(t,e){return new r.ProxyAudioPlayer(this._handlerSet,t,e)},i.ProxyAudioPlugin=o},{"./ProxyAudioAsset":166,"./ProxyAudioPlayer":167}],169:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.WebAudioAsset=void 0,t("../../asset/AudioAsset")),h=t("../../PathUtil"),c=t("../../utils/ExceptionFactory"),u=t("../../utils/XHRLoader"),l=t("./WebAudioHelper"),t=(o=s.AudioAsset,n(a,o),a.prototype._load=function(e){var i,r,o,n,s,t,a=this;null==this.path?(this.data=null,setTimeout(function(){return e._onAssetLoad(a)},0)):(i=function(t){a.data=t,e._onAssetLoad(a)},r=function(){e._onAssetError(a,c.ExceptionFactory.createAssetLoadError("WebAudioAsset unknown loading error"))},o=function(t){l.getAudioContext().decodeAudioData(t,i,r)},n=new u.XHRLoader,s=function(t,i,r){n.getArrayBuffer(t,function(t,e){t?r(t):i(e)})},".aac"===(0<=(t=this.path.indexOf("?"))?this.path.substring(0,t):this.path).slice(-4)?s(this.path,o,function(t){var e=(0,h.addExtname)(a.originalPath,"mp4");s(e,function(t){a.path=e,o(t)},r)}):s(this.path,o,r))},a.prototype._assetPathFilter=function(t){return-1!==a.supportedFormats.indexOf("ogg")?(0,h.addExtname)(t,"ogg"):-1!==a.supportedFormats.indexOf("aac")?(0,h.addExtname)(t,"aac"):null},a.prototype._modifyPath=function(t){if(this.hint&&this.hint.extensions&&0<this.hint.extensions.length)for(var e=0,i=a.supportedFormats;e<i.length;e++){var r=i[e];if(-1!==this.hint.extensions.indexOf(r))return(0,h.addExtname)(this.originalPath,r)}return t},a.supportedFormats=[],a);function a(){return null!==o&&o.apply(this,arguments)||this}i.WebAudioAsset=t},{"../../PathUtil":120,"../../asset/AudioAsset":126,"../../utils/ExceptionFactory":174,"../../utils/XHRLoader":175,"./WebAudioHelper":171}],170:[function(t,e,i){"use strict";var r,o=t("./WebAudioHelper");function n(){o.getAudioContext().resume(),document.removeEventListener("keydown",n),document.removeEventListener("mousedown",n),document.removeEventListener("touchend",n)}(r||(r={})).setupChromeMEIWorkaround=function(){var t,e,i=o.getAudioContext();i&&"function"!=typeof i.resume||(e=o.createGainNode(i),(t=i.createOscillator()).type="sawtooth",t.frequency.value=440,t.connect(e),t.start(0),e=i.state,t.disconnect(),"running"!==e&&(document.addEventListener("keydown",n,!0),document.addEventListener("mousedown",n,!0),document.addEventListener("touchend",n,!0)))},e.exports=r},{"./WebAudioHelper":171}],171:[function(t,e,i){"use strict";var r,o,n=window.AudioContext||window.webkitAudioContext;(o=r=r||{}).getAudioContext=function(){window.__akashic__||Object.defineProperty(window,"__akashic__",{value:{},enumerable:!1,configurable:!1,writable:!1});var t=window.__akashic__.audioContext;return t instanceof n||(t=window.__akashic__.audioContext=new n,o._workAroundSafari()),t},o.createGainNode=function(t){return t.createGain?t.createGain():t.createGainNode()},o.createBufferNode=function(t){return(t=t.createBufferSource()).start||(t.start=t.noteOn,t.stop=t.noteOff),t},o._workAroundSafari=function(){document.addEventListener("touchstart",function t(){document.removeEventListener("touchstart",t),o.getAudioContext().createBufferSource().start(0)},!0)},e.exports=r},{}],172:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=(Object.defineProperty(i,"__esModule",{value:!0}),i.WebAudioPlayer=void 0,t("../AudioPlayer")),a=t("./WebAudioHelper"),t=(o=s.AudioPlayer,n(h,o),h.prototype.changeVolume=function(t){o.prototype.changeVolume.call(this,t),this._gainNode.gain.value=this._calculateVolume()},h.prototype._changeMuted=function(t){o.prototype._changeMuted.call(this,t),this._gainNode.gain.value=this._calculateVolume()},h.prototype.play=function(t){var e;this.currentAudio&&this.stop(),t.data?((e=a.createBufferNode(this._audioContext)).buffer=t.data,this._gainNode.gain.value=this._calculateVolume(),e.connect(this._gainNode),this._sourceNode=e,this._sourceNode.onended=this._endedEventHandler,t.loop?(e.loop=t.loop,this._sourceNode.start(0)):(e=(null!=(e=t.offset)?e:0)/1e3,0<t.duration?this._sourceNode.start(0,e,t.duration/1e3):this._sourceNode.start(0,e))):this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,t.duration),o.prototype.play.call(this,t)},h.prototype.stop=function(){this.currentAudio&&(this._clearEndedEventHandler(),this._sourceNode&&this._sourceNode.stop(0)),o.prototype.stop.call(this)},h.prototype.notifyMasterVolumeChanged=function(){this._gainNode.gain.value=this._calculateVolume()},h.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),o.prototype.stop.call(this)},h.prototype._clearEndedEventHandler=function(){this._sourceNode&&(this._sourceNode.onended=null),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},h.prototype._calculateVolume=function(){return this._system._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},h);function h(t,e){var i=o.call(this,t)||this;return i._audioContext=a.getAudioContext(),i._manager=e,i._gainNode=a.createGainNode(i._audioContext),i._gainNode.connect(i._audioContext.destination),i._dummyDurationWaitTimer=null,i._endedEventHandler=function(){i._onAudioEnded()},i}i.WebAudioPlayer=t},{"../AudioPlayer":159,"./WebAudioHelper":171}],173:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebAudioPlugin=void 0;var a=t("./WebAudioAsset"),r=t("./WebAudioAutoplayHelper"),o=t("./WebAudioPlayer");function n(){this._supportedFormats=[],this.supportedFormats=this._detectSupportedFormats(),r.setupChromeMEIWorkaround()}n.isSupported=function(){return"AudioContext"in window||"webkitAudioContext"in window},Object.defineProperty(n.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,a.WebAudioAsset.supportedFormats=t},enumerable:!1,configurable:!0}),n.prototype.createAsset=function(t,e,i,r,o,n,s){return new a.WebAudioAsset(t,e,i,r,o,n,s)},n.prototype.createPlayer=function(t,e){return new o.WebAudioPlayer(t,e)},n.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf("Edge/"))return["aac"];var t=document.createElement("audio"),e=[];try{for(var i=["m4a","ogg","aac","mp4"],r=0,o=i.length;r<o;r++){var n=i[r],s=t.canPlayType("audio/"+n);"no"!==s&&""!==s&&e.push(n)}}catch(t){}return e},i.WebAudioPlugin=n},{"./WebAudioAsset":169,"./WebAudioAutoplayHelper":170,"./WebAudioPlayer":172}],174:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ExceptionFactory=void 0,(i.ExceptionFactory||(i.ExceptionFactory={})).createAssetLoadError=function(t,e,i){return{name:"AssetLoadError",message:t,retriable:e=void 0===e?!0:e,cause:i}}},{}],175:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.XHRLoader=void 0;var o=t("./ExceptionFactory");function r(t){this.timeout=(t=void 0===t?{}:t).timeout||15e3}r.prototype.get=function(t,e){this._getRequestObject({url:t,responseType:"text"},e)},r.prototype.getArrayBuffer=function(t,e){this._getRequestObject({url:t,responseType:"arraybuffer"},e)},r.prototype._getRequestObject=function(e,i){var r=new XMLHttpRequest;r.open("GET",e.url,!0),r.responseType=e.responseType,r.timeout=this.timeout,r.addEventListener("timeout",function(){i(o.ExceptionFactory.createAssetLoadError("loading timeout"))},!1),r.addEventListener("load",function(){var t;200<=r.status&&r.status<300?(t="text"===e.responseType?r.responseText:r.response,i(null,t)):i(o.ExceptionFactory.createAssetLoadError("loading error. status: "+r.status))},!1),r.addEventListener("error",function(){i(o.ExceptionFactory.createAssetLoadError("loading error. status: "+r.status))},!1),r.send()},i.XHRLoader=r},{"./ExceptionFactory":174}],176:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Asset=void 0;var r=t("@akashic/trigger");function o(t,e){this.id=t,this.originalPath=e,this.path=this._assetPathFilter(e),this.onDestroyed=new r.Trigger}o.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},o.prototype.destroyed=function(){return void 0===this.id},o.prototype.inUse=function(){return!1},o.prototype._assetPathFilter=function(t){return t},i.Asset=o},{"@akashic/trigger":225}],177:[function(t,e,i){"use strict";var r,a,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.AudioAsset=void 0,t("./Asset")),t=(a=t.Asset,o(n,a),n.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),this._lastPlayedPlayer=t},n.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},n.prototype.inUse=function(){return 0<this._system.findPlayers(this).length},n.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,a.prototype.destroy.call(this)},n);function n(t,e,i,r,o,n,s){t=a.call(this,t,e)||this;return t.type="audio",t.duration=i,t.loop=o,t.hint=n,t._system=r,t.data=void 0,t.offset=s,t}i.AudioAsset=t},{"./Asset":176}],178:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AudioPlayer=void 0;var r=t("@akashic/trigger");function o(t){this.onPlay=new r.Trigger,this.onStop=new r.Trigger,this.played=this.onPlay,this.stopped=this.onStop,this.currentAudio=void 0,this.volume=t.volume,this._muted=t._muted,this._system=t}o.prototype.play=function(t){this.currentAudio=t,this.onPlay.fire({player:this,audio:t})},o.prototype.stop=function(){var t=this.currentAudio;t&&(this.currentAudio=void 0,this.onStop.fire({player:this,audio:t}))},o.prototype.canHandleStopped=function(){return!0},o.prototype.changeVolume=function(t){this.volume=t},o.prototype._changeMuted=function(t){this._muted=t},o.prototype._notifyVolumeChanged=function(){this.changeVolume(this.volume)},i.AudioPlayer=o},{"@akashic/trigger":225}],179:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.ScriptAsset=void 0,t("./Asset")),t=(o=t.Asset,n(s,o),s.prototype.destroy=function(){this.script=void 0,o.prototype.destroy.call(this)},s);function s(t,e){t=o.call(this,t,e)||this;return t.type="script",t.script=void 0,t}i.ScriptAsset=t},{"./Asset":176}],180:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.TextAsset=void 0,t("./Asset")),t=(o=t.Asset,n(s,o),s.prototype.destroy=function(){this.data=void 0,o.prototype.destroy.call(this)},s);function s(t,e){t=o.call(this,t,e)||this;return t.type="text",t.data=void 0,t}i.TextAsset=t},{"./Asset":176}],181:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],182:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetLoadErrorType=void 0,(i=i.AssetLoadErrorType||(i.AssetLoadErrorType={}))[i.Unspecified=0]="Unspecified",i[i.RetryLimitExceeded=1]="RetryLimitExceeded",i[i.NetworkError=2]="NetworkError",i[i.ClientError=3]="ClientError",i[i.ServerError=4]="ServerError"},{}],183:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],184:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],185:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],186:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],187:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],188:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],189:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],190:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],191:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],192:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],193:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],194:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],195:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],196:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],197:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],198:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],199:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],200:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FontFamily=void 0,(i=i.FontFamily||(i.FontFamily={}))[i.SansSerif=0]="SansSerif",i[i.Serif=1]="Serif",i[i.Monospace=2]="Monospace"},{}],201:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FontWeight=void 0,(i=i.FontWeight||(i.FontWeight={}))[i.Normal=0]="Normal",i[i.Bold=1]="Bold"},{}],202:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],203:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],204:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],205:[function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var o=Object.getOwnPropertyDescriptor(e,i);o&&("get"in o?e.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,o)}:function(t,e,i,r){t[r=void 0===r?i:r]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(i,"__esModule",{value:!0}),o(t("./commons"),i),o(t("./errors"),i),o(t("./surface/CompositeOperation"),i),o(t("./surface/CompositeOperationString"),i),o(t("./surface/ImageData"),i),o(t("./surface/Renderer"),i),o(t("./surface/ShaderProgram"),i),o(t("./surface/ShaderUniform"),i),o(t("./surface/Surface"),i),o(t("./asset/audio/AudioAsset"),i),o(t("./asset/audio/AudioPlayer"),i),o(t("./asset/audio/AudioSystem"),i),o(t("./asset/audio/AudioAssetHint"),i),o(t("./asset/image/ImageAssetHint"),i),o(t("./asset/image/ImageAsset"),i),o(t("./asset/script/ScriptAsset"),i),o(t("./asset/script/Module"),i),o(t("./asset/script/ScriptAssetRuntimeValue"),i),o(t("./asset/text/TextAsset"),i),o(t("./asset/video/VideoPlayer"),i),o(t("./asset/video/VideoSystem"),i),o(t("./asset/video/VideoAsset"),i),o(t("./asset/vector-image/VectorImageAsset"),i),o(t("./asset/vector-image/VectorImageAssetHint"),i),o(t("./asset/Asset"),i),o(t("./asset/AssetLoadErrorType"),i),o(t("./font/FontWeightString"),i),o(t("./font/FontWeight"),i),o(t("./font/FontFamily"),i),o(t("./font/Glyph"),i),o(t("./font/GlyphFactory"),i),o(t("./platform/Looper"),i),o(t("./platform/OperationPluginView"),i),o(t("./platform/OperationPluginViewInfo"),i),o(t("./platform/Platform"),i),o(t("./platform/PlatformEventHandler"),i),o(t("./platform/PlatformPointEvent"),i),o(t("./platform/RendererRequirement"),i),o(t("./platform/ResourceFactory"),i)},{"./asset/Asset":181,"./asset/AssetLoadErrorType":182,"./asset/audio/AudioAsset":183,"./asset/audio/AudioAssetHint":184,"./asset/audio/AudioPlayer":185,"./asset/audio/AudioSystem":186,"./asset/image/ImageAsset":187,"./asset/image/ImageAssetHint":188,"./asset/script/Module":189,"./asset/script/ScriptAsset":190,"./asset/script/ScriptAssetRuntimeValue":191,"./asset/text/TextAsset":192,"./asset/vector-image/VectorImageAsset":193,"./asset/vector-image/VectorImageAssetHint":194,"./asset/video/VideoAsset":195,"./asset/video/VideoPlayer":196,"./asset/video/VideoSystem":197,"./commons":198,"./errors":199,"./font/FontFamily":200,"./font/FontWeight":201,"./font/FontWeightString":202,"./font/Glyph":203,"./font/GlyphFactory":204,"./platform/Looper":206,"./platform/OperationPluginView":207,"./platform/OperationPluginViewInfo":208,"./platform/Platform":209,"./platform/PlatformEventHandler":210,"./platform/PlatformPointEvent":211,"./platform/RendererRequirement":212,"./platform/ResourceFactory":213,"./surface/CompositeOperation":214,"./surface/CompositeOperationString":215,"./surface/ImageData":216,"./surface/Renderer":217,"./surface/ShaderProgram":218,"./surface/ShaderUniform":219,"./surface/Surface":220}],206:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],207:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],208:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],209:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],210:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],211:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],212:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],213:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],214:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CompositeOperation=void 0,(i=i.CompositeOperation||(i.CompositeOperation={}))[i.SourceOver=0]="SourceOver",i[i.SourceAtop=1]="SourceAtop",i[i.Lighter=2]="Lighter",i[i.Copy=3]="Copy",i[i.ExperimentalSourceIn=4]="ExperimentalSourceIn",i[i.ExperimentalSourceOut=5]="ExperimentalSourceOut",i[i.ExperimentalDestinationAtop=6]="ExperimentalDestinationAtop",i[i.ExperimentalDestinationIn=7]="ExperimentalDestinationIn",i[i.DestinationOut=8]="DestinationOut",i[i.DestinationOver=9]="DestinationOver",i[i.Xor=10]="Xor"},{}],215:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],216:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],217:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],218:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],219:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],220:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],221:[function(t,e,i){"use strict";var r,o,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t=(Object.defineProperty(i,"__esModule",{value:!0}),i.ChainTrigger=void 0,t("./Trigger")),t=(o=t.Trigger,n(s,o),s.prototype.add=function(t,e){o.prototype.add.call(this,t,e),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},s.prototype.addOnce=function(t,e){o.prototype.addOnce.call(this,t,e),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},s.prototype.remove=function(t,e){o.prototype.remove.call(this,t,e),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},s.prototype.removeAll=function(t){o.prototype.removeAll.call(this,t),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},s.prototype.destroy=function(){o.prototype.destroy.call(this),this.chain.remove(this._onChainTriggerFired,this),this.filter=null,this.filterOwner=null,this._isActivated=!1},s.prototype._onChainTriggerFired=function(t){this.filter&&!this.filter.call(this.filterOwner,t)||this.fire(t)},s);function s(t,e,i){var r=o.call(this)||this;return r.chain=t,r.filter=null!=e?e:null,r.filterOwner=i,r._isActivated=!1,r}i.ChainTrigger=t},{"./Trigger":223}],222:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],223:[function(t,e,i){"use strict";function r(){this._handlers=[],this.length=0}Object.defineProperty(i,"__esModule",{value:!0}),i.Trigger=void 0,r.prototype.add=function(t,e){"function"==typeof t?this._handlers.push({func:t,owner:e,once:!1,name:void 0}):"number"==typeof(e=t).index?this._handlers.splice(e.index,0,{func:e.func,owner:e.owner,once:!1,name:e.name}):this._handlers.push({func:e.func,owner:e.owner,once:!1,name:e.name}),this.length=this._handlers.length},r.prototype.addOnce=function(t,e){"function"==typeof t?this._handlers.push({func:t,owner:e,once:!0,name:void 0}):"number"==typeof(e=t).index?this._handlers.splice(e.index,0,{func:e.func,owner:e.owner,once:!0,name:e.name}):this._handlers.push({func:e.func,owner:e.owner,once:!0,name:e.name}),this.length=this._handlers.length},r.prototype.handle=function(t,e,i){this.add(e?{owner:t,func:e,name:i}:{func:t})},r.prototype.fire=function(t){if(this._handlers&&this._handlers.length){for(var e=this._handlers.concat(),i=0;i<e.length;i++){var r=e[i];(r.func.call(r.owner,t)||r.once)&&this._handlers&&-1!==(r=this._handlers.indexOf(r))&&this._handlers.splice(r,1)}null!=this._handlers&&(this.length=this._handlers.length)}},r.prototype.contains=function(t,e){for(var i="function"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++)if(this._comparePartial(i,this._handlers[r]))return!0;return!1},r.prototype.remove=function(t,e){for(var i="function"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++){var o=this._handlers[r];if(i.func===o.func&&i.owner===o.owner&&i.name===o.name)return this._handlers.splice(r,1),void--this.length}},r.prototype.removeAll=function(t){var e=[];if(t)for(var i=0;i<this._handlers.length;i++){var r=this._handlers[i];this._comparePartial(t,r)||e.push(r)}this._handlers=e,this.length=this._handlers.length},r.prototype.destroy=function(){this._handlers=null,this.length=null},r.prototype.destroyed=function(){return null===this._handlers},r.prototype._comparePartial=function(t,e){return(void 0===t.func||t.func===e.func)&&((void 0===t.owner||t.owner===e.owner)&&(void 0===t.name||t.name===e.name))},i.Trigger=r},{}],224:[function(t,e,i){arguments[4][89][0].apply(i,arguments)},{dup:89}],225:[function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var o=Object.getOwnPropertyDescriptor(e,i);o&&("get"in o?e.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,o)}:function(t,e,i,r){t[r=void 0===r?i:r]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(i,"__esModule",{value:!0}),o(t("./TriggerLike"),i),o(t("./ChainTriggerLike"),i),o(t("./Trigger"),i),o(t("./ChainTrigger"),i)},{"./ChainTrigger":221,"./ChainTriggerLike":222,"./Trigger":223,"./TriggerLike":224}],226:[function(B,i,r){!function(H,N){!function(){var t,e;t=this,e=function(){"use strict";function h(t){return"function"==typeof t}var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=0,e=void 0,o=void 0,s=function(t,e){l[r]=t,l[r+1]=e,2===(r+=2)&&(o?o(d):D())};var t="undefined"!=typeof window?window:void 0,n=t||{},n=n.MutationObserver||n.WebKitMutationObserver,a="undefined"==typeof self&&void 0!==H&&"[object process]"==={}.toString.call(H),c="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function u(){var t=setTimeout;return function(){return t(d,1)}}var l=new Array(1e3);function d(){for(var t=0;t<r;t+=2)(0,l[t])(l[t+1]),l[t]=void 0,l[t+1]=void 0;r=0}function p(){try{var t=Function("return this")().require("vertx");return void 0!==(e=t.runOnLoop||t.runOnContext)?function(){e(d)}:u()}catch(t){return u()}}var f,_,g,D=void 0;function y(t,e){var i,r=this,o=new this.constructor(A),n=(void 0===o[v]&&R(o),r._state);return n?(i=arguments[n-1],s(function(){return M(n,o,i,r._result)})):k(r,o,t,e),o}function m(t){var e;return t&&"object"==typeof t&&t.constructor===this?t:(P(e=new this(A),t),e)}var D=a?function(){return H.nextTick(d)}:n?(_=0,a=new n(d),g=document.createTextNode(""),a.observe(g,{characterData:!0}),function(){g.data=_=++_%2}):c?((f=new MessageChannel).port1.onmessage=d,function(){return f.port2.postMessage(0)}):(void 0===t&&"function"==typeof B?p:u)(),v=Math.random().toString(36).substring(2);function A(){}var T=void 0,S=1,x=2;function j(t,r,o){s(function(e){var i=!1,t=function(t,e,i,r){try{t.call(e,i,r)}catch(t){return t}}(o,r,function(t){i||(i=!0,(r!==t?P:b)(e,t))},function(t){i||(i=!0,E(e,t))},e._label);!i&&t&&(i=!0,E(e,t))},t)}function w(t,e,i){var r,o;e.constructor===t.constructor&&i===y&&e.constructor.resolve===m?(r=t,(o=e)._state===S?b(r,o._result):o._state===x?E(r,o._result):k(o,void 0,function(t){return P(r,t)},function(t){return E(r,t)})):void 0!==i&&h(i)?j(t,e,i):b(t,e)}function P(e,t){if(e===t)E(e,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof t,null===t||"object"!=i&&"function"!=i)b(e,t);else{i=void 0;try{i=t.then}catch(t){return void E(e,t)}w(e,t,i)}var i}function G(t){t._onerror&&t._onerror(t._result),O(t)}function b(t,e){t._state===T&&(t._result=e,t._state=S,0!==t._subscribers.length&&s(O,t))}function E(t,e){t._state===T&&(t._state=x,t._result=e,s(G,t))}function k(t,e,i,r){var o=t._subscribers,n=o.length;t._onerror=null,o[n]=e,o[n+S]=i,o[n+x]=r,0===n&&t._state&&s(O,t)}function O(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var r,o=void 0,n=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+i],r?M(i,r,o,n):o(n);t._subscribers.length=0}}function M(t,e,i,r){var o=h(i),n=void 0,s=void 0,a=!0;if(o){try{n=i(r)}catch(t){a=!1,s=t}if(e===n)return void E(e,new TypeError("A promises callback cannot return that same promise."))}else n=r;e._state===T&&(o&&a?P(e,n):!1===a?E(e,s):t===S?b(e,n):t===x&&E(e,n))}var L=0;function R(t){t[v]=L++,t._state=void 0,t._result=void 0,t._subscribers=[]}C.prototype._enumerate=function(t){for(var e=0;this._state===T&&e<t.length;e++)this._eachEntry(t[e],e)},C.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,r=i.resolve;if(r===m){var o,n=void 0,s=void 0,a=!1;try{n=e.then}catch(t){a=!0,s=t}n===y&&e._state!==T?this._settledAt(e._state,t,e._result):"function"!=typeof n?(this._remaining--,this._result[t]=e):i===F?(o=new i(A),a?E(o,s):w(o,e,n),this._willSettleAt(o,t)):this._willSettleAt(new i(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},C.prototype._settledAt=function(t,e,i){var r=this.promise;r._state===T&&(this._remaining--,t===x?E(r,i):this._result[e]=i),0===this._remaining&&b(r,this._result)},C.prototype._willSettleAt=function(t,e){var i=this;k(t,void 0,function(t){return i._settledAt(S,e,t)},function(t){return i._settledAt(x,e,t)})};var U=C;function C(t,e){this._instanceConstructor=t,this.promise=new t(A),this.promise[v]||R(this.promise),i(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0!==this.length&&(this.length=this.length||0,this._enumerate(e),0!==this._remaining)||b(this.promise,this._result)):E(this.promise,new Error("Array Methods must be provided an Array"))}I.prototype.catch=function(t){return this.then(null,t)},I.prototype.finally=function(e){var i=this.constructor;return h(e)?this.then(function(t){return i.resolve(e()).then(function(){return t})},function(t){return i.resolve(e()).then(function(){throw t})}):this.then(e,e)};var F=I;function I(t){if(this[v]=L++,this._result=this._state=void 0,this._subscribers=[],A!==t){if("function"!=typeof t)throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof I))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");var e=this;try{t(function(t){P(e,t)},function(t){E(e,t)})}catch(t){E(e,t)}}}return F.prototype.then=y,F.all=function(t){return new U(this,t).promise},F.race=function(o){var n=this;return i(o)?new n(function(t,e){for(var i=o.length,r=0;r<i;r++)n.resolve(o[r]).then(t,e)}):new n(function(t,e){return e(new TypeError("You must pass an array to race."))})},F.resolve=m,F.reject=function(t){var e=new this(A);return E(e,t),e},F._setScheduler=function(t){o=t},F._setAsap=function(t){s=t},F._asap=s,F.polyfill=function(){var t=void 0;if(void 0!==N)t=N;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===i&&!e.cast)return}t.Promise=F},F.Promise=F},"object"==typeof r&&void 0!==i?i.exports=e():t.ES6Promise=e()}.call(this)}.call(this,B("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:1}],227:[function(t,e,i){var r=t("@akashic/akashic-engine");r.AudioAsset=t("@akashic/pdi-common-impl/lib/AudioAsset").AudioAsset,r.AudioPlayer=t("@akashic/pdi-common-impl/lib/AudioPlayer").AudioPlayer,r.ScriptAsset=t("@akashic/pdi-common-impl/lib/ScriptAsset").ScriptAsset,r.TextAsset=t("@akashic/pdi-common-impl/lib/TextAsset").TextAsset,e.exports=r},{"@akashic/akashic-engine":2,"@akashic/pdi-common-impl/lib/AudioAsset":177,"@akashic/pdi-common-impl/lib/AudioPlayer":178,"@akashic/pdi-common-impl/lib/ScriptAsset":179,"@akashic/pdi-common-impl/lib/TextAsset":180}],228:[function(t,e,i){e.exports={gameDriver:t("@akashic/game-driver"),akashicEngine:t("./akashicEngine"),pdiBrowser:"undefined"!=typeof window?t("@akashic/pdi-browser"):null}},{"./akashicEngine":227,"@akashic/game-driver":97,"@akashic/pdi-browser":116}]},{},[228])(228)});

	window.engineFiles=engineFilesV3_6_7,window.g=engineFiles.akashicEngine,function(){window.require;window.require=function(i){return"@akashic/akashic-engine"!==i?this.call(this,i):engineFiles.akashicEngine}}();

</script>

<script>
if (! ("optionProps" in window)) {
	window.optionProps = {};
}
window.optionProps.magnify = true

window.g = require("@akashic/akashic-engine");
</script>
<script>
if (! ("gLocalAssetContainer" in window)) {
	window.gLocalAssetContainer = {};
}

if (! ("__akashic__" in window)) {
	window.__akashic__ = {};
}


	
		window.gLocalAssetContainer["game.json"] = "{%0A%09%22width%22: 1280,%0A%09%22height%22: 720,%0A%09%22fps%22: 60,%0A%09%22main%22: %22./script/_bootstrap.js%22,%0A%09%22assets%22: {%0A%09%09%22_bootstrap%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/1b69b90133980bf57115.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/_bootstrap.js%22%0A%09%09},%0A%09%09%22game%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/fd527e0362cf299bdcac.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/wasm.js%22%0A%09%09},%0A%09%09%22wasm%22: {%0A%09%09%09%22type%22: %22text%22,%0A%09%09%09%22path%22: %22files/41e708fdcac13d27fc9c.wasm%22,%0A%09%09%09%22virtualPath%22: %22script/wasm.wasm%22%0A%09%09},%0A%09%09%22main%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22files/0d75bfc2cf044a49e7a9.js%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22virtualPath%22: %22script/main.js%22%0A%09%09},%0A%09%09%22floor%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/6f2fe86fbf79e83fdee9.jpg%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22width%22: 128,%0A%09%09%09%22height%22: 128,%0A%09%09%09%22virtualPath%22: %22image/floor.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22ceil%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/d83b264fcbe79aa4f327.jpg%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22width%22: 128,%0A%09%09%09%22height%22: 128,%0A%09%09%09%22virtualPath%22: %22image/ceil.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22wall%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/bd75c35a505e6384fee5.jpg%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22width%22: 128,%0A%09%09%09%22height%22: 128,%0A%09%09%09%22virtualPath%22: %22image/wall.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22enemy%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/42e7b3292ac3eba53c06.jpg%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22width%22: 128,%0A%09%09%09%22height%22: 128,%0A%09%09%09%22virtualPath%22: %22image/enemy.jpg%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22enemy_model%22: {%0A%09%09%09%22type%22: %22text%22,%0A%09%09%09%22path%22: %22files/4f192e2f52b93f2ea128.mesh%22,%0A%09%09%09%22virtualPath%22: %22model/low_enemy.mesh%22%0A%09%09},%0A%09%09%22manual%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22path%22: %22files/60713ccc31fc5ecabfad.png%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22width%22: 1280,%0A%09%09%09%22height%22: 720,%0A%09%09%09%22virtualPath%22: %22image/manual.png%22,%0A%09%09%09%22hint%22: {%0A%09%09%09%09%22untainted%22: true%0A%09%09%09}%0A%09%09},%0A%09%09%22bird%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/f79215d3b43b2e0ee523%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22duration%22: 3000,%0A%09%09%09%22virtualPath%22: %22audio/bird%22%0A%09%09},%0A%09%09%22damage%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/7d6f9efc28e6863b5042%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22duration%22: 1500,%0A%09%09%09%22virtualPath%22: %22audio/damage%22%0A%09%09},%0A%09%09%22common%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/eed3699f4f0bf8685c70%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22duration%22: 10000,%0A%09%09%09%22virtualPath%22: %22audio/common%22%0A%09%09},%0A%09%09%22uncommon%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/77cad136d33d6e701638%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22duration%22: 10000,%0A%09%09%09%22virtualPath%22: %22audio/uncommon%22%0A%09%09},%0A%09%09%22rare%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/52ae93f099a350a88cdb%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22duration%22: 10000,%0A%09%09%09%22virtualPath%22: %22audio/rare%22%0A%09%09},%0A%09%09%22mythic%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/9026af70b2a1d1016267%22,%0A%09%09%09%22systemId%22: %22sound%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22duration%22: 20000,%0A%09%09%09%22virtualPath%22: %22audio/mythic%22%0A%09%09},%0A%09%09%22bgm%22: {%0A%09%09%09%22type%22: %22audio%22,%0A%09%09%09%22path%22: %22files/3a8e69138d41ed08187c%22,%0A%09%09%09%22systemId%22: %22music%22,%0A%09%09%09%22global%22: true,%0A%09%09%09%22duration%22: 55000,%0A%09%09%09%22virtualPath%22: %22audio/horror_zone1%22%0A%09%09},%0A%09%09%22a_e_z_0%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-hover-plugin/lib/Converter.js%22,%0A%09%09%09%22path%22: %22files/02b086419153ca8815d3.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_1%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-hover-plugin/lib/HoverPlugin.js%22,%0A%09%09%09%22path%22: %22files/4c08e5c8d37ce2ee6c7f.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22a_e_z_2%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22virtualPath%22: %22node_modules/@akashic-extension/akashic-hover-plugin/lib/index.js%22,%0A%09%09%09%22path%22: %22files/e495008e90fbf9907b7d.js%22,%0A%09%09%09%22global%22: true%0A%09%09}%0A%09},%0A%09%22moduleMainScripts%22: {%0A%09%09%22@akashic-extension/akashic-hover-plugin%22: %22node_modules/@akashic-extension/akashic-hover-plugin/lib/index.js%22%0A%09},%0A%09%22environment%22: {%0A%09%09%22sandbox-runtime%22: %223%22,%0A%09%09%22niconico%22: {%0A%09%09%09%22supportedModes%22: [%0A%09%09%09%09%22ranking%22%0A%09%09%09],%0A%09%09%09%22preferredSessionParameters%22: {%0A%09%09%09%09%22totalTimeLimit%22: 120%0A%09%09%09}%0A%09%09}%0A%09},%0A%09%22globalScripts%22: []%0A}";
	

	
		window.gLocalAssetContainer["_bootstrap"] = function(g) {
			!function(e,a){var t=e("./main");a.exports=function(a){var n={},d=(Object.keys(a).forEach(function(e){n[e]=a[e]}),n.sessionParameter={},n.isAtsumaru="undefined"!=typeof window&&void 0!==window.RPGAtsumaru,new g.Scene({game:g.game}));d.onMessage.add(function(e){e.data&&"start"===e.data.type&&e.data.parameters&&(n.sessionParameter=e.data.parameters,null!=e.data.parameters.randomSeed&&(n.randomSeed=e.data.parameters.randomSeed),g.game.popScene(),t.main(n))}),d.onLoad.add(function(){var e=0;d.onUpdate.add(function(){3<++e&&(g.game.popScene(),t.main(n))})}),g.game.pushScene(d)}}((g.module.exports,g.module.require),g.module,(g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["game"] = function(g) {
			!function(e){var v={locateFile:e=>g.game._assetManager.configuration.wasm.path};e.exports=v;const T=void 0;var W,v=void 0!==v?v:{},e=Object.assign({},v),z=(e,n)=>{throw n},G=!0,o=!1,n="";(G||o)&&(o?n=self.location.href:"undefined"!=typeof document&&document.currentScript&&(n=document.currentScript.src),n=0!==n.indexOf("blob:")?n.substr(0,n.replace(/[?#].*/,"").lastIndexOf("/")+1):"",o&&(W=e=>{var n=new XMLHttpRequest;return n.open("GET",e,!1),n.responseType="arraybuffer",n.send(null),new Uint8Array(n.response)}));var i,c=v.print||console.log.bind(console),l=v.printErr||console.warn.bind(console);function s(e){s.shown||(s.shown={}),s.shown[e]||(s.shown[e]=1,l(e))}Object.assign(v,e),v.arguments&&v.arguments,v.thisProgram&&v.thisProgram,v.quit&&(z=v.quit),v.wasmBinary&&(i=v.wasmBinary);var N,V=v.noExitRuntime||!0;function u(e,n,t="i8"){switch(t="*"===t.charAt(t.length-1)?"i32":t){case"i1":case"i8":d[e>>0]=n;break;case"i16":Y[e>>1]=n;break;case"i32":p[e>>2]=n;break;case"i64":r=[n>>>0,(r=n,1<=+Math.abs(r)?0<r?(0|Math.min(+Math.floor(r/4294967296),4294967295))>>>0:~~+Math.ceil((r-(~~r>>>0))/4294967296)>>>0:0)],p[e>>2]=r[0],p[e+4>>2]=r[1];break;case"float":b[e>>2]=n;break;case"double":K[e>>3]=n;break;default:L("invalid type for setValue: "+t)}}"object"!=typeof WebAssembly&&L("no native wasm support detected");var t,f=!1;function q(e,n){e||L(n)}function j(e){return v["_"+e]}function O(e,n,t,r,a){var o={string:function(e){var n,t=0;return null!=e&&0!==e&&(n=1+(e.length<<2),t=Fe(n),Q(e,m,t,n)),t},array:function(e){var n=Fe(e.length);return d.set(e,n),n}};var e=j(e),i=[],u=0;if(r)for(var s=0;s<r.length;s++){var c=o[t[s]];c?(0===u&&(u=Le()),i[s]=c(r[s])):i[s]=r[s]}e=e.apply(null,i);return e=e,0!==u&&ke(u),e=e,"string"===n?x(e):"boolean"===n?Boolean(e):e}var h,d,m,Y,X,p,w,b,K,H="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function J(e,n,t){for(var r=n+t,a=n;e[a]&&!(r<=a);)++a;if(16<a-n&&e.buffer&&H)return H.decode(e.subarray(n,a));for(var o="";n<a;){var i,u,s=e[n++];128&s?(u=63&e[n++],192==(224&s)?o+=String.fromCharCode((31&s)<<6|u):(i=63&e[n++],(s=224==(240&s)?(15&s)<<12|u<<6|i:(7&s)<<18|u<<12|i<<6|63&e[n++])<65536?o+=String.fromCharCode(s):(u=s-65536,o+=String.fromCharCode(55296|u>>10,56320|1023&u)))):o+=String.fromCharCode(s)}return o}function x(e,n){return e?J(m,e,n):""}function Q(e,n,t,r){if(!(0<r))return 0;for(var a=t,o=t+r-1,i=0;i<e.length;++i){var u=e.charCodeAt(i);if((u=55296<=u&&u<=57343?65536+((1023&u)<<10)|1023&e.charCodeAt(++i):u)<=127){if(o<=t)break;n[t++]=u}else{if(u<=2047){if(o<=t+1)break;n[t++]=192|u>>6}else{if(u<=65535){if(o<=t+2)break;n[t++]=224|u>>12}else{if(o<=t+3)break;n[t++]=240|u>>18,n[t++]=128|u>>12&63}n[t++]=128|u>>6&63}n[t++]=128|63&u}}return n[t]=0,t-a}function $(e){var n=function(e){for(var n=0,t=0;t<e.length;++t){var r=e.charCodeAt(t);(r=55296<=r&&r<=57343?65536+((1023&r)<<10)|1023&e.charCodeAt(++t):r)<=127?++n:n+=r<=2047?2:r<=65535?3:4}return n}(e)+1,t=U(n);return t&&Q(e,d,t,n),t}function Z(e){h=e,v.HEAP8=d=new Int8Array(e),v.HEAP16=Y=new Int16Array(e),v.HEAP32=p=new Int32Array(e),v.HEAPU8=m=new Uint8Array(e),v.HEAPU16=X=new Uint16Array(e),v.HEAPU32=w=new Uint32Array(e),v.HEAPF32=b=new Float32Array(e),v.HEAPF64=K=new Float64Array(e)}v.INITIAL_MEMORY;var ee,ne=[],te=[],re=[],ae=[];function oe(){if(v.preRun)for("function"==typeof v.preRun&&(v.preRun=[v.preRun]);v.preRun.length;)e=v.preRun.shift(),ne.unshift(e);var e;a(ne)}function ie(){if(v.postRun)for("function"==typeof v.postRun&&(v.postRun=[v.postRun]);v.postRun.length;)e=v.postRun.shift(),ae.unshift(e);var e;a(ae)}var y=0,ue=null,B=null;function L(e){throw v.onAbort&&v.onAbort(e),l(e="Aborted("+e+")"),f=!0,t=1,e+=". Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(e)}v.preloadedImages={},v.preloadedAudios={};var k,r;function se(e){return e.startsWith("data:application/octet-stream;base64,")}function ce(e){try{if(e==k&&i)return new Uint8Array(i);if(W)return W(e);throw"both async and sync fetching of the wasm failed"}catch(e){L(e)}}se(k="wasm.wasm")||(e=k,k=v.locateFile?v.locateFile(e,n):n+e);var le={18108:function(e,n,t,r){var a=P,e=x(e),o=new Uint16Array(h,n,2),n=new Uint16Array(h,n+4,3),i=g.game.assets[e];i?(a.pixelStorei(a.UNPACK_ALIGNMENT,4),a.texImage2D(r,0,a.RGBA,i.width,i.height,0,a.RGBA,a.UNSIGNED_BYTE,i.data),o[0]=i.width,o[1]=i.height,n[0]=a.RGBA,n[1]=a.RGBA,n[2]=a.UNSIGNED_BYTE):(a.pixelStorei(a.UNPACK_ALIGNMENT,4),a.texImage2D(r,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array(4)),o[0]=1,o[1]=1,n[0]=a.RGBA,n[1]=a.RGBA,n[2]=a.UNSIGNED_BYTE,fetch(g.game._assetManager.configuration[e].path).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>{var n=U(e.byteLength);d.set(new Uint8Array(e),n),v._onTextureLoad(n,e.byteLength,t),R(n)}))},19040:function(e){let n=g.game.vars.sounds.findIndex(e=>null===e);-1==n&&(n=g.game.vars.sounds.push(42)-1);var t={};return t.asset=g.game.assets[x(e)],t.player=null,t.play=function(){this.stop(),this.player=this.asset.play()}.bind(t),t.stop=function(){this.player&&this.player.stop()}.bind(t),t.changeVolume=function(e){this.player.changeVolume(e)}.bind(t),g.game.vars.sounds[n]=t,n},19543:function(e){g.game.vars.sounds[e].play()},19597:function(e,n){g.game.vars.sounds[e].changeVolume(n)},19638:function(e){g.game.vars.sounds[e].stop(),g.game.vars.sounds[e]=null},19700:function(e){v.fontlib[e]=null},19727:function(e,n){var t=document.createElement("canvas"),t=(t.width=t.height=128,t.getContext("2d",{willReadFrequently:!0}));return t.font=n+"px _"+x(e),t.lineCap="round",t.lineJoin="round",t.textBaseline="top",t.textAlign="left",v.fontlib[++v.fonthandle]=t,v.fonthandle},20098:function(e,n,t,r,a,o,i,u){var s=v.fontlib[e],e=s.canvas,c=x(n,t),l=s.measureText(c),n=new Float32Array(h,a,3),f=new Float32Array(h,o,4*i),d=i?Math.ceil(f[3]):0,t=Math.ceil(l.actualBoundingBoxRight)+Math.ceil(l.actualBoundingBoxLeft)+1+2*d,a=Math.ceil(l.actualBoundingBoxDescent)+Math.ceil(l.actualBoundingBoxAscent)+1+2*d;(e.width<t||e.height<a)&&(e.width=t,e.height=a),s.clearRect(0,0,t,a);for(var m=0;m<i;++m)s.lineWidth=2*f[4*m+3],s.strokeStyle=`rgb(${255*f[4*m]}, ${255*f[4*m+1]}, ${255*f[4*m+2]})`,s.strokeText(c,Math.ceil(l.actualBoundingBoxLeft)+d,Math.ceil(l.actualBoundingBoxAscent)+d);s.fillStyle=`rgb(${255*n[0]}, ${255*n[1]}, ${255*n[2]})`,s.fillText(c,Math.ceil(l.actualBoundingBoxLeft)+d,Math.ceil(l.actualBoundingBoxAscent)+d);o=s.getImageData(0,0,t,a),g.game.vars.tmpFontData={},g.game.vars.tmpFontData.data=o,g.game.vars.tmpFontData.tm=l,g.game.vars.tmpFontData.maxStroke=d,e=new Uint16Array(h,r,2),e[0]=o.width,e[1]=o.height,n=new Uint16Array(h,u,2);n[0]=~~(256*(l.actualBoundingBoxRight+l.actualBoundingBoxLeft+2*d)),n[1]=~~(256*(l.actualBoundingBoxDescent+l.actualBoundingBoxAscent+2*d))},21801:function(e,n){var t=g.game.vars.tmpFontData.data,r=g.game.vars.tmpFontData.tm,a=g.game.vars.tmpFontData.maxStroke,e=(delete g.game.vars.tmpFontData,new Uint32Array(h,e,t.width*t.height)),t=new Uint32Array(t.data.buffer,t.data.byteOffset,t.width*t.height),e=(e.set(t),new Int16Array(h,n,2));e[0]=~~(256*-r.actualBoundingBoxLeft),e[1]=~~(256*(r.actualBoundingBoxDescent+a))},22301:function(e,n){var t=document.createElement("canvas");t.width=e,t.height=n;let r=0;for(;null!=v.canvaslib[r];++r);e={};return(v.canvaslib[r]=e).canvas=t,e.g=t.getContext("2d"),r},22551:function(e){v.canvaslib[e]=void 0},22582:function(e,n,t,r,a,o,i,u,s,c,l){e=v.canvaslib[e].g;e.lineWidth=n,e.lineCap=t,e.lineJoin=r,e.strokeStyle="#"+(a>>>0).toString(16),e.beginPath(),e.ellipse(o,i,u,s,0,c,l),e.stroke()},22780:function(e){e=v.canvaslib[e].canvas;return e.width*e.height},22861:function(e,n,t){var e=v.canvaslib[e],e=e.g.getImageData(0,0,e.canvas.width,e.canvas.height),n=new Uint32Array(h,n,e.width*e.height),r=new Uint32Array(e.data.buffer,e.data.byteOffset,e.width*e.height),n=(n.set(r),new Int32Array(h,t,2));n[0]=e.width,n[1]=e.height},23249:function(e){e=x(e);g.game.vars.loadinId=g.game.vars.loadinId??0;const t=g.game.vars.loadinId++;return fetch(g.game._assetManager.configuration[e].path).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>{var n=U(e.byteLength);d.set(new Uint8Array(e),n),v._onLoad(n,e.byteLength,t)}),t},23619:function(e){new Float32Array(h,e,1)[0]=g.game.vars.time},23674:function(){let e=0;var n=P;for(const r of["floor","wall","ceil"]){var t=g.game.assets[r];n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,e++,128,128,1,n.RGBA,n.UNSIGNED_BYTE,t.data)}},23896:function(e){g.game.vars.gameState.score=e}};function a(e){for(;0<e.length;){var n,t=e.shift();"function"==typeof t?t(v):"number"==typeof(n=t.func)?void 0===t.arg?E(n)():E(n)(t.arg):n(void 0===t.arg?null:t.arg)}}var F=[];function E(e){var n=F[e];return n||(e>=F.length&&(F.length=e+1),F[e]=n=ee.get(e)),n}function fe(e){if(e instanceof Ee||"unwind"==e)return t;z(1,e)}var de=[];var me={buffers:[null,[],[]],printChar:function(e,n){var t=me.buffers[e];0===n||10===n?((1===e?c:l)(J(t,0)),t.length=0):t.push(n)},varargs:void 0,get:function(){return me.varargs+=4,p[me.varargs-4>>2]},getStr:function(e){return x(e)},get64:function(e,n){return e}};var C={counter:1,buffers:[],mappedBuffers:{},programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],samplers:[],transformFeedbacks:[],syncs:[],byteSizeByTypeRoot:5120,byteSizeByType:[1,1,2,2,4,4,4,2,3,4,8],stringCache:{},stringiCache:{},unpackAlignment:4,recordError:function(e){C.lastError||(C.lastError=e)},getNewId:function(e){for(var n=C.counter++,t=e.length;t<n;t++)e[t]=null;return n},MAX_TEMP_BUFFER_SIZE:2097152,numTempVertexBuffersPerSize:64,log2ceilLookup:function(e){return 32-Math.clz32(0===e?0:e-1)},generateTempBuffers:function(e,n){var t=C.log2ceilLookup(C.MAX_TEMP_BUFFER_SIZE);n.tempVertexBufferCounters1=[],n.tempVertexBufferCounters2=[],n.tempVertexBufferCounters1.length=n.tempVertexBufferCounters2.length=t+1,n.tempVertexBuffers1=[],n.tempVertexBuffers2=[],n.tempVertexBuffers1.length=n.tempVertexBuffers2.length=t+1,n.tempIndexBuffers=[],n.tempIndexBuffers.length=t+1;for(var r=0;r<=t;++r){n.tempIndexBuffers[r]=null,n.tempVertexBufferCounters1[r]=n.tempVertexBufferCounters2[r]=0;var a=C.numTempVertexBuffersPerSize,o=(n.tempVertexBuffers1[r]=[],n.tempVertexBuffers2[r]=[],n.tempVertexBuffers1[r]),i=n.tempVertexBuffers2[r];o.length=i.length=a;for(var u=0;u<a;++u)o[u]=i[u]=null}if(e){n.tempQuadIndexBuffer=P.createBuffer(),n.GLctx.bindBuffer(34963,n.tempQuadIndexBuffer);for(var s=C.MAX_TEMP_BUFFER_SIZE>>1,c=new Uint16Array(s),r=0,l=0;;){if(c[r++]=l,s<=r)break;if(c[r++]=l+1,s<=r)break;if(c[r++]=l+2,s<=r)break;if(c[r++]=l,s<=r)break;if(c[r++]=l+2,s<=r)break;if(c[r++]=l+3,s<=r)break;l+=4}n.GLctx.bufferData(34963,c,35044),n.GLctx.bindBuffer(34963,null)}},getTempVertexBuffer:function(e){var e=C.log2ceilLookup(e),n=C.currentContext.tempVertexBuffers1[e],t=C.currentContext.tempVertexBufferCounters1[e],r=(C.currentContext.tempVertexBufferCounters1[e]=C.currentContext.tempVertexBufferCounters1[e]+1&C.numTempVertexBuffersPerSize-1,n[t]);return r||(r=P.getParameter(34964),n[t]=P.createBuffer(),P.bindBuffer(34962,n[t]),P.bufferData(34962,1<<e,35048),P.bindBuffer(34962,r),n[t])},getTempIndexBuffer:function(e){var e=C.log2ceilLookup(e),n=C.currentContext.tempIndexBuffers[e];return n||(n=P.getParameter(34965),C.currentContext.tempIndexBuffers[e]=P.createBuffer(),P.bindBuffer(34963,C.currentContext.tempIndexBuffers[e]),P.bufferData(34963,1<<e,35048),P.bindBuffer(34963,n),C.currentContext.tempIndexBuffers[e])},newRenderingFrameStarted:function(){if(C.currentContext)for(var e=C.currentContext.tempVertexBuffers1,n=(C.currentContext.tempVertexBuffers1=C.currentContext.tempVertexBuffers2,C.currentContext.tempVertexBuffers2=e,e=C.currentContext.tempVertexBufferCounters1,C.currentContext.tempVertexBufferCounters1=C.currentContext.tempVertexBufferCounters2,C.currentContext.tempVertexBufferCounters2=e,C.log2ceilLookup(C.MAX_TEMP_BUFFER_SIZE)),t=0;t<=n;++t)C.currentContext.tempVertexBufferCounters1[t]=0},getSource:function(e,n,t,r){for(var a="",o=0;o<n;++o){var i=r?p[r+4*o>>2]:-1;a+=x(p[t+4*o>>2],i<0?void 0:i)}return a},calcBufLength:function(e,n,t,r){return 0<t?r*t:e*C.byteSizeByType[n-C.byteSizeByTypeRoot]*r},usedTempBuffers:[],preDrawHandleClientVertexAttribBindings:function(e){C.resetBufferBinding=!1;for(var n=0;n<C.currentContext.maxVertexAttribs;++n){var t,r,a=C.currentContext.clientBuffers[n];a.clientside&&a.enabled&&(C.resetBufferBinding=!0,t=C.calcBufLength(a.size,a.type,a.stride,e),r=C.getTempVertexBuffer(t),P.bindBuffer(34962,r),P.bufferSubData(34962,0,m.subarray(a.ptr,a.ptr+t)),a.vertexAttribPointerAdaptor.call(P,n,a.size,a.type,a.normalized,a.stride,0))}},postDrawHandleClientVertexAttribBindings:function(){C.resetBufferBinding&&P.bindBuffer(34962,C.buffers[P.currentArrayBufferBinding])},createContext:function(t,e){t.getContextSafariWebGL2Fixed||(t.getContextSafariWebGL2Fixed=t.getContext,t.getContext=function(e,n){return n=t.getContextSafariWebGL2Fixed(e,n),"webgl"==e==n instanceof WebGLRenderingContext?n:null});var n=1<e.majorVersion?t.getContext("webgl2",e):t.getContext("webgl",e);return n?C.registerContext(n,e):0},registerContext:function(e,n){var t=C.getNewId(C.contexts),r={handle:t,attributes:n,version:n.majorVersion,GLctx:e};e.canvas&&(e.canvas.GLctxObject=r),C.contexts[t]=r,void 0!==n.enableExtensionsByDefault&&!n.enableExtensionsByDefault||C.initExtensions(r),r.maxVertexAttribs=r.GLctx.getParameter(34921),r.clientBuffers=[];for(var a=0;a<r.maxVertexAttribs;a++)r.clientBuffers[a]={enabled:!1,clientside:!1,size:0,type:0,normalized:0,stride:0,ptr:0,vertexAttribPointerAdaptor:null};return C.generateTempBuffers(!1,r),t},makeContextCurrent:function(e){return C.currentContext=C.contexts[e],v.ctx=P=C.currentContext&&C.currentContext.GLctx,!(e&&!P)},getContext:function(e){return C.contexts[e]},deleteContext:function(e){C.currentContext===C.contexts[e]&&(C.currentContext=null),"object"==typeof JSEvents&&JSEvents.removeAllHandlersOnTarget(C.contexts[e].GLctx.canvas),C.contexts[e]&&C.contexts[e].GLctx.canvas&&(C.contexts[e].GLctx.canvas.GLctxObject=void 0),C.contexts[e]=null},initExtensions:function(e){var n,o,t,r,a;(e=e||C.currentContext).initExtensionsDone||(e.initExtensionsDone=!0,n=e.GLctx,(o=(r=n).getExtension("ANGLE_instanced_arrays"))&&(r.vertexAttribDivisor=function(e,n){o.vertexAttribDivisorANGLE(e,n)},r.drawArraysInstanced=function(e,n,t,r){o.drawArraysInstancedANGLE(e,n,t,r)},r.drawElementsInstanced=function(e,n,t,r,a){o.drawElementsInstancedANGLE(e,n,t,r,a)}),(t=(r=n).getExtension("OES_vertex_array_object"))&&(r.createVertexArray=function(){return t.createVertexArrayOES()},r.deleteVertexArray=function(e){t.deleteVertexArrayOES(e)},r.bindVertexArray=function(e){t.bindVertexArrayOES(e)},r.isVertexArray=function(e){return t.isVertexArrayOES(e)}),(a=(r=n).getExtension("WEBGL_draw_buffers"))&&(r.drawBuffers=function(e,n){a.drawBuffersWEBGL(e,n)}),n.dibvbi=n.getExtension("WEBGL_draw_instanced_base_vertex_base_instance"),n.mdibvbi=n.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance"),2<=e.version&&(n.disjointTimerQueryExt=n.getExtension("EXT_disjoint_timer_query_webgl2")),(e.version<2||!n.disjointTimerQueryExt)&&(n.disjointTimerQueryExt=n.getExtension("EXT_disjoint_timer_query")),n.multiDrawWebgl=n.getExtension("WEBGL_multi_draw"),(n.getSupportedExtensions()||[]).forEach(function(e){e.includes("lose_context")||e.includes("debug")||n.getExtension(e)}))}};function ve(e,n,t,r){for(var a=0;a<e;a++){var o=P[t](),i=o&&C.getNewId(r);o?r[o.name=i]=o:C.recordError(1282),p[n+4*a>>2]=i}}function ge(n,e,t){if(e){var r,a,o=void 0;switch(n){case 36346:o=1;break;case 36344:return void(0!=t&&1!=t&&C.recordError(1280));case 34814:case 36345:o=0;break;case 34466:var i=P.getParameter(34467),o=i?i.length:0;break;case 33309:if(C.currentContext.version<2)return void C.recordError(1282);o=2*(P.getSupportedExtensions()||[]).length;break;case 33307:case 33308:if(C.currentContext.version<2)return void C.recordError(1280);o=33307==n?3:0}if(void 0===o){var u=P.getParameter(n);switch(typeof u){case"number":o=u;break;case"boolean":o=u?1:0;break;case"string":return void C.recordError(1280);case"object":if(null===u)switch(n){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 36662:case 36663:case 35053:case 35055:case 36010:case 35097:case 35869:case 32874:case 36389:case 35983:case 35368:case 34068:o=0;break;default:return void C.recordError(1280)}else{if(u instanceof Float32Array||u instanceof Uint32Array||u instanceof Int32Array||u instanceof Array){for(var s=0;s<u.length;++s)switch(t){case 0:p[e+4*s>>2]=u[s];break;case 2:b[e+4*s>>2]=u[s];break;case 4:d[e+s>>0]=u[s]?1:0}return}try{o=0|u.name}catch(e){return C.recordError(1280),void l("GL_INVALID_ENUM in glGet"+t+"v: Unknown object returned from WebGL getParameter("+n+")! (error: "+e+")")}}break;default:return C.recordError(1280),void l("GL_INVALID_ENUM in glGet"+t+"v: Native code calling glGet"+t+"v("+n+") and it returns "+u+" of type "+typeof u+"!")}}switch(t){case 1:a=o,w[(r=e)>>2]=a,w[r+4>>2]=(a-w[r>>2])/4294967296;break;case 0:p[e>>2]=o;break;case 2:b[e>>2]=o;break;case 4:d[e>>0]=o?1:0}}else C.recordError(1281)}function he(e){return"]"==e.slice(-1)&&e.lastIndexOf("[")}function A(e){return 0==(e-=5120)?d:1==e?m:2==e?Y:4==e?p:6==e?b:5==e||28922==e||28520==e||30779==e||30782==e?w:X}function S(e){return 31-Math.clz32(e.BYTES_PER_ELEMENT)}function pe(e,n,t,r,a){var o,e=A(e),i=S(e);return o=C.unpackAlignment,e.subarray(a>>i,a+r*(t*(({5:3,6:4,8:2,29502:3,29504:4,26917:2,26918:2,29846:3,29847:4}[n-6402]||1)*(1<<i))+o-1&-o)>>i)}function M(e,n){var t,r;D.mainLoop.timingMode=e,D.mainLoop.timingValue=n,D.mainLoop.func&&(D.mainLoop.running||(D.mainLoop.running=!0),0==e?(D.mainLoop.scheduler=function(){var e=0|Math.max(0,D.mainLoop.tickStartTime+n-be());setTimeout(D.mainLoop.runner,e)},D.mainLoop.method="timeout"):1==e?(D.mainLoop.scheduler=function(){D.requestAnimationFrame(D.mainLoop.runner)},D.mainLoop.method="rAF"):2==e&&(void 0===T&&(t=[],r="setimmediate",addEventListener("message",function(e){e.data!==r&&e.data.target!==r||(e.stopPropagation(),t.shift()())},!0),T=function(e){t.push(e),o?(void 0===v.setImmediates&&(v.setImmediates=[]),v.setImmediates.push(e),postMessage({target:r})):postMessage(r,"*")}),D.mainLoop.scheduler=function(){T(D.mainLoop.runner)},D.mainLoop.method="immediate"))}function I(e,n){if(!f)if(n)e();else try{e()}catch(e){fe(e)}}function we(e,n){return setTimeout(function(){I(e)},n)}var be=()=>performance.now(),D={mainLoop:{running:!1,scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause:function(){D.mainLoop.scheduler=null,D.mainLoop.currentlyRunningMainloop++},resume:function(){D.mainLoop.currentlyRunningMainloop++;var e=D.mainLoop.timingMode,n=D.mainLoop.timingValue,t=D.mainLoop.func,a=(D.mainLoop.func=null,t),t=0,r=!1,o=D.mainLoop.arg,i=!0,u=(q(!D.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),D.mainLoop.func=a,D.mainLoop.arg=o,D.mainLoop.currentlyRunningMainloop);function s(){return!(u<D.mainLoop.currentlyRunningMainloop)}if(D.mainLoop.running=!1,D.mainLoop.runner=function(){var e,n,t,r;if(!f)return 0<D.mainLoop.queue.length?(e=Date.now(),(n=D.mainLoop.queue.shift()).func(n.arg),D.mainLoop.remainingBlockers&&(r=(t=D.mainLoop.remainingBlockers)%1==0?t-1:Math.floor(t),n.counted?D.mainLoop.remainingBlockers=r:D.mainLoop.remainingBlockers=(8*t+(r+=.5))/9),c('main loop blocker "'+n.name+'" took '+(Date.now()-e)+" ms"),D.mainLoop.updateStatus(),s()?void setTimeout(D.mainLoop.runner,0):void 0):void(s()&&(D.mainLoop.currentFrameNumber=D.mainLoop.currentFrameNumber+1|0,1==D.mainLoop.timingMode&&1<D.mainLoop.timingValue&&D.mainLoop.currentFrameNumber%D.mainLoop.timingValue!=0?D.mainLoop.scheduler():(0==D.mainLoop.timingMode&&(D.mainLoop.tickStartTime=be()),C.newRenderingFrameStarted(),D.mainLoop.runIter(a),s()&&("object"==typeof SDL&&SDL.audio&&SDL.audio.queueNewAudioData&&SDL.audio.queueNewAudioData(),D.mainLoop.scheduler()))))},i||(t&&0<t?M(0,1e3/t):M(1,1),D.mainLoop.scheduler()),r)throw"unwind";M(e,n),D.mainLoop.scheduler()},updateStatus:function(){var e,n,t;v.setStatus&&(e=v.statusMessage||"Please wait...",n=D.mainLoop.remainingBlockers,t=D.mainLoop.expectedBlockers,n?n<t?v.setStatus(e+" ("+(t-n)+"/"+t+")"):v.setStatus(e):v.setStatus(""))},runIter:function(e){if(!f){if(v.preMainLoop)if(!1===v.preMainLoop())return;I(e),v.postMainLoop&&v.postMainLoop()}}},isFullscreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init:function(){if(v.preloadPlugins||(v.preloadPlugins=[]),!D.initted){D.initted=!0;try{new Blob,D.hasBlobConstructor=!0}catch(e){D.hasBlobConstructor=!1,c("warning: no blob constructor, cannot create blobs with mimetypes")}D.BlobBuilder="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:D.hasBlobConstructor?null:c("warning: no BlobBuilder"),D.URLObject="undefined"!=typeof window?window.URL||window.webkitURL:void 0,v.noImageDecoding||void 0!==D.URLObject||(c("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),v.noImageDecoding=!0);var e={canHandle:function(e){return!v.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(e)},handle:function(n,t,r,a){var e,o=null;if(D.hasBlobConstructor)try{(o=new Blob([n],{type:D.getMimetype(t)})).size!==n.length&&(o=new Blob([new Uint8Array(n).buffer],{type:D.getMimetype(t)}))}catch(e){s("Blob constructor present but fails: "+e+"; falling back to blob builder")}o||((e=new D.BlobBuilder).append(new Uint8Array(n).buffer),o=e.getBlob());var i=D.URLObject.createObjectURL(o),u=new Image;u.onload=()=>{q(u.complete,"Image "+t+" could not be decoded");var e=document.createElement("canvas");e.width=u.width,e.height=u.height,e.getContext("2d").drawImage(u,0,0),v.preloadedImages[t]=e,D.URLObject.revokeObjectURL(i),r&&r(n)},u.onerror=e=>{c("Image "+i+" could not be decoded"),a&&a()},u.src=i}},e=(v.preloadPlugins.push(e),{canHandle:function(e){return!v.noAudioDecoding&&e.substr(-4)in{".ogg":1,".wav":1,".mp3":1}}}),e=(e.handle=function(n,t,r,e){var a=!1;function o(e){a||(a=!0,v.preloadedAudios[t]=e,r&&r(n))}function i(){a||(a=!0,v.preloadedAudios[t]=new Audio,e&&e())}if(!D.hasBlobConstructor)return i();try{var u=new Blob([n],{type:D.getMimetype(t)})}catch(e){return i()}var u=D.URLObject.createObjectURL(u),s=new Audio;s.addEventListener("canplaythrough",function(){o(s)},!1),s.onerror=function(e){a||(c("warning: browser could not fully decode audio "+t+", trying slower base64 approach"),s.src="data:audio/x-"+t.substr(-3)+";base64,"+function(e){for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t="",r=0,a=0,o=0;o<e.length;o++)for(r=r<<8|e[o],a+=8;6<=a;){var i=r>>a-6&63;a-=6,t+=n[i]}return 2==a?t=t+n[(3&r)<<4]+"==":4==a&&(t=t+n[(15&r)<<2]+"="),t}(n),o(s))},s.src=u,we(function(){o(s)},1e4)},v.preloadPlugins.push(e),v.canvas);e&&(e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock||e.msRequestPointerLock||function(){},e.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},e.exitPointerLock=e.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",n,!1),document.addEventListener("mozpointerlockchange",n,!1),document.addEventListener("webkitpointerlockchange",n,!1),document.addEventListener("mspointerlockchange",n,!1),v.elementPointerLock&&e.addEventListener("click",function(e){!D.pointerLock&&v.canvas.requestPointerLock&&(v.canvas.requestPointerLock(),e.preventDefault())},!1))}function n(){D.pointerLock=document.pointerLockElement===v.canvas||document.mozPointerLockElement===v.canvas||document.webkitPointerLockElement===v.canvas||document.msPointerLockElement===v.canvas}},handledByPreloadPlugin:function(n,t,r,a){D.init();var o=!1;return v.preloadPlugins.forEach(function(e){o||e.canHandle(t)&&(e.handle(n,t,r,a),o=!0)}),o},createContext:function(e,n,t,r){if(n&&v.ctx&&e==v.canvas)return v.ctx;var a,o;if(n){var i={antialias:!1,alpha:!1,majorVersion:"undefined"!=typeof WebGL2RenderingContext?2:1};if(r)for(var u in r)i[u]=r[u];void 0!==C&&(o=C.createContext(e,i))&&(a=C.getContext(o).GLctx)}else a=e.getContext("2d");return a?(t&&(n||q(void 0===P,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),v.ctx=a,n&&C.makeContextCurrent(o),v.useWebGL=n,D.moduleContextCreatedCallbacks.forEach(function(e){e()}),D.init()),a):null},destroyContext:function(e,n,t){},fullscreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullscreen:function(e,n){D.lockPointer=e,D.resizeCanvas=n,void 0===D.lockPointer&&(D.lockPointer=!0),void 0===D.resizeCanvas&&(D.resizeCanvas=!1);var t=v.canvas;function r(){D.isFullscreen=!1;var e=t.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e?(t.exitFullscreen=D.exitFullscreen,D.lockPointer&&t.requestPointerLock(),D.isFullscreen=!0,D.resizeCanvas?D.setFullscreenCanvasSize():D.updateCanvasDimensions(t)):(e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e),D.resizeCanvas?D.setWindowedCanvasSize():D.updateCanvasDimensions(t)),v.onFullScreen&&v.onFullScreen(D.isFullscreen),v.onFullscreen&&v.onFullscreen(D.isFullscreen)}D.fullscreenHandlersInstalled||(D.fullscreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",r,!1),document.addEventListener("mozfullscreenchange",r,!1),document.addEventListener("webkitfullscreenchange",r,!1),document.addEventListener("MSFullscreenChange",r,!1));var a=document.createElement("div");t.parentNode.insertBefore(a,t),a.appendChild(t),a.requestFullscreen=a.requestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||(a.webkitRequestFullscreen?function(){a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}:null)||(a.webkitRequestFullScreen?function(){a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),a.requestFullscreen()},exitFullscreen:function(){return!!D.isFullscreen&&((document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||function(){}).apply(document,[]),!0)},nextRAF:0,fakeRequestAnimationFrame:function(e){var n=Date.now();if(0===D.nextRAF)D.nextRAF=n+1e3/60;else for(;n+2>=D.nextRAF;)D.nextRAF+=1e3/60;var t=Math.max(D.nextRAF-n,0);setTimeout(e,t)},requestAnimationFrame:function(e){("function"==typeof requestAnimationFrame?requestAnimationFrame:D.fakeRequestAnimationFrame)(e)},safeSetTimeout:function(e){return we(e)},safeRequestAnimationFrame:function(e){return D.requestAnimationFrame(function(){I(e)})},getMimetype:function(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]},getUserMedia:function(e){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(e)},getMovementX:function(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY:function(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},getMouseWheelDelta:function(e){var n=0;switch(e.type){case"DOMMouseScroll":n=e.detail/3;break;case"mousewheel":n=e.wheelDelta/120;break;case"wheel":switch(n=e.deltaY,e.deltaMode){case 0:n/=100;break;case 1:n/=3;break;case 2:n*=80;break;default:throw"unrecognized mouse wheel delta mode: "+e.deltaMode}break;default:throw"unrecognized mouse wheel event: "+e.type}return n},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseEvent:function(e){if(D.pointerLock)"mousemove"!=e.type&&"mozMovementX"in e?D.mouseMovementX=D.mouseMovementY=0:(D.mouseMovementX=D.getMovementX(e),D.mouseMovementY=D.getMovementY(e)),"undefined"!=typeof SDL?(D.mouseX=SDL.mouseX+D.mouseMovementX,D.mouseY=SDL.mouseY+D.mouseMovementY):(D.mouseX+=D.mouseMovementX,D.mouseY+=D.mouseMovementY);else{var n,t=v.canvas.getBoundingClientRect(),r=v.canvas.width,a=v.canvas.height,o=void 0!==window.scrollX?window.scrollX:window.pageXOffset,i=void 0!==window.scrollY?window.scrollY:window.pageYOffset;if("touchstart"===e.type||"touchend"===e.type||"touchmove"===e.type)return void 0===(s=e.touch)?void 0:(n=s.pageX-(o+t.left),u=s.pageY-(i+t.top),n={x:n*=r/t.width,y:u*=a/t.height},void("touchstart"===e.type?(D.lastTouches[s.identifier]=n,D.touches[s.identifier]=n):"touchend"!==e.type&&"touchmove"!==e.type||(u=(u=D.touches[s.identifier])||n,D.lastTouches[s.identifier]=u,D.touches[s.identifier]=n)));var u=e.pageX-(o+t.left),s=e.pageY-(i+t.top);u*=r/t.width,s*=a/t.height,D.mouseMovementX=u-D.mouseX,D.mouseMovementY=s-D.mouseY,D.mouseX=u,D.mouseY=s}},resizeListeners:[],updateResizeListeners:function(){var n=v.canvas;D.resizeListeners.forEach(function(e){e(n.width,n.height)})},setCanvasSize:function(e,n,t){var r=v.canvas;D.updateCanvasDimensions(r,e,n),t||D.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize:function(){var e;"undefined"!=typeof SDL&&(e=w[SDL.screen>>2],p[SDL.screen>>2]=e|=8388608),D.updateCanvasDimensions(v.canvas),D.updateResizeListeners()},setWindowedCanvasSize:function(){var e;"undefined"!=typeof SDL&&(e=w[SDL.screen>>2],p[SDL.screen>>2]=e&=-8388609),D.updateCanvasDimensions(v.canvas),D.updateResizeListeners()},updateCanvasDimensions:function(e,n,t){n&&t?(e.widthNative=n,e.heightNative=t):(n=e.widthNative,t=e.heightNative);var r,a=n,o=t;v.forcedAspectRatio&&0<v.forcedAspectRatio&&(a/o<v.forcedAspectRatio?a=Math.round(o*v.forcedAspectRatio):o=Math.round(a/v.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&"undefined"!=typeof screen&&(r=Math.min(screen.width/a,screen.height/o),a=Math.round(a*r),o=Math.round(o*r)),D.resizeCanvas?(e.width!=a&&(e.width=a),e.height!=o&&(e.height=o),void 0!==e.style&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=n&&(e.width=n),e.height!=t&&(e.height=t),void 0!==e.style&&(a!=n||o!=t?(e.style.setProperty("width",a+"px","important"),e.style.setProperty("height",o+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))}};function xe(e,n,t,r,a,o){this.id=e,this.x=0,this.y=0,this.fullscreen=!1,this.storedX=0,this.storedY=0,this.width=n,this.height=t,this.storedWidth=n,this.storedHeight=t,this.title=r,this.monitor=a,this.share=o,this.attributes=_.hints,this.inputModes={208897:212993,208898:0,208899:0},this.buttons=0,this.keys=new Array,this.domKeys=new Array,this.shouldClose=0,this.title=null,this.windowPosFunc=null,this.windowSizeFunc=null,this.windowCloseFunc=null,this.windowRefreshFunc=null,this.windowFocusFunc=null,this.windowIconifyFunc=null,this.framebufferSizeFunc=null,this.mouseButtonFunc=null,this.cursorPosFunc=null,this.cursorEnterFunc=null,this.scrollFunc=null,this.dropFunc=null,this.keyFunc=null,this.charFunc=null,this.userptr=null}var P,_={WindowFromId:function(e){return e<=0||!_.windows?null:_.windows[e-1]},joystickFunc:null,errorFunc:null,monitorFunc:null,active:null,windows:null,monitors:null,monitorString:null,versionString:null,initialTime:null,extensions:null,hints:null,defaultHints:{131073:0,131074:0,131075:1,131076:1,131077:1,135169:8,135170:8,135171:8,135172:8,135173:24,135174:8,135175:0,135176:0,135177:0,135178:0,135179:0,135180:0,135181:0,135182:0,135183:0,139265:196609,139266:1,139267:0,139268:0,139269:0,139270:0,139271:0,139272:0},DOMToGLFWKeyCode:function(e){switch(e){case 32:return 32;case 222:return 39;case 188:return 44;case 173:case 189:return 45;case 190:return 46;case 191:return 47;case 48:return 48;case 49:return 49;case 50:return 50;case 51:return 51;case 52:return 52;case 53:return 53;case 54:return 54;case 55:return 55;case 56:return 56;case 57:return 57;case 59:return 59;case 61:case 187:return 61;case 65:return 65;case 66:return 66;case 67:return 67;case 68:return 68;case 69:return 69;case 70:return 70;case 71:return 71;case 72:return 72;case 73:return 73;case 74:return 74;case 75:return 75;case 76:return 76;case 77:return 77;case 78:return 78;case 79:return 79;case 80:return 80;case 81:return 81;case 82:return 82;case 83:return 83;case 84:return 84;case 85:return 85;case 86:return 86;case 87:return 87;case 88:return 88;case 89:return 89;case 90:return 90;case 219:return 91;case 220:return 92;case 221:return 93;case 192:return 96;case 27:return 256;case 13:return 257;case 9:return 258;case 8:return 259;case 45:return 260;case 46:return 261;case 39:return 262;case 37:return 263;case 40:return 264;case 38:return 265;case 33:return 266;case 34:return 267;case 36:return 268;case 35:return 269;case 20:return 280;case 145:return 281;case 144:return 282;case 44:return 283;case 19:return 284;case 112:return 290;case 113:return 291;case 114:return 292;case 115:return 293;case 116:return 294;case 117:return 295;case 118:return 296;case 119:return 297;case 120:return 298;case 121:return 299;case 122:return 300;case 123:return 301;case 124:return 302;case 125:return 303;case 126:return 304;case 127:return 305;case 128:return 306;case 129:return 307;case 130:return 308;case 131:return 309;case 132:return 310;case 133:return 311;case 134:return 312;case 135:return 313;case 136:return 314;case 96:return 320;case 97:return 321;case 98:return 322;case 99:return 323;case 100:return 324;case 101:return 325;case 102:return 326;case 103:return 327;case 104:return 328;case 105:return 329;case 110:return 330;case 111:return 331;case 106:return 332;case 109:return 333;case 107:return 334;case 16:return 340;case 17:return 341;case 18:return 342;case 91:return 343;case 93:return 348;default:return-1}},getModBits:function(e){var n=0;return e.keys[340]&&(n|=1),e.keys[341]&&(n|=2),e.keys[342]&&(n|=4),e.keys[343]&&(n|=8),n},onKeyPress:function(e){_.active&&_.active.charFunc&&(e.ctrlKey||e.metaKey||(0==(e=e.charCode)||0<=e&&e<=31||E(_.active.charFunc)(_.active.id,e)))},onKeyChanged:function(e,n){var t,r;!_.active||-1!=(t=_.DOMToGLFWKeyCode(e))&&(r=n&&_.active.keys[t],_.active.keys[t]=n,_.active.domKeys[e]=n,_.active.keyFunc&&(r&&(n=2),E(_.active.keyFunc)(_.active.id,t,e,n,_.getModBits(_.active))))},onGamepadConnected:function(e){_.refreshJoysticks()},onGamepadDisconnected:function(e){_.refreshJoysticks()},onKeydown:function(e){_.onKeyChanged(e.keyCode,1)},onKeyup:function(e){_.onKeyChanged(e.keyCode,0)},onBlur:function(e){if(_.active)for(var n=0;n<_.active.domKeys.length;++n)_.active.domKeys[n]&&_.onKeyChanged(n,0)},onMousemove:function(e){_.active&&(D.calculateMouseEvent(e),e.target==v.canvas&&_.active.cursorPosFunc&&E(_.active.cursorPosFunc)(_.active.id,D.mouseX,D.mouseY))},DOMToGLFWMouseButton:function(e){e=e.button;return e=0<e?1==e?2:1:e},onMouseenter:function(e){_.active&&e.target==v.canvas&&_.active.cursorEnterFunc&&E(_.active.cursorEnterFunc)(_.active.id,1)},onMouseleave:function(e){_.active&&e.target==v.canvas&&_.active.cursorEnterFunc&&E(_.active.cursorEnterFunc)(_.active.id,0)},onMouseButtonChanged:function(e,n){if(_.active&&(D.calculateMouseEvent(e),e.target==v.canvas)){var t=_.DOMToGLFWMouseButton(e);if(1==n){_.active.buttons|=1<<t;try{e.target.setCapture()}catch(e){}}else _.active.buttons&=~(1<<t);_.active.mouseButtonFunc&&E(_.active.mouseButtonFunc)(_.active.id,t,n,_.getModBits(_.active))}},onMouseButtonDown:function(e){_.active&&_.onMouseButtonChanged(e,1)},onMouseButtonUp:function(e){_.active&&_.onMouseButtonChanged(e,0)},onMouseWheel:function(e){var n,t=0==(t=-D.getMouseWheelDelta(e))?0:0<t?Math.max(t,1):Math.min(t,-1);_.wheelPos+=t,_.active&&_.active.scrollFunc&&e.target==v.canvas&&(n=0,t=t,n="mousewheel"==e.type?e.wheelDeltaX:e.deltaX,E(_.active.scrollFunc)(_.active.id,n,t),e.preventDefault())},onCanvasResize:function(e,n){var t;_.active&&(t=!0,document.fullscreen||document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen?(_.active.storedX=_.active.x,_.active.storedY=_.active.y,_.active.storedWidth=_.active.width,_.active.storedHeight=_.active.height,_.active.x=_.active.y=0,_.active.width=screen.width,_.active.height=screen.height,_.active.fullscreen=!0):1==_.active.fullscreen?(_.active.x=_.active.storedX,_.active.y=_.active.storedY,_.active.width=_.active.storedWidth,_.active.height=_.active.storedHeight,_.active.fullscreen=!1):_.active.width!=e||_.active.height!=n?(_.active.width=e,_.active.height=n):t=!1,t&&(D.setCanvasSize(_.active.width,_.active.height,!0),_.onWindowSizeChanged(),_.onFramebufferSizeChanged()))},onWindowSizeChanged:function(){_.active&&_.active.windowSizeFunc&&I(function(){E(_.active.windowSizeFunc)(_.active.id,_.active.width,_.active.height)})},onFramebufferSizeChanged:function(){_.active&&_.active.framebufferSizeFunc&&I(function(){E(_.active.framebufferSizeFunc)(_.active.id,_.active.width,_.active.height)})},getTime:function(){return be()/1e3},setWindowTitle:function(e,n){e=_.WindowFromId(e);e&&(e.title=x(n),_.active.id==e.id&&(document.title=e.title))},setJoystickCallback:function(e){_.joystickFunc=e,_.refreshJoysticks()},joys:{},lastGamepadState:[],lastGamepadStateFrame:null,refreshJoysticks:function(){if(D.mainLoop.currentFrameNumber!==_.lastGamepadStateFrame||!D.mainLoop.currentFrameNumber){_.lastGamepadState=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads||[],_.lastGamepadStateFrame=D.mainLoop.currentFrameNumber;for(var e=0;e<_.lastGamepadState.length;++e){var n=_.lastGamepadState[e];if(n){_.joys[e]||(c("glfw joystick connected:",e),_.joys[e]={id:$(n.id),buttonsCount:n.buttons.length,axesCount:n.axes.length,buttons:U(n.buttons.length),axes:U(4*n.axes.length)},_.joystickFunc&&E(_.joystickFunc)(e,262145));for(var t=_.joys[e],r=0;r<n.buttons.length;++r)u(t.buttons+r,n.buttons[r].pressed,"i8");for(r=0;r<n.axes.length;++r)u(t.axes+4*r,n.axes[r],"float")}else _.joys[e]&&(c("glfw joystick disconnected",e),_.joystickFunc&&E(_.joystickFunc)(e,262146),R(_.joys[e].id),R(_.joys[e].buttons),R(_.joys[e].axes),delete _.joys[e])}}},setKeyCallback:function(e,n){var t,e=_.WindowFromId(e);return e?(t=e.keyFunc,e.keyFunc=n,t):null},setCharCallback:function(e,n){var t,e=_.WindowFromId(e);return e?(t=e.charFunc,e.charFunc=n,t):null},setMouseButtonCallback:function(e,n){var t,e=_.WindowFromId(e);return e?(t=e.mouseButtonFunc,e.mouseButtonFunc=n,t):null},setCursorPosCallback:function(e,n){var t,e=_.WindowFromId(e);return e?(t=e.cursorPosFunc,e.cursorPosFunc=n,t):null},setScrollCallback:function(e,n){var t,e=_.WindowFromId(e);return e?(t=e.scrollFunc,e.scrollFunc=n,t):null},setDropCallback:function(e,n){var t,e=_.WindowFromId(e);return e?(t=e.dropFunc,e.dropFunc=n,t):null},onDrop:function(e){if(_.active&&_.active.dropFunc&&e.dataTransfer&&e.dataTransfer.files&&0!=e.dataTransfer.files.length)return e.preventDefault(),!1},onDragover:function(e){if(_.active&&_.active.dropFunc)return e.preventDefault(),!1},setWindowSizeCallback:function(e,n){var t,e=_.WindowFromId(e);return e?(t=e.windowSizeFunc,e.windowSizeFunc=n,t):null},setWindowCloseCallback:function(e,n){var t,e=_.WindowFromId(e);return e?(t=e.windowCloseFunc,e.windowCloseFunc=n,t):null},setWindowRefreshCallback:function(e,n){var t,e=_.WindowFromId(e);return e?(t=e.windowRefreshFunc,e.windowRefreshFunc=n,t):null},onClickRequestPointerLock:function(e){!D.pointerLock&&v.canvas.requestPointerLock&&(v.canvas.requestPointerLock(),e.preventDefault())},setInputMode:function(e,n,t){var r=_.WindowFromId(e);if(r)switch(n){case 208897:switch(t){case 212993:r.inputModes[n]=t,v.canvas.removeEventListener("click",_.onClickRequestPointerLock,!0),v.canvas.exitPointerLock();break;case 212994:c("glfwSetInputMode called with GLFW_CURSOR_HIDDEN value not implemented.");break;case 212995:r.inputModes[n]=t,v.canvas.addEventListener("click",_.onClickRequestPointerLock,!0),v.canvas.requestPointerLock();break;default:c("glfwSetInputMode called with unknown value parameter value: "+t+".")}break;case 208898:c("glfwSetInputMode called with GLFW_STICKY_KEYS mode not implemented.");break;case 208899:c("glfwSetInputMode called with GLFW_STICKY_MOUSE_BUTTONS mode not implemented.");break;default:c("glfwSetInputMode called with unknown mode parameter value: "+n+".")}},getKey:function(e,n){e=_.WindowFromId(e);return e?e.keys[n]:0},getMouseButton:function(e,n){e=_.WindowFromId(e);return e?0<(e.buttons&1<<n):0},getCursorPos:function(e,n,t){u(n,D.mouseX,"double"),u(t,D.mouseY,"double")},getMousePos:function(e,n,t){u(n,D.mouseX,"i32"),u(t,D.mouseY,"i32")},setCursorPos:function(e,n,t){},getWindowPos:function(e,n,t){var r=0,a=0,e=_.WindowFromId(e);e&&(r=e.x,a=e.y),n&&u(n,r,"i32"),t&&u(t,a,"i32")},setWindowPos:function(e,n,t){e=_.WindowFromId(e);e&&(e.x=n,e.y=t)},getWindowSize:function(e,n,t){var r=0,a=0,e=_.WindowFromId(e);e&&(r=e.width,a=e.height),n&&u(n,r,"i32"),t&&u(t,a,"i32")},setWindowSize:function(e,n,t){e=_.WindowFromId(e);e&&(_.active.id==e.id&&(n==screen.width&&t==screen.height?D.requestFullscreen():(D.exitFullscreen(),D.setCanvasSize(n,t),e.width=n,e.height=t)),e.windowSizeFunc&&E(e.windowSizeFunc)(e.id,n,t))},createWindow:function(e,n,t,r,a){for(var o,i=0;i<_.windows.length&&null!==_.windows[i];i++);if(0<i)throw"glfwCreateWindow only supports one window at time currently";if(o=i+1,e<=0||n<=0)return 0;for(r?D.requestFullscreen():D.setCanvasSize(e,n),i=0;i<_.windows.length&&null==_.windows[i];i++);var u,s=0<_.hints[139265];return i==_.windows.length&&(s?(u={antialias:1<_.hints[135181],depth:0<_.hints[135173],stencil:0<_.hints[135174],alpha:0<_.hints[135172]},v.ctx=D.createContext(v.canvas,!0,!0,u)):D.init()),!v.ctx&&s?0:(u=new xe(o,e,n,t,r,a),o-1==_.windows.length?_.windows.push(u):_.windows[o-1]=u,(_.active=u).id)},destroyWindow:function(e){e=_.WindowFromId(e);if(e){e.windowCloseFunc&&E(e.windowCloseFunc)(e.id),_.windows[e.id-1]=null,_.active.id==e.id&&(_.active=null);for(var n=0;n<_.windows.length;n++)if(null!==_.windows[n])return;v.ctx=D.destroyContext(v.canvas,!0,!0)}},swapBuffers:function(e){},GLFW2ParamToGLFW3Param:function(e){return{196609:0,196610:0,196611:0,196612:0,196613:0,196614:0,131073:0,131074:0,131075:0,131076:0,131077:135169,131078:135170,131079:135171,131080:135172,131081:135173,131082:135174,131083:135183,131084:135175,131085:135176,131086:135177,131087:135178,131088:135179,131089:135180,131090:0,131091:135181,131092:139266,131093:139267,131094:139270,131095:139271,131096:139272}[e]}};v.requestFullscreen=function(e,n){D.requestFullscreen(e,n)},v.requestAnimationFrame=function(e){D.requestAnimationFrame(e)},v.setCanvasSize=function(e,n,t){D.setCanvasSize(e,n,t)},v.pauseMainLoop=function(){D.mainLoop.pause()},v.resumeMainLoop=function(){D.mainLoop.resume()},v.getUserMedia=function(){D.getUserMedia()},v.createContext=function(e,n,t,r){return D.createContext(e,n,t,r)};var ye,Be={c:function(){L("")},a:function(e,n,t){return n=function(e,n){for(de.length=0,n>>=2;t=m[e++];){var t=t<105;t&&1&n&&n++,de.push(t?K[n++>>1]:p[n]),++n}return de}(n,t),le[e].apply(null,n)},V:function(e,n,t){m.copyWithin(e,n,n+t)},U:function(e){var n=m.length,t=(e>>>=0,2147483648);if(!(t<e))for(var r,a=1;a<=4;a*=2){var o=n*(1+.2/a),o=Math.min(o,e+100663296);if(function(e){try{return N.grow(e-h.byteLength+65535>>>16),Z(N.buffer),1}catch(e){}}(Math.min(t,(o=Math.max(e,o))+((r=65536)-o%r)%r)))return!0}return!1},H:function(e){Ae(e)},F:function(e,n,t,r){for(var a=0,o=0;o<t;o++){var i=p[n>>2],u=p[n+4>>2];n+=8;for(var s=0;s<u;s++)me.printChar(e,m[i+s]);a+=u}return p[r>>2]=a,0},pa:function(e){P.activeTexture(e)},Q:function(e,n){P.attachShader(C.programs[e],C.shaders[n])},b:function(e,n){34962==e?P.currentArrayBufferBinding=n:34963==e&&(P.currentElementArrayBufferBinding=n),35051==e?P.currentPixelPackBufferBinding=n:35052==e&&(P.currentPixelUnpackBufferBinding=n),P.bindBuffer(e,C.buffers[n])},n:function(e,n,t){P.bindBufferBase(e,n,C.buffers[t])},v:function(e,n){P.bindFramebuffer(e,C.framebuffers[n])},s:function(e,n){P.bindTexture(e,C.textures[n])},i:function(e){P.bindVertexArray(C.vaos[e]),e=P.getParameter(34965),P.currentElementArrayBufferBinding=e?0|e.name:0},Aa:function(e,n){P.blendFunc(e,n)},za:function(e,n,t,r){P.blendFuncSeparate(e,n,t,r)},J:function(e,n,t,r,a,o,i,u,s,c){P.blitFramebuffer(e,n,t,r,a,o,i,u,s,c)},e:function(e,n,t,r){2<=C.currentContext.version?t?P.bufferData(e,m,r,t,n):P.bufferData(e,n,r):P.bufferData(e,t?m.subarray(t,t+n):n,r)},l:function(e,n,t,r){2<=C.currentContext.version?P.bufferSubData(e,n,m,r,t):P.bufferSubData(e,n,m.subarray(r,r+t))},da:function(e){P.clear(e)},ea:function(e,n,t,r){P.clearColor(e,n,t,r)},fa:function(e){P.clearDepth(e)},G:function(e,n,t,r){P.colorMask(!!e,!!n,!!t,!!r)},M:function(e){P.compileShader(C.shaders[e])},va:function(){var e=C.getNewId(C.programs),n=P.createProgram();return n.name=e,n.maxUniformLength=n.maxAttributeLength=n.maxUniformBlockNameLength=0,n.uniformIdCounter=1,C.programs[e]=n,e},O:function(e){var n=C.getNewId(C.shaders);return C.shaders[n]=P.createShader(e),n},ya:function(e){P.cullFace(e)},g:function(e,n){for(var t=0;t<e;t++){var r=p[n+4*t>>2],a=C.buffers[r];a&&(P.deleteBuffer(a),a.name=0,C.buffers[r]=null,r==P.currentArrayBufferBinding&&(P.currentArrayBufferBinding=0),r==P.currentElementArrayBufferBinding&&(P.currentElementArrayBufferBinding=0),r==P.currentPixelPackBufferBinding&&(P.currentPixelPackBufferBinding=0),r==P.currentPixelUnpackBufferBinding&&(P.currentPixelUnpackBufferBinding=0))}},z:function(e,n){for(var t=0;t<e;++t){var r=p[n+4*t>>2],a=C.framebuffers[r];a&&(P.deleteFramebuffer(a),a.name=0,C.framebuffers[r]=null)}},R:function(e){var n;e&&((n=C.programs[e])?(P.deleteProgram(n),n.name=0,C.programs[e]=null):C.recordError(1281))},r:function(e,n){for(var t=0;t<e;t++){var r=p[n+4*t>>2],a=C.renderbuffers[r];a&&(P.deleteRenderbuffer(a),a.name=0,C.renderbuffers[r]=null)}},E:function(e){var n;e&&((n=C.shaders[e])?(P.deleteShader(n),C.shaders[e]=null):C.recordError(1281))},j:function(e,n){for(var t=0;t<e;t++){var r=p[n+4*t>>2],a=C.textures[r];a&&(P.deleteTexture(a),a.name=0,C.textures[r]=null)}},B:function(e,n){for(var t=0;t<e;t++){var r=p[n+4*t>>2];P.deleteVertexArray(C.vaos[r]),C.vaos[r]=null}},xa:function(e){P.depthFunc(e)},T:function(e){P.depthMask(!!e)},A:function(e){P.disable(e)},ga:function(e,n,t){C.preDrawHandleClientVertexAttribBindings(n+t),P.drawArrays(e,n,t),C.postDrawHandleClientVertexAttribBindings()},ha:function(e,n,t,r){P.drawArraysInstanced(e,n,t,r)},ia:function(e,n,t,r){var a,o;P.currentElementArrayBufferBinding||(a=C.calcBufLength(1,t,0,n),o=C.getTempIndexBuffer(a),P.bindBuffer(34963,o),P.bufferSubData(34963,0,m.subarray(r,r+a)),r=0),C.preDrawHandleClientVertexAttribBindings(n),P.drawElements(e,n,t,r),C.postDrawHandleClientVertexAttribBindings(n),P.currentElementArrayBufferBinding||P.bindBuffer(34963,null)},ja:function(e,n,t,r,a){P.drawElementsInstanced(e,n,t,r,a)},w:function(e){P.enable(e)},la:function(e){C.currentContext.clientBuffers[e].enabled=!0,P.enableVertexAttribArray(e)},ca:function(){P.flush()},oa:function(e,n,t,r,a){P.framebufferTexture2D(e,n,t,C.textures[r],a)},na:function(e,n,t,r,a){P.framebufferTextureLayer(e,n,C.textures[t],r,a)},f:function(e,n){ve(e,n,"createBuffer",C.buffers)},y:function(e,n){ve(e,n,"createFramebuffer",C.framebuffers)},L:function(e,n){ve(e,n,"createTexture",C.textures)},ma:function(e,n){ve(e,n,"createVertexArray",C.vaos)},wa:function(e,n,t,r){var a=P.getAttachedShaders(C.programs[e]),o=a.length;p[t>>2]=o=n<o?n:o;for(var i=0;i<o;++i){var u=C.shaders.indexOf(a[i]);p[r+4*i>>2]=u}},q:function(e,n){return P.getAttribLocation(C.programs[e],x(n))},d:function(e,n){ge(e,n,0)},S:function(e,n,t){if(t)if(e>=C.counter)C.recordError(1281);else if(e=C.programs[e],35716==n){var r=P.getProgramInfoLog(e);p[t>>2]=(r=null===r?"(unknown error)":r).length+1}else if(35719==n){if(!e.maxUniformLength)for(var a=0;a<P.getProgramParameter(e,35718);++a)e.maxUniformLength=Math.max(e.maxUniformLength,P.getActiveUniform(e,a).name.length+1);p[t>>2]=e.maxUniformLength}else if(35722==n){if(!e.maxAttributeLength)for(a=0;a<P.getProgramParameter(e,35721);++a)e.maxAttributeLength=Math.max(e.maxAttributeLength,P.getActiveAttrib(e,a).name.length+1);p[t>>2]=e.maxAttributeLength}else if(35381==n){if(!e.maxUniformBlockNameLength)for(a=0;a<P.getProgramParameter(e,35382);++a)e.maxUniformBlockNameLength=Math.max(e.maxUniformBlockNameLength,P.getActiveUniformBlockName(e,a).length+1);p[t>>2]=e.maxUniformBlockNameLength}else p[t>>2]=P.getProgramParameter(e,n);else C.recordError(1281)},P:function(e,n,t){var r;t?35716==n?(r=(r=null===(r=P.getShaderInfoLog(C.shaders[e]))?"(unknown error)":r)?r.length+1:0,p[t>>2]=r):35720==n?(r=(r=P.getShaderSource(C.shaders[e]))?r.length+1:0,p[t>>2]=r):p[t>>2]=P.getShaderParameter(C.shaders[e],n):C.recordError(1281)},I:function(e,n,t){t?p[t>>2]=P.getTexParameter(e,n):C.recordError(1281)},o:function(e,n){return P.getUniformBlockIndex(C.programs[e],x(n))},k:function(e,n){if(n=x(n),e=C.programs[e]){var t,r,a=e,o=a.uniformLocsById,i=a.uniformSizeAndIdsByName;if(!o)for(a.uniformLocsById=o={},a.uniformArrayNamesById={},t=0;t<P.getProgramParameter(a,35718);++t){var u=P.getActiveUniform(a,t),s=u.name,c=u.size,u=he(s),l=0<u?s.slice(0,u):s,f=a.uniformIdCounter;for(a.uniformIdCounter+=c,i[l]=[c,f],r=0;r<c;++r)o[f]=r,a.uniformArrayNamesById[f++]=l}var d=e.uniformLocsById,m=0,v=n,g=he(n),h=(0<g&&(h=n.slice(g+1),m=parseInt(h)>>>0,v=n.slice(0,g)),e.uniformSizeAndIdsByName[v]);if(h&&m<h[0]&&(d[m+=h[1]]=d[m]||P.getUniformLocation(e,n)))return m}else C.recordError(1281);var h;return-1},h:function(e){return(e=C.buffers[e])?P.isBuffer(e):0},ua:function(e){e=C.programs[e],P.linkProgram(e),e.uniformLocsById=0,e.uniformSizeAndIdsByName={}},ta:function(e,n){3317==e&&(C.unpackAlignment=n),P.pixelStorei(e,n)},C:function(e,n,t,r){P.scissor(e,n,t,r)},N:function(e,n,t,r){n=C.getSource(e,n,t,r),P.shaderSource(C.shaders[e],n)},sa:function(e,n,t,r,a,o,i,u,s){var c;2<=C.currentContext.version?P.currentPixelUnpackBufferBinding?P.texImage2D(e,n,t,r,a,o,i,u,s):s?(c=A(u),P.texImage2D(e,n,t,r,a,o,i,u,c,s>>S(c))):P.texImage2D(e,n,t,r,a,o,i,u,null):P.texImage2D(e,n,t,r,a,o,i,u,s?pe(u,i,r,a,s):null)},ra:function(e,n,t,r,a,o,i,u,s,c){var l;P.currentPixelUnpackBufferBinding?P.texImage3D(e,n,t,r,a,o,i,u,s,c):c?(l=A(s),P.texImage3D(e,n,t,r,a,o,i,u,s,l,c>>S(l))):P.texImage3D(e,n,t,r,a,o,i,u,s,null)},m:function(e,n,t){P.texParameteri(e,n,t)},K:function(e,n,t,r,a,o,i,u,s){var c;2<=C.currentContext.version?P.currentPixelUnpackBufferBinding?P.texSubImage2D(e,n,t,r,a,o,i,u,s):s?(c=A(u),P.texSubImage2D(e,n,t,r,a,o,i,u,c,s>>S(c))):P.texSubImage2D(e,n,t,r,a,o,i,u,null):(c=null,s&&(c=pe(u,i,a,o,s)),P.texSubImage2D(e,n,t,r,a,o,i,u,c))},qa:function(e,n,t,r,a,o,i,u,s,c,l){var f;P.currentPixelUnpackBufferBinding?P.texSubImage3D(e,n,t,r,a,o,i,u,s,c,l):l?(f=A(c),P.texSubImage3D(e,n,t,r,a,o,i,u,s,c,f,l>>S(f))):P.texSubImage3D(e,n,t,r,a,o,i,u,s,c,null)},x:function(e,n){P.uniform1i(function(e){var n,t=P.currentProgram;if(t)return"number"==typeof(n=t.uniformLocsById[e])&&(t.uniformLocsById[e]=n=P.getUniformLocation(t,t.uniformArrayNamesById[e]+(0<n?"["+n+"]":""))),n;C.recordError(1282)}(e),n)},p:function(e,n,t){e=C.programs[e],P.uniformBlockBinding(e,n,t)},t:function(e){e=C.programs[e],P.useProgram(e),P.currentProgram=e},ka:function(e,n,t,r,a,o){var i=C.currentContext.clientBuffers[e];P.currentArrayBufferBinding?(i.clientside=!1,P.vertexAttribPointer(e,n,t,!!r,a,o)):(i.size=n,i.type=t,i.normalized=r,i.stride=a,i.ptr=o,i.clientside=!0,i.vertexAttribPointerAdaptor=function(e,n,t,r,a,o){this.vertexAttribPointer(e,n,t,r,a,o)})},D:function(e,n,t,r){P.viewport(e,n,t,r)},Z:function(e,n,t,r,a){return _.createWindow(e,n,t,r,a)},_:function(){return _.windows||(_.initialTime=_.getTime(),_.hints=_.defaultHints,_.windows=new Array,_.active=null,window.addEventListener("gamepadconnected",_.onGamepadConnected,!0),window.addEventListener("gamepaddisconnected",_.onGamepadDisconnected,!0),window.addEventListener("keydown",_.onKeydown,!0),window.addEventListener("keypress",_.onKeyPress,!0),window.addEventListener("keyup",_.onKeyup,!0),window.addEventListener("blur",_.onBlur,!0),v.canvas.addEventListener("touchmove",_.onMousemove,!0),v.canvas.addEventListener("touchstart",_.onMouseButtonDown,!0),v.canvas.addEventListener("touchcancel",_.onMouseButtonUp,!0),v.canvas.addEventListener("touchend",_.onMouseButtonUp,!0),v.canvas.addEventListener("mousemove",_.onMousemove,!0),v.canvas.addEventListener("mousedown",_.onMouseButtonDown,!0),v.canvas.addEventListener("mouseup",_.onMouseButtonUp,!0),v.canvas.addEventListener("wheel",_.onMouseWheel,!0),v.canvas.addEventListener("mousewheel",_.onMouseWheel,!0),v.canvas.addEventListener("mouseenter",_.onMouseenter,!0),v.canvas.addEventListener("mouseleave",_.onMouseleave,!0),v.canvas.addEventListener("drop",_.onDrop,!0),v.canvas.addEventListener("dragover",_.onDragover,!0),D.resizeListeners.push(function(e,n){_.onCanvasResize(e,n)})),1},X:function(e){},aa:function(){},$:function(e){var n=_.errorFunc;return _.errorFunc=e,n},ba:function(e){_.swapBuffers(e)},W:function(e){0==(e=Math.abs(e))?M(0,0):M(1,e)},Y:function(){window.removeEventListener("gamepadconnected",_.onGamepadConnected,!0),window.removeEventListener("gamepaddisconnected",_.onGamepadDisconnected,!0),window.removeEventListener("keydown",_.onKeydown,!0),window.removeEventListener("keypress",_.onKeyPress,!0),window.removeEventListener("keyup",_.onKeyup,!0),window.removeEventListener("blur",_.onBlur,!0),v.canvas.removeEventListener("touchmove",_.onMousemove,!0),v.canvas.removeEventListener("touchstart",_.onMouseButtonDown,!0),v.canvas.removeEventListener("touchcancel",_.onMouseButtonUp,!0),v.canvas.removeEventListener("touchend",_.onMouseButtonUp,!0),v.canvas.removeEventListener("mousemove",_.onMousemove,!0),v.canvas.removeEventListener("mousedown",_.onMouseButtonDown,!0),v.canvas.removeEventListener("mouseup",_.onMouseButtonUp,!0),v.canvas.removeEventListener("wheel",_.onMouseWheel,!0),v.canvas.removeEventListener("mousewheel",_.onMouseWheel,!0),v.canvas.removeEventListener("mouseenter",_.onMouseenter,!0),v.canvas.removeEventListener("mouseleave",_.onMouseleave,!0),v.canvas.removeEventListener("drop",_.onDrop,!0),v.canvas.removeEventListener("dragover",_.onDragover,!0),v.canvas.width=v.canvas.height=1,_.windows=null,_.active=null},u:function(e,n){_.hints[e]=n}},R=(function(){var n={a:Be};function t(e,n){var e=e.exports;v.asm=e,Z((N=v.asm.Ba).buffer),ee=v.asm.Ra,e=v.asm.Ca,te.unshift(e),y--,v.monitorRunDependencies&&v.monitorRunDependencies(y),0==y&&(null!==ue&&(clearInterval(ue),ue=null),B&&(e=B,B=null,e()))}function r(e){t(e.instance)}function a(e){return(i||!G&&!o||"function"!=typeof fetch?Promise.resolve().then(function(){return ce(k)}):fetch(k,{credentials:"same-origin"}).then(function(e){if(e.ok)return e.arrayBuffer();throw"failed to load wasm binary file at '"+k+"'"}).catch(function(){return ce(k)})).then(function(e){return WebAssembly.instantiate(e,n)}).then(function(e){return e}).then(e,function(e){l("failed to asynchronously prepare wasm: "+e),L(e)})}if(y++,v.monitorRunDependencies&&v.monitorRunDependencies(y),v.instantiateWasm)try{return v.instantiateWasm(n,t)}catch(e){return l("Module.instantiateWasm callback failed with error: "+e)}i||"function"!=typeof WebAssembly.instantiateStreaming||se(k)||"function"!=typeof fetch?a(r):fetch(k,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,n).then(r,function(e){return l("wasm streaming compile failed: "+e),l("falling back to ArrayBuffer instantiation"),a(r)})})}(),v.___wasm_call_ctors=function(){return(v.___wasm_call_ctors=v.asm.Ca).apply(null,arguments)},v._onTextureLoad=function(){return(v._onTextureLoad=v.asm.Da).apply(null,arguments)},v._textureWrite=function(){return(v._textureWrite=v.asm.Ea).apply(null,arguments)},v._onLoad=function(){return(v._onLoad=v.asm.Fa).apply(null,arguments)},v._free=function(){return(R=v._free=v.asm.Ga).apply(null,arguments)}),U=(v._start=function(){return(v._start=v.asm.Ha).apply(null,arguments)},v._key=function(){return(v._key=v.asm.Ia).apply(null,arguments)},v._update=function(){return(v._update=v.asm.Ja).apply(null,arguments)},v._render=function(){return(v._render=v.asm.Ka).apply(null,arguments)},v._pointDown=function(){return(v._pointDown=v.asm.La).apply(null,arguments)},v._pointDrag=function(){return(v._pointDrag=v.asm.Ma).apply(null,arguments)},v._pointUp=function(){return(v._pointUp=v.asm.Na).apply(null,arguments)},v._pointMove=function(){return(v._pointMove=v.asm.Oa).apply(null,arguments)},v._pointLeave=function(){return(v._pointLeave=v.asm.Pa).apply(null,arguments)},v._main=function(){return(v._main=v.asm.Qa).apply(null,arguments)},v._malloc=function(){return(U=v._malloc=v.asm.Sa).apply(null,arguments)}),Le=v.stackSave=function(){return(Le=v.stackSave=v.asm.Ta).apply(null,arguments)},ke=v.stackRestore=function(){return(ke=v.stackRestore=v.asm.Ua).apply(null,arguments)},Fe=v.stackAlloc=function(){return(Fe=v.stackAlloc=v.asm.Va).apply(null,arguments)};function Ee(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}v.ccall=O;v.cwrap=function(e,n,t,r){var a=(t=t||[]).every(function(e){return"number"===e});return"string"!==n&&a&&!r?j(e):function(){return O(e,n,t,arguments)}};function Ce(e){function n(){ye||(ye=!0,v.calledRun=!0,f||(a(te),a(re),v.onRuntimeInitialized&&v.onRuntimeInitialized(),Se&&function(){var e=v._main;try{var n=e(0,0);Ae(n)}catch(e){return fe(e)}finally{0}}(),ie()))}0<y||(oe(),0<y||(v.setStatus?(v.setStatus("Running..."),setTimeout(function(){setTimeout(function(){v.setStatus("")},1),n()},1)):n()))}function Ae(e){e=t=e;t=e,V||(v.onExit&&v.onExit(e),f=!0),z(e,new Ee(e))}if(B=function e(){ye||Ce(),ye||(B=e)},v.run=Ce,v.preInit)for("function"==typeof v.preInit&&(v.preInit=[v.preInit]);0<v.preInit.length;)v.preInit.pop()();var Se=!0;v.noInitialRun&&(Se=!1),Ce()}((g.module.exports,g.module.require,g.module),(g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["main"] = function(g) {
			!function(e,a){const m=a("@akashic-extension/akashic-hover-plugin");class u extends g.E{constructor(e,a,t){super({scene:e,parent:e,width:a.width,height:a.height}),this.surface=a,this.game=t}renderSelf(e){this.game._render(),e.drawImage(this.surface,0,0,this.surface.width,this.surface.height,0,0)}}e.main=void 0,e.main=function(t){const n="undefined"!=typeof navigator&&(navigator.userAgent.includes("iPhone")||navigator.userAgent.includes("Android")),i=a("./wasm");var r=new g.Scene({game:g.game});let o=!(g.game.vars.sounds=[1]),s=!1;const d=g.game.resourceFactory.createSurface(g.game.width,g.game.height);function e(){g.game.vars.time<=0&&(t.isAtsumaru&&(window.RPGAtsumaru.experimental.scoreboards.setRecord(1,g.game.vars.gameState.score).then(function(){window.RPGAtsumaru.experimental.scoreboards.display(1)}),g.game.terminateGame()),r.onUpdate.remove(e)),g.game.vars.time-=1/g.game.fps}i.preRun=()=>{i.canvas=d._drawable,i.fontlib=[],i.fonthandle=0,i.canvaslib=[],i.lineCap=["butt","round","square"],i.lineJoin=["bevel","round","miter"]},i.postRun=()=>{if(!s&&i?.calledRun&&o){s=!0;var e=m.Converter.asHoverable(new u(r,d,i)),e=(e.onPointDown.add(e=>{i._pointDown(e.pointerId,e.point.x,e.point.y)}),e.onPointMove.add(e=>{i._pointDrag(e.pointerId,e.point.x+e.startDelta.x,e.point.y+e.startDelta.y)}),e.onPointUp.add(e=>{i._pointUp(e.pointerId,e.point.x+e.startDelta.x,e.point.y+e.startDelta.y)}),e.hovered.add(e=>{i._pointMove(e.x,e.y)}),e.unhovered.add(()=>{i._pointLeave()}),r.onUpdate.add(()=>{i._update(),g.game.modified()}),g.game.renderers[0].surface.canvas);e.tabIndex=-1,e.focus();const a=i.cwrap("key","boolean",["string"]);window.addEventListener("keydown",e=>{!g.game.isSkipping&&a(e.key,!0,e.repeat)&&e.preventDefault()}),window.addEventListener("keyup",e=>{a(e.key,!1)&&e.preventDefault()}),i._start(t.randomSeed,t.isAtsumaru,n)}},o=!0,t.isAtsumaru&&(r.setTimeout(()=>{},6e5),window.RPGAtsumaru.popups.setThanksSettings({autoThanks:!1})),g.game.vars.time=120,t.sessionParameter.totalTimeLimit&&(g.game.vars.time=t.sessionParameter.totalTimeLimit),g.game.vars.gameState={score:0},r.onUpdate.add(e),g.game.pushScene(r)}}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["a_e_z_0"] = function(g) {
			!function(e){"use strict";function r(){}Object.defineProperty(e,"__esModule",{value:!0}),r.asHoverable=function(e,r){return e.hoverable=!0,e.touchable=!0,e.hovered=e.hovered||new g.Trigger,e.unhovered=e.unhovered||new g.Trigger,r&&r.cursor&&(e.cursor=r.cursor),e},r.asUnhoverable=function(e){return delete e.hoverable,e.hovered&&!e.hovered.destroyed()&&(e.hovered.destroy(),delete e.hovered),e.unhovered&&!e.unhovered.destroyed()&&(e.unhovered.fire(),e.unhovered.destroy(),delete e.unhovered),e},e.Converter=r}(g.module.exports,(g.module.require,g.module,g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["a_e_z_1"] = function(g) {
			!function(e,o){"use strict";function t(e,o,t){void 0===t&&(t={}),this.game=e,this.view=o.view,this.beforeHover=null,this.operationTrigger=new g.Trigger,this._cursor=t.cursor||"pointer",this._showTooltip=!!t.showTooltip,this._getScale=o.getScale?function(){return o.getScale()}:null,this._onMouseMove_bound=this._onMouseMove.bind(this),this._onMouseOut_bound=this._onMouseOut.bind(this)}Object.defineProperty(e,"__esModule",{value:!0}),t.isSupported=function(){return"undefined"!=typeof document&&"function"==typeof document.addEventListener},t.prototype.start=function(){return this.view.addEventListener("mousemove",this._onMouseMove_bound,!1),this.view.addEventListener("mouseout",this._onMouseOut_bound,!1),!0},t.prototype.stop=function(){this.view.removeEventListener("mousemove",this._onMouseMove_bound,!1),this.view.removeEventListener("mouseout",this._onMouseOut_bound,!1)},t.prototype._onMouseMove=function(e){var o,t,i=this.game.scene();i&&(t=(o=this.view.getBoundingClientRect()).left+window.pageXOffset,o=o.top+window.pageYOffset,t=e.pageX-t,e=e.pageY-o,o={x:1,y:1},t={x:t/(o=this._getScale?this._getScale():o).x,y:e/o.y},(e=i.findPointSourceByPoint(t).target)&&e.hoverable?(e!==this.beforeHover&&(this.beforeHover&&this.beforeHover.hoverable&&this._onUnhovered(e),this._onHovered(e)),this.beforeHover=e):this.beforeHover&&this._onUnhovered(this.beforeHover))},t.prototype._onHovered=function(e){e.hoverable&&(this.view.style.cursor=e.cursor||this._cursor,this._showTooltip&&e.title&&this.view.setAttribute("title",e.title),e.hovered.fire())},t.prototype._onUnhovered=function(e){this.view.style.cursor="auto",this.beforeHover&&this.beforeHover.unhovered&&(this.beforeHover.unhovered.fire(),this._showTooltip&&this.view.removeAttribute("title")),this.beforeHover=null},t.prototype._onMouseOut=function(){this.beforeHover&&this._onUnhovered(this.beforeHover)},o.exports=t}(g.module.exports,(g.module.require,g.module),(g.filename,g.dirname));
		};
	

	
		window.gLocalAssetContainer["a_e_z_2"] = function(g) {
			!function(e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=r("./Converter"),o=(e.Converter=o.Converter,r("./HoverPlugin"));e.HoverPlugin=o}(g.module.exports,g.module.require,(g.module,g.filename,g.dirname));
		};
	



</script>

<script>

	window.addEventListener("load",function(){var e,n="sandboxDummyPlayId",o=engineFiles.pdiBrowser,t=engineFiles.gameDriver,i=new t.MemoryAmflowClient({playId:n}),a=(!0!==window.__akashic__.autoSendEventName&&"string"!=typeof window.__akashic__.autoSendEventName||(e=window.__akashic__.sandboxConfigFunc(),!0===(a=window.__akashic__.autoSendEventName)&&(a=e.autoSendEventName||e.autoSendEvents),e&&a&&e.events&&e.events[a]&&e.events[a].forEach(function(e){i.sendEvent(e)})),e="file:"!==location.protocol?[o.WebAudioPlugin,o.HTMLAudioPlugin]:[o.HTMLAudioPlugin],document.getElementById("container")),r=new o.Platform({amflow:i,containerView:a,audioPlugins:e,disablePreventDefault:!0});function d(e){var n,o,t,i;r.containerController&&(n=window.innerWidth||document.documentElement.clientWidth,o=window.innerHeight||document.documentElement.clientHeight,i=Math.min(n/e.width,o/e.height),t=Math.floor(e.width*i),e=Math.floor(e.height*i),r.containerController.changeScale(i,i),i={x:Math.floor((n-t)/2),y:Math.floor((o-e)/2)},r.containerController.inputHandlerLayer.setOffset(i))}a.addEventListener("touchstart",function(e){e.preventDefault()}),r.loadGameConfiguration=function(e,n){try{var o=window.gLocalAssetContainer["game.json"],o=decodeURIComponent(o);n(null,JSON.parse(o))}catch(e){n(e,null)}},r._resourceFactory.createScriptAsset=function(e,n){return new LocalScriptAssetV3(e,n)},"undefined"!=typeof LocalTextAssetV3&&(r._resourceFactory.createTextAsset=function(e,n){return new LocalTextAssetV3(e,n)}),(driver=new t.GameDriver({platform:r,player:{id:"9999",name:"sandbox-player"},errorHandler:function(e){console.log("ERRORHANDLER:",e)}})).gameCreatedTrigger.add(function(e){window.optionProps.magnify&&(d(e),window.addEventListener("resize",function(){d(e)}))}),driver.initialize({configurationUrl:"game.json",assetBase:"./",driverConfiguration:{playId:n,playToken:"dummyToken",executionMode:t.ExecutionMode.Active},loopConfiguration:{loopMode:t.LoopMode.Realtime}},function(e){if(e)throw e;try{var n;"undefined"!=typeof window&&window.RPGAtsumaru&&(n=window.RPGAtsumaru.volume.getCurrentValue(),r.setMasterVolume(n),window.RPGAtsumaru.volume.changed.subscribe(function(e){r.setMasterVolume(e)}),window.RPGAtsumaru.screenshot.setScreenshotHandler(function(){var e=r.getPrimarySurface().canvas.toDataURL("image/png");return Promise.resolve(e)}))}catch(e){console.error(e)}driver.startGame()})});

	window.g=require("@akashic/akashic-engine"),"gLocalAssetContainer"in window||(window.gLocalAssetContainer={}),"__akashic__"in window||(window.__akashic__={});

	var LocalScriptAssetV3=function(){function t(t,o){this.type="script",this.id=t,this.originalPath=o,this.path=this._assetPathFilter(o),this.onDestroyed=new g.Trigger,this.func=window.gLocalAssetContainer[t]}return t.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},t.prototype.destroyed=function(){return void 0===this.id},t.prototype.inUse=function(){return!1},t.prototype.execute=function(t){return this.func(t),t.module.exports},t.prototype._load=function(t){var o=this;void 0!==this.func?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError("can not load script asset"))},0)},t.prototype._assetPathFilter=function(t){return t},t}();

</script>

<style type="text/css">
* {
	margin: 0;
	border: 0;
	padding: 0;
}

html {
	width: 100%;
	height: 100%;
}

body {
	overflow: hidden;
	width: 100%;
	height: 100%;
}

#container {
	margin: 0px;
	padding: 0px;
	overflow: hidden;
	touch-action: none;
	width: 100%;
	height: 100%;

	/* iOS: body */
	position: absolute;
}

#container canvas {
	background-size: contain;
}

</style>



</head>
<body>
<div id="container">
</div>
</body>
</html>
